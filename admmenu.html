<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXE.ADMIN // OVERLORD V3</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg: #050507;
            --panel: #0d0d12;
            --accent: #00f3ff;
            --danger: #ff0055;
            --warning: #ffcc00;
            --success: #00ff99;
            --border: rgba(0, 243, 255, 0.1);
        }

        body {
            background: var(--bg);
            color: #e0e6ed;
            margin: 0;
            font-family: 'Rajdhani', sans-serif;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* --- UI GLITCH & CRT --- */
        body::after {
            content: "";
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: repeating-linear-gradient(0deg, rgba(0,0,0,0.1), rgba(0,0,0,0.1) 1px, transparent 1px, transparent 2px);
            pointer-events: none; z-index: 999;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px; background: var(--panel);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 25px;
        }

        .brand {
            font-family: 'JetBrains Mono', monospace; font-size: 20px;
            color: var(--accent); margin-bottom: 40px; text-shadow: 0 0 10px var(--accent);
        }

        .nav-btn {
            background: none; border: none; color: #676e79;
            padding: 15px; text-align: left; font-size: 15px;
            cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px;
            border-radius: 4px; margin-bottom: 5px; font-weight: bold;
        }

        .nav-btn:hover, .nav-btn.active {
            color: var(--accent); background: rgba(0, 243, 255, 0.05);
            box-shadow: inset 3px 0 0 var(--accent);
        }

        /* --- CONTENT AREA --- */
        .main-view {
            flex: 1; padding: 40px; overflow-y: auto; position: relative;
        }

        .view-section { display: none; animation: slideUp 0.4s ease; }
        .view-section.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- CARDS --- */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .card {
            background: rgba(20, 20, 25, 0.8); border: 1px solid var(--border);
            padding: 25px; border-radius: 8px; position: relative;
        }

        .stat-num { font-family: 'JetBrains Mono'; font-size: 35px; color: #fff; }
        
        /* --- TABLE / LIST --- */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .data-table th { text-align: left; padding: 12px; color: var(--accent); border-bottom: 2px solid var(--border); }
        .data-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }

        /* --- INPUTS --- */
        .cyber-input {
            background: #000; border: 1px solid var(--border); padding: 12px;
            color: var(--accent); font-family: 'JetBrains Mono'; width: 100%; border-radius: 4px;
        }

        .btn {
            padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer;
            font-weight: bold; font-family: 'JetBrains Mono'; transition: 0.2s;
        }
        .btn-neon { background: var(--accent); color: #000; }
        .btn-danger { background: var(--danger); color: #fff; }

        /* --- CAPTCHA OVERLAY --- */
        #lockScreen {
            position: fixed; inset: 0; background: #050507; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="lockScreen">
    <div style="text-align: center;">
        <i class="fas fa-shield-virus" style="font-size: 50px; color: var(--danger); margin-bottom: 15px;"></i>
        <h2 style="letter-spacing: 5px;">SYSTEM ENCRYPTED</h2>
        <canvas id="capCanvas" width="250" height="80" style="background: #111; margin: 20px 0; border: 1px dashed var(--accent);"></canvas>
        <input type="text" id="capInput" class="cyber-input" placeholder="VERIFY PROTOCOL" style="text-align: center; width: 250px;" maxlength="5">
        <button class="btn btn-neon" style="width: 250px; margin-top: 15px;" onclick="verifyCaptcha()">INITIALIZE</button>
    </div>
</div>

<div class="sidebar">
    <div class="brand"><i class="fas fa-biohazard"></i> EXE.OVERLORD</div>
    <button class="nav-btn active" onclick="showView('dash')"><i class="fas fa-th-large"></i> DASHBOARD</button>
    <button class="nav-btn" onclick="showView('users')"><i class="fas fa-user-shield"></i> USER MANAGER</button>
    <button class="nav-btn" onclick="showView('songs')"><i class="fas fa-music"></i> SONG DATABASE</button>
    
    <div style="margin-top: auto;">
        <button class="btn btn-danger" style="width: 100%;" onclick="logout()">LOGOUT</button>
    </div>
</div>

<div class="main-view">
    <div id="view-dash" class="view-section active">
        <h1 style="margin-top:0">DASHBOARD_SUMMARY</h1>
        <div class="grid">
            <div class="card">
                <div style="color: var(--accent)">TOTAL_USERS</div>
                <div class="stat-num" id="stat-u">0</div>
            </div>
            <div class="card">
                <div style="color: var(--accent)">TOTAL_SONGS</div>
                <div class="stat-num" id="stat-s">0</div>
            </div>
            <div class="card" id="mt-card">
                <div style="color: var(--warning)">MAINTENANCE_STATUS</div>
                <div class="stat-num" id="stat-mt" style="font-size: 18px;">FETCHING...</div>
                <button class="btn btn-neon" style="font-size: 10px; width: 100%; margin-top: 10px;" onclick="toggleMT()">TOGGLE MT</button>
            </div>
        </div>

        <div class="card" style="margin-top: 20px;">
            <div style="color: var(--success); margin-bottom: 15px;">GLOBAL_ANNOUNCEMENT</div>
            <div style="display: flex; gap: 10px;">
                <input type="text" id="annInput" class="cyber-input" placeholder="Broadcast message...">
                <button class="btn btn-neon" onclick="saveAnn()">SEND</button>
                <button class="btn btn-danger" onclick="clearAnn()">CLEAR</button>
            </div>
        </div>

        <div class="card" style="margin-top: 20px; background: #000;">
            <div style="font-family: 'JetBrains Mono'; font-size: 12px; color: #555; margin-bottom: 10px;">SYSTEM_LOGS</div>
            <div id="logBox" style="height: 150px; overflow-y: auto; font-family: 'JetBrains Mono'; font-size: 11px; color: var(--success);"></div>
        </div>
    </div>

    <div id="view-users" class="view-section">
        <h1>USER_MANAGEMENT</h1>
        <input type="text" class="cyber-input" placeholder="Search user..." onkeyup="filterTabel('userTable', this.value)">
        <table class="data-table" id="userTable">
            <thead>
                <tr><th>USERNAME</th><th>ROLE</th><th>STATUS</th><th>ACTION</th></tr>
            </thead>
            <tbody id="userList"></tbody>
        </table>
    </div>

    <div id="view-songs" class="view-section">
        <h1>SONG_REPOSITORY</h1>
        <input type="text" class="cyber-input" placeholder="Search title/artist..." onkeyup="filterTabel('songTable', this.value)">
        <table class="data-table" id="songTable">
            <thead>
                <tr><th>TITLE</th><th>ARTIST</th><th>UPLOADER</th><th>ACTION</th></tr>
            </thead>
            <tbody id="songList"></tbody>
        </table>
    </div>
</div>

<script>
    // --- CONFIG --- (Sesuaikan dengan data kamu)
    const firebaseConfig = {
        apiKey: "AIzaSyCVJYSR4nHeoRA9WTMZa3-2xliKQRrd5g4",
        authDomain: "exemusic-execuriverp.firebaseapp.com",
        databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "exemusic-execuriverp",
        storageBucket: "exemusic-execuriverp.firebasestorage.app",
        messagingSenderId: "722057744401",
        appId: "1:722057744401:web:cd6a6a103692059bda61b0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    let capCode = "";
    let isMT = false;

    // --- CAPTCHA ---
    function genCap() {
        const c = document.getElementById('capCanvas');
        const ctx = c.getContext('2d');
        capCode = Math.random().toString(36).substring(2, 7).toUpperCase();
        ctx.fillStyle = "#111"; ctx.fillRect(0,0,250,80);
        ctx.font = "bold 35px 'JetBrains Mono'";
        ctx.fillStyle = "#00f3ff"; ctx.textAlign = "center";
        ctx.fillText(capCode, 125, 50);
        for(let i=0; i<5; i++) {
            ctx.strokeStyle = "rgba(255,0,85,0.5)"; ctx.beginPath();
            ctx.moveTo(Math.random()*250, Math.random()*80); ctx.lineTo(Math.random()*250, Math.random()*80);
            ctx.stroke();
        }
    }

    function verifyCaptcha() {
        if(document.getElementById('capInput').value.toUpperCase() === capCode) {
            document.getElementById('lockScreen').style.display = 'none';
        } else {
            Swal.fire('ERROR', 'Invalid Protocol Code', 'error'); genCap();
        }
    }

    // --- NAVIGATION ---
    function showView(id) {
        document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('view-'+id).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- CORE LOGIC ---
    auth.onAuthStateChanged(user => {
        if(user) {
            db.ref('users/' + user.uid).once('value', snap => {
                if(snap.val()?.role === 'admin') {
                    loadData();
                    genCap();
                } else { window.location.href = 'exemusic.html'; }
            });
        } else { window.location.href = 'exemusic.html'; }
    });

    function loadData() {
        // Users
        db.ref('users').on('value', snap => {
            const list = document.getElementById('userList');
            let html = ''; let count = 0;
            snap.forEach(c => {
                const u = c.val(); count++;
                html += `<tr>
                    <td>${u.username}</td>
                    <td>${u.role || 'user'}</td>
                    <td style="color:${u.banned ? 'red' : 'green'}">${u.banned ? 'BANNED' : 'ACTIVE'}</td>
                    <td><button onclick="toggleBan('${c.key}', ${u.banned})" class="btn" style="background:#222; color:#fff">${u.banned ? 'UNBAN' : 'BAN'}</button></td>
                </tr>`;
            });
            list.innerHTML = html;
            document.getElementById('stat-u').innerText = count;
        });

        // Songs
        db.ref('songs').on('value', snap => {
            const list = document.getElementById('songList');
            let html = ''; let count = 0;
            snap.forEach(c => {
                const s = c.val(); count++;
                html += `<tr>
                    <td>${s.title}</td>
                    <td>${s.by || '-'}</td>
                    <td>${s.uploadedBy || 'System'}</td>
                    <td><button onclick="delSong('${c.key}')" class="btn btn-danger"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
            list.innerHTML = html;
            document.getElementById('stat-s').innerText = count;
        });

        // MT Status
        db.ref('settings/mt').on('value', snap => {
            isMT = snap.val();
            const el = document.getElementById('stat-mt');
            el.innerText = isMT ? "ACTIVE" : "OFFLINE";
            el.style.color = isMT ? "var(--danger)" : "var(--success)";
        });

        // Ann
        db.ref('settings/announcement').on('value', snap => {
            document.getElementById('annInput').value = snap.val() || "";
        });

        // Logs
        db.ref('logs').limitToLast(20).on('value', snap => {
            const box = document.getElementById('logBox');
            let h = '';
            snap.forEach(c => { h += `<div>> ${c.val().time}: ${c.val().msg}</div>`; });
            box.innerHTML = h; box.scrollTop = box.scrollHeight;
        });
    }

    // --- ACTIONS ---
    function toggleMT() {
        db.ref('settings').update({ mt: !isMT });
        logIt(`Maintenance toggled to ${!isMT}`);
    }

    function saveAnn() {
        const val = document.getElementById('annInput').value;
        db.ref('settings').update({ announcement: val });
        logIt(`Ann updated: ${val}`);
        Swal.fire('SUCCESS', 'Broadcast sent', 'success');
    }

    function clearAnn() {
        db.ref('settings/announcement').remove();
        logIt(`Ann cleared`);
    }

    function toggleBan(uid, current) {
        db.ref('users/' + uid).update({ banned: !current });
        logIt(`User ${uid} status changed`);
    }

    function delSong(id) {
        if(confirm('Purge this song?')) {
            db.ref('songs/' + id).remove();
            logIt(`Song ${id} removed`);
        }
    }

    function logIt(msg) {
        db.ref('logs').push({ msg, time: new Date().toLocaleTimeString() });
    }

    function filterTabel(tableId, query) {
        const rows = document.querySelectorAll(`#${tableId} tbody tr`);
        rows.forEach(row => {
            row.style.display = row.innerText.toLowerCase().includes(query.toLowerCase()) ? '' : 'none';
        });
    }

    function logout() { auth.signOut(); }
</script>

</body>
</html>
