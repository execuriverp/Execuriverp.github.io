<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic v3.1 - Hyper Realtime</title>
  <link rel="icon" type="image/png" href="exemusicicon.png">
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --accent: #00ff88; 
      --text: #ffffff;
      --bg: #050505;
      --disco-color: #ff00ff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
      transition: background 0.5s ease;
    }

    /* --- REALISTIC EQ ANIMATION --- */
    .eq { display: flex; align-items: flex-end; gap: 5px; height: 70px; }
    .eq span { 
        width: 7px; 
        background: var(--accent); 
        border-radius: 10px; 
        height: 10px; 
        transition: background 0.5s ease;
    }

    /* Gerakan EQ Berbeda-beda (Realistik) */
    .playing span { animation: wave var(--d) infinite ease-in-out; }
    .eq span:nth-child(1) { --d: 0.8s; animation-delay: 0.1s; }
    .eq span:nth-child(2) { --d: 1.1s; animation-delay: 0.3s; }
    .eq span:nth-child(3) { --d: 0.9s; animation-delay: 0.0s; }
    .eq span:nth-child(4) { --d: 1.2s; animation-delay: 0.5s; }
    .eq span:nth-child(5) { --d: 1.0s; animation-delay: 0.2s; }

    /* EQ Saat Disco Mode (Lebih Cepat & Agresif) */
    .disco-active .playing span { 
        animation: discoWave var(--d) infinite ease-in-out; 
        background: var(--disco-color) !important;
    }
    .disco-active .eq span:nth-child(1) { --d: 0.3s; }
    .disco-active .eq span:nth-child(2) { --d: 0.4s; }
    .disco-active .eq span:nth-child(3) { --d: 0.35s; }
    .disco-active .eq span:nth-child(4) { --d: 0.45s; }
    .disco-active .eq span:nth-child(5) { --d: 0.32s; }

    @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 50px; } }
    @keyframes discoWave { 0%, 100% { height: 10px; } 50% { height: 80px; } }

    /* --- ROBLOX BROADCAST UI --- */
    .sys-broadcast {
        position: fixed; top: -150px; left: 50%; transform: translateX(-50%);
        width: 90%; max-width: 400px; background: rgba(15, 15, 15, 0.95);
        border-left: 4px solid var(--accent); border-radius: 8px; padding: 15px;
        z-index: 10000; transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(15px); box-shadow: 0 10px 40px rgba(0,0,0,0.5);
    }
    .sys-broadcast.active { top: 20px; }
    .sb-bar { width: 100%; height: 3px; background: var(--accent); margin-top: 10px; transform-origin: left; }

    /* --- APP LAYOUT --- */
    .app {
      background: rgba(20, 20, 20, 0.7);
      backdrop-filter: blur(30px);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 40px; width: 95%; max-width: 400px; height: 90vh;
      display: flex; flex-direction: column; padding: 30px; position: relative;
    }

    body.disco-active { animation: bgDisco 2s infinite alternate; }
    @keyframes bgDisco { from { background: #050505; } to { background: #1a002b; } }

    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .header img { width: 100px; }
    #loginBtn { background: var(--accent); color: black; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; cursor: pointer; }

    .cover { flex: 1; background: #000; border-radius: 25px; display: flex; align-items: center; justify-content: center; margin-bottom: 20px; border: 1px solid #222; }

    .track-info h2 { font-size: 22px; margin-bottom: 5px; }
    .track-info p { color: var(--accent); font-weight: bold; cursor: pointer; }

    .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
    .play-btn { width: 70px; height: 70px; background: var(--accent); border-radius: 50%; border: none; font-size: 24px; cursor: pointer; }

    /* MODAL STYLE */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 9999; align-items: center; justify-content: center; }
    .modal-content { background: #111; width: 90%; max-width: 350px; padding: 30px; border-radius: 20px; border: 1px solid #333; }
    
    #toast { position: fixed; bottom: 50px; background: var(--accent); color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; display: none; z-index: 10001; }
  </style>
</head>
<body id="mainBody">

  <div id="sysBroadcast" class="sys-broadcast">
    <div style="display:flex; gap:15px; align-items:center">
      <i class="fas fa-bullhorn" style="color:var(--accent)"></i>
      <div>
        <h4 style="font-size:12px; color:var(--accent)">SISTEM BROADCAST</h4>
        <p id="sbMsg" style="font-size:13px">Memuat pesan...</p>
      </div>
    </div>
    <div id="sbBar" class="sb-bar"></div>
  </div>

  <div id="toast"></div>

  <div class="app">
    <div class="header">
      <img src="exemusic.png" alt="Logo">
      <button id="loginBtn" onclick="openProfile()">LOGIN</button>
    </div>

    <div class="cover">
      <div class="eq" id="eq">
        <span></span><span></span><span></span><span></span><span></span>
      </div>
    </div>

    <div class="track-info">
      <h2 id="title">Memuat Musik...</h2>
      <p id="artist" onclick="openAbout()">@system</p>
    </div>

    <div style="margin-top:20px">
      <input type="range" id="seek" style="width:100%; accent-color:var(--accent)" value="0">
      <div style="display:flex; justify-content:space-between; font-size:10px; margin-top:5px">
        <span id="cur">0:00</span>
        <span id="dur">0:00</span>
      </div>
    </div>

    <div class="controls">
      <button style="background:none; border:none; color:white; font-size:25px" onclick="prev()"><i class="fas fa-backward"></i></button>
      <button class="play-btn" id="playBtn" onclick="toggle()"><i class="fas fa-play"></i></button>
      <button style="background:none; border:none; color:white; font-size:25px" onclick="next()"><i class="fas fa-forward"></i></button>
    </div>
  </div>

  <div class="modal" id="modalAbout" onclick="this.style.display='none'">
    <div class="modal-content">
      <h3 style="color:var(--accent); margin-bottom:15px">Tentang ExeMusic</h3>
      <div style="font-size:13px; line-height:1.6; color:#ccc">
        <p><b>Realtime Tech:</b> Menggunakan Firebase RTDB untuk sinkronisasi tanpa delay.</p>
        <p><b>Disco Mode:</b> Fitur visual party yang dikontrol admin.</p>
        <p><b>Reward:</b> Dapatkan $1 (17rb) setiap pencapaian tertentu. Hubungi admin untuk klaim.</p>
        <p><b>Verified:</b> Otomatis centang biru pada 50 followers.</p>
      </div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCVJYSR4nHeoRA9WTMZa3-2xliKQRrd5g4",
      authDomain: "exemusic-execuriverp.firebaseapp.com",
      databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "exemusic-execuriverp",
      storageBucket: "exemusic-execuriverp.firebasestorage.app",
      messagingSenderId: "722057744401",
      appId: "1:722057744401:web:cd6a6a103692059bda61b0"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const audio = new Audio();
    let songs = [], i = 0, isDisco = false;

    // --- INSTANT REALTIME SETTINGS ---
    db.ref('settings').on('value', (s) => {
      const data = s.val();
      if(!data) return;

      // Realtime Announcement
      if(data.announcement) {
        showBroadcast(data.announcement);
      }

      // Realtime Disco Mode
      if(data.discoMode !== isDisco) {
        isDisco = data.discoMode;
        if(isDisco) {
          document.getElementById('mainBody').classList.add('disco-active');
          showBroadcast("DISCO MODE TELAH DIMULAI! âœ¨");
        } else {
          document.getElementById('mainBody').classList.remove('disco-active');
        }
      }
    });

    function showBroadcast(msg) {
      const b = document.getElementById('sysBroadcast');
      document.getElementById('sbMsg').innerText = msg;
      b.classList.add('active');
      document.getElementById('sbBar').style.transition = 'none';
      document.getElementById('sbBar').style.transform = 'scaleX(1)';
      setTimeout(() => {
        document.getElementById('sbBar').style.transition = 'transform 8s linear';
        document.getElementById('sbBar').style.transform = 'scaleX(0)';
      }, 100);
      setTimeout(() => b.classList.remove('active'), 8000);
    }

    // --- LOAD SONGS ---
    db.ref('songs').on('value', (s) => {
      const val = s.val();
      if(val) {
        songs = Object.keys(val).map(k => val[k]);
        if(!audio.src) loadTrack(0);
      }
    });

    function loadTrack(idx) {
      i = idx;
      audio.src = songs[i].url;
      document.getElementById('title').innerText = songs[i].title;
      document.getElementById('artist').innerText = "@" + songs[i].by;
    }

    function toggle() {
      if(audio.paused) {
        audio.play();
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
        document.getElementById('eq').classList.add('playing');
      } else {
        audio.pause();
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
        document.getElementById('eq').classList.remove('playing');
      }
    }

    function next() { i = (i + 1) % songs.length; loadTrack(i); audio.play(); }
    function prev() { i = (i - 1 + songs.length) % songs.length; loadTrack(i); audio.play(); }

    audio.ontimeupdate = () => {
      const p = (audio.currentTime / audio.duration) * 100;
      document.getElementById('seek').value = p || 0;
      document.getElementById('cur').innerText = formatTime(audio.currentTime);
      document.getElementById('dur').innerText = formatTime(audio.duration);
    };

    function formatTime(sec) {
      if(isNaN(sec)) return "0:00";
      let m = Math.floor(sec/60), s = Math.floor(sec%60);
      return m + ":" + (s < 10 ? "0"+s : s);
    }

    function openAbout() { document.getElementById('modalAbout').style.display = 'flex'; }

  </script>
</body>
</html>
