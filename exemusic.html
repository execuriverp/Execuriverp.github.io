<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>ExeMusic</title>

<!-- FAVICON -->
<link rel="icon" type="image/png" href="exemusicicon.png">

<style>
:root{
  --accent:#1db954;
  --accent2:#1ed760;
  --text:#fff;
  --muted:#b3b3b3;
  --card:#181818;
  --card2:#282828;
  --bg:#121212;
}

/* RESET */
*{box-sizing:border-box;font-family:'Circular',system-ui,-apple-system,sans-serif}
html,body{
  margin:0;width:100%;height:100%;
  background:#000;color:#fff;overflow:hidden;
  -webkit-font-smoothing:antialiased;
}

/* BG */
.bg{
  position:fixed;inset:0;
  background:
    linear-gradient(180deg,rgba(29,185,84,0.15) 0%,rgba(0,0,0,0.95) 40%,#000 100%),
    radial-gradient(circle at 50% 0%,rgba(29,185,84,0.2),transparent 70%);
}

/* APP */
.app{
  position:relative;z-index:1;
  height:100dvh;max-width:420px;
  margin:auto;padding:20px 16px 16px;
  display:flex;flex-direction:column;gap:8px;
}

/* HEADER */
.header{
  display:flex;
  align-items:center;
  justify-content:center;
  padding:8px 0 4px;
}
.header img{
  width:200px;
  max-width:85vw;
  height:auto;
  object-fit:contain;
  filter:drop-shadow(0 4px 12px rgba(29,185,84,.4));
}

/* VERSION */
.version{
  text-align:center;
  font-size:10px;
  color:var(--muted);
  margin-top:-2px;
  margin-bottom:8px;
  opacity:0.7;
  letter-spacing:0.5px;
}

/* COVER */
.cover{
  height:32dvh;
  border-radius:8px;
  background:linear-gradient(135deg,var(--accent) 0%,var(--accent2) 100%);
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 8px 24px rgba(0,0,0,.5);
  margin-bottom:12px;
  position:relative;
  overflow:hidden;
}
.cover::before{
  content:'';
  position:absolute;
  inset:0;
  background:radial-gradient(circle at 30% 30%,rgba(255,255,255,.15),transparent 60%);
}
.eq{display:flex;gap:5px;height:50px;align-items:flex-end;position:relative;z-index:1}
.eq span{
  width:5px;background:rgba(0,0,0,.8);border-radius:3px;
  animation:eq .8s infinite ease-in-out paused;
}
.eq span:nth-child(1){animation-delay:0s;height:20px}
.eq span:nth-child(2){animation-delay:.15s;height:30px}
.eq span:nth-child(3){animation-delay:.3s;height:25px}
@keyframes eq{0%,100%{transform:scaleY(0.3)}50%{transform:scaleY(1)}}

/* META */
.title{
  text-align:center;
  font-size:22px;
  font-weight:700;
  margin:8px 0 4px;
  line-height:1.2;
  letter-spacing:-0.3px;
}
.by{
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin-bottom:12px;
  font-weight:400;
}

/* URL + COPY */
.url-wrap{
  display:flex;gap:8px;justify-content:center;align-items:center;
  padding:8px 12px;
  background:rgba(255,255,255,.05);
  border-radius:6px;
  margin-bottom:8px;
}
.url{
  font-size:10px;
  color:#8ab4f8;
  word-break:break-all;
  max-width:85%;
  font-family:monospace;
}
.copy-btn{
  cursor:pointer;
  font-size:16px;
  opacity:0.7;
  transition:opacity .2s,transform .1s;
  user-select:none;
}
.copy-btn:hover{opacity:1}
.copy-btn:active{transform:scale(0.9)}

/* PROGRESS */
.progress{
  display:flex;gap:10px;align-items:center;
  font-size:11px;
  color:var(--muted);
  margin:8px 0;
}
.progress span{
  min-width:36px;
  font-variant-numeric:tabular-nums;
  font-family:monospace;
}
.progress input{
  flex:1;
  height:4px;
  -webkit-appearance:none;
  background:rgba(255,255,255,.2);
  border-radius:2px;
  outline:none;
  cursor:pointer;
}
.progress input::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:12px;height:12px;
  background:#fff;
  border-radius:50%;
  cursor:pointer;
  opacity:0;
  transition:opacity .2s;
}
.progress input:hover::-webkit-slider-thumb{opacity:1}
.progress input::-moz-range-thumb{
  width:12px;height:12px;
  background:#fff;
  border:none;
  border-radius:50%;
  cursor:pointer;
}
.progress input::-webkit-slider-runnable-track{
  height:4px;
  background:linear-gradient(to right,var(--accent) 0%,var(--accent) var(--seek-progress,0%),rgba(255,255,255,.2) var(--seek-progress,0%));
  border-radius:2px;
}

/* CONTROLS */
.controls{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:20px;
  margin:16px 0;
}
.controls span{
  cursor:pointer;
  font-size:24px;
  opacity:0.7;
  transition:opacity .2s,transform .1s;
  user-select:none;
  display:flex;
  align-items:center;
  justify-content:center;
  width:40px;
  height:40px;
}
.controls span:hover{opacity:1}
.controls span:active{transform:scale(0.95)}
.play{
  width:56px;
  height:56px;
  border-radius:50%;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:22px;
  color:#000;
  cursor:pointer;
  transition:transform .1s,box-shadow .2s;
  box-shadow:0 4px 12px rgba(0,0,0,.3);
  user-select:none;
}
.play:hover{
  transform:scale(1.06);
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}
.play:active{transform:scale(1)}

/* VOLUME */
.volume{
  display:flex;gap:12px;
  font-size:14px;
  color:var(--muted);
  align-items:center;
  margin:8px 0 16px;
}
.volume span{opacity:0.7}
.volume input{
  flex:1;
  height:4px;
  -webkit-appearance:none;
  background:rgba(255,255,255,.2);
  border-radius:2px;
  outline:none;
  cursor:pointer;
}
.volume input::-webkit-slider-thumb{
  -webkit-appearance:none;
  width:12px;height:12px;
  background:#fff;
  border-radius:50%;
  cursor:pointer;
  opacity:0;
  transition:opacity .2s;
}
.volume input:hover::-webkit-slider-thumb{opacity:1}
.volume input::-moz-range-thumb{
  width:12px;height:12px;
  background:#fff;
  border:none;
  border-radius:50%;
  cursor:pointer;
}

/* ACTIONS */
.actions{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:8px;
  margin-top:4px;
}
.actions button{
  background:rgba(255,255,255,.07);
  border:1px solid rgba(255,255,255,.1);
  color:#fff;
  padding:12px;
  border-radius:8px;
  font-weight:700;
  font-size:18px;
  cursor:pointer;
  transition:all .2s;
  opacity:0.7;
}
.actions button:hover{
  background:rgba(255,255,255,.12);
  opacity:1;
}
.actions button:active{transform:scale(0.96)}
.actions button.active{
  background:var(--accent);
  border-color:var(--accent);
  color:#000;
  opacity:1;
}

/* POPUP */
.popup{
  position:fixed;inset:0;
  background:rgba(0,0,0,.75);
  backdrop-filter:blur(4px);
  display:none;
  z-index:20;
  animation:fadeIn .2s;
}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}

/* SHEET */
.sheet{
  position:absolute;bottom:0;left:50%;
  transform:translateX(-50%);
  width:100%;max-width:420px;
  max-height:70dvh;
  background:var(--bg);
  border-radius:12px 12px 0 0;
  padding:20px 16px;
  overflow-y:auto;
  animation:slideUp .3s;
  box-shadow:0 -4px 24px rgba(0,0,0,.5);
}
@keyframes slideUp{from{transform:translate(-50%,100%)}to{transform:translate(-50%,0)}}

/* CLOSE */
.close{
  position:absolute;top:16px;right:20px;
  font-size:24px;
  cursor:pointer;
  color:#b3b3b3;
  transition:color .2s;
  user-select:none;
  z-index:1;
}
.close:hover{color:#fff}

/* FORM */
.form h3{
  text-align:center;
  margin:0 0 20px;
  font-size:20px;
  font-weight:700;
}
.form input{
  width:100%;
  padding:14px 16px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.07);
  color:#fff;
  margin-bottom:12px;
  font-size:14px;
  transition:border-color .2s,background .2s;
}
.form input:focus{
  outline:none;
  border-color:var(--accent);
  background:rgba(255,255,255,.1);
}
.form input::placeholder{color:var(--muted)}
.form button{
  width:100%;
  padding:16px;
  border:none;
  border-radius:24px;
  font-weight:700;
  font-size:15px;
  background:var(--accent);
  color:#000;
  cursor:pointer;
  transition:transform .1s,background .2s;
  margin-top:8px;
}
.form button:hover{background:var(--accent2)}
.form button:active{transform:scale(0.98)}

/* SONG CARD */
.song{
  display:flex;
  align-items:center;
  gap:12px;
  background:rgba(255,255,255,.05);
  border-radius:6px;
  padding:8px 12px;
  margin-bottom:6px;
  cursor:pointer;
  transition:background .2s;
}
.song:hover{background:rgba(255,255,255,.1)}
.thumb{
  width:48px;
  height:48px;
  border-radius:4px;
  background:linear-gradient(135deg,var(--card),var(--card2));
  flex-shrink:0;
}
.song-meta{
  flex:1;
  min-width:0;
  cursor:pointer;
}
.song-title{
  font-size:14px;
  font-weight:600;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  margin-bottom:2px;
}
.song-by{
  font-size:12px;
  color:var(--muted);
}
.song-dur{
  font-size:12px;
  color:var(--muted);
  margin-right:8px;
  font-variant-numeric:tabular-nums;
}
.fav-btn{
  cursor:pointer;
  font-size:20px;
  opacity:0.5;
  transition:opacity .2s,transform .1s;
  user-select:none;
}
.fav-btn:hover{opacity:0.8}
.fav-btn.active{
  color:var(--accent);
  opacity:1;
}
.fav-btn:active{transform:scale(0.9)}

/* SCROLLBAR */
.sheet::-webkit-scrollbar{width:8px}
.sheet::-webkit-scrollbar-track{background:transparent}
.sheet::-webkit-scrollbar-thumb{background:rgba(255,255,255,.2);border-radius:4px}
.sheet::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.3)}
</style>
</head>

<body>

<div class="bg"></div>

<div class="app">
  <div class="header">
    <img src="exemusic.png" alt="ExeMusic Logo">
  </div>
  <div class="version">v1.0.1</div>

  <div class="cover">
    <div class="eq"><span></span><span></span><span></span></div>
  </div>

  <div class="title" id="title">Loading‚Ä¶</div>
  <div class="by" id="by"></div>

  <div class="url-wrap">
    <div class="url" id="url"></div>
    <div class="copy-btn" onclick="copyURL()" title="Copy URL">üìã</div>
  </div>

  <div class="progress">
    <span id="cur">0:00</span>
    <input type="range" id="seek" min="0" max="100" value="0">
    <span id="dur">0:00</span>
  </div>

  <div class="controls">
    <span onclick="prev()" title="Previous">‚èÆ</span>
    <div class="play" id="play" onclick="toggle()" title="Play/Pause">‚ñ∂</div>
    <span onclick="next()" title="Next">‚è≠</span>
  </div>

  <div class="volume">
    <span id="volIcon">üîä</span>
    <input type="range" id="vol" min="0" max="1" step="0.01" value="0.6">
  </div>

  <div class="actions">
    <button onclick="toggleRepeat()" id="rep" title="Repeat">üîÅ</button>
    <button onclick="openList(false)" title="All Songs">‚ò∞</button>
    <button onclick="openList(true)" title="Favorites">‚òÖ</button>
    <button onclick="openReq()" title="Request Song">‚ûï</button>
  </div>
</div>

<!-- POPUP LIST -->
<div class="popup" id="popup">
  <div class="sheet" id="sheet"></div>
</div>

<!-- POPUP REQUEST -->
<div class="popup" id="reqPopup">
  <div class="sheet">
    <div class="close" onclick="closeReq()">‚úï</div>
    <div class="form">
      <h3>Add Your Owned Music Request</h3>
      <input id="rNama" placeholder="Nama" autocomplete="off">
      <input id="rUrl" placeholder="URL" autocomplete="off">
      <input id="rLagu" placeholder="Nama Lagu" autocomplete="off">
      <button onclick="sendReq()">Kirim ke WhatsApp</button>
    </div>
  </div>
</div>

<script>
let songs=[],i=0,repeat=false;
let fav=JSON.parse(localStorage.getItem("exeFav")||"[]");
const audio=new Audio();
const eq=document.querySelectorAll(".eq span");

/* LOAD DATA */
fetch("data/urlbb.json").then(r=>r.json()).then(d=>{
  songs=d;
  preloadDurations();
  if(songs.length>0)load(0);
}).catch(err=>{
  title.textContent="Error loading songs";
  by.textContent="Check console for details";
  console.error(err);
});

function preloadDurations(){
  songs.forEach((s,idx)=>{
    const a=new Audio();
    a.src=s.url;
    a.onloadedmetadata=()=>songs[idx].duration=format(a.duration);
  });
}

function load(n){
  if(!songs[n])return;
  i=n;
  audio.src=songs[n].url;
  title.textContent=songs[n].title;
  by.textContent="request by "+songs[n].by;
  url.textContent=songs[n].url;
  audio.play();
  play.textContent="‚ùö‚ùö";
  eq.forEach(e=>e.style.animationPlayState="running");
}

function toggle(){
  if(audio.paused){
    audio.play();
    play.textContent="‚ùö‚ùö";
    eq.forEach(e=>e.style.animationPlayState="running");
  }else{
    audio.pause();
    play.textContent="‚ñ∂";
    eq.forEach(e=>e.style.animationPlayState="paused");
  }
}

function prev(){
  if(songs.length>0)load((i-1+songs.length)%songs.length);
}

function next(){
  if(songs.length>0)load((i+1)%songs.length);
}

audio.onloadedmetadata=()=>{
  seek.max=audio.duration;
  dur.textContent=format(audio.duration);
};

audio.ontimeupdate=()=>{
  seek.value=audio.currentTime;
  cur.textContent=format(audio.currentTime);
  // Update progress bar visual
  const progress=(audio.currentTime/audio.duration)*100||0;
  seek.style.setProperty('--seek-progress',progress+'%');
};

seek.oninput=()=>audio.currentTime=seek.value;

vol.oninput=e=>{
  audio.volume=e.target.value;
  volIcon.textContent=e.target.value==0?"üîá":e.target.value<0.6?"üîâ":"üîä";
};

function toggleRepeat(){
  repeat=!repeat;
  rep.classList.toggle("active",repeat);
}

audio.onended=()=>repeat?audio.play():next();

function copyURL(){
  const t=url.textContent;
  if(navigator.clipboard){
    navigator.clipboard.writeText(t).then(()=>{
      const orig=document.querySelector('.copy-btn').textContent;
      document.querySelector('.copy-btn').textContent='‚úì';
      setTimeout(()=>document.querySelector('.copy-btn').textContent=orig,1000);
    });
  }else{
    const a=document.createElement("textarea");
    a.value=t;
    document.body.appendChild(a);
    a.select();
    document.execCommand("copy");
    document.body.removeChild(a);
  }
}

function openList(favOnly){
  popup.style.display="block";
  sheet.innerHTML='<div class="close" onclick="popup.style.display=\'none\'">‚úï</div>';
  
  const filteredSongs=favOnly?songs.filter(s=>fav.includes(s.url)):songs;
  
  if(filteredSongs.length===0){
    sheet.innerHTML+='<p style="text-align:center;color:var(--muted);margin-top:40px;">Belum ada lagu favorit</p>';
    return;
  }
  
  filteredSongs.forEach((s,n)=>{
    const actualIndex=songs.indexOf(s);
    sheet.innerHTML+=`
    <div class="song">
      <div class="thumb"></div>
      <div class="song-meta" onclick="load(${actualIndex});popup.style.display='none'">
        <div class="song-title">${s.title}</div>
        <div class="song-by">${s.by}</div>
      </div>
      <div class="song-dur">${s.duration||"0:00"}</div>
      <div class="fav-btn ${fav.includes(s.url)?"active":""}"
           onclick="toggleFav('${s.url}',event)">‚òÖ</div>
    </div>`;
  });
}

function toggleFav(u,e){
  e.stopPropagation();
  fav=fav.includes(u)?fav.filter(x=>x!==u):[...fav,u];
  localStorage.setItem("exeFav",JSON.stringify(fav));
  // Refresh the current list view
  const isFavView=document.querySelectorAll('.song').length<songs.length;
  openList(isFavView);
}

popup.onclick=e=>{if(e.target===popup)popup.style.display="none"};
reqPopup.onclick=e=>{if(e.target===reqPopup)closeReq()};

function openReq(){reqPopup.style.display="block"}
function closeReq(){
  reqPopup.style.display="none";
  rNama.value='';
  rUrl.value='';
  rLagu.value='';
}

function sendReq(){
  if(!rNama.value||!rUrl.value||!rLagu.value){
    alert('Mohon isi semua field');
    return;
  }
  const text=`Format Req Lagu

Nama : ${rNama.value}
Url : ${rUrl.value}
Nama Lagu : ${rLagu.value}`;
  window.open(
    "https://wa.me/62895329018240?text="+encodeURIComponent(text),
    "_blank"
  );
  closeReq();
}

function format(t){
  if(isNaN(t))return"0:00";
  return Math.floor(t/60)+":"+String(Math.floor(t%60)).padStart(2,"0");
}
</script>

</body>
</html>
