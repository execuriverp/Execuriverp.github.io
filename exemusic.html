<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic v3.0 - Premium Edition</title>
  <link rel="icon" type="image/png" href="exemusicicon.png">
  
  <style>
    /* CSS MODERN TANPA MERUBAH LOGIKA */
    :root {
      --accent: #1db954;
      --accent-hover: #1ed760;
      --text: #fff;
      --text-secondary: #b3b3b3;
      --bg: #000;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      background-image: radial-gradient(circle at top left, rgba(29, 185, 84, 0.15), transparent 40%);
      color: var(--text);
      height: 100vh; overflow: hidden;
    }

    /* CONTAINER UTAMA */
    .app {
      max-width: 420px; margin: 0 auto; height: 100dvh;
      padding: 20px; display: flex; flex-direction: column;
      position: relative; z-index: 1;
    }

    .header { text-align: center; margin-bottom: 5px; }
    .header img { width: 130px; filter: drop-shadow(0 4px 10px rgba(29,185,84,0.3)); }

    .version {
      text-align: center; font-size: 10px; color: var(--accent);
      background: rgba(29, 185, 84, 0.1); padding: 4px 12px;
      border-radius: 20px; width: fit-content; margin: 0 auto 10px;
    }

    /* VISUALIZER COVER */
    .cover {
      width: 100%; aspect-ratio: 1; border-radius: 30px;
      background: linear-gradient(145deg, #1e1e1e, #121212);
      display: flex; align-items: center; justify-content: center;
      margin: 10px 0; border: 1px solid var(--border);
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    }

    .eq { display: flex; gap: 5px; align-items: flex-end; height: 60px; }
    .eq span { 
      width: 6px; background: var(--accent); border-radius: 3px; 
      height: 10px; transition: 0.2s;
      animation: eq 0.6s infinite ease-in-out paused;
    }

    /* INFO LAGU */
    .title { font-size: 22px; font-weight: 800; text-align: center; margin-top: 10px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .by { font-size: 14px; color: var(--text-secondary); text-align: center; margin-bottom: 15px; }

    /* PANEL FITUR (Logika Tetap Sama) */
    .url-wrap {
      display: flex; justify-content: space-between; align-items: center;
      background: var(--glass); padding: 12px 18px; border-radius: 20px;
      margin-bottom: 15px; border: 1px solid var(--border);
    }
    .url { display: none; } /* Tetap ada di DOM tapi sembunyi agar rapi */
    .url-actions { display: flex; width: 100%; justify-content: space-around; }
    .action-btn { font-size: 20px; cursor: pointer; opacity: 0.8; transition: 0.2s; }

    /* PROGRESS BAR */
    .progress { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .progress span { font-size: 11px; font-family: monospace; color: var(--text-secondary); min-width: 35px; }
    #seek { 
      flex: 1; accent-color: var(--accent); cursor: pointer; height: 5px; 
      --seek-progress: 0%;
      background: linear-gradient(to right, var(--accent) var(--seek-progress), #333 var(--seek-progress));
      border-radius: 10px; -webkit-appearance: none;
    }

    /* CONTROLS UTAMA */
    .controls { display: flex; justify-content: space-evenly; align-items: center; margin: 15px 0; }
    .controls button { background: none; border: none; color: #fff; font-size: 28px; cursor: pointer; }
    .play { 
      width: 70px; height: 70px; background: var(--accent); border-radius: 50%; 
      display: flex; align-items: center; justify-content: center; color: #000;
      font-size: 24px; box-shadow: 0 5px 20px rgba(29,185,84,0.4);
    }

    /* VOLUME */
    .volume { display: flex; align-items: center; gap: 10px; background: var(--glass); padding: 10px 15px; border-radius: 15px; }
    #vol { flex: 1; accent-color: var(--accent); cursor: pointer; }

    /* NAVIGASI BAWAH */
    .actions {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-top: 20px;
    }
    .actions button { 
      background: var(--glass); border: 1px solid var(--border); color: #fff; 
      padding: 12px; border-radius: 12px; cursor: pointer; font-size: 18px;
    }
    .actions button.active { background: var(--accent); color: #000; }

    /* MODAL LIST & REQUEST */
    .popup { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; }
    .sheet { 
      position: absolute; bottom: 0; width: 100%; max-width: 420px; left: 50%; transform: translateX(-50%);
      background: #121212; border-radius: 30px 30px 0 0; padding: 25px; max-height: 80vh; overflow-y: auto;
    }
    .song { 
      display: flex; align-items: center; gap: 12px; padding: 12px; 
      border-radius: 12px; background: rgba(255,255,255,0.03); margin-bottom: 8px;
    }
    .song.playing { border-left: 4px solid var(--accent); background: rgba(29,185,84,0.1); }
    .song-meta { flex: 1; }
    .song-title { font-weight: bold; font-size: 14px; }
    .song-by { font-size: 12px; color: var(--text-secondary); }

    /* TOAST & NOTIF */
    .toast {
      position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
      background: var(--accent); color: #000; padding: 8px 20px; border-radius: 20px;
      font-weight: bold; font-size: 12px; display: none; z-index: 2000;
    }
    .loading-screen { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; }
    .hidden { display: none !important; }

    @keyframes eq {
      0%, 100% { transform: scaleY(0.3); }
      50% { transform: scaleY(1); }
    }
  </style>
</head>
<body>

  <div class="loading-screen" id="loadingScreen">
    <div style="text-align:center">
      <div style="width:40px; height:40px; border:4px solid #1db954; border-top-color:transparent; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 10px"></div>
      <p>Memuat ExeMusic...</p>
    </div>
  </div>
  <style>@keyframes spin { to { transform: rotate(360deg); } }</style>

  <div class="app">
    <div class="header"><img src="exemusic.png" alt="Logo"></div>
    <div class="version">v3.0 Premium</div>

    <div class="cover">
      <div class="eq"><span></span><span></span><span></span><span></span><span></span></div>
    </div>

    <div class="title" id="title">Memuat Lagu...</div>
    <div class="by" id="by">Sistem sedang disiapkan</div>

    <div class="url-wrap">
      <div class="url" id="url"></div>
      <div class="url-actions">
        <div class="action-btn" onclick="copyURL()" id="copyBtn">üìã</div>
        <div class="action-btn" onclick="shareCurrentSong()" id="shareBtn">üîó</div>
        <div class="action-btn" onclick="downloadAudio()" id="downloadBtn">‚¨á</div>
      </div>
    </div>

    <div class="progress">
      <span id="cur">0:00</span>
      <input type="range" id="seek" min="0" max="100" value="0">
      <span id="dur">0:00</span>
    </div>

    <div class="controls">
      <button onclick="prev()">‚èÆ</button>
      <div class="play" id="play" onclick="toggle()">‚ñ∂</div>
      <button onclick="next()">‚è≠</button>
    </div>

    <div class="volume">
      <span id="volIcon">üîä</span>
      <input type="range" id="vol" min="0" max="1" step="0.01" value="0.6">
    </div>

    <div class="actions">
      <button onclick="toggleShuffle()" id="shuffle" class="active">üîÄ</button>
      <button onclick="toggleRepeat()" id="rep">üîÅ</button>
      <button onclick="openList(false)">‚ò∞</button>
      <button onclick="openList(true)">‚≠ê</button>
      <button onclick="openReq()">‚ûï</button>
    </div>
  </div>

  <div class="popup" id="popup">
    <div class="sheet" id="sheet"></div>
  </div>

  <div class="popup" id="reqPopup">
    <div class="sheet">
      <h3 style="margin-bottom:15px; text-align:center">Request Music</h3>
      <input id="rNama" placeholder="Nama" style="width:100%; padding:12px; margin-bottom:10px; background:#222; border:none; color:#fff; border-radius:8px">
      <input id="rUrl" placeholder="URL" style="width:100%; padding:12px; margin-bottom:10px; background:#222; border:none; color:#fff; border-radius:8px">
      <input id="rLagu" placeholder="Nama Lagu" style="width:100%; padding:12px; margin-bottom:15px; background:#222; border:none; color:#fff; border-radius:8px">
      <button onclick="sendReq()" style="width:100%; padding:14px; background:#1db954; border:none; border-radius:8px; font-weight:bold">KIRIM WA</button>
      <button onclick="closeReq()" style="width:100%; margin-top:10px; background:none; border:none; color:#ff4444">Batal</button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /* LOGIKA JAVASCRIPT 100% DIAMBIL DARI FILE V3.0 MILIKMU 
       TANPA MENGUBAH NAMA VARIABEL ATAU ALUR.
    */
    let songs = [], i = 0, repeat = false, shuffle = true, shuffledOrder = [];
    let fav = JSON.parse(localStorage.getItem("exeFav") || "[]");
    const audio = new Audio();
    const eq = document.querySelectorAll(".eq span");
    const shuffleBtn = document.getElementById('shuffle');

    // Load Data
    fetch("data/urlbb.json")
      .then(r => r.json())
      .then(d => {
        songs = d;
        if (songs.length > 0) {
          shuffledOrder = [...Array(songs.length).keys()].sort(() => Math.random() - 0.5);
          i = shuffledOrder[0];
          load(i, false);
        }
        document.getElementById('loadingScreen').classList.add('hidden');
      });

    function load(n, autoPlay = true) {
      if (!songs[n]) return;
      i = n;
      audio.src = songs[n].url;
      document.getElementById('title').textContent = songs[n].title;
      document.getElementById('by').textContent = "request by " + songs[n].by;
      document.getElementById('url').textContent = songs[n].url;
      
      if (autoPlay) {
        audio.play();
        document.getElementById('play').textContent = "‚ùö‚ùö";
        eq.forEach(e => e.style.animationPlayState = "running");
      } else {
        document.getElementById('play').textContent = "‚ñ∂";
        eq.forEach(e => e.style.animationPlayState = "paused");
      }
    }

    function toggle() {
      if (audio.paused) {
        audio.play();
        document.getElementById('play').textContent = "‚ùö‚ùö";
        eq.forEach(e => e.style.animationPlayState = "running");
        showToast('Playing');
      } else {
        audio.pause();
        document.getElementById('play').textContent = "‚ñ∂";
        eq.forEach(e => e.style.animationPlayState = "paused");
        showToast('Paused');
      }
    }

    // Fungsi Navigasi
    function next() {
      if (shuffle) {
        const currentPos = shuffledOrder.indexOf(i);
        load(shuffledOrder[(currentPos + 1) % shuffledOrder.length]);
      } else {
        load((i + 1) % songs.length);
      }
    }

    function prev() {
      load((i - 1 + songs.length) % songs.length);
    }

    // Progress & Volume
    audio.ontimeupdate = () => {
      const seek = document.getElementById('seek');
      seek.value = audio.currentTime;
      document.getElementById('cur').textContent = format(audio.currentTime);
      document.getElementById('dur').textContent = format(audio.duration);
      const progress = (audio.currentTime / audio.duration) * 100 || 0;
      seek.style.setProperty('--seek-progress', progress + '%');
    };

    audio.onloadedmetadata = () => { document.getElementById('seek').max = audio.duration; };
    document.getElementById('seek').oninput = () => audio.currentTime = document.getElementById('seek').value;
    
    document.getElementById('vol').oninput = e => {
      audio.volume = e.target.value;
      document.getElementById('volIcon').textContent = e.target.value == 0 ? "üîá" : e.target.value < 0.6 ? "üîâ" : "üîä";
    };

    // Fitur Extra
    function copyURL() {
      navigator.clipboard.writeText(songs[i].url);
      showToast('URL Copied!');
    }

    function downloadAudio() {
      const a = document.createElement("a");
      a.href = songs[i].url;
      a.download = songs[i].title + ".mp3";
      a.click();
      showToast('Downloading...');
    }

    function shareCurrentSong() {
      const text = `üéµ Check out: ${songs[i].title}\nLink: ${songs[i].url}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
    }

    function toggleShuffle() {
      shuffle = !shuffle;
      shuffleBtn.classList.toggle("active", shuffle);
      showToast(shuffle ? 'Shuffle ON' : 'Shuffle OFF');
    }

    function toggleRepeat() {
      repeat = !repeat;
      document.getElementById('rep').classList.toggle("active", repeat);
      showToast(repeat ? 'Repeat ON' : 'Repeat OFF');
    }

    audio.onended = () => repeat ? audio.play() : next();

    // Modal List
    function openList(favOnly) {
      const popup = document.getElementById('popup');
      const sheet = document.getElementById('sheet');
      popup.style.display = "block";
      
      const list = favOnly ? songs.filter(s => fav.includes(s.url)) : songs;
      sheet.innerHTML = `
        <div style="display:flex; justify-content:space-between; margin-bottom:15px">
          <h3>${favOnly ? 'Favorites' : 'All Songs'}</h3>
          <span onclick="document.getElementById('popup').style.display='none'" style="color:#ff4444; cursor:pointer">Tutup</span>
        </div>
        ${list.map(s => {
          const idx = songs.indexOf(s);
          return `
            <div class="song ${idx === i ? 'playing' : ''}" onclick="load(${idx}); document.getElementById('popup').style.display='none'">
              <div class="song-meta">
                <div class="song-title">${s.title}</div>
                <div class="song-by">${s.by}</div>
              </div>
              <span onclick="toggleFav('${s.url}', event)" style="color:${fav.includes(s.url) ? '#1db954' : '#444'}">‚≠ê</span>
            </div>
          `;
        }).join('')}
      `;
    }

    function toggleFav(u, e) {
      e.stopPropagation();
      fav = fav.includes(u) ? fav.filter(x => x !== u) : [...fav, u];
      localStorage.setItem("exeFav", JSON.stringify(fav));
      showToast('Favorite Updated');
      openList(false);
    }

    // Request
    function openReq() { document.getElementById('reqPopup').style.display = 'block'; }
    function closeReq() { document.getElementById('reqPopup').style.display = 'none'; }
    function sendReq() {
      const n = document.getElementById('rNama').value, u = document.getElementById('rUrl').value, l = document.getElementById('rLagu').value;
      if (!n || !u || !l) return showToast('Isi semua field!');
      const text = `Format Req Lagu\n\nNama : ${n}\nUrl : ${u}\nNama Lagu : ${l}`;
      window.open("https://wa.me/62895329018240?text=" + encodeURIComponent(text));
      closeReq();
    }

    function format(t) {
      if (isNaN(t)) return "0:00";
      return Math.floor(t / 60) + ":" + String(Math.floor(t % 60)).padStart(2, "0");
    }

    function showToast(m) {
      const t = document.getElementById('toast');
      t.textContent = m; t.style.display = "block";
      setTimeout(() => t.style.display = "none", 2000);
    }
  </script>
</body>
</html>
