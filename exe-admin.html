<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Execurive RP | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #020617; color: #f8fafc; font-family: 'Segoe UI', sans-serif; }
        .sidebar { background: #0f172a; border-right: 1px solid #1e293b; }
        .stat-card { background: #1e293b; border-radius: 8px; padding: 20px; border-left: 4px solid #2563eb; }
    </style>
</head>
<body class="flex min-h-screen">

    <div class="w-64 sidebar p-6 space-y-8">
        <h1 class="text-xl font-black italic text-blue-500">EXE-ADMIN <span class="text-white text-xs block">STAFF ONLY</span></h1>
        <nav class="space-y-4">
            <a href="#" class="block text-sm font-bold text-blue-400"><i class="fa fa-home mr-2"></i> Dashboard</a>
            <a href="#" class="block text-sm font-bold text-gray-400 hover:text-white"><i class="fa fa-file-alt mr-2"></i> Character Stories</a>
            <a href="#" class="block text-sm font-bold text-gray-400 hover:text-white"><i class="fa fa-users mr-2"></i> Manage Users</a>
            <a href="#" class="block text-sm font-bold text-red-500 pt-10" onclick="logout()"><i class="fa fa-power-off mr-2"></i> Logout</a>
        </nav>
    </div>

    <div class="flex-1 p-10">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h2 class="text-3xl font-bold">Admin Panel</h2>
                <p class="text-gray-500 text-sm">Welcome back, <span id="admin-name" class="text-white">Staff</span></p>
            </div>
            <div id="admin-rank" class="bg-red-600 px-4 py-1 rounded text-xs font-black uppercase">Checking Rank...</div>
        </header>

        <div class="grid grid-cols-3 gap-6 mb-10">
            <div class="stat-card">
                <p class="text-gray-400 text-xs uppercase font-bold">Pending CS</p>
                <h4 class="text-2xl font-black mt-2">12</h4>
            </div>
            <div class="stat-card" style="border-left-color: #ef4444;">
                <p class="text-gray-400 text-xs uppercase font-bold">Total Reports</p>
                <h4 class="text-2xl font-black mt-2">5</h4>
            </div>
            <div class="stat-card" style="border-left-color: #10b981;">
                <p class="text-gray-400 text-xs uppercase font-bold">Users Online</p>
                <h4 class="text-2xl font-black mt-2">42</h4>
            </div>
        </div>

        <div class="bg-[#0f172a] rounded-xl border border-gray-800 overflow-hidden">
            <div class="p-4 bg-blue-900/20 border-b border-gray-800 font-bold text-sm">Character Story Queue</div>
            <table class="w-full text-left text-sm">
                <thead class="bg-black/20 text-gray-500 uppercase text-[10px]">
                    <tr>
                        <th class="p-4">Uploader</th>
                        <th class="p-4">Character Name</th>
                        <th class="p-4">Status</th>
                        <th class="p-4">Action</th>
                    </tr>
                </thead>
                <tbody id="cs-list">
                    </tbody>
            </table>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Konfigurasi sama dengan execurive.html
        const firebaseConfig = {
          apiKey: "AIzaSyCtfsTqg3sJuJCq_EGF36c4eg8QUwyhtwE",
          authDomain: "execuriverp.firebaseapp.com",
          databaseURL: "https://execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "execuriverp",
          storageBucket: "execuriverp.firebasestorage.app",
          appId: "1:672894448184:web:2d9635ca19ea94c3e7eccd"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getDatabase(app);

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                const userRef = ref(db, 'users/' + user.uid);
                const snap = await get(userRef);
                
                if (snap.exists()) {
                    const role = snap.val().role;
                    // IZIN AKSES: Jika bukan Staff (Helper/Admin/Owner), tendang balik
                    if (role === 'Member') {
                        alert("AKSES DITOLAK: Kamu bukan Staff!");
                        window.location.href = "execurive.html";
                    } else {
                        document.getElementById('admin-name').innerText = snap.val().username;
                        document.getElementById('admin-rank').innerText = role;
                    }
                }
            } else {
                window.location.href = "execurive.html";
            }
        });

        window.logout = () => signOut(auth);
    </script>
</body>
</html>
