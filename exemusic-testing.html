<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic v3.0 - Spotify Hexky Edition</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root { --accent: #1DB954; --bg: #0c0c0c; --card: #181818; --text: #ffffff; }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: sans-serif; transition: 0.3s; }
    body { background: var(--bg); color: var(--text); height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }

    #loadingCard { position: absolute; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; }
    .loader { width: 40px; height: 40px; border: 4px solid #333; border-top-color: var(--accent); border-radius: 50%; animation: rot 1s linear infinite; }
    @keyframes rot { to { transform: rotate(360deg); } }

    .app { width: 100%; max-width: 400px; height: 96vh; background: linear-gradient(to bottom, #222, #0c0c0c); display: flex; flex-direction: column; position: relative; border-radius: 20px; border: 1px solid #333; }
    
    .header { padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    #userBtn { background: rgba(255,255,255,0.1); border: none; color: white; padding: 6px 15px; border-radius: 20px; font-size: 12px; cursor: pointer; }

    .main-player { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 10px; }
    .art-box { width: 200px; height: 200px; background: #222; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; margin-bottom: 20px; font-size: 50px; }
    
    .track-info { width: 100%; padding: 0 25px; margin-bottom: 15px; text-align: left; }
    #trackTitle { font-size: 18px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    #trackArtist { color: #b3b3b3; font-size: 13px; margin-top: 5px; }

    .controls { width: 100%; padding: 0 25px; margin-bottom: 10px; }
    #seek { width: 100%; height: 4px; accent-color: var(--accent); cursor: pointer; }
    .times { display: flex; justify-content: space-between; font-size: 10px; color: #aaa; margin-top: 5px; }
    
    .btns { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .play-btn { width: 50px; height: 50px; background: white; border: none; border-radius: 50%; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

    .nav { background: #000; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #222; border-radius: 0 0 20px 20px; }
    .nav button { background: none; border: none; color: #888; font-size: 10px; cursor: pointer; }
    .nav .active { color: white; }

    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; z-index: 2000; padding: 20px; overflow-y: auto; }
    .sheet { max-width: 350px; margin: 30px auto; background: var(--card); padding: 20px; border-radius: 15px; }
    .inp { width: 100%; padding: 12px; margin-bottom: 10px; background: #222; border: 1px solid #333; border-radius: 8px; color: white; }
    .btn-act { width: 100%; padding: 12px; background: var(--accent); border: none; border-radius: 25px; font-weight: bold; cursor: pointer; }

    .acc-card { text-align: center; }
    .acc-pic { width: 60px; height: 60px; background: var(--accent); border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 25px; color: black; font-weight: bold; }
    .stat-row { display: flex; justify-content: space-around; margin: 15px 0; border-top: 1px solid #333; padding-top: 10px; }
  </style>
</head>
<body>

  <div id="loadingCard"><div class="loader"></div></div>

  <div class="app">
    <div class="header">
      <h3 style="color:var(--accent)">ExeMusic</h3>
      <button id="userBtn" onclick="openUserModal()">Login</button>
    </div>

    <div class="main-player">
      <div class="art-box" id="eq">üéß</div>
      <div class="track-info">
        <div id="trackTitle">Memuat Lagu...</div>
        <div id="trackArtist">@hexky</div>
      </div>
      <div class="controls">
        <input type="range" id="seek" value="0">
        <div class="times"><span id="cur">0:00</span><span id="dur">0:00</span></div>
        <div class="btns">
          <button onclick="toggleShuf()" id="sBtn" style="background:none; border:none; color:#555; font-size:18px">üîÄ</button>
          <button onclick="prev()" style="background:none; border:none; color:white; font-size:22px">‚èÆ</button>
          <button class="play-btn" id="pBtn" onclick="togglePlay()">‚ñ∂</button>
          <button onclick="next()" style="background:none; border:none; color:white; font-size:22px">‚è≠</button>
          <button onclick="toggleRep()" id="rBtn" style="background:none; border:none; color:#555; font-size:18px">üîÅ</button>
        </div>
      </div>
    </div>

    <div class="nav">
      <button class="active" onclick="location.reload()">üè†<br>Home</button>
      <button onclick="openList()">üîç<br>Explore</button>
      <button onclick="openProfile()">üë§<br>Account</button>
    </div>
  </div>

  <div id="modalUser" class="modal" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <div id="v-login">
        <h2 style="margin-bottom:15px">Login</h2>
        <input id="logU" class="inp" placeholder="Username">
        <input id="logP" type="password" class="inp" placeholder="Password">
        <button class="btn-act" onclick="handleLogin()">MASUK</button>
        <p onclick="showV('v-reg')" style="text-align:center; font-size:12px; margin-top:10px; color:#aaa; cursor:pointer">Belum punya akun? Daftar</p>
      </div>

      <div id="v-reg" style="display:none">
        <h2 style="margin-bottom:15px">Daftar</h2>
        <input id="regU" class="inp" placeholder="Username">
        <input id="regE" class="inp" placeholder="Email (Gmail)">
        <input id="regP" type="password" class="inp" placeholder="Password">
        <button class="btn-act" onclick="handleReg()">DAFTAR</button>
        <p onclick="showV('v-login')" style="text-align:center; font-size:12px; margin-top:10px; color:#aaa; cursor:pointer">Sudah punya akun? Login</p>
      </div>

      <div id="v-acc" style="display:none" class="acc-card">
        <div class="acc-pic" id="accInitial">H</div>
        <h2 id="accName">Hexky</h2>
        <p id="accEmail" style="font-size:12px; color:#888"></p>
        <div class="stat-row">
          <div><b id="f1">0</b><br><small>Followers</small></div>
          <div><b id="f2">0</b><br><small>Following</small></div>
        </div>
        <button class="btn-act" style="background:#333; color:white" onclick="auth.signOut(); location.reload()">LOGOUT</button>
      </div>

      <div id="v-verify" style="display:none" class="acc-card">
        <h2 style="color:var(--accent)">Cek Email!</h2>
        <p style="margin:15px 0; font-size:13px">Kami sudah mengirim link verifikasi ke Gmail kamu. Tolong di-klik lalu login kembali ya!</p>
        <button class="btn-act" onclick="location.reload()">SAYA SUDAH KLIK</button>
      </div>
    </div>
  </div>

  <div id="modalList" class="modal" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="margin-bottom:15px">Daftar Lagu</h3>
      <div id="listInbox" style="max-height: 300px; overflow-y: auto;"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCVJYSR4nHeoRA9WTMZa3-2xliKQRrd5g4",
      authDomain: "exemusic-execuriverp.firebaseapp.com",
      databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "exemusic-execuriverp",
      storageBucket: "exemusic-execuriverp.firebasestorage.app",
      messagingSenderId: "722057744401",
      appId: "1:722057744401:web:cd6a6a103692059bda61b0"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // DAFTAR LAGU (By Hexky)
    let songs = [
      {title: "DJ Lowkey", url: "https://e.top4top.io/m_3663xnyxb1.mp3", by: "Hexky"},
      {title: "DJ Barudak Phonk Teror", url: "https://l.top4top.io/m_3663el4ki1.mp3", by: "Hexky"},
      {title: "DJ Poppin The Club", url: "https://a.top4top.io/m_3663e5c4g1.mp3", by: "Hexky"},
      {title: "DJ Gak Dulu", url: "https://k.top4top.io/m_3663k2izf1.mp3", by: "Hexky"},
      {title: "DJ Hero Breakbeat Remix", url: "https://j.top4top.io/m_3663j8iv41.mp3", by: "Hexky"},
      {title: "Sedia Aku Sebelum Hujan", url: "https://j.top4top.io/m_3663vjzab1.mp3", by: "Hexky"},
      {title: "Monolog", url: "https://h.top4top.io/m_3663ws86l1.mp3", by: "Hexky"},
      {title: "JKT48 Jokowi", url: "https://l.top4top.io/m_3663gpm0b1.mp3", by: "Hexky"},
      {title: "JKT48 Jokowi (Slow)", url: "https://g.top4top.io/m_3663oirnh1.mp3", by: "Hexky"},
      {title: "JKT48 Prabowo", url: "https://l.top4top.io/m_3663iy1xi1.mp3", by: "Hexky"},
      {title: "Furac√£o 2000 - Mimosa 2000", url: "https://k.top4top.io/m_36721n5ug1.mp3", by: "Hexky"},
      {title: "SURAT X BAHAGIA LAGI", url: "https://l.top4top.io/m_366910p0d1.mp3", by: "Hexky"},
      {title: "NUTS", url: "https://h.top4top.io/m_3652masce1.mp3", by: "Hexky"},
      {title: "DI UJUNG JALAN", url: "https://b.top4top.io/m_35722bxot1.mp3", by: "Hexky"},
      {title: "DID IT FIRST", url: "https://f.top4top.io/m_3655awnz81.mp3", by: "Hexky"},
      {title: "Kaulah Ahlinya Bagiku", url: "https://a.top4top.io/m_3671hwfp11.mp3", by: "Hexky"},
      {title: "Hindia", url: "https://c.top4top.io/m_3672ol0gy1.mp3", by: "Hexky"},
      {title: "Tyla", url: "https://d.top4top.io/m_3672yb1xm2.mp3", by: "Hexky"},
      {title: "End of Beginning", url: "https://e.top4top.io/m_3672ozkd83.mp3", by: "Hexky"},
      {title: "By Minako AI", url: "https://l.top4top.io/m_3672k907s1.mp3", by: "Hexky"},
      {title: "DJ CAMPURAN 2026", url: "https://f.top4top.io/m_3675dp65g1.mp3", by: "Hexky"}
    ];

    let i = 0, isShuf = false, isRep = false, userData = null;
    const audio = new Audio();

    // AUTH SYSTEM
    auth.onAuthStateChanged(async (u) => {
      if(u) {
        if(!u.emailVerified) { showV('v-verify'); openUserModal(); }
        else {
          const s = await db.ref('users/' + u.uid).get();
          userData = s.val();
          document.getElementById('userBtn').innerText = userData.username;
          document.getElementById('accName').innerText = userData.username;
          document.getElementById('accEmail').innerText = u.email;
          document.getElementById('accInitial').innerText = userData.username[0].toUpperCase();
          showV('v-acc');
        }
      }
      document.getElementById('loadingCard').style.display = 'none';
    });

    async function handleReg() {
      const u = document.getElementById('regU').value, e = document.getElementById('regE').value, p = document.getElementById('regP').value;
      if(u.length < 3) return alert("Username minimal 3 huruf");
      const check = await db.ref('usernames/' + u.toLowerCase()).get();
      if(check.exists()) return alert("Username sudah dipakai!");

      auth.createUserWithEmailAndPassword(e, p).then(async (res) => {
        await res.user.sendEmailVerification();
        await db.ref('users/' + res.user.uid).set({ username: u, email: e, role: 'user' });
        await db.ref('usernames/' + u.toLowerCase()).set(res.user.uid);
        showV('v-verify');
      }).catch(err => alert(err.message));
    }

    async function handleLogin() {
      const u = document.getElementById('logU').value, p = document.getElementById('logP').value;
      const snap = await db.ref('usernames/' + u.toLowerCase()).get();
      if(!snap.exists()) return alert("Username tidak ada!");
      const userSnap = await db.ref('users/' + snap.val()).get();
      auth.signInWithEmailAndPassword(userSnap.val().email, p).catch(err => alert(err.message));
    }

    // PLAYER SYSTEM
    function setup(idx, play = true) {
      i = idx; audio.src = songs[i].url;
      document.getElementById('trackTitle').innerText = songs[i].title;
      if(play) { audio.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
    }

    function togglePlay() {
      if(audio.paused) { audio.play(); document.getElementById('pBtn').innerText = "‚è∏"; }
      else { audio.pause(); document.getElementById('pBtn').innerText = "‚ñ∂"; }
    }

    function next() { setup(isShuf ? Math.floor(Math.random()*songs.length) : (i+1)%songs.length); }
    function prev() { setup((i-1+songs.length)%songs.length); }

    audio.ontimeupdate = () => {
      document.getElementById('seek').value = (audio.currentTime/audio.duration)*100 || 0;
      document.getElementById('cur').innerText = fmt(audio.currentTime);
      document.getElementById('dur').innerText = fmt(audio.duration);
    };
    document.getElementById('seek').oninput = (e) => audio.currentTime = (e.target.value/100)*audio.duration;
    audio.onended = () => isRep ? (audio.currentTime=0, audio.play()) : next();

    function fmt(s) { if(isNaN(s)) return "0:00"; const m=Math.floor(s/60),sc=Math.floor(s%60); return m+":"+(sc<10?"0"+sc:sc); }

    // UI SYSTEM
    function openUserModal() { document.getElementById('modalUser').style.display='block'; }
    function openProfile() { if(!userData) openUserModal(); else { showV('v-acc'); openUserModal(); } }
    function showV(id) { 
      ['v-reg','v-login','v-acc','v-verify'].forEach(v => document.getElementById(v).style.display='none');
      document.getElementById(id).style.display='block';
    }
    function toggleShuf() { isShuf = !isShuf; document.getElementById('sBtn').style.color = isShuf ? '#1DB954' : '#555'; }
    function toggleRep() { isRep = !isRep; document.getElementById('rBtn').style.color = isRep ? '#1DB954' : '#555'; }

    function openList() {
      const inbox = document.getElementById('listInbox');
      inbox.innerHTML = songs.map((s, idx) => `
        <div style="padding:12px; border-bottom:1px solid #222; cursor:pointer" onclick="setup(${idx}); document.getElementById('modalList').style.display='none'">
          <b style="font-size:14px">${s.title}</b><br><small style="color:#888">@${s.by}</small>
        </div>
      `).join('');
      document.getElementById('modalList').style.display='block';
    }

    // Start
    setup(0, false);
  </script>
</body>
</html>
