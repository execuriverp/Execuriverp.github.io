<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>ExeMusic v4.0 - Modern Interface</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <style>
        :root {
            --accent: #1db954;
            --bg: #0b0b0b;
            --surface: #181818;
            --text: #ffffff;
            --text-dim: #a7a7a7;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, sans-serif; }
        
        body {
            background: var(--bg);
            color: var(--text);
            display: flex; justify-content: center; align-items: center;
            height: 100vh; overflow: hidden;
        }

        .player-card {
            width: 90%; max-width: 400px;
            height: 90vh;
            background: linear-gradient(180deg, #222 0%, #000 100%);
            border-radius: 40px;
            padding: 30px;
            display: flex; flex-direction: column;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative; border: 1px solid rgba(255,255,255,0.1);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header img { height: 30px; }

        .art-work {
            flex: 1;
            background: #111;
            border-radius: 25px;
            margin-bottom: 25px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.4);
            overflow: hidden; border: 1px solid #333;
        }

        /* Visualizer Sederhana */
        .visualizer { display: flex; align-items: flex-end; gap: 5px; height: 60px; }
        .visualizer div { width: 6px; background: var(--accent); border-radius: 3px; height: 10px; transition: 0.3s; }
        .playing .visualizer div { animation: bounce 0.8s infinite alternate; }
        @keyframes bounce { from { height: 10px; } to { height: 50px; } }

        .info { margin-bottom: 20px; }
        .info h1 { font-size: 24px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .info p { color: var(--accent); font-weight: 600; cursor: pointer; }

        .controls-main { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .play-btn { 
            width: 70px; height: 70px; background: var(--accent); 
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            color: black; font-size: 30px; cursor: pointer; border: none;
        }

        .slider { width: 100%; height: 5px; accent-color: var(--accent); cursor: pointer; margin-top: 10px; }
        .time { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-dim); margin-top: 5px; }

        .footer-nav { 
            margin-top: auto; display: flex; justify-content: space-around; 
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 20px;
        }
        .footer-nav button { background: none; border: none; color: white; font-size: 20px; cursor: pointer; opacity: 0.6; }
        .active { opacity: 1 !important; color: var(--accent) !important; }

        /* Modal Modern */
        .modal { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); 
            display: none; z-index: 100; align-items: flex-end;
        }
        .modal-content { 
            width: 100%; max-width: 400px; background: #1c1c1c; 
            border-radius: 30px 30px 0 0; padding: 25px; max-height: 70vh; overflow-y: auto;
            margin: 0 auto;
        }

        input { 
            width: 100%; padding: 15px; margin-bottom: 10px; 
            background: #252525; border: none; border-radius: 12px; color: white;
        }
        .btn-action { 
            width: 100%; padding: 15px; background: var(--accent); 
            border: none; border-radius: 12px; font-weight: bold; cursor: pointer;
        }

        #toast {
            position: fixed; top: 20px; background: var(--accent); color: black;
            padding: 10px 25px; border-radius: 50px; font-weight: bold;
            display: none; z-index: 1000;
        }
    </style>
</head>
<body>

    <div id="toast">Notif</div>

    <div class="player-card" id="app">
        <div class="header">
            <img src="exemusic.png" alt="Logo">
            <button id="adminBtn" style="display:none; background:none; border:none; font-size:20px;" onclick="openAdmin()">üõ°Ô∏è</button>
        </div>

        <div class="art-work" id="artContainer">
            <div class="visualizer">
                <div></div><div></div><div></div><div></div><div></div>
            </div>
        </div>

        <div class="info">
            <h1 id="trackTitle">Memuat Musik...</h1>
            <p id="trackBy" onclick="viewProfile(songs[i]?.uid)">@system</p>
        </div>

        <div class="progress">
            <input type="range" id="seek" class="slider" value="0">
            <div class="time">
                <span id="cur">0:00</span>
                <span id="dur">0:00</span>
            </div>
        </div>

        <div class="controls-main">
            <button onclick="prev()" style="background:none; border:none; color:white; font-size:30px;">‚èÆ</button>
            <button class="play-btn" onclick="togglePlay()" id="playBtn">‚ñ∂</button>
            <button onclick="next()" style="background:none; border:none; color:white; font-size:30px;">‚è≠</button>
        </div>

        <div class="footer-nav">
            <button onclick="openList()">‚ò∞</button>
            <button onclick="openAdd()">‚ûï</button>
            <button id="shufBtn" onclick="toggleShuffle()">üîÄ</button>
            <button id="repBtn" onclick="toggleRepeat()">üîÅ</button>
        </div>
    </div>

    <div class="modal" id="modalGeneric" onclick="if(event.target==this)this.style.display='none'">
        <div class="modal-content" id="modalBody"></div>
    </div>

    <script>
        // CONFIG - Ganti dengan milikmu jika ingin custom
        const config = {
            apiKey: atob("QUl6YVN5Q1ZKWVNSNG5IZW9SQTlXVE1aYTMtMnhsaUtRcmQ1ZzQ="),
            authDomain: "exemusic-execuriverp.firebaseapp.com",
            databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "exemusic-execuriverp"
        };

        firebase.initializeApp(config);
        const auth = firebase.auth();
        const db = firebase.database();
        const audio = new Audio();

        let songs = [], i = 0, isShuffle = false, isRepeat = false, userData = null;

        // AUTH SYSTEM
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                const snap = await db.ref('users/' + user.uid).get();
                if (snap.exists()) {
                    userData = snap.val();
                    if(userData.role === "admin") document.getElementById('adminBtn').style.display = 'block';
                } else {
                    showRegisForm();
                }
            }
        });

        // LOAD DATA
        db.ref('songs').on('value', snap => {
            const val = snap.val();
            if (val) {
                songs = Object.keys(val).map(k => ({...val[k], id: k}));
                if(audio.src === "") loadSong(0, false);
            }
        });

        function loadSong(idx, play = true) {
            if(!songs[idx]) return;
            i = idx;
            audio.src = songs[i].url;
            document.getElementById('trackTitle').textContent = songs[i].title;
            document.getElementById('trackBy').textContent = "@" + songs[i].by;
            if(play) { audio.play(); updateUI(true); }
        }

        function togglePlay() {
            if(audio.paused) {
                audio.play();
                updateUI(true);
            } else {
                audio.pause();
                updateUI(false);
            }
        }

        function updateUI(isPlaying) {
            document.getElementById('playBtn').textContent = isPlaying ? "‚ùö‚ùö" : "‚ñ∂";
            isPlaying ? document.getElementById('app').classList.add('playing') : document.getElementById('app').classList.remove('playing');
        }

        function next() {
            let nextIdx = isShuffle ? Math.floor(Math.random()*songs.length) : (i + 1) % songs.length;
            loadSong(nextIdx);
        }

        function prev() {
            loadSong((i - 1 + songs.length) % songs.length);
        }

        // TIME & PROGRESS
        audio.ontimeupdate = () => {
            const seek = document.getElementById('seek');
            seek.value = (audio.currentTime / audio.duration) * 100 || 0;
            document.getElementById('cur').textContent = fmtTime(audio.currentTime);
            document.getElementById('dur').textContent = fmtTime(audio.duration);
        };
        document.getElementById('seek').oninput = (e) => audio.currentTime = (e.target.value/100) * audio.duration;
        audio.onended = () => isRepeat ? loadSong(i) : next();

        function fmtTime(s) {
            if(isNaN(s)) return "0:00";
            let m = Math.floor(s/60), sc = Math.floor(s%60);
            return m + ":" + (sc < 10 ? "0"+sc : sc);
        }

        // MODAL FUNCTIONS
        function openList() {
            const body = document.getElementById('modalBody');
            body.innerHTML = `<h3>Playlist</h3><br>` + songs.map((s, idx) => `
                <div onclick="loadSong(${idx})" style="padding:15px; border-bottom:1px solid #333; cursor:pointer">
                    <b>${s.title}</b><br><small color="#888">${s.by}</small>
                </div>
            `).join('');
            document.getElementById('modalGeneric').style.display = 'flex';
        }

        function openAdd() {
            if(!auth.currentUser) return auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
            const body = document.getElementById('modalBody');
            body.innerHTML = `
                <h3>Tambah Lagu</h3><br>
                <input id="inT" placeholder="Judul Lagu">
                <input id="inU" placeholder="URL Audio (Top4Top)">
                <button class="btn-action" onclick="saveSong()">UPLOAD</button>
            `;
            document.getElementById('modalGeneric').style.display = 'flex';
        }

        async function saveSong() {
            const title = document.getElementById('inT').value;
            const url = document.getElementById('inU').value;
            if(!title || !url) return alert("Isi semua!");
            await db.ref('songs').push({
                title, url, by: userData.username, uid: auth.currentUser.uid, date: Date.now()
            });
            document.getElementById('modalGeneric').style.display = 'none';
            showToast("Berhasil Menambah Lagu!");
        }

        function showRegisForm() {
            const body = document.getElementById('modalBody');
            body.innerHTML = `
                <h3>Buat Akun</h3><br>
                <input id="regUser" placeholder="Username">
                <button class="btn-action" onclick="finishReg()">DAFTAR</button>
            `;
            document.getElementById('modalGeneric').style.display = 'flex';
        }

        async function finishReg() {
            const u = document.getElementById('regUser').value;
            await db.ref('users/' + auth.currentUser.uid).set({
                username: u, role: 'user', joined: Date.now()
            });
            location.reload();
        }

        function toggleShuffle() { isShuffle = !isShuffle; document.getElementById('shufBtn').classList.toggle('active'); }
        function toggleRepeat() { isRepeat = !isRepeat; document.getElementById('repBtn').classList.toggle('active'); }

        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m; t.style.display = 'block';
            setTimeout(() => t.style.display = 'none', 3000);
        }

        // ADMIN
        function openAdmin() {
            const body = document.getElementById('modalBody');
            body.innerHTML = `<h3>Admin Panel</h3><br>` + songs.map((s) => `
                <div style="display:flex; justify-content:space-between; padding:10px;">
                    <span>${s.title}</span>
                    <button onclick="delS('${s.id}')" style="color:red; background:none; border:none;">Hapus</button>
                </div>
            `).join('');
            document.getElementById('modalGeneric').style.display = 'flex';
        }

        window.delS = (id) => { if(confirm('Hapus?')) db.ref('songs/'+id).remove(); };
        window.viewProfile = (uid) => { alert("User ID: " + uid); };

    </script>
</body>
</html>
