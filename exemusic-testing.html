<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic - Spotify Style</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root {
      --spotify-green: #1DB954;
      --spotify-black: #121212;
      --spotify-light-black: #181818;
      --spotify-grey: #b3b3b3;
      --spotify-white: #ffffff;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }

    body {
      background-color: var(--spotify-black);
      color: var(--spotify-white);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
    }

    /* Loading Card (sesuai request.) */
    #loadingCard {
      position: absolute; inset: 0; background: var(--spotify-black); z-index: 9999;
      display: flex; justify-content: center; align-items: center; transition: 0.5s;
    }
    .loader { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: var(--spotify-green); border-radius: 50%; animation: rotation 1s linear infinite; }
    @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .app-container {
      width: 100%;
      max-width: 450px;
      height: 100vh;
      background: linear-gradient(to bottom, #222222 0%, #121212 40%);
      display: flex;
      flex-direction: column;
      position: relative;
    }

    /* Header */
    .header {
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h2 { font-size: 22px; font-weight: 700; }
    #userBtn { 
      background: rgba(255,255,255,0.1); border: none; color: white; 
      padding: 8px 16px; border-radius: 20px; font-weight: 600; cursor: pointer;
    }

    /* Album Art Section */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .album-art {
      width: 85%;
      aspect-ratio: 1/1;
      background: #282828;
      border-radius: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      margin-bottom: 40px;
    }
    
    /* EQ Modern */
    .eq-container { display: flex; align-items: flex-end; gap: 4px; height: 60px; }
    .eq-bar { width: 6px; background: var(--spotify-green); border-radius: 3px; height: 10px; }
    .playing .eq-bar { animation: wave 0.8s infinite ease-in-out; }
    @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 50px; } }

    /* Track Info */
    .track-meta { width: 100%; padding: 0 20px; margin-bottom: 25px; }
    #trackTitle { font-size: 24px; font-weight: 700; margin-bottom: 5px; }
    #trackArtist { color: var(--spotify-grey); font-size: 16px; font-weight: 500; cursor: pointer; }
    #trackArtist:hover { color: var(--spotify-white); text-decoration: underline; }

    /* Player Controls */
    .player-controls { width: 100%; padding: 0 20px; }
    .progress-box { margin-bottom: 20px; }
    #seekRange { 
      width: 100%; height: 4px; accent-color: var(--spotify-white); 
      cursor: pointer; background: #4f4f4f; border-radius: 2px;
    }
    .time-info { display: flex; justify-content: space-between; color: var(--spotify-grey); font-size: 12px; margin-top: 8px; }

    .buttons-row { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
    .btn-circle { 
      width: 65px; height: 65px; background: var(--spotify-white); border: none; 
      border-radius: 50%; display: flex; align-items: center; justify-content: center; 
      font-size: 24px; cursor: pointer; transition: 0.2s;
    }
    .btn-circle:active { transform: scale(0.9); }
    .btn-icon { background: none; border: none; color: var(--spotify-white); font-size: 28px; cursor: pointer; }
    .btn-icon.active { color: var(--spotify-green); }

    /* Bottom Nav */
    .bottom-nav {
      background: rgba(18,18,18,0.95);
      display: flex; justify-content: space-around; padding: 15px 0;
      border-top: 1px solid #282828;
    }
    .nav-item { background: none; border: none; color: var(--spotify-grey); font-size: 11px; cursor: pointer; }
    .nav-item.active { color: white; }

    /* Modal Styling */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 1000; padding: 20px; overflow-y: auto; }
    .modal-content { max-width: 400px; margin: 40px auto; }
    .input-group { margin-bottom: 15px; }
    .input-group input { width: 100%; padding: 12px; background: #333; border: none; border-radius: 5px; color: white; }
    .btn-submit { width: 100%; padding: 12px; background: var(--spotify-green); border: none; border-radius: 25px; font-weight: 700; cursor: pointer; margin-top: 10px; }

    #toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%); background: #2e77d0; color: white; padding: 10px 20px; border-radius: 4px; font-size: 14px; opacity: 0; transition: 0.3s; pointer-events: none; }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

  <div id="loadingCard"><div class="loader"></div></div>
  <div id="toast">Notifikasi</div>

  <div class="app-container">
    <div class="header">
      <h2>ExeMusic</h2>
      <button id="userBtn" onclick="openProfile()">Login</button>
    </div>

    <div class="main-content">
      <div class="album-art" id="artBox">
        <div class="eq-container" id="eq">
          <div class="eq-bar" style="animation-delay: 0.1s"></div>
          <div class="eq-bar" style="animation-delay: 0.3s"></div>
          <div class="eq-bar" style="animation-delay: 0.2s"></div>
          <div class="eq-bar" style="animation-delay: 0.4s"></div>
          <div class="eq-bar" style="animation-delay: 0.1s"></div>
        </div>
      </div>

      <div class="track-meta">
        <div id="trackTitle">Pilih Lagu</div>
        <div id="trackArtist" onclick="viewCreator()">@system</div>
      </div>

      <div class="player-controls">
        <div class="progress-box">
          <input type="range" id="seekRange" value="0" step="0.1">
          <div class="time-info">
            <span id="curTime">0:00</span>
            <span id="durTime">0:00</span>
          </div>
        </div>

        <div class="buttons-row">
          <button class="btn-icon" id="shufBtn" onclick="toggleShuffle()">üîÄ</button>
          <button class="btn-icon" onclick="prev()">‚èÆ</button>
          <button class="btn-circle" onclick="togglePlay()" id="playBtn">‚ñ∂</button>
          <button class="btn-icon" onclick="next()">‚è≠</button>
          <button class="btn-icon" id="repBtn" onclick="toggleRepeat()">üîÅ</button>
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <button class="nav-item active" onclick="location.reload()">üè†<br>Home</button>
      <button class="nav-item" onclick="openList(false)">üîç<br>Explore</button>
      <button class="nav-item" onclick="openList(true)">‚≠ê<br>Library</button>
      <button class="nav-item" id="adminMenu" style="display:none" onclick="openAdmin()">üõ°Ô∏è<br>Admin</button>
    </div>
  </div>

  <div id="modalProfile" class="modal" onclick="if(event.target==this)this.style.display='none'">
    <div class="modal-content">
      <div id="authSection">
        <h2 style="text-align:center; margin-bottom:20px" id="authTitle">Masuk ke ExeMusic</h2>
        <div class="input-group"><input type="text" id="authU" placeholder="Username (Untuk Daftar)" style="display:none"></div>
        <div class="input-group"><input type="email" id="authE" placeholder="Email"></div>
        <div class="input-group"><input type="password" id="authP" placeholder="Password"></div>
        <button class="btn-submit" onclick="handleAuth()" id="authBtn">MASUK</button>
        <p style="text-align:center; margin-top:15px; color:#b3b3b3; font-size:13px" onclick="toggleAuthMode()" id="authToggle">Belum punya akun? Daftar gratis</p>
      </div>

      <div id="profileSection" style="display:none">
        <h2 id="profName" style="text-align:center">Username</h2>
        <div style="display:flex; justify-content:space-around; margin:20px 0">
          <div style="text-align:center"><b id="countFol">0</b><br><small>Followers</small></div>
          <div style="text-align:center"><b id="countFollowing">0</b><br><small>Following</small></div>
        </div>
        <button class="btn-submit" style="background:#333; color:white" onclick="auth.signOut(); location.reload()">KELUAR</button>
      </div>
    </div>
  </div>

  <div id="modalList" class="modal" onclick="if(event.target==this)this.style.display='none'">
    <div class="modal-content">
        <h3 style="margin-bottom:15px">Daftar Lagu</h3>
        <div id="songContainer"></div>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCVJYSR4nHeoRA9WTMZa3-2xliKQRrd5g4",
      authDomain: "exemusic-execuriverp.firebaseapp.com",
      databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "exemusic-execuriverp",
      storageBucket: "exemusic-execuriverp.firebasestorage.app",
      messagingSenderId: "722057744401",
      appId: "1:722057744401:web:cd6a6a103692059bda61b0",
      measurementId: "G-2P56Y7QQ18"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    let songs = [], i = 0, isShuf = false, isRep = false, isLoginMode = true;
    let userData = null;
    let favs = JSON.parse(localStorage.getItem('exeFavs') || "[]");
    const audio = new Audio();

    // --- AUTH ---
    auth.onAuthStateChanged(async (user) => {
      if(user) {
        const snap = await db.ref('users/' + user.uid).get();
        userData = snap.val();
        document.getElementById('userBtn').innerText = userData?.username || "Profil";
        if(userData?.role === 'admin') document.getElementById('adminMenu').style.display='block';
      }
      document.getElementById('loadingCard').style.opacity = '0';
      setTimeout(() => document.getElementById('loadingCard').style.display='none', 500);
    });

    function toggleAuthMode() {
      isLoginMode = !isLoginMode;
      document.getElementById('authTitle').innerText = isLoginMode ? "Masuk ke ExeMusic" : "Daftar Akun Baru";
      document.getElementById('authU').style.display = isLoginMode ? "none" : "block";
      document.getElementById('authBtn').innerText = isLoginMode ? "MASUK" : "DAFTAR";
      document.getElementById('authToggle').innerText = isLoginMode ? "Belum punya akun? Daftar gratis" : "Sudah punya akun? Masuk";
    }

    function handleAuth() {
      const e = document.getElementById('authE').value, p = document.getElementById('authP').value;
      if(isLoginMode) {
        auth.signInWithEmailAndPassword(e, p).then(() => location.reload()).catch(err => alert(err.message));
      } else {
        const u = document.getElementById('authU').value;
        auth.createUserWithEmailAndPassword(e, p).then(res => {
          db.ref('users/' + res.user.uid).set({ username: u, role: 'user', created: Date.now() });
          location.reload();
        }).catch(err => alert(err.message));
      }
    }

    // --- DATA ---
    db.ref('songs').on('value', snap => {
      const data = snap.val();
      if(data) {
        songs = Object.keys(data).map(k => ({...data[k], key: k}));
        if(audio.src === "") setup(0, false);
      }
    });

    function setup(idx, play = true) {
      i = idx;
      const s = songs[i];
      audio.src = s.url;
      document.getElementById('trackTitle').innerText = s.title;
      document.getElementById('trackArtist').innerText = "@" + (s.by || "system");
      if(play) { audio.play(); document.getElementById('playBtn').innerText = "‚è∏"; document.getElementById('eq').classList.add('playing'); }
    }

    function togglePlay() {
      if(audio.paused) { audio.play(); document.getElementById('playBtn').innerText = "‚è∏"; document.getElementById('eq').classList.add('playing'); }
      else { audio.pause(); document.getElementById('playBtn').innerText = "‚ñ∂"; document.getElementById('eq').classList.remove('playing'); }
    }

    function next() { setup(isShuf ? Math.floor(Math.random()*songs.length) : (i+1)%songs.length); }
    function prev() { setup((i-1+songs.length)%songs.length); }

    audio.ontimeupdate = () => {
      const per = (audio.currentTime / audio.duration) * 100 || 0;
      document.getElementById('seekRange').value = per;
      document.getElementById('curTime').innerText = fmt(audio.currentTime);
      document.getElementById('durTime').innerText = fmt(audio.duration);
    };
    document.getElementById('seekRange').oninput = (e) => audio.currentTime = (e.target.value/100) * audio.duration;
    audio.onended = () => isRep ? (audio.currentTime=0, audio.play()) : next();

    function fmt(s) { if(isNaN(s)) return "0:00"; const m=Math.floor(s/60), sec=Math.floor(s%60); return m+":"+(sec<10?"0"+sec:sec); }

    function openProfile() {
      if(!userData) { document.getElementById('modalProfile').style.display='block'; return; }
      document.getElementById('authSection').style.display='none';
      document.getElementById('profileSection').style.display='block';
      document.getElementById('profName').innerText = userData.username;
      document.getElementById('modalProfile').style.display='block';
    }

    function openList(isFav) {
      const list = isFav ? songs.filter(s => favs.includes(s.key)) : songs;
      document.getElementById('songContainer').innerHTML = list.map(s => `
        <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #222" onclick="setup(${songs.indexOf(s)}); document.getElementById('modalList').style.display='none'">
          <div><b>${s.title}</b><br><small style="color:#b3b3b3">@${s.by}</small></div>
          <span onclick="toggleFav('${s.key}', event)" style="color:${favs.includes(s.key)?'#1DB954':'#444'}">‚≠ê</span>
        </div>
      `).join('');
      document.getElementById('modalList').style.display='block';
    }

    function toggleFav(key, e) {
        e.stopPropagation();
        favs = favs.includes(key) ? favs.filter(k => k !== key) : [...favs, key];
        localStorage.setItem('exeFavs', JSON.stringify(favs));
        showToast("Library Updated");
        openList(false);
    }

    function toggleShuffle() { isShuf = !isShuf; document.getElementById('shufBtn').classList.toggle('active', isShuf); }
    function toggleRepeat() { isRep = !isRep; document.getElementById('repBtn').classList.toggle('active', isRep); }

    function showToast(m) { const t = document.getElementById('toast'); t.innerText = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
  </script>
</body>
</html>
