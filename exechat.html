<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ExeChat | Admin Control</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --main: #3b82f6; --admin: #ef4444; --bg: #09090b; --panel: #16161a; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #eee; font-family: sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        
        /* Layout */
        header { padding: 15px; background: #111; border-bottom: 2px solid #222; text-align: center; color: var(--main); font-weight: 800; font-size: 1.3rem; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        
        /* Announcement Card */
        .anno-card { background: linear-gradient(45deg, #1e3a8a, #3b82f6); padding: 15px; border-radius: 12px; border-left: 5px solid white; margin-bottom: 10px; animation: slideIn 0.5s ease; }
        .anno-title { font-weight: 900; font-size: 12px; text-transform: uppercase; color: #bfdbfe; }
        
        /* Bubbles */
        .msg { padding: 12px; border-radius: 15px; max-width: 85%; font-size: 14px; position: relative; }
        .warga { background: var(--panel); align-self: flex-start; border: 1px solid #333; }
        .admin { background: rgba(239, 68, 68, 0.15); border: 1px solid var(--admin); align-self: flex-start; color: #fecaca; }
        .tag { font-size: 10px; font-weight: bold; display: block; margin-bottom: 4px; }

        /* Input area */
        .footer { padding: 15px; background: #111; border-top: 1px solid #222; }
        .input-wrap { display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #000; color: white; outline: none; }
        button { background: var(--main); color: white; border: none; padding: 0 20px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        button:disabled { background: #333; cursor: not-allowed; }

        @keyframes slideIn { from { transform: translateX(-100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>

<header id="chat-title">ExeChat</header>
<div id="chat-box"></div>

<div class="footer">
    <div class="input-wrap">
        <input type="text" id="userMsg" placeholder="Ketik pesan..." autocomplete="off">
        <button id="btnSend" onclick="handleSend()">SEND</button>
    </div>
</div>

<script>
    // === 1. TEMPEL KODE FIREBASE CONFIG KAMU DI SINI ===
    const firebaseConfig = {
        apiKey: "AIzaSyCl4ei8kfMaBoQEokFE5FlkPvz-NdEhQXw",
        authDomain: "exeai-eefc8.firebaseapp.com",
        databaseURL: "https://exeai-eefc8-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "exeai-eefc8",
        storageBucket: "exeai-eefc8.firebasestorage.app",
        messagingSenderId: "1013428002517",
        appId: "1:1013428002517:web:6e3e07a810167c97bb8c5c"
    };

    // === SETTINGS ===
    const PW_B64 = "aGV4a3kxMjM="; // Ini adalah "hexky123" dalam Base64 agar tidak terbaca jelas
    let myName = "someone" + Math.floor(1000 + Math.random() * 9000);
    let isAdmin = false;
    let isChatStopped = false;

    // --- LOGIKA KIRIM ---
    function handleSend() {
        const input = document.getElementById('userMsg');
        const text = input.value.trim();
        if (!text) return;

        // 1. Fitur Login
        if (text.startsWith("/login ")) {
            if (btoa(text.replace("/login ", "")) === PW_B64) {
                isAdmin = true; myName = "Admin Hexky";
                alert("ðŸ‘‘ Admin Activated!");
            } else { alert("âŒ Wrong Password!"); }
            input.value = ""; return;
        }

        // 2. Cek Lock Chat (Untuk Warga)
        if (isChatStopped && !isAdmin) {
            alert("âš ï¸ Chat sedang dihentikan oleh Admin!");
            return;
        }

        // 3. Block Link (Untuk Warga)
        if (!isAdmin && (text.includes("http://") || text.includes("https://"))) {
            alert("âŒ Dilarang mengirim link!");
            return;
        }

        // --- COMMAND ADMIN ---
        if (isAdmin) {
            if (text === "/clearchat") {
                db.ref("messages").remove();
                input.value = ""; return;
            }
            if (text.startsWith("/announcement ")) {
                db.ref("messages").push({
                    type: "anno",
                    nama: "Admin Hexky",
                    pesan: text.replace("/announcement ", ""),
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                input.value = ""; return;
            }
            if (text === "/stopchat") {
                isChatStopped = !isChatStopped;
                db.ref("room_status").set({ locked: isChatStopped });
                alert(isChatStopped ? "Chat Stopped" : "Chat Resumed");
                input.value = ""; return;
            }
        }

        // Kirim Chat Biasa
        db.ref("messages").push({
            nama: myName,
            pesan: text,
            role: isAdmin ? "admin" : "user",
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });

        input.value = "";
        applyCooldown();
    }

    // --- LISTENER REALTIME ---
    db.ref("messages").limitToLast(50).on("child_added", (snapshot) => {
        const data = snapshot.val();
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');

        if (data.type === "anno") {
            div.className = "anno-card";
            div.innerHTML = `<div class="anno-title">ðŸ“¢ Announcement</div><div><b>${data.nama}:</b> ${data.pesan}</div>`;
        } else {
            div.className = `msg ${data.role === 'admin' ? 'admin' : 'warga'}`;
            div.innerHTML = `<span class="tag" style="color:${data.role === 'admin' ? '#f87171' : '#3b82f6'}">${data.role === 'admin' ? 'ðŸ‘‘ ' : ''}${data.nama}</span>${data.pesan}`;
        }
        
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    // Listener Status Room
    db.ref("room_status/locked").on("value", (snap) => {
        isChatStopped = snap.val() || false;
        document.getElementById('chat-title').innerText = isChatStopped ? "ExeChat (LOCKED)" : "ExeChat";
    });

    // Clear UI saat data dihapus
    db.ref("messages").on("child_removed", () => {
        document.getElementById('chat-box').innerHTML = "";
    });

    function applyCooldown() {
        if (isAdmin) return;
        const btn = document.getElementById('btnSend');
        btn.disabled = true;
        setTimeout(() => btn.disabled = false, 5000);
    }

    document.getElementById('userMsg').addEventListener("keypress", (e) => { if(e.key === 'Enter') handleSend(); });
</script>
</body>
</html>
