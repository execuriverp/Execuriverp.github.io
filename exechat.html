<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ExeChat | Admin Console</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #09090b; --panel: #111114; --main: #3b82f6; --admin: #ef4444; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background: var(--bg); color: #e4e4e7; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; position: fixed; width: 100%; }
        
        header { background: #0f0f14; padding: 15px; border-bottom: 2px solid #222; text-align: center; font-weight: 900; color: var(--main); font-size: 1.4rem; letter-spacing: 2px; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }

        /* Bubbles */
        .msg { padding: 12px 16px; border-radius: 16px; max-width: 85%; font-size: 14px; line-height: 1.5; animation: fadeIn 0.3s ease; }
        .warga { background: var(--panel); align-self: flex-start; border: 1px solid #27272a; border-bottom-left-radius: 2px; }
        .admin-msg { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--admin); align-self: flex-start; border-bottom-left-radius: 2px; }
        .tag { font-size: 10px; font-weight: 800; display: block; margin-bottom: 4px; text-transform: uppercase; }

        /* Announcement & System Notif */
        .anno-card { background: linear-gradient(135deg, #1e3a8a, #3b82f6); padding: 16px; border-radius: 12px; border-left: 6px solid #fff; margin: 10px 0; }
        .sys-notif { text-align: center; font-size: 11px; color: #71717a; margin: 5px 0; font-style: italic; }

        /* Admin Console UI */
        #admin-launcher { position: fixed; bottom: 100px; right: 20px; background: var(--admin); width: 50px; height: 50px; border-radius: 50%; display: none; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 0 20px rgba(239, 68, 68, 0.4); font-size: 24px; z-index: 100; }
        #admin-panel { position: fixed; bottom: 160px; right: 20px; width: 280px; background: #1c1c21; border: 1px solid #333; border-radius: 15px; padding: 15px; display: none; flex-direction: column; gap: 10px; z-index: 99; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .panel-btn { background: #333; color: white; border: none; padding: 10px; border-radius: 8px; font-size: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .panel-btn:hover { background: #444; }
        .btn-red { background: #7f1d1d; color: #fca5a5; }

        /* Login Card */
        #login-card { background: var(--panel); border: 1px solid var(--main); padding: 20px; border-radius: 15px; margin: 10px 0; display: none; }
        
        .footer { background: #0c0c0e; border-top: 1px solid #222; padding: 12px 12px 30px; }
        .input-row { display: flex; gap: 10px; max-width: 900px; margin: 0 auto; }
        input { flex: 1; padding: 14px; border-radius: 12px; border: 1px solid #333; background: #000; color: white; outline: none; font-size: 16px; }
        button#btnSend { background: var(--main); color: white; border: none; padding: 0 20px; border-radius: 12px; font-weight: 800; cursor: pointer; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<header id="chat-title">ExeChat</header>
<div id="chat-box"></div>

<div id="login-area" style="padding: 0 20px;">
    <div id="login-card">
        <div style="font-weight:900; color:var(--main); margin-bottom:10px;">ADMIN VERIFICATION</div>
        <input type="password" id="adminPass" placeholder="Enter Password..." style="width:100%; margin-bottom:10px;">
        <button class="panel-btn" style="width:100%; background:var(--main)" onclick="doLogin()">VERIFY ACCESS</button>
    </div>
</div>

<div id="admin-launcher" onclick="togglePanel()">‚öôÔ∏è</div>
<div id="admin-panel">
    <div style="font-weight:900; font-size:12px; color:var(--admin); border-bottom:1px solid #333; padding-bottom:5px;">ADMIN CONSOLE</div>
    <input type="text" id="annoText" placeholder="Announcement text..." style="font-size:12px; padding:8px;">
    <button class="panel-btn" onclick="sendAnno()" style="background:var(--main)">POST ANNOUNCEMENT</button>
    <button class="panel-btn" onclick="toggleLock()" id="lockBtn">STOP CHAT</button>
    <button class="panel-btn btn-red" onclick="clearChat()">CLEAR ALL CHAT</button>
    <button class="panel-btn" onclick="togglePanel()" style="background:transparent; border:1px solid #444;">CLOSE PANEL</button>
</div>

<div class="footer">
    <div class="input-row">
        <input type="text" id="userMsg" placeholder="Tulis pesan..." autocomplete="off">
        <button id="btnSend" onclick="handleSend()">SEND</button>
    </div>
</div>

<script>
    // === CONFIG FIREBASE ===
    const firebaseConfig = { apiKey: "AIzaSyCl4ei8kfMaBoQEokFE5FlkPvz-NdEhQXw", authDomain: "exeai-eefc8.firebaseapp.com", databaseURL: "https://exeai-eefc8-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "exeai-eefc8", storageBucket: "exeai-eefc8.firebasestorage.app", messagingSenderId: "1013428002517", appId: "1:1013428002517:web:6e3e07a810167c97bb8c5c" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let remotePW = "";
    let myName = "someone" + Math.floor(1000 + Math.random() * 9000);
    let isAdmin = false;
    let isLocked = false;

    db.ref("admin_config/password").on("value", (s) => remotePW = s.val());

    // --- HANDLE LOGIN ---
    function doLogin() {
        const pass = document.getElementById('adminPass').value;
        if (btoa(pass) === remotePW.trim()) {
            isAdmin = true;
            myName = "Admin Hexky";
            document.getElementById('login-card').style.display = "none";
            document.getElementById('admin-launcher').style.display = "flex";
            alert("üëë Welcome Back, Admin Hexky!");
        } else { alert("‚ùå Wrong Password!"); }
    }

    function togglePanel() {
        const p = document.getElementById('admin-panel');
        p.style.display = p.style.display === "flex" ? "none" : "flex";
    }

    // --- ADMIN ACTIONS ---
    function sendAnno() {
        const txt = document.getElementById('annoText').value;
        if (!txt) return;
        db.ref("messages").push({ type: "anno", nama: "Admin Hexky", pesan: txt, timestamp: firebase.database.ServerValue.TIMESTAMP });
        document.getElementById('annoText').value = "";
    }

    function clearChat() {
        if (!confirm("Hapus semua chat?")) return;
        db.ref("messages").remove();
        // Kirim Notif Clear
        db.ref("messages").push({ type: "sys", pesan: `[i] Admin Hexky telah membersihkan semua chat.` });
    }

    function toggleLock() {
        db.ref("room_status").set({ locked: !isLocked });
    }

    // --- HANDLE SEND ---
    function handleSend() {
        const input = document.getElementById('userMsg');
        const text = input.value.trim();
        if (!text) return;

        if (text === "/admin") {
            document.getElementById('login-card').style.display = "block";
            input.value = ""; return;
        }

        if (isLocked && !isAdmin) { alert("‚ö†Ô∏è Chat Locked!"); return; }
        if (!isAdmin && text.includes("http")) { alert("‚ùå No Links!"); return; }

        db.ref("messages").push({
            nama: myName,
            pesan: text,
            role: isAdmin ? "admin" : "user",
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });
        input.value = "";
    }

    // --- LISTENERS ---
    db.ref("messages").limitToLast(50).on("child_added", (snap) => {
        const data = snap.val();
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');

        if (data.type === "anno") {
            div.className = "anno-card";
            div.innerHTML = `<span style="font-size:10px; font-weight:900; opacity:0.8">üì¢ ANNOUNCEMENT</span><br><b>${data.pesan}</b>`;
        } else if (data.type === "sys") {
            div.className = "sys-notif";
            div.innerText = data.pesan;
        } else {
            const isAdm = data.role === 'admin';
            div.className = `msg ${isAdm ? 'admin-msg' : 'warga'}`;
            div.innerHTML = `<span class="tag ${isAdm ? 'tag-admin' : 'tag-warga'}">${isAdm ? 'üëë ' : ''}${data.nama}</span>${data.pesan}`;
        }
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    db.ref("room_status/locked").on("value", (s) => {
        isLocked = s.val() || false;
        document.getElementById('chat-title').innerText = isLocked ? "ExeChat (LOCKED)" : "ExeChat";
        document.getElementById('lockBtn').innerText = isLocked ? "RESUME CHAT" : "STOP CHAT";
    });

    db.ref("messages").on("child_removed", () => { document.getElementById('chat-box').innerHTML = ""; });
    document.getElementById('userMsg').addEventListener("keypress", (e) => { if(e.key === 'Enter') handleSend(); });
</script>
</body>
</html>
