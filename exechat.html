<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ExeChat | Global Hub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { background: #09090b; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        header { background: #111; padding: 15px; border-bottom: 1px solid #333; text-align: center; font-weight: bold; color: #3b82f6; font-size: 1.5rem; }
        
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .msg { padding: 10px 14px; border-radius: 12px; max-width: 85%; word-wrap: break-word; font-size: 14px; position: relative; }
        .warga { background: #1f1f23; align-self: flex-start; border: 1px solid #333; border-bottom-left-radius: 2px; }
        
        /* Style Admin Hexky */
        .admin { background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444 !self; align-self: flex-start; border-bottom-left-radius: 2px; }
        .nama-admin { font-size: 11px; color: #ef4444; display: block; margin-bottom: 3px; font-weight: 900; }
        
        .ai { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; align-self: flex-start; color: #4ade80; border-bottom-left-radius: 2px; }
        .nama-anonim { font-size: 10px; color: #3b82f6; display: block; margin-bottom: 3px; font-weight: bold; }
        
        .input-area { padding: 15px; background: #0d0d0f; border-top: 1px solid #27272a; display: flex; gap: 8px; flex-direction: column; }
        .input-row { display: flex; gap: 8px; }
        input { flex: 1; padding: 12px; border-radius: 10px; border: 1px solid #333; background: #18181b; color: white; outline: none; }
        button { background: #3b82f6; color: white; border: none; padding: 0 20px; border-radius: 10px; cursor: pointer; font-weight: bold; }
        button:disabled { background: #333; cursor: not-allowed; }

        #cooldown-txt { font-size: 11px; color: #ef4444; display: none; text-align: center; }
        .notif-bar { font-size: 11px; color: #888; text-align: center; padding: 5px; background: #111; border-top: 1px solid #222; }
    </style>
</head>
<body>

<header>ExeChat</header>
<div id="chat-box"></div>

<div class="notif-bar" id="notif-text">Menghubungkan ke jaringan...</div>

<div class="input-area">
    <div id="cooldown-txt">Tunggu 5 detik sebelum mengirim lagi!</div>
    <div class="input-row">
        <input type="text" id="userMsg" placeholder="Ketik pesan..." autocomplete="off">
        <button id="btnKirim" onclick="kirimChat()">KIRIM</button>
    </div>
</div>

<script>
    // === 1. TEMPEL KODE FIREBASE CONFIG KAMU DI SINI ===
    const firebaseConfig = {
        apiKey: "AIzaSyCl4ei8kfMaBoQEokFE5FlkPvz-NdEhQXw",
        authDomain: "exeai-eefc8.firebaseapp.com",
        databaseURL: "https://exeai-eefc8-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "exeai-eefc8",
        storageBucket: "exeai-eefc8.firebasestorage.app",
        messagingSenderId: "1013428002517",
        appId: "1:1013428002517:web:6e3e07a810167c97bb8c5c"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const BRIDGE_URL = "ISI_LINK_EXEC_KAMU";

    // Set Identitas
    let myName = "Warga#" + Math.floor(1000 + Math.random() * 9000);
    // TIPS ADMIN: Ketik "/admin Hexky" di chat untuk berubah jadi admin
    let isAdmin = false;

    // --- FITUR NOTIFIKASI 20 DETIK ---
    const notices = [
        "Saat ini Hexky tidak menyediakan chat realtime.",
        "Mungkin akan delay beberapa detik jika jaringan kamu delay.",
        "Pastikan jaringan stabil agar chat tidak semakin delay.",
        "Gunakan !ask untuk bertanya kepada ExeAI."
    ];
    let noticeIdx = 0;
    setInterval(() => {
        document.getElementById('notif-text').innerText = notices[noticeIdx];
        noticeIdx = (noticeIdx + 1) % notices.length;
    }, 20000);

    // --- FITUR KIRIM CHAT & COOLDOWN ---
    let canSend = true;

    function kirimChat() {
        const input = document.getElementById('userMsg');
        const btn = document.getElementById('btnKirim');
        const cdTxt = document.getElementById('cooldown-txt');
        const text = input.value.trim();

        if (!text || !canSend) return;

        // Perintah Khusus Admin (Ketik ini di input: /login Hexky)
        if(text === "/login dadadadasdiajnduanduawbdadha78dyadahdauidgaydgadhauidgaydagdhaduagdyagd87ahdusiadbwyadg6atya718373714654534dhauidhaudaduhdwaodaksdnkwabdsd") {
            isAdmin = true;
            myName = "Admin Hexky";
            alert("Login Admin Berhasil!");
            input.value = "";
            return;
        }

        // Kirim ke Firebase
        db.ref("messages").push({
            nama: myName,
            pesan: text,
            role: isAdmin ? "admin" : "user",
            timestamp: firebase.database.ServerValue.TIMESTAMP
        });

        if (text.toLowerCase().startsWith("!ask ")) {
            tanyaAI(text.replace("!ask ", ""));
        }

        // Aktifkan Cooldown 5 Detik
        canSend = false;
        btn.disabled = true;
        cdTxt.style.display = "block";
        input.value = "";

        setTimeout(() => {
            canSend = true;
            btn.disabled = false;
            cdTxt.style.display = "none";
        }, 5000);
    }

    // --- LISTENER CHAT ---
    db.ref("messages").limitToLast(50).on("child_added", (snapshot) => {
        const data = snapshot.val();
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        
        if (data.type === "ai") {
            div.className = "msg ai";
            div.innerHTML = `<span class="nama-anonim">üõ°Ô∏è ExeAI</span>${data.pesan}`;
        } else if (data.role === "admin") {
            div.className = "msg admin";
            div.innerHTML = `<span class="nama-admin">üëë ${data.nama}</span>${data.pesan}`;
        } else {
            div.className = "msg warga";
            div.innerHTML = `<span class="nama-anonim">${data.nama}</span>${data.pesan}`;
        }
        
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    // Menangani hapus chat secara realtime (jika dihapus di Firebase)
    db.ref("messages").on("child_removed", () => {
        location.reload(); // Reload simpel untuk update tampilan jika ada yang dihapus
    });

    function tanyaAI(prompt) {
        const script = document.createElement('script');
        script.src = `${BRIDGE_URL}?prompt=${encodeURIComponent(prompt)}&callback=handleAI`;
        document.body.appendChild(script);
        script.onload = () => document.body.removeChild(script);
    }

    function handleAI(data) {
        db.ref("messages").push({ nama: "ExeAI", pesan: data.reply, type: "ai", timestamp: firebase.database.ServerValue.TIMESTAMP });
    }

    document.getElementById('userMsg').addEventListener("keypress", (e) => { if(e.key === 'Enter') kirimChat(); });
</script>

</body>
</html>
