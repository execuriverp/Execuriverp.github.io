<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ExeChat | Admin Authority</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { 
            --bg: #09090b; 
            --panel: #111114; 
            --main: #3b82f6; 
            --admin-color: #ef4444; 
            --text: #e4e4e7;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); color: var(--text); font-family: 'Inter', -apple-system, sans-serif; 
            margin: 0; display: flex; flex-direction: column; height: 100vh; 
            overflow: hidden; position: fixed; width: 100%;
        }

        /* Header Modern */
        header { 
            background: rgba(15, 15, 20, 0.9); backdrop-filter: blur(10px); 
            padding: 15px; border-bottom: 2px solid #222; text-align: center; 
            font-weight: 900; color: var(--main); font-size: 1.4rem; letter-spacing: 2px;
        }

        /* Container Chat */
        #chat-box { 
            flex: 1; overflow-y: auto; padding: 20px; display: flex; 
            flex-direction: column; gap: 12px; background-image: radial-gradient(#1a1a1a 1px, transparent 1px);
            background-size: 24px 24px;
        }

        /* Bubble Chat */
        .msg { padding: 12px 16px; border-radius: 16px; max-width: 85%; font-size: 14px; line-height: 1.5; position: relative; animation: fadeIn 0.3s ease; }
        .warga { background: var(--panel); align-self: flex-start; border: 1px solid #27272a; border-bottom-left-radius: 2px; }
        .admin { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--admin-color); align-self: flex-start; border-bottom-left-radius: 2px; }
        
        .tag { font-size: 10px; font-weight: 800; display: block; margin-bottom: 4px; text-transform: uppercase; }
        .tag-warga { color: var(--main); }
        .tag-admin { color: var(--admin-color); }

        /* Announcement Card */
        .anno-card { 
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); 
            padding: 16px; border-radius: 12px; border-left: 6px solid #fff;
            margin: 10px 0; box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            animation: slideDown 0.5s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }
        .anno-tag { font-weight: 900; font-size: 11px; color: #bfdbfe; margin-bottom: 5px; display: block; }

        /* Input Area */
        .footer { background: #0c0c0e; border-top: 1px solid #222; padding: 12px 12px 30px 12px; }
        .input-row { display: flex; gap: 10px; max-width: 900px; margin: 0 auto; width: 100%; }
        input { 
            flex: 1; padding: 14px; border-radius: 12px; border: 1px solid #333; 
            background: #000; color: white; outline: none; font-size: 16px; transition: 0.2s;
        }
        input:focus { border-color: var(--main); }
        
        button { 
            background: var(--main); color: white; border: none; padding: 0 20px; 
            border-radius: 12px; font-weight: 800; cursor: pointer; transition: 0.2s;
        }
        button:active { transform: scale(0.95); }
        button:disabled { background: #222; color: #555; cursor: not-allowed; }

        /* Notif & Status */
        .status-bar { font-size: 10px; text-align: center; padding: 6px; background: #000; color: #666; font-weight: bold; border-top: 1px solid #1a1a1a; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideDown { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>

<header id="chat-title">ExeChat</header>
<div id="chat-box"></div>
<div class="status-bar" id="notif-bar">System Connected</div>

<div class="footer">
    <div class="input-row">
        <input type="text" id="userMsg" placeholder="Tulis pesan..." autocomplete="off">
        <button id="btnSend" onclick="handleSend()">SEND</button>
    </div>
</div>

<script>
    // === 1. CONFIG FIREBASE ===
    const firebaseConfig = {
        apiKey: "AIzaSyCl4ei8kfMaBoQEokFE5FlkPvz-NdEhQXw",
        authDomain: "exeai-eefc8.firebaseapp.com",
        databaseURL: "https://exeai-eefc8-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "exeai-eefc8",
        storageBucket: "exeai-eefc8.firebasestorage.app",
        messagingSenderId: "1013428002517",
        appId: "1:1013428002517:web:6e3e07a810167c97bb8c5c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === 2. SETTINGS ===
    // Password Admin: hexky123 (Base64: aGV4a3kxMjM=)
    const PW_B64 = "aGV4a3kxMjM="; 
    let myName = "someone" + Math.floor(Math.random() * (99999 - 100) + 100);
    let isAdmin = false;
    let isLocked = false;

    // --- FUNGSI KIRIM ---
    function handleSend() {
        const input = document.getElementById('userMsg');
        const text = input.value.trim();
        if (!text) return;

        // Login Admin
        if (text.startsWith("/login ")) {
            if (btoa(text.replace("/login ", "")) === PW_B64) {
                isAdmin = true;
                myName = "Admin Hexky";
                alert("ðŸ‘‘ Admin Access Granted!");
            } else { alert("âŒ Access Denied!"); }
            input.value = ""; return;
        }

        // Check Lock
        if (isLocked && !isAdmin) {
            alert("âš ï¸ Chat sedang dikunci!");
            return;
        }

        // Admin Commands
        if (isAdmin) {
            if (text === "/clearchat") {
                db.ref("messages").remove();
                input.value = ""; return;
            }
            if (text === "/stopchat") {
                db.ref("room_status").set({ locked: !isLocked });
                input.value = ""; return;
            }
            if (text.startsWith("/announcement ")) {
                db.ref("messages").push({
                    type: "anno",
                    nama: "Admin Hexky",
                    pesan: text.replace("/announcement ", ""),
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });
                input.value = ""; return;
            }
        }

        // Push ke Firebase (Rules akan otomatis blokir link jika role bukan admin)
        db.ref("messages").push({
            nama: myName,
            pesan: text,
            role: isAdmin ? "admin" : "user",
            timestamp: firebase.database.ServerValue.TIMESTAMP
        }).catch(err => {
            alert("âŒ Gagal! (Dilarang kirim link atau database terkunci)");
        });

        input.value = "";
        applyCooldown();
    }

    // --- LISTENERS ---
    db.ref("messages").limitToLast(50).on("child_added", (snapshot) => {
        const data = snapshot.val();
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');

        if (data.type === "anno") {
            div.className = "anno-card";
            div.innerHTML = `<span class="anno-tag">ðŸ“¢ GLOBAL ANNOUNCEMENT</span><div style="font-weight:700">${data.pesan}</div>`;
        } else {
            const isAdm = data.role === 'admin';
            div.className = `msg ${isAdm ? 'admin' : 'warga'}`;
            div.innerHTML = `<span class="tag ${isAdm ? 'tag-admin' : 'tag-warga'}">${isAdm ? 'ðŸ‘‘ ' : ''}${data.nama}</span>${data.pesan}`;
        }
        
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    // Monitor Status Lock
    db.ref("room_status/locked").on("value", (s) => {
        isLocked = s.val() || false;
        document.getElementById('chat-title').innerText = isLocked ? "ExeChat (LOCKED)" : "ExeChat";
        document.getElementById('notif-bar').innerText = isLocked ? "STATUS: CHAT DISPENSED BY ADMIN" : "STATUS: CONNECTED";
    });

    // Monitor Clear Chat
    db.ref("messages").on("child_removed", () => {
        document.getElementById('chat-box').innerHTML = "";
    });

    function applyCooldown() {
        if (isAdmin) return;
        const btn = document.getElementById('btnSend');
        btn.disabled = true;
        setTimeout(() => btn.disabled = false, 5000);
    }

    document.getElementById('userMsg').addEventListener("keypress", (e) => { if(e.key === 'Enter') handleSend(); });
</script>
</body>
</html>
