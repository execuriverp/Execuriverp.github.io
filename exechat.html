<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>ExeChat | V21 Ultimate</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #050507; --panel: rgba(20, 20, 25, 0.98); --main: #3b82f6; --admin: #ef4444; }
        * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: #fff; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }

        /* Admin Colors */
        .name-rainbow { background: linear-gradient(to right, red, orange, yellow, green, blue, indigo, violet); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-size: 200%; animation: rb 2s linear infinite; font-weight: 900; }
        .name-gold { color: #ffd700 !important; font-weight: 900; text-shadow: 0 0 5px rgba(255,215,0,0.5); }
        .name-neon { color: #00f2ff !important; font-weight: 900; text-shadow: 0 0 5px rgba(0,242,255,0.5); }
        @keyframes rb { to { background-position: 200% center; } }

        header { background: #000; padding: 15px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; padding-bottom: 100px; }

        /* Announcement Card */
        .anno-card { background: linear-gradient(135deg, #1e3a8a, #3b82f6); padding: 15px; border-radius: 15px; border-left: 5px solid #fff; margin: 10px 0; animation: slideIn 0.3s ease; }

        /* Chat Bubbles */
        .msg { padding: 12px; border-radius: 15px; max-width: 85%; font-size: 14px; background: #16161a; align-self: flex-start; border: 1px solid #222; position: relative; }
        .msg-admin { border-color: rgba(239, 68, 68, 0.3); background: rgba(239, 68, 68, 0.05); }

        /* Admin Context Menu */
        #ctx-menu { position: fixed; background: #1c1c22; border: 1px solid #333; border-radius: 10px; padding: 5px; z-index: 10000; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ctx-item { padding: 10px 20px; font-size: 13px; cursor: pointer; border-radius: 5px; }
        .ctx-item:hover { background: var(--main); }

        /* Floating UI */
        #launcher { position: fixed; bottom: 130px; right: 20px; background: var(--admin); width: 50px; height: 50px; border-radius: 12px; display: none; align-items: center; justify-content: center; z-index: 100; cursor: pointer; }
        #panel { position: fixed; bottom: 190px; right: 20px; width: 280px; background: var(--panel); border: 1px solid #333; border-radius: 20px; padding: 15px; display: none; flex-direction: column; gap: 8px; z-index: 101; }

        /* Gemini Style Footer */
        .footer-area { background: #000; border-top: 1px solid #222; padding: 10px 15px calc(15px + env(safe-area-inset-bottom)); }
        .disclaimer { font-size: 10px; color: #666; text-align: center; margin-top: 8px; line-height: 1.4; }
        
        .p-btn { background: #222; color: #fff; border: none; padding: 10px; border-radius: 8px; font-size: 11px; font-weight: 700; cursor: pointer; width: 100%; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 12px; width: 100%; outline: none; }
        
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>

<div id="maint-screen" style="display:none; position:fixed; inset:0; background:#000; z-index:20000; flex-direction:column; align-items:center; justify-content:center;"><h1>üöß MAINTENANCE</h1></div>

<div id="ctx-menu">
    <div class="ctx-item" onclick="copyMsg()">Copy Text</div>
    <div class="ctx-item" onclick="pinMsg()">Sematkan (30s)</div>
</div>

<header>
    <span style="font-weight:900; color:var(--main); letter-spacing:1px;">EXECHAT</span>
    <div id="pin-area" style="font-size: 11px; color: #ffd700;"></div>
</header>

<div id="chat-box"></div>

<div id="launcher" onclick="togP()">‚öôÔ∏è</div>
<div id="panel">
    <select id="sel-color" onchange="setCol(this.value)">
        <option value="name-rainbow">Style: Rainbow</option>
        <option value="name-gold">Style: Gold</option>
        <option value="name-neon">Style: Neon Blue</option>
    </select>
    <input type="text" id="a-ann" placeholder="Isi Pengumuman...">
    <button class="p-btn" style="background:var(--main)" onclick="sendAnn()">KIRIM ANNOUNCEMENT</button>
    <button class="p-btn" style="background:#059669" onclick="sLi()">PUBLISH LINK</button>
    <button class="p-btn" onclick="preMT()" id="mtBtn">MAINTENANCE</button>
    <button class="p-btn" style="background:var(--admin)" onclick="wCh()">CLEAR ALL CHAT</button>
</div>

<div class="footer-area">
    <div style="display:flex; gap:10px;">
        <input type="text" id="u-msg" placeholder="Tulis pesan..." onkeypress="if(event.key=='Enter') hS()">
        <button onclick="hS()" style="background:var(--main); border:none; padding:0 20px; border-radius:12px; color:#fff; font-weight:800;">SEND</button>
    </div>
    <div class="disclaimer">
        ExeChat dapat membuat kesalahan. Periksa kembali responsnya.<br>
        <b>Dilarang keras untuk toxic di ExeChat!</b>
    </div>
</div>

<script>
    const _0xCf = {
        k: atob("QUl6YVN5Q2w0ZWk4a2ZNYUJvUUVva0ZFNUZsa1B2ei1OZEVoUVh3"), 
        d: atob("aHR0cHM6Ly9leGVhaS1lZWZjOC1kZWZhdWx0LXJ0ZGIuYXNpYS1zb3V0aGVhc3QxLmZpcmViYXNlZGF0YWJhc2UuYXBw"),
        p: atob("ZXhlYWktZWVmYzg="),
        a: atob("MToxMDEzNDI4MDAyNTE3OndlYjo2ZTNlMDdhODEwMTY3Yzk3YmI4YzVj")
    };
    firebase.initializeApp({ apiKey: _0xCf.k, databaseURL: _0xCf.d, projectId: _0xCf.p, appId: _0xCf.a });
    const db = firebase.database();
    
    let iA = false, iM = false, curCol = "name-rainbow", selectedMsg = "";
    let mN = "User_" + Math.floor(Math.random() * 9000);

    if (localStorage.getItem("hexAdm") === "true") {
        iA = true; mN = "Admin Hexky";
        document.getElementById('launcher').style.display = "flex";
    }

    // Fix Clear Chat History (Reactive Listener)
    db.ref("messages").on("value", snapshot => {
        const b = document.getElementById('chat-box');
        b.innerHTML = ""; 
        if (!snapshot.exists()) return;
        
        snapshot.forEach(child => {
            const d = child.val();
            const v = document.createElement('div');
            if (d.type === 'anno') {
                v.className = "anno-card";
                v.innerHTML = `<small style="opacity:0.8">üì¢ PENGUMUMAN ADMIN</small><br><b>${d.pesan}</b>`;
            } else {
                v.className = d.role === 'admin' ? "msg msg-admin" : "msg";
                const c = d.role === 'admin' ? d.color : '';
                v.innerHTML = `<span class="${c}" style="font-size:10px; display:block;">${d.nama}</span>${d.pesan}`;
                // Context Menu Event
                if(iA) {
                    v.oncontextmenu = (e) => {
                        e.preventDefault();
                        selectedMsg = d.pesan;
                        const m = document.getElementById('ctx-menu');
                        m.style.display = "block";
                        m.style.left = e.pageX + "px";
                        m.style.top = e.pageY + "px";
                    };
                }
            }
            b.appendChild(v);
        });
        b.scrollTop = b.scrollHeight;
    });

    // Close Context Menu
    window.onclick = () => document.getElementById('ctx-menu').style.display = "none";

    function copyMsg() { navigator.clipboard.writeText(selectedMsg); alert("Copied!"); }
    function pinMsg() { db.ref("pinned").set({ txt: selectedMsg, expire: Date.now() + 30000 }); }

    db.ref("pinned").on("value", s => {
        const d = s.val(), a = document.getElementById('pin-area');
        if(d && Date.now() < d.expire) {
            a.innerText = "üìå Pinned: " + d.txt;
            setTimeout(() => db.ref("pinned").set(null), d.expire - Date.now());
        } else { a.innerText = ""; }
    });

    function hS() {
        const i = document.getElementById('u-msg'), t = i.value.trim();
        if (!t || (iM && !iA)) return;
        if (t === "/admin") { localStorage.setItem("hexAdm", "true"); location.reload(); return; }
        db.ref("messages").push({ nama: mN, pesan: t, role: iA?"admin":"user", color: iA?curCol:'', ts: firebase.database.ServerValue.TIMESTAMP });
        i.value = "";
    }

    function sendAnn() {
        const t = document.getElementById('a-ann').value;
        if(t) db.ref("messages").push({ type: 'anno', pesan: t, ts: Date.now() });
        document.getElementById('a-ann').value = ""; togP();
    }

    function wCh() { if(confirm("Bersihkan database?")) db.ref("messages").set(null); togP(); }
    function togP() { const p = document.getElementById('panel'); p.style.display = p.style.display==='flex'?'none':'flex'; }
    function setCol(v) { curCol = v; db.ref("admin_config/color").set(v); }
    function preMT() { db.ref("room_status/maint").set(!iM); }

    db.ref("room_status/maint").on("value", s => {
        iM = s.val();
        document.getElementById('maint-screen').style.display = (iM && !iA) ? "flex" : "none";
        document.getElementById('mtBtn').innerText = iM ? "MT: ON" : "MT: OFF";
    });
</script>
</body>
</html>
