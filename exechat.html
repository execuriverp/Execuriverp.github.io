<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Execurive Global Chat | ExeAI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body { background: #09090b; color: #eee; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; }
        header { background: #111; padding: 15px; border-bottom: 1px solid #333; text-align: center; font-weight: bold; color: #3b82f6; font-size: 1.2rem; }
        #chat-box { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        
        /* Chat Bubble */
        .msg { padding: 10px 15px; border-radius: 12px; max-width: 80%; word-wrap: break-word; line-height: 1.4; }
        .warga { background: #1f1f23; align-self: flex-start; border: 1px solid #333; border-bottom-left-radius: 2px; }
        .nama-anonim { font-size: 11px; color: #3b82f6; display: block; margin-bottom: 4px; font-weight: bold; }
        
        /* ExeAI Style */
        .ai { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; align-self: flex-start; color: #4ade80; border-bottom-left-radius: 2px; }
        
        .input-area { padding: 20px; background: #09090b; border-top: 1px solid #333; display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #18181b; color: white; outline: none; }
        button { background: #3b82f6; color: white; border: none; padding: 0 25px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .info { font-size: 11px; color: #666; text-align: center; margin-bottom: 5px; }
    </style>
</head>
<body>

<header>EXE AI GLOBAL CHAT</header>
<div id="chat-box"></div>
<div class="info">Ketik <b>!ask [pesan]</b> untuk memanggil ExeAI</div>

<div class="input-area">
    <input type="text" id="userMsg" placeholder="Ketik pesan ke warga..." autocomplete="off">
    <button onclick="kirimChat()">KIRIM</button>
</div>

<script>
    // === 1. TEMPEL KODE FIREBASE CONFIG KAMU DI SINI ===
    const firebaseConfig = {
        apiKey: "AIzaSyCl4ei8kfMaBoQEokFE5FlkPvz-NdEhQXw",
        authDomain: "exeai-eefc8.firebaseapp.com",
        databaseURL: "https://exeai-eefc8-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "exeai-eefc8",
        storageBucket: "exeai-eefc8.firebasestorage.app",
        messagingSenderId: "1013428002517",
        appId: "1:1013428002517:web:6e3e07a810167c97bb8c5c"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // === 2. TEMPEL LINK GOOGLE APPS SCRIPT (EXEC) KAMU DI SINI ===
    const BRIDGE_URL = "ISI_LINK_EXEC_GOOGLE_SCRIPT_KAMU";

    // Buat Nama Anonim (Warga#1234)
    const myId = "Warga#" + Math.floor(1000 + Math.random() * 9000);

    // Fungsi Kirim ke Firebase
    function kirimChat() {
        const input = document.getElementById('userMsg');
        const text = input.value.trim();
        if (!text) return;

        db.ref("messages").push({
            nama: myId,
            pesan: text,
            time: Date.now()
        });

        // Cek jika memanggil AI
        if (text.toLowerCase().startsWith("!ask ")) {
            tanyaAI(text.replace("!ask ", ""));
        }

        input.value = "";
    }

    // Fungsi Panggil ExeAI (Bypass JSONP)
    function tanyaAI(prompt) {
        const script = document.createElement('script');
        script.src = `${BRIDGE_URL}?prompt=${encodeURIComponent(prompt)}&callback=handleAI`;
        document.body.appendChild(script);
        script.onload = () => document.body.removeChild(script);
    }

    // Respon dari AI masuk ke Firebase juga biar semua orang liat
    function handleAI(data) {
        db.ref("messages").push({
            nama: "ðŸ›¡ï¸ ExeAI (Official)",
            pesan: data.reply,
            type: "ai",
            time: Date.now()
        });
    }

    // Dengerin chat baru dari Firebase secara Real-Time
    db.ref("messages").limitToLast(50).on("child_added", (snapshot) => {
        const data = snapshot.val();
        const box = document.getElementById('chat-box');
        const div = document.createElement('div');
        const isAI = data.type === "ai";
        
        div.className = `msg ${isAI ? 'ai' : 'warga'}`;
        div.innerHTML = `<span class="nama-anonim">${data.nama}</span>${data.pesan.replace(/\n/g, '<br>')}`;
        
        box.appendChild(div);
        box.scrollTop = box.scrollHeight;
    });

    document.getElementById('userMsg').addEventListener("keypress", (e) => { if(e.key === 'Enter') kirimChat(); });
</script>

</body>
</html>
