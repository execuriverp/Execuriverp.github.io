<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miracle RP ‚Äî Community Forum</title>
<style>
:root{--bg:#0a0a0a;--bg2:#111;--bg3:#181818;--bg4:#202020;--bg5:#282828;--border:#2a2a2a;--border2:#333;--border3:#404040;--text:#e8e8e8;--text2:#aaa;--text3:#666;--accent:#fff;--accent2:#d4d4d4;--red:#e03e3e;--green:#3e9e5a;--blue:#4a90d9;--gold:#c8a84b;--purple:#9b6bc4;--pink:#d45bb4;--orange:#e07830;--radius:4px;--font:'Segoe UI',system-ui,-apple-system,sans-serif;--mono:'Courier New',monospace}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--text);font-family:var(--font);font-size:14px;line-height:1.5;min-height:100vh}
a{color:inherit;text-decoration:none}a:hover{color:var(--accent)}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:var(--bg2)}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
.wrap{max-width:1200px;margin:0 auto;padding:0 16px}
#topbar{background:var(--bg2);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200}
.topbar-inner{display:flex;align-items:center;height:50px}
.logo{font-size:17px;font-weight:800;letter-spacing:2px;color:var(--accent);white-space:nowrap;margin-right:20px;flex-shrink:0;text-transform:uppercase}
.logo span{color:var(--text3);font-weight:400;font-size:11px;margin-left:6px;letter-spacing:0;text-transform:none}
nav.main-nav{display:flex;align-items:center;gap:1px;flex:1;overflow-x:auto}
nav.main-nav a{padding:6px 11px;color:var(--text2);font-size:12px;border-radius:var(--radius);white-space:nowrap;transition:all .15s}
nav.main-nav a:hover,nav.main-nav a.active{color:var(--accent);background:var(--bg4)}
.topbar-right{display:flex;align-items:center;gap:8px;flex-shrink:0;margin-left:12px}
.btn{display:inline-flex;align-items:center;gap:5px;padding:5px 12px;border:1px solid var(--border2);border-radius:var(--radius);font-size:12px;cursor:pointer;transition:all .15s;background:transparent;color:var(--text2);font-family:var(--font);white-space:nowrap}
.btn:hover{border-color:var(--border3);color:var(--accent);background:var(--bg4)}
.btn-primary{background:var(--accent);color:#000;border-color:var(--accent);font-weight:700}
.btn-primary:hover{background:var(--accent2);border-color:var(--accent2);color:#000}
.btn-danger{background:rgba(224,62,62,.1);color:var(--red);border-color:rgba(224,62,62,.3)}
.btn-danger:hover{background:var(--red);color:#fff;border-color:var(--red)}
.btn-sm{padding:3px 9px;font-size:11px}
.hamburger{display:none;flex-direction:column;gap:4px;cursor:pointer;padding:8px;background:none;border:none}
.hamburger span{display:block;width:18px;height:2px;background:var(--text2);border-radius:2px}
.mobile-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:300}
.mobile-overlay.open{display:block}
.mobile-nav{display:flex;flex-direction:column;position:fixed;top:0;left:0;width:270px;height:100vh;background:var(--bg2);border-right:1px solid var(--border);z-index:301;padding:16px 12px;gap:2px;overflow-y:auto;transform:translateX(-100%);transition:transform .25s ease}
.mobile-nav.open{transform:translateX(0)}
.mobile-nav-logo{font-size:15px;font-weight:800;color:var(--accent);padding:4px 10px 14px;border-bottom:1px solid var(--border);margin-bottom:8px;letter-spacing:2px}
.mobile-nav-close{position:absolute;top:14px;right:14px;background:none;border:none;color:var(--text2);font-size:18px;cursor:pointer}
.mobile-nav a{display:block;padding:9px 10px;color:var(--text2);border-radius:var(--radius);font-size:13px;transition:all .15s}
.mobile-nav a:hover{background:var(--bg4);color:var(--accent)}
.page-layout{display:flex;gap:18px;padding:18px 0 40px;align-items:flex-start}
.main-col{flex:1;min-width:0}
.side-col{width:250px;flex-shrink:0;display:flex;flex-direction:column;gap:10px}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.category{margin-bottom:14px}
.cat-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--text3);padding:0 0 7px;border-bottom:1px solid var(--border);margin-bottom:3px}
.forum-row{display:flex;align-items:center;padding:11px 13px;border-bottom:1px solid var(--border);gap:11px;transition:background .1s;cursor:pointer}
.forum-row:last-child{border-bottom:none}
.forum-row:hover{background:var(--bg3)}
.forum-icon{width:34px;height:34px;border-radius:var(--radius);background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0;border:1px solid var(--border)}
.forum-icon.unread{border-color:var(--accent)}
.forum-info{flex:1;min-width:0}
.forum-name{font-size:13px;font-weight:600;color:var(--text);margin-bottom:2px}
.forum-desc{font-size:11px;color:var(--text3)}
.forum-sub{display:flex;flex-wrap:wrap;gap:4px;margin-top:3px}
.forum-sub span{font-size:10px;color:var(--text3)}
.forum-sub span::after{content:'¬∑';margin-left:4px}
.forum-sub span:last-child::after{content:''}
.forum-stats{text-align:right;flex-shrink:0;min-width:65px}
.forum-stats .count{font-size:14px;font-weight:700;color:var(--text);display:block}
.forum-stats .label{font-size:10px;color:var(--text3)}
.forum-last{flex-shrink:0;min-width:140px;max-width:170px;text-align:right}
.forum-last .topic-link{font-size:11px;color:var(--text2);display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-bottom:2px}
.forum-last .meta{font-size:10px;color:var(--text3)}
.widget{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.widget-title{padding:9px 12px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--text3);border-bottom:1px solid var(--border)}
.widget-body{padding:10px 12px}
.server-block{padding:9px;border:1px solid var(--border);border-radius:var(--radius);margin-bottom:7px;cursor:pointer;transition:border-color .15s}
.server-block:last-child{margin-bottom:0}
.server-block:hover{border-color:var(--border2)}
.server-block .srv-type{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);margin-bottom:3px}
.server-block .srv-addr{font-family:var(--mono);color:var(--accent2);font-size:12px}
.online-count{font-size:20px;font-weight:700;color:var(--accent)}
.online-sub{font-size:11px;color:var(--text3);margin-bottom:10px}
.online-tags{display:flex;flex-wrap:wrap;gap:5px}
.online-tag{display:flex;align-items:center;gap:4px;font-size:11px;color:var(--text2)}
.online-tag .dot{width:6px;height:6px;border-radius:50%;background:var(--green);flex-shrink:0}
.stat-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-size:12px}
.stat-row:last-child{border-bottom:none}
.stat-row .s-val{font-weight:700;color:var(--accent)}
.rt-item{padding:7px 0;border-bottom:1px solid var(--border)}
.rt-item:last-child{border-bottom:none;padding-bottom:0}
.rt-item a{font-size:12px;color:var(--text2);display:block;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.rt-item a:hover{color:var(--accent)}
.rt-item .rt-meta{font-size:10px;color:var(--text3);margin-top:1px}
.breadcrumb{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--text3);margin-bottom:12px}
.breadcrumb a:hover{color:var(--accent)}
.breadcrumb .sep{color:var(--border2)}
.announce-bar{background:var(--bg3);border:1px solid var(--border);border-left:3px solid var(--accent);border-radius:var(--radius);padding:9px 12px;font-size:12px;color:var(--text2);margin-bottom:14px;display:flex;align-items:center;gap:9px}
.announce-bar strong{color:var(--accent)}
.tabs{display:flex;border-bottom:1px solid var(--border);margin-bottom:14px}
.tab-btn{padding:7px 14px;font-size:12px;color:var(--text3);cursor:pointer;border-bottom:2px solid transparent;margin-bottom:-1px;transition:all .15s;background:none;border-top:none;border-left:none;border-right:none;font-family:var(--font)}
.tab-btn:hover{color:var(--text)}
.tab-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab-panel{display:none}
.tab-panel.active{display:block}
.pagination{display:flex;align-items:center;gap:3px;justify-content:center;padding:14px 0}
.page-btn{width:30px;height:30px;border-radius:var(--radius);display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--text2);border:1px solid var(--border);cursor:pointer;transition:all .1s;background:none;font-family:var(--font)}
.page-btn:hover,.page-btn.active{background:var(--bg4);color:var(--accent);border-color:var(--border2)}
.notif-dot{display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--red);margin-left:3px;vertical-align:middle}
.form-row{display:flex;flex-direction:column;gap:4px;margin-bottom:12px}
.form-label{font-size:11px;font-weight:600;color:var(--text2)}
.form-input{background:var(--bg4);border:1px solid var(--border);border-radius:var(--radius);padding:7px 10px;color:var(--text);font-size:13px;font-family:var(--font);outline:none;transition:border-color .15s;width:100%}
.form-input:focus{border-color:var(--border3)}
select.form-input{cursor:pointer}
textarea.form-input{resize:vertical;min-height:90px}
.badge-status{display:inline-block;padding:2px 7px;border-radius:2px;font-size:10px;font-weight:700}
.bs-active{background:rgba(62,158,90,.15);color:var(--green);border:1px solid rgba(62,158,90,.3)}
.bs-banned{background:rgba(224,62,62,.15);color:var(--red);border:1px solid rgba(224,62,62,.3)}
.bs-warn{background:rgba(200,168,75,.15);color:var(--gold);border:1px solid rgba(200,168,75,.3)}
.bs-pending{background:rgba(74,144,217,.15);color:var(--blue);border:1px solid rgba(74,144,217,.3)}
.bs-process{background:rgba(224,120,48,.15);color:var(--orange);border:1px solid rgba(224,120,48,.3)}
.topic-badge{display:inline-block;padding:1px 5px;border-radius:2px;font-size:9px;font-weight:700;margin-right:4px;text-transform:uppercase;letter-spacing:.3px}
.badge-pinned{background:rgba(62,158,90,.15);color:var(--green);border:1px solid rgba(62,158,90,.3)}
.badge-hot{background:rgba(224,62,62,.15);color:var(--red);border:1px solid rgba(224,62,62,.3)}
.role-owner{color:#ff6b6b;font-weight:700}
.role-admin{color:var(--red);font-weight:700}
.role-developer{color:var(--blue);font-weight:700}
.role-gm{color:var(--green);font-weight:700}
.role-helper{color:var(--purple);font-weight:700}
.role-vip{color:var(--gold);font-weight:700}
.role-member{color:var(--text2)}
.topic-row{display:flex;align-items:center;padding:9px 13px;border-bottom:1px solid var(--border);gap:10px;transition:background .1s}
.topic-row:hover{background:var(--bg3)}
.topic-row:last-child{border-bottom:none}
.topic-icon{width:30px;height:30px;border-radius:50%;background:var(--bg4);flex-shrink:0;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--text2);overflow:hidden}
.topic-main{flex:1;min-width:0}
.topic-title{font-size:13px;font-weight:600;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:2px}
.topic-meta{font-size:10px;color:var(--text3)}
.topic-replies{text-align:center;flex-shrink:0;width:48px}
.topic-replies .num{font-size:14px;font-weight:700;display:block}
.topic-replies .lbl{font-size:9px;color:var(--text3);text-transform:uppercase}
.topic-last{flex-shrink:0;min-width:110px;text-align:right}
.topic-last .time{font-size:10px;color:var(--text3);display:block}
.profile-banner{height:130px;background:linear-gradient(135deg,#111 0%,#1a1a1a 50%,#0d0d0d 100%);border-bottom:1px solid var(--border);position:relative;overflow:hidden}
.profile-banner::after{content:'';position:absolute;inset:0;background:repeating-linear-gradient(45deg,transparent,transparent 10px,rgba(255,255,255,.012) 10px,rgba(255,255,255,.012) 11px)}
.profile-head{display:flex;align-items:flex-end;gap:14px;padding:0 18px 14px;margin-top:-34px;position:relative}
.profile-avatar-wrap{position:relative;flex-shrink:0}
.profile-avatar{width:76px;height:76px;border-radius:50%;border:3px solid var(--bg2);background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:700;color:var(--text2);overflow:hidden}
.profile-avatar img{width:100%;height:100%;object-fit:cover}
.profile-edit-btn{position:absolute;bottom:0;right:0;width:22px;height:22px;border-radius:50%;background:var(--bg4);border:1px solid var(--border2);display:flex;align-items:center;justify-content:center;font-size:10px;cursor:pointer;color:var(--text2);transition:all .15s}
.profile-edit-btn:hover{background:var(--border2);color:var(--accent)}
.profile-name{font-size:18px;font-weight:700;color:var(--accent)}
.profile-role-badge{display:inline-block;padding:2px 7px;border-radius:2px;font-size:10px;font-weight:700;margin-top:3px}
.rb-admin{background:rgba(224,62,62,.15);color:var(--red);border:1px solid rgba(224,62,62,.3)}
.rb-helper{background:rgba(155,107,196,.15);color:var(--purple);border:1px solid rgba(155,107,196,.3)}
.rb-vip{background:rgba(200,168,75,.15);color:var(--gold);border:1px solid rgba(200,168,75,.3)}
.rb-member{background:rgba(255,255,255,.06);color:var(--text2);border:1px solid var(--border)}
.profile-stats-row{display:flex;gap:18px;margin-top:8px}
.p-stat .v{font-size:16px;font-weight:700;color:var(--accent);display:block}
.p-stat .l{font-size:10px;color:var(--text3);text-transform:uppercase}
.chat-layout{display:flex;height:calc(100vh - 120px);background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden}
.chat-sidebar{width:250px;flex-shrink:0;border-right:1px solid var(--border);display:flex;flex-direction:column}
.chat-sidebar-header{padding:12px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.chat-sidebar-title{font-size:12px;font-weight:700;color:var(--accent)}
.chat-search{padding:7px 10px;border-bottom:1px solid var(--border)}
.chat-search input{width:100%;background:var(--bg4);border:1px solid var(--border);border-radius:var(--radius);padding:5px 9px;color:var(--text);font-size:12px;font-family:var(--font);outline:none}
.chat-search input::placeholder{color:var(--text3)}
.chat-list{flex:1;overflow-y:auto}
.chat-item{display:flex;align-items:center;gap:9px;padding:9px 11px;cursor:pointer;border-bottom:1px solid var(--border);transition:background .1s;position:relative}
.chat-item:hover{background:var(--bg3)}
.chat-item.active{background:var(--bg4)}
.chat-item.unread-item::before{content:'';position:absolute;left:0;top:50%;transform:translateY(-50%);width:3px;height:22px;background:var(--accent);border-radius:0 2px 2px 0}
.chat-ava{width:36px;height:36px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--text2);position:relative;overflow:hidden}
.chat-ava img{width:100%;height:100%;object-fit:cover}
.online-dot{position:absolute;bottom:1px;right:1px;width:8px;height:8px;border-radius:50%;background:var(--green);border:2px solid var(--bg2)}
.chat-item-info{flex:1;min-width:0}
.chat-item-name{font-size:12px;font-weight:600;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.chat-item-preview{font-size:10px;color:var(--text3);overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-top:1px}
.chat-item-time{font-size:9px;color:var(--text3);flex-shrink:0}
.chat-unread-badge{position:absolute;top:7px;right:9px;background:var(--accent);color:#000;font-size:9px;font-weight:700;width:16px;height:16px;border-radius:50%;display:flex;align-items:center;justify-content:center}
.chat-main{flex:1;display:flex;flex-direction:column;min-width:0}
.chat-main-header{padding:10px 14px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:9px}
.chat-header-name{font-size:13px;font-weight:700;color:var(--accent)}
.chat-header-status{font-size:10px;color:var(--green)}
.chat-messages{flex:1;overflow-y:auto;padding:14px;display:flex;flex-direction:column;gap:10px}
.msg-group{display:flex;gap:9px;align-items:flex-end}
.msg-group.mine{flex-direction:row-reverse}
.msg-ava{width:26px;height:26px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--text2);overflow:hidden}
.msg-bubbles{display:flex;flex-direction:column;gap:3px;max-width:65%}
.msg-group.mine .msg-bubbles{align-items:flex-end}
.msg-bubble{padding:7px 11px;border-radius:12px;font-size:12px;line-height:1.45;word-break:break-word;background:var(--bg4);color:var(--text);border:1px solid var(--border)}
.msg-bubble:only-child{border-radius:3px 12px 12px 12px}
.msg-group.mine .msg-bubble:only-child{border-radius:12px 3px 12px 12px}
.msg-group.mine .msg-bubble{background:var(--bg5);border-color:var(--border2)}
.msg-time{font-size:10px;color:var(--text3);margin-top:2px}
.msg-group.mine .msg-time{text-align:right}
.date-sep{text-align:center;font-size:10px;color:var(--text3);padding:3px 0;display:flex;align-items:center;gap:8px}
.date-sep::before,.date-sep::after{content:'';flex:1;height:1px;background:var(--border)}
.chat-input-area{padding:10px 14px;border-top:1px solid var(--border);display:flex;align-items:flex-end;gap:7px}
.chat-input-wrap{flex:1;background:var(--bg4);border:1px solid var(--border);border-radius:18px;display:flex;align-items:flex-end;gap:7px;padding:7px 12px;transition:border-color .15s}
.chat-input-wrap:focus-within{border-color:var(--border3)}
.chat-textarea{flex:1;background:none;border:none;color:var(--text);font-size:12px;font-family:var(--font);outline:none;resize:none;max-height:100px;line-height:1.5;padding:0}
.chat-textarea::placeholder{color:var(--text3)}
.chat-action-btn{background:none;border:none;color:var(--text3);cursor:pointer;font-size:14px;padding:2px;line-height:1}
.chat-send-btn{width:34px;height:34px;border-radius:50%;background:var(--accent);color:#000;border:none;cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;flex-shrink:0}
.chat-send-btn:hover{background:var(--accent2)}
.feed-composer{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:14px;margin-bottom:12px}
.composer-row{display:flex;gap:10px;align-items:flex-start}
.composer-input{flex:1;background:var(--bg4);border:1px solid var(--border);border-radius:var(--radius);padding:9px 12px;color:var(--text);font-size:13px;font-family:var(--font);outline:none;resize:none;min-height:60px;transition:border-color .15s}
.composer-input:focus{border-color:var(--border3)}
.composer-input::placeholder{color:var(--text3)}
.composer-actions{display:flex;align-items:center;gap:8px;margin-top:10px}
.post-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:8px}
.post-header{display:flex;align-items:center;gap:10px;padding:12px 14px 0}
.post-avatar{width:36px;height:36px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700;color:var(--text2);overflow:hidden}
.post-avatar img{width:100%;height:100%;object-fit:cover}
.post-author{font-size:13px;font-weight:600}
.post-time{font-size:11px;color:var(--text3);margin-top:1px}
.post-body{padding:10px 14px;font-size:13px;color:var(--text2);line-height:1.6}
.post-image{width:100%;max-height:300px;object-fit:cover;border-top:1px solid var(--border);border-bottom:1px solid var(--border);display:block;cursor:pointer}
.post-actions{display:flex;align-items:center;gap:6px;padding:8px 14px 12px;border-top:1px solid var(--border);margin-top:8px;flex-wrap:wrap}
.reaction-btn{background:none;border:1px solid var(--border);border-radius:20px;padding:4px 10px;font-size:12px;color:var(--text3);cursor:pointer;font-family:var(--font);transition:all .15s;display:flex;align-items:center;gap:4px}
.reaction-btn:hover{border-color:var(--border2);color:var(--text2)}
.reaction-btn.active{border-color:var(--border3);color:var(--accent);background:rgba(255,255,255,.05)}
.post-comments{border-top:1px solid var(--border);padding:10px 14px}
.comment-item{display:flex;gap:8px;margin-bottom:8px}
.comment-item:last-child{margin-bottom:0}
.comment-ava{width:26px;height:26px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;color:var(--text2)}
.comment-body{background:var(--bg3);border-radius:var(--radius);padding:6px 10px;flex:1}
.comment-author{font-size:11px;font-weight:600;color:var(--text);margin-bottom:2px}
.comment-text{font-size:12px;color:var(--text2)}
.comment-input-row{display:flex;gap:8px;align-items:center;margin-top:8px}
.comment-input{flex:1;background:var(--bg4);border:1px solid var(--border);border-radius:20px;padding:6px 12px;color:var(--text);font-size:12px;font-family:var(--font);outline:none}
.comment-input::placeholder{color:var(--text3)}
.feed-announce{background:var(--bg3);border:1px solid var(--border);border-left:3px solid var(--red);border-radius:var(--radius);padding:12px 14px;margin-bottom:10px}
.feed-announce .ann-title{font-size:13px;font-weight:700;color:var(--accent);margin-bottom:4px}
.feed-announce .ann-body{font-size:12px;color:var(--text2);line-height:1.6}
.feed-announce .ann-meta{font-size:10px;color:var(--text3);margin-top:6px}
.wl-progress{display:flex;align-items:center;margin-bottom:20px}
.wl-step{display:flex;align-items:center;flex:1}
.wl-step-circle{width:28px;height:28px;border-radius:50%;border:2px solid var(--border2);background:var(--bg3);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;color:var(--text3);flex-shrink:0;transition:all .3s}
.wl-step.done .wl-step-circle{background:var(--green);border-color:var(--green);color:#fff}
.wl-step.active .wl-step-circle{border-color:var(--accent);color:var(--accent)}
.wl-step-label{font-size:10px;color:var(--text3);margin-left:6px;white-space:nowrap}
.wl-step.done .wl-step-label{color:var(--green)}
.wl-step.active .wl-step-label{color:var(--accent)}
.wl-step-line{flex:1;height:1px;background:var(--border);margin:0 6px}
.wl-status-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:24px;text-align:center}
.wl-status-icon{font-size:40px;margin-bottom:10px}
.wl-status-title{font-size:16px;font-weight:700;margin-bottom:6px}
.wl-status-desc{font-size:12px;color:var(--text3);line-height:1.6}
.staff-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px}
.staff-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:14px;text-align:center;transition:border-color .15s;cursor:pointer}
.staff-card:hover{border-color:var(--border2)}
.staff-avatar{width:52px;height:52px;border-radius:50%;background:var(--bg4);border:2px solid var(--border);margin:0 auto 8px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:700;color:var(--text2);overflow:hidden}
.staff-name{font-size:13px;font-weight:600;margin-bottom:3px}
.staff-role{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px}
.import-type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:14px}
.import-type-btn{background:var(--bg4);border:2px solid var(--border);border-radius:var(--radius);padding:12px 8px;text-align:center;cursor:pointer;transition:all .2s}
.import-type-btn:hover{border-color:var(--border2)}
.import-type-btn.selected{border-color:var(--accent);background:rgba(255,255,255,.05)}
.import-type-btn .it-icon{font-size:22px;margin-bottom:5px}
.import-type-btn .it-label{font-size:11px;font-weight:600;color:var(--text2)}
.time-slots{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.time-slot{background:var(--bg4);border:1px solid var(--border);border-radius:var(--radius);padding:5px 10px;font-size:11px;color:var(--text2);cursor:pointer;transition:all .15s}
.time-slot:hover{border-color:var(--border2)}
.time-slot.selected{border-color:var(--accent);color:var(--accent);background:rgba(255,255,255,.05)}
.time-slot.unavailable{opacity:.4;cursor:not-allowed;text-decoration:line-through}
.lb-row{display:flex;align-items:center;gap:10px;padding:10px 13px;border-bottom:1px solid var(--border);transition:background .1s}
.lb-row:hover{background:var(--bg3)}
.lb-row:last-child{border-bottom:none}
.lb-rank{width:26px;text-align:center;font-size:12px;font-weight:700;color:var(--text3);flex-shrink:0}
.lb-rank.top1{color:var(--gold)}.lb-rank.top2{color:var(--text2)}.lb-rank.top3{color:#cd7f32}
.lb-avatar{width:34px;height:34px;border-radius:50%;background:var(--bg4);border:1px solid var(--border);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:var(--text2);overflow:hidden}
.lb-info{flex:1;min-width:0}
.lb-name{font-size:13px;font-weight:600;color:var(--text)}
.lb-sub{font-size:10px;color:var(--text3)}
.lb-rep{font-size:13px;font-weight:700;color:var(--green);flex-shrink:0}
.media-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:9px}
.media-item{background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;cursor:pointer;transition:border-color .15s}
.media-item:hover{border-color:var(--border2)}
.media-thumb{width:100%;aspect-ratio:16/9;background:var(--bg4);display:flex;align-items:center;justify-content:center;font-size:26px;color:var(--text3)}
.media-caption{padding:7px 9px;font-size:11px;color:var(--text2)}
.media-meta{font-size:10px;color:var(--text3);margin-top:1px}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:500;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);width:90%;max-width:420px;max-height:90vh;overflow-y:auto}
.modal-header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid var(--border)}
.modal-title{font-size:14px;font-weight:700;color:var(--accent)}
.modal-close{background:none;border:none;color:var(--text3);font-size:18px;cursor:pointer;line-height:1}
.modal-close:hover{color:var(--accent)}
.modal-body{padding:16px}
.modal-footer{padding:12px 16px;border-top:1px solid var(--border);display:flex;gap:8px;justify-content:flex-end}
.toast-container{position:fixed;bottom:20px;right:20px;z-index:600;display:flex;flex-direction:column;gap:8px}
.toast{background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:10px 16px;font-size:12px;color:var(--text);display:flex;align-items:center;gap:8px;min-width:200px;animation:slideIn .2s ease}
.toast.success{border-left:3px solid var(--green)}.toast.error{border-left:3px solid var(--red)}.toast.info{border-left:3px solid var(--blue)}
@keyframes slideIn{from{transform:translateX(20px);opacity:0}to{transform:translateX(0);opacity:1}}
.admin-layout{display:flex;min-height:calc(100vh - 50px);margin:0 -16px}
.admin-sidebar{width:210px;flex-shrink:0;background:var(--bg2);border-right:1px solid var(--border);padding:14px 0}
.admin-nav-section{margin-bottom:14px}
.admin-nav-label{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--text3);padding:0 14px 5px}
.admin-nav-item{display:flex;align-items:center;gap:7px;padding:7px 14px;font-size:12px;color:var(--text2);cursor:pointer;transition:all .1s}
.admin-nav-item:hover,.admin-nav-item.active{background:var(--bg4);color:var(--accent)}
.admin-nav-item .icon{width:14px;text-align:center}
.admin-content{flex:1;padding:22px;overflow:auto}
.admin-page-title{font-size:18px;font-weight:700;color:var(--accent);margin-bottom:18px}
.admin-cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:10px;margin-bottom:20px}
.admin-card{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);padding:14px}
.admin-card .ac-label{font-size:10px;color:var(--text3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:3px}
.admin-card .ac-val{font-size:26px;font-weight:700;color:var(--accent)}
.admin-card .ac-sub{font-size:10px;color:var(--text3);margin-top:2px}
.table-wrap{background:var(--bg2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;overflow-x:auto}
table{width:100%;border-collapse:collapse;min-width:500px}
th{padding:9px 12px;text-align:left;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--text3);border-bottom:1px solid var(--border);background:var(--bg3)}
td{padding:9px 12px;font-size:12px;color:var(--text2);border-bottom:1px solid var(--border)}
tr:last-child td{border-bottom:none}
tr:hover td{background:var(--bg3)}
.report-info{background:var(--bg3);border:1px solid var(--border);border-radius:var(--radius);padding:10px 12px;font-size:12px;color:var(--text2);margin-bottom:14px}
.report-info strong{color:var(--accent)}
.d-flex-center{display:flex;align-items:center}
.justify-between{justify-content:space-between}
.mb12{margin-bottom:12px}
.text-dim{color:var(--text3)}
.text-bold{font-weight:700}
#loader{position:fixed;inset:0;background:var(--bg);z-index:999;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;transition:opacity .3s}
#loader.hidden{opacity:0;pointer-events:none}
.loader-logo{font-size:22px;font-weight:800;letter-spacing:3px;color:var(--accent)}
.loader-bar-wrap{width:160px;height:2px;background:var(--border);border-radius:2px;overflow:hidden}
.loader-bar{height:100%;background:var(--accent);animation:loadBar 1.2s ease-in-out forwards}
@keyframes loadBar{0%{width:0%}100%{width:100%}}
.page{display:none}
.page.active{display:block}
@media(max-width:900px){.side-col{display:none}.forum-last{display:none}}
@media(max-width:700px){.hamburger{display:flex}nav.main-nav{display:none}.forum-stats{display:none}.chat-sidebar{display:none}.admin-sidebar{display:none}.topic-replies{display:none}.topic-last{display:none}.admin-cards{grid-template-columns:1fr 1fr}.staff-grid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr))}}
@media(max-width:480px){.admin-cards{grid-template-columns:1fr}}
</style>
</head>
<body>

<div id="loader">
  <div class="loader-logo">MIRACLE</div>
  <div class="loader-bar-wrap"><div class="loader-bar"></div></div>
</div>

<div class="toast-container" id="toastContainer"></div>

<!-- MOBILE NAV -->
<div class="mobile-overlay" id="mobileOverlay" onclick="closeMobileNav()"></div>
<nav class="mobile-nav" id="mobileNav">
  <button class="mobile-nav-close" onclick="closeMobileNav()">√ó</button>
  <div class="mobile-nav-logo">MIRACLE</div>
  <a href="#" onclick="showPage('forums');closeMobileNav()">üè† Home</a>
  <a href="#" onclick="showPage('feed');closeMobileNav()">üì∞ Community Feed</a>
  <a href="#" onclick="showPage('whitelist');closeMobileNav()">üìã Whitelist</a>
  <a href="#" onclick="showPage('cs');closeMobileNav()">üé≠ Character Story</a>
  <a href="#" onclick="showPage('import');closeMobileNav()">üì¶ Import Request</a>
  <a href="#" onclick="showPage('staff');closeMobileNav()">üë• Staff</a>
  <a href="#" onclick="showPage('leaderboard');closeMobileNav()">üèÜ Leaderboard</a>
  <a href="#" onclick="showPage('report');closeMobileNav()">üö© Report</a>
  <a href="#" onclick="showPage('announcements');closeMobileNav()">üì¢ Pengumuman</a>
  <a href="#" onclick="showPage('rules');closeMobileNav()">üìú Peraturan</a>
  <a href="#" onclick="showPage('profile');closeMobileNav()">üë§ Profile</a>
  <a href="#" onclick="showPage('pm');closeMobileNav()">üí¨ Pesan<span class="notif-dot" id="pmDotMobile" style="display:none"></span></a>
</nav>

<!-- TOPBAR -->
<div id="topbar">
  <div class="wrap">
    <div class="topbar-inner">
      <button class="hamburger" onclick="openMobileNav()"><span></span><span></span><span></span></button>
      <div class="logo">MIRACLE<span>RP</span></div>
      <nav class="main-nav" id="mainNav">
        <a href="#" class="active" onclick="showPage('forums',this)">Home</a>
        <a href="#" onclick="showPage('feed',this)">Feed</a>
        <a href="#" onclick="showPage('whitelist',this)">Whitelist</a>
        <a href="#" onclick="showPage('cs',this)">C.Story</a>
        <a href="#" onclick="showPage('import',this)">Import</a>
        <a href="#" onclick="showPage('staff',this)">Staff</a>
        <a href="#" onclick="showPage('leaderboard',this)">Leaderboard</a>
        <a href="#" onclick="showPage('report',this)">Report</a>
        <a href="#" onclick="showPage('announcements',this)">Pengumuman</a>
        <a href="#" onclick="showPage('pm',this)">Pesan<span class="notif-dot" id="pmDot" style="display:none"></span></a>
        <a href="#" id="adminNavLink" onclick="showPage('admin',this)" style="display:none">Admin</a>
      </nav>
      <div class="topbar-right" id="topbarRight">
        <button class="btn" onclick="openModal('loginModal')">Masuk</button>
        <button class="btn btn-primary" onclick="openModal('loginModal')">Daftar</button>
      </div>
    </div>
  </div>
</div>

<!-- MODALS -->
<div class="modal-overlay" id="loginModal">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">Masuk / Daftar</div><button class="modal-close" onclick="closeModal('loginModal')">√ó</button></div>
    <div class="modal-body">
      <p style="font-size:12px;color:var(--text3);margin-bottom:16px">Login menggunakan akun Google untuk bergabung di komunitas Miracle RP.</p>
      <button class="btn btn-primary" style="width:100%;justify-content:center;padding:10px" onclick="loginWithGoogle()">üîê Masuk dengan Google</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="newPmModal">
  <div class="modal">
    <div class="modal-header"><div class="modal-title">Pesan Baru</div><button class="modal-close" onclick="closeModal('newPmModal')">√ó</button></div>
    <div class="modal-body">
      <div class="form-row"><label class="form-label">Kirim ke (username)</label><input type="text" class="form-input" id="newPmTarget" placeholder="Nama pengguna..."></div>
      <div class="form-row"><label class="form-label">Pesan</label><textarea class="form-input" id="newPmMessage" placeholder="Tulis pesan..."></textarea></div>
    </div>
    <div class="modal-footer">
      <button class="btn" onclick="closeModal('newPmModal')">Batal</button>
      <button class="btn btn-primary" onclick="sendNewPm()">Kirim</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="imageModal" onclick="closeModal('imageModal')">
  <img id="imageModalSrc" src="" style="max-width:90vw;max-height:90vh;border-radius:4px;object-fit:contain">
</div>

<div class="wrap">

<!-- HOME -->
<div class="page active" id="page-forums">
  <div class="page-layout">
    <div class="main-col">
      <div class="announce-bar" id="topAnnounce">
        <span>üì¢</span><span><strong>Selamat datang</strong> di Miracle RP Community Forum! Login untuk akses penuh.</span>
      </div>
      <div class="category">
        <div class="cat-title">Miracle Roleplay</div>
        <div class="card">
          <div class="forum-row" onclick="showPage('feed')">
            <div class="forum-icon unread">üì∞</div>
            <div class="forum-info"><div class="forum-name">Community Feed</div><div class="forum-desc">Update, cerita, dan diskusi komunitas.</div></div>
            <div class="forum-stats"><span class="count" id="statPosts">‚Äî</span><span class="label">posts</span></div>
            <div class="forum-last"><span class="topic-link">Lihat semua post</span></div>
          </div>
          <div class="forum-row" onclick="showPage('whitelist')">
            <div class="forum-icon">üìã</div>
            <div class="forum-info"><div class="forum-name">Pendaftaran Whitelist</div><div class="forum-desc">Daftar untuk bergabung sebagai player Miracle RP.</div></div>
            <div class="forum-stats"><span class="count" id="statWL">‚Äî</span><span class="label">pending</span></div>
            <div class="forum-last"><span class="topic-link">Form pendaftaran</span></div>
          </div>
          <div class="forum-row" onclick="showPage('cs')">
            <div class="forum-icon">üé≠</div>
            <div class="forum-info"><div class="forum-name">Character Story Request</div><div class="forum-desc">Ajukan cerita latar belakang karakter kamu.</div></div>
            <div class="forum-stats"><span class="count" id="statCS">‚Äî</span><span class="label">request</span></div>
            <div class="forum-last"><span class="topic-link">Buat CS Request</span></div>
          </div>
          <div class="forum-row" onclick="showPage('import')">
            <div class="forum-icon">üì¶</div>
            <div class="forum-info"><div class="forum-name">Import Request</div><div class="forum-desc">Request import item, kendaraan, atau karakter.</div><div class="forum-sub"><span>Goodside</span><span>Badside</span><span>Family</span></div></div>
            <div class="forum-stats"><span class="count" id="statImport">‚Äî</span><span class="label">pending</span></div>
            <div class="forum-last"><span class="topic-link">Buat Import Request</span></div>
          </div>
          <div class="forum-row" onclick="showPage('report')">
            <div class="forum-icon">üö©</div>
            <div class="forum-info"><div class="forum-name">Laporan & Bantuan</div><div class="forum-desc">Laporkan pelanggaran atau minta bantuan staff.</div></div>
            <div class="forum-stats"><span class="count" id="statReports">‚Äî</span><span class="label">open</span></div>
            <div class="forum-last"><span class="topic-link">Buat laporan</span></div>
          </div>
        </div>
      </div>
      <div class="category">
        <div class="cat-title">Informasi Server</div>
        <div class="card">
          <div class="forum-row" onclick="showPage('announcements')">
            <div class="forum-icon unread">üì¢</div>
            <div class="forum-info"><div class="forum-name">Pengumuman</div><div class="forum-desc">Informasi resmi dari tim Miracle RP.</div></div>
            <div class="forum-stats"><span class="count" id="statAnnouncements">‚Äî</span><span class="label">posts</span></div>
          </div>
          <div class="forum-row" onclick="showPage('rules')">
            <div class="forum-icon">üìú</div>
            <div class="forum-info"><div class="forum-name">Peraturan Server</div><div class="forum-desc">Baca dan pahami peraturan sebelum bermain.</div></div>
          </div>
          <div class="forum-row" onclick="showPage('guides')">
            <div class="forum-icon">üìñ</div>
            <div class="forum-info"><div class="forum-name">Guide & Tutorial</div><div class="forum-desc">Panduan bermain dan fitur server.</div></div>
          </div>
          <div class="forum-row" onclick="showPage('staff')">
            <div class="forum-icon">üë•</div>
            <div class="forum-info"><div class="forum-name">Tim Staff</div><div class="forum-desc">Kenali tim admin dan staff Miracle RP.</div></div>
          </div>
        </div>
      </div>
    </div>
    <div class="side-col">
      <div class="widget">
        <div class="widget-title">Server Address</div>
        <div class="widget-body">
          <div class="server-block" onclick="copyToClip('play.miracle-rp.id:7777')">
            <div class="srv-type">SA:MP Roleplay</div><div class="srv-addr">play.miracle-rp.id:7777</div>
          </div>
          <div class="server-block" onclick="copyToClip('discord.gg/miraclerp')">
            <div class="srv-type">Discord</div><div class="srv-addr">discord.gg/miraclerp</div>
          </div>
        </div>
      </div>
      <div class="widget">
        <div class="widget-title">Online Sekarang</div>
        <div class="widget-body">
          <div class="online-count" id="onlineCount">0</div>
          <div class="online-sub" id="onlineSub">memuat...</div>
          <div class="online-tags" id="onlineTags"></div>
        </div>
      </div>
      <div class="widget">
        <div class="widget-title">Statistik</div>
        <div class="widget-body" style="padding:0 12px">
          <div class="stat-row"><span>Total Member</span><span class="s-val" id="totalMembers">‚Äî</span></div>
          <div class="stat-row"><span>Player Online</span><span class="s-val" id="playersOnline">‚Äî</span></div>
          <div class="stat-row"><span>WL Pending</span><span class="s-val" id="wlPending">‚Äî</span></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- FEED -->
<div class="page" id="page-feed">
  <div class="page-layout">
    <div class="main-col">
      <div id="feedAnnouncements"></div>
      <div id="feedComposer" style="display:none">
        <div class="feed-composer">
          <div class="composer-row">
            <div class="post-avatar" id="composerAvatar">?</div>
            <textarea class="composer-input" id="composerText" placeholder="Bagikan sesuatu ke komunitas..." rows="3"></textarea>
          </div>
          <div class="composer-actions">
            <label class="btn" style="cursor:pointer">üñºÔ∏è Foto<input type="file" accept="image/*" style="display:none" onchange="handlePostImage(event)"></label>
            <div style="flex:1"></div>
            <span id="cooldownTimer" style="font-size:11px;color:var(--text3);display:none"></span>
            <button class="btn btn-primary btn-sm" onclick="submitPost()">Posting</button>
          </div>
          <div id="postImagePreview" style="display:none;margin-top:8px">
            <img id="postImgPreviewImg" style="max-height:150px;border-radius:4px;border:1px solid var(--border)">
            <button onclick="clearPostImage()" style="background:none;border:none;color:var(--red);cursor:pointer;margin-left:8px;font-size:12px">‚úï</button>
          </div>
        </div>
      </div>
      <div id="feedList"></div>
      <div id="feedEmpty" style="display:none;text-align:center;padding:40px;color:var(--text3);font-size:13px">Belum ada post.</div>
    </div>
    <div class="side-col">
      <div class="widget"><div class="widget-title">Server Info</div><div class="widget-body"><div class="server-block"><div class="srv-type">SA:MP</div><div class="srv-addr">play.miracle-rp.id:7777</div></div></div></div>
    </div>
  </div>
</div>

<!-- WHITELIST -->
<div class="page" id="page-whitelist">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Whitelist</span></div>
      <div id="wlStatusView" style="display:none"></div>
      <div id="wlFormView">
        <div class="d-flex-center justify-between mb12"><div class="text-bold">Form Pendaftaran Whitelist</div></div>
        <div class="wl-progress">
          <div class="wl-step active" id="wlStep1"><div class="wl-step-circle">1</div><div class="wl-step-label">Data Diri</div></div>
          <div class="wl-step-line"></div>
          <div class="wl-step" id="wlStep2"><div class="wl-step-circle">2</div><div class="wl-step-label">Pengetahuan RP</div></div>
          <div class="wl-step-line"></div>
          <div class="wl-step" id="wlStep3"><div class="wl-step-circle">3</div><div class="wl-step-label">Verifikasi WA</div></div>
          <div class="wl-step-line"></div>
          <div class="wl-step" id="wlStep4"><div class="wl-step-circle">4</div><div class="wl-step-label">Selesai</div></div>
        </div>
        <div id="wlPage1" class="card" style="padding:20px">
          <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:14px">Data Diri</div>
          <div class="form-row"><label class="form-label">Nama Lengkap</label><input type="text" class="form-input" id="wlNama" placeholder="Nama lengkap kamu"></div>
          <div class="form-row"><label class="form-label">Nama Karakter (IC)</label><input type="text" class="form-input" id="wlKarakter" placeholder="Nama_Karakter"></div>
          <div class="form-row"><label class="form-label">Umur</label><input type="number" class="form-input" id="wlUmur" placeholder="Umur" style="max-width:120px"></div>
          <div class="form-row"><label class="form-label">Nomor WhatsApp</label><input type="text" class="form-input" id="wlWA" placeholder="08xxxxxxxxxx" style="max-width:200px"></div>
          <div class="form-row"><label class="form-label">Pengalaman SA:MP</label><select class="form-input" id="wlExp" style="max-width:240px"><option value="">Pilih...</option><option>Ya, sudah berpengalaman</option><option>Ya, tapi masih belajar</option><option>Belum pernah</option></select></div>
          <button class="btn btn-primary" onclick="wlNext(1)">Lanjut ‚Üí</button>
        </div>
        <div id="wlPage2" class="card" style="padding:20px;display:none">
          <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:14px">Pengetahuan Roleplay</div>
          <div class="form-row"><label class="form-label">Apa itu Roleplay?</label><textarea class="form-input" id="wlQ1" placeholder="Jelaskan dengan kata-katamu sendiri..."></textarea></div>
          <div class="form-row"><label class="form-label">Apa itu Metagaming? Contoh!</label><textarea class="form-input" id="wlQ2" placeholder="Penjelasan + contoh..."></textarea></div>
          <div class="form-row"><label class="form-label">Apa itu Powergaming? Contoh!</label><textarea class="form-input" id="wlQ3" placeholder="Penjelasan + contoh..."></textarea></div>
          <div class="form-row"><label class="form-label">Latar belakang karakter kamu</label><textarea class="form-input" id="wlLatar" placeholder="Background story karakter..." rows="4"></textarea></div>
          <div style="display:flex;gap:8px"><button class="btn" onclick="wlBack(2)">‚Üê Kembali</button><button class="btn btn-primary" onclick="wlNext(2)">Lanjut ‚Üí</button></div>
        </div>
        <div id="wlPage3" class="card" style="padding:20px;display:none">
          <div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:14px">Verifikasi WhatsApp</div>
          <p style="font-size:13px;color:var(--text2);margin-bottom:14px;line-height:1.6">Kode verifikasi dikirim ke WA <strong id="wlWADisplay"></strong>.</p>
          <div class="report-info">üì± Demo: masukkan kode <strong>123456</strong></div>
          <div class="form-row"><label class="form-label">Kode Verifikasi</label><input type="text" class="form-input" id="wlOTP" placeholder="6 digit kode" style="max-width:160px;letter-spacing:4px;text-align:center"></div>
          <div style="display:flex;gap:8px"><button class="btn" onclick="wlBack(3)">‚Üê Kembali</button><button class="btn btn-primary" onclick="wlSubmit()">Kirim Pendaftaran</button></div>
        </div>
        <div id="wlPage4" class="card" style="padding:30px;text-align:center;display:none">
          <div style="font-size:40px;margin-bottom:12px">‚úÖ</div>
          <div style="font-size:16px;font-weight:700;color:var(--green);margin-bottom:8px">Pendaftaran Berhasil!</div>
          <div style="font-size:12px;color:var(--text3);line-height:1.6">Pendaftaran sedang diproses oleh staff. Pantau status di halaman ini.</div>
        </div>
      </div>
    </div>
    <div class="side-col">
      <div class="widget"><div class="widget-title">Syarat Whitelist</div><div class="widget-body" style="font-size:12px;color:var(--text2);line-height:1.8"><p>‚úì Min. 17 tahun</p><p>‚úì WhatsApp aktif</p><p>‚úì Mengerti dasar RP</p><p>‚úì Ikuti peraturan server</p></div></div>
      <div class="widget"><div class="widget-title">Status WL</div><div class="widget-body" style="padding:0 12px"><div class="stat-row"><span>Pending</span><span class="s-val" id="wlStatPending">‚Äî</span></div><div class="stat-row"><span>Diproses</span><span class="s-val" id="wlStatProcess">‚Äî</span></div><div class="stat-row"><span>Diterima</span><span class="s-val" id="wlStatAccepted">‚Äî</span></div></div></div>
    </div>
  </div>
</div>

<!-- CHARACTER STORY -->
<div class="page" id="page-cs">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Character Story Request</span></div>
      <div id="csMyRequest" style="display:none"></div>
      <div id="csFormView">
        <div class="d-flex-center justify-between mb12"><div class="text-bold">Buat Character Story Request</div></div>
        <div class="card" style="padding:20px">
          <div class="report-info"><strong>Jadwal CS Review:</strong> Senin & Kamis pukul 19:00 ‚Äì 21:00 WIB.</div>
          <div class="form-row"><label class="form-label">Nama Karakter</label><input type="text" class="form-input" id="csCharName" placeholder="Nama_Karakter"></div>
          <div class="form-row"><label class="form-label">Jenis Karakter</label><select class="form-input" id="csType"><option value="">Pilih jenis...</option><option>Civilian</option><option>Criminal</option><option>Gang Member</option><option>Business Owner</option><option>Law Enforcement (ex)</option></select></div>
          <div class="form-row"><label class="form-label">Usia Karakter</label><input type="number" class="form-input" id="csAge" placeholder="Usia" style="max-width:120px"></div>
          <div class="form-row"><label class="form-label">Asal Karakter</label><input type="text" class="form-input" id="csOrigin" placeholder="Kota / negara asal karakter"></div>
          <div class="form-row"><label class="form-label">Latar Belakang Karakter (min. 200 kata)</label><textarea class="form-input" id="csBg" rows="6" placeholder="Ceritakan latar belakang karakter secara detail..."></textarea></div>
          <div class="form-row">
            <label class="form-label">Jadwal Review</label>
            <div class="time-slots" id="timeSlots">
              <div class="time-slot" onclick="selectSlot(this,'Senin 19:00')">Senin 19:00</div>
              <div class="time-slot" onclick="selectSlot(this,'Senin 20:00')">Senin 20:00</div>
              <div class="time-slot unavailable">Senin 21:00</div>
              <div class="time-slot" onclick="selectSlot(this,'Kamis 19:00')">Kamis 19:00</div>
              <div class="time-slot" onclick="selectSlot(this,'Kamis 20:00')">Kamis 20:00</div>
              <div class="time-slot" onclick="selectSlot(this,'Kamis 21:00')">Kamis 21:00</div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="submitCS()">Kirim CS Request</button>
        </div>
      </div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Panduan CS</div><div class="widget-body" style="font-size:12px;color:var(--text2);line-height:1.8"><p>‚úì Min. 200 kata latar belakang</p><p>‚úì Karakter harus realistis</p><p>‚úì Tidak boleh overpowered</p><p>‚úì Sesuai setting Los Santos</p></div></div></div>
  </div>
</div>

<!-- IMPORT REQUEST -->
<div class="page" id="page-import">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Import Request</span></div>
      <div id="importMyRequest" style="display:none"></div>
      <div id="importFormView">
        <div class="d-flex-center justify-between mb12"><div class="text-bold">Buat Import Request</div></div>
        <div class="card" style="padding:20px">
          <div class="form-row"><label class="form-label">Jenis Import</label>
            <div class="import-type-grid">
              <div class="import-type-btn" onclick="selectImportType(this,'goodside')"><div class="it-icon">üïäÔ∏è</div><div class="it-label">Goodside</div></div>
              <div class="import-type-btn" onclick="selectImportType(this,'badside')"><div class="it-icon">üî™</div><div class="it-label">Badside</div></div>
              <div class="import-type-btn" onclick="selectImportType(this,'family')"><div class="it-icon">üë®‚Äçüë©‚Äçüëß</div><div class="it-label">Family</div></div>
            </div>
          </div>
          <div class="form-row"><label class="form-label">Nama Karakter</label><input type="text" class="form-input" id="importChar" placeholder="Nama_Karakter"></div>
          <div class="form-row"><label class="form-label">Item / Kendaraan yang Diminta</label><textarea class="form-input" id="importItems" rows="3" placeholder="Daftar item atau kendaraan..."></textarea></div>
          <div class="form-row"><label class="form-label">Alasan / Lore IC</label><textarea class="form-input" id="importLore" rows="4" placeholder="Jelaskan alasan in-character..."></textarea></div>
          <div class="form-row"><label class="form-label">Bukti Pendukung (link)</label><input type="text" class="form-input" id="importProof" placeholder="https://..."></div>
          <button class="btn btn-primary" onclick="submitImport()">Kirim Request</button>
        </div>
      </div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Ketentuan Import</div><div class="widget-body" style="font-size:12px;color:var(--text2);line-height:1.8"><p>‚úì Harus ada lore IC yang kuat</p><p>‚úì Maks 1 request per minggu</p><p>‚úì Tidak untuk PVP murni</p><p>‚úì Staff berhak menolak</p></div></div></div>
  </div>
</div>

<!-- STAFF -->
<div class="page" id="page-staff">
  <div class="page-layout">
    <div class="main-col">
      <div class="d-flex-center justify-between mb12"><div class="text-bold">Tim Staff Miracle RP</div></div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(this,'staff-all')">Semua</button>
        <button class="tab-btn" onclick="switchTab(this,'staff-owner')">Owner</button>
        <button class="tab-btn" onclick="switchTab(this,'staff-admin')">Admin</button>
        <button class="tab-btn" onclick="switchTab(this,'staff-dev')">Developer</button>
        <button class="tab-btn" onclick="switchTab(this,'staff-helper')">Helper</button>
      </div>
      <div class="tab-panel active" id="staff-all"><div class="staff-grid" id="staffGridAll"></div></div>
      <div class="tab-panel" id="staff-owner"><div class="staff-grid" id="staffGridOwner"></div></div>
      <div class="tab-panel" id="staff-admin"><div class="staff-grid" id="staffGridAdmin"></div></div>
      <div class="tab-panel" id="staff-dev"><div class="staff-grid" id="staffGridDev"></div></div>
      <div class="tab-panel" id="staff-helper"><div class="staff-grid" id="staffGridHelper"></div></div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Hubungi Staff</div><div class="widget-body" style="font-size:12px;color:var(--text2);line-height:1.8"><p>üí¨ Forum ini</p><p>üì± Discord: discord.gg/miraclerp</p><p>‚è∞ Jam aktif: 17:00 ‚Äì 24:00 WIB</p></div></div></div>
  </div>
</div>

<!-- LEADERBOARD -->
<div class="page" id="page-leaderboard">
  <div class="page-layout">
    <div class="main-col">
      <div class="d-flex-center justify-between mb12"><div class="text-bold">Leaderboard</div></div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(this,'lb-week')">Minggu Ini</button>
        <button class="tab-btn" onclick="switchTab(this,'lb-month')">Bulan Ini</button>
        <button class="tab-btn" onclick="switchTab(this,'lb-all')">All Time</button>
      </div>
      <div class="tab-panel active" id="lb-week"><div class="card" id="lbWeekList"></div></div>
      <div class="tab-panel" id="lb-month"><div class="card" id="lbMonthList"></div></div>
      <div class="tab-panel" id="lb-all"><div class="card" id="lbAllList"></div></div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Keterangan Role</div><div class="widget-body" style="padding:0 12px"><div class="stat-row"><span class="role-owner">Owner</span><span></span></div><div class="stat-row"><span class="role-admin">Admin</span><span></span></div><div class="stat-row"><span class="role-developer">Developer</span><span></span></div><div class="stat-row"><span class="role-helper">Helper</span><span></span></div><div class="stat-row"><span class="role-vip">VIP</span><span></span></div><div class="stat-row"><span class="role-member">Member</span><span></span></div></div></div></div>
  </div>
</div>

<!-- REPORT -->
<div class="page" id="page-report">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Laporan</span></div>
      <div class="tabs">
        <button class="tab-btn active" onclick="switchTab(this,'rp-form')">Buat Laporan</button>
        <button class="tab-btn" onclick="switchTab(this,'rp-list');loadReportList()">Daftar Laporan</button>
      </div>
      <div class="tab-panel active" id="rp-form">
        <div class="report-info">Pastikan kamu memiliki <strong>bukti valid</strong> sebelum melaporkan. Laporan palsu = sanksi.</div>
        <div class="card" style="padding:18px">
          <div class="form-row"><label class="form-label">Nama Karakter Pelapor</label><input type="text" class="form-input" id="repReporter" placeholder="Nama_Karakter_Kamu"></div>
          <div class="form-row"><label class="form-label">Nama / Mask ID Terlapor</label><input type="text" class="form-input" id="repTarget" placeholder="Nama_Karakter / Mask 123456"></div>
          <div class="form-row"><label class="form-label">Jenis Pelanggaran</label><select class="form-input" id="repType"><option value="">Pilih...</option><option>DM (Deathmatch)</option><option>VDM (Vehicle Deathmatch)</option><option>Hack / Cheat</option><option>Bug Abuse</option><option>Bad RP</option><option>OOC Harassment</option><option>Scam / Penipuan</option><option>Lainnya</option></select></div>
          <div class="form-row"><label class="form-label">Tanggal & Waktu</label><input type="datetime-local" class="form-input" id="repDate" style="max-width:240px"></div>
          <div class="form-row"><label class="form-label">Kronologi Kejadian</label><textarea class="form-input" id="repKronologi" rows="5" placeholder="Jelaskan kronologi secara detail..."></textarea></div>
          <div class="form-row"><label class="form-label">Link Bukti</label><input type="text" class="form-input" id="repBukti" placeholder="https://imgur.com/... atau https://youtu.be/..."></div>
          <button class="btn btn-primary" onclick="submitReport()">Kirim Laporan</button>
        </div>
      </div>
      <div class="tab-panel" id="rp-list"><div class="card" id="reportList"><div style="text-align:center;padding:30px;color:var(--text3)">Memuat laporan...</div></div></div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Panduan Report</div><div class="widget-body" style="font-size:12px;color:var(--text2);line-height:1.8"><p>1. Sertakan bukti valid</p><p>2. Isi semua kolom</p><p>3. Jangan report hal remeh</p><p>4. Laporan palsu = sanksi</p><p>5. Sabar menunggu respons staff</p></div></div></div>
  </div>
</div>

<!-- ANNOUNCEMENTS -->
<div class="page" id="page-announcements">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Pengumuman</span></div>
      <div id="announcementsList"></div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Info</div><div class="widget-body" style="font-size:12px;color:var(--text2)">Pengumuman resmi dari tim Miracle RP.</div></div></div>
  </div>
</div>

<!-- RULES -->
<div class="page" id="page-rules">
  <div class="page-layout">
    <div class="main-col">
      <div class="card" style="padding:22px">
        <div style="font-size:18px;font-weight:700;color:var(--accent);margin-bottom:4px">Peraturan Server</div>
        <div style="font-size:11px;color:var(--text3);margin-bottom:18px">Wajib dibaca sebelum bermain</div>
        <div style="margin-bottom:18px"><div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--border)">1. Roleplay Umum</div><p style="font-size:13px;color:var(--text2);line-height:1.7">Semua pemain wajib bermain sesuai karakter (IC). Dilarang keras menggunakan informasi OOC untuk keuntungan IC (metagaming).</p></div>
        <div style="margin-bottom:18px"><div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--border)">2. Kekerasan & Senjata</div><p style="font-size:13px;color:var(--text2);line-height:1.7">Dilarang membunuh pemain lain tanpa alasan IC yang kuat (DM/VDM). Semua tindak kekerasan harus memiliki latar cerita yang logis.</p></div>
        <div style="margin-bottom:18px"><div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--border)">3. Cheat & Bug Abuse</div><p style="font-size:13px;color:var(--text2);line-height:1.7">Penggunaan cheat, hack, atau bug abuse adalah pelanggaran berat dan akan mengakibatkan ban permanen tanpa peringatan.</p></div>
        <div style="margin-bottom:18px"><div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--border)">4. Komunikasi</div><p style="font-size:13px;color:var(--text2);line-height:1.7">Jaga sopan santun dalam komunikasi IC maupun OOC. Dilarang SARA, pelecehan, atau spam di chat maupun forum.</p></div>
        <div style="margin-bottom:18px"><div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:7px;padding-bottom:5px;border-bottom:1px solid var(--border)">5. Sanksi</div><p style="font-size:13px;color:var(--text2);line-height:1.7">Pelanggaran dikenakan sanksi bertahap: peringatan ‚Üí kick ‚Üí ban sementara ‚Üí ban permanen.</p></div>
      </div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Navigasi</div><div class="widget-body" style="padding:0 12px"><div class="rt-item"><a href="#">1. Roleplay Umum</a></div><div class="rt-item"><a href="#">2. Kekerasan & Senjata</a></div><div class="rt-item"><a href="#">3. Cheat & Bug Abuse</a></div><div class="rt-item"><a href="#">4. Komunikasi</a></div><div class="rt-item"><a href="#">5. Sanksi</a></div></div></div></div>
  </div>
</div>

<!-- GUIDES -->
<div class="page" id="page-guides">
  <div class="page-layout">
    <div class="main-col">
      <div class="breadcrumb"><a href="#" onclick="showPage('forums')">Home</a><span class="sep">‚Ä∫</span><span style="color:var(--text2)">Guide & Tutorial</span></div>
      <div id="guidesList"></div>
    </div>
    <div class="side-col"><div class="widget"><div class="widget-title">Kategori</div><div class="widget-body" style="padding:0 12px"><div class="rt-item"><a href="#">Pemula</a></div><div class="rt-item"><a href="#">Sistem IC</a></div><div class="rt-item"><a href="#">Organisasi</a></div><div class="rt-item"><a href="#">Ekonomi</a></div></div></div></div>
  </div>
</div>

<!-- PROFILE -->
<div class="page" id="page-profile">
  <div style="max-width:840px">
    <div class="card mb12" style="overflow:visible">
      <div class="profile-banner"></div>
      <div class="profile-head">
        <div class="profile-avatar-wrap">
          <div class="profile-avatar" id="profileAvatar">?</div>
          <div class="profile-edit-btn" onclick="document.getElementById('avatarInput').click()" title="Ganti foto">‚úè</div>
          <input type="file" id="avatarInput" accept="image/*" style="display:none" onchange="changeAvatar(event)">
        </div>
        <div style="flex:1">
          <div class="profile-name" id="profileName">‚Äî</div>
          <span class="profile-role-badge rb-member" id="profileRoleBadge">Member</span>
          <div class="profile-stats-row">
            <div class="p-stat"><span class="v" id="profilePosts">0</span><span class="l">Posts</span></div>
            <div class="p-stat"><span class="v" id="profileJoined">‚Äî</span><span class="l">Bergabung</span></div>
          </div>
        </div>
        <div style="margin-left:auto;display:flex;gap:7px;align-self:flex-start;margin-top:44px">
          <button class="btn btn-sm btn-danger" onclick="logoutUser()" id="profileLogoutBtn" style="display:none">Logout</button>
        </div>
      </div>
    </div>
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab(this,'prof-about')">Tentang</button>
      <button class="tab-btn" onclick="switchTab(this,'prof-posts')">Postingan</button>
      <button class="tab-btn" onclick="switchTab(this,'prof-settings')">Pengaturan</button>
    </div>
    <div class="tab-panel active" id="prof-about">
      <div class="card" style="padding:14px">
        <div class="form-row"><div class="form-label">Username</div><div style="font-size:13px;color:var(--text2)" id="profileUsername">‚Äî</div></div>
        <div class="form-row"><div class="form-label">Email</div><div style="font-size:13px;color:var(--text2)" id="profileEmail">‚Äî</div></div>
        <div class="form-row" style="margin-bottom:0"><div class="form-label">Status Akun</div><div id="profileStatus">‚Äî</div></div>
      </div>
    </div>
    <div class="tab-panel" id="prof-posts"><div class="card" id="profilePostsList"><div style="text-align:center;padding:30px;color:var(--text3)">Memuat post...</div></div></div>
    <div class="tab-panel" id="prof-settings">
      <div class="card" style="padding:18px;max-width:440px">
        <div class="form-row"><label class="form-label">Display Name</label><input type="text" class="form-input" id="settingsDisplayName" placeholder="Nama tampilan"></div>
        <div class="form-row"><label class="form-label">Bio</label><textarea class="form-input" id="settingsBio" rows="3" placeholder="Tulis bio singkat..."></textarea></div>
        <button class="btn btn-primary" onclick="saveSettings()">Simpan</button>
      </div>
    </div>
  </div>
</div>

<!-- PM -->
<div class="page" id="page-pm" style="padding:18px 0">
  <div class="chat-layout">
    <div class="chat-sidebar">
      <div class="chat-sidebar-header">
        <div class="chat-sidebar-title">Pesan</div>
        <button class="btn btn-primary btn-sm" onclick="openModal('newPmModal')">+ Baru</button>
      </div>
      <div class="chat-search"><input type="text" placeholder="Cari..." oninput="filterConvos(this.value)"></div>
      <div class="chat-list" id="pmConvoList"><div style="text-align:center;padding:20px;color:var(--text3);font-size:12px">Memuat...</div></div>
    </div>
    <div class="chat-main">
      <div class="chat-main-header" id="chatHeader" style="display:none">
        <div class="chat-ava" id="chatHeaderAvatar">?</div>
        <div><div class="chat-header-name" id="chatHeaderName">‚Äî</div><div class="chat-header-status">‚óè Online</div></div>
      </div>
      <div class="chat-messages" id="chatMessages"><div style="text-align:center;padding:40px;color:var(--text3);font-size:13px">Pilih percakapan atau mulai yang baru.</div></div>
      <div class="chat-input-area" id="chatInputArea" style="display:none">
        <div class="chat-input-wrap">
          <button class="chat-action-btn">üìé</button>
          <textarea class="chat-textarea" id="chatInput" placeholder="Tulis pesan..." rows="1" onkeydown="handleChatKey(event)" oninput="this.style.height='auto';this.style.height=Math.min(this.scrollHeight,100)+'px'"></textarea>
          <button class="chat-action-btn">üòä</button>
        </div>
        <button class="chat-send-btn" onclick="sendMessage()">‚û§</button>
      </div>
    </div>
  </div>
</div>

</div><!-- /wrap -->

<!-- ADMIN (full width) -->
<div class="page" id="page-admin">
  <div class="admin-layout">
    <div class="admin-sidebar">
      <div class="admin-nav-section">
        <div class="admin-nav-label">Dashboard</div>
        <div class="admin-nav-item active" onclick="switchAdminTab(this,'adm-overview')"><span class="icon">‚óà</span> Overview</div>
      </div>
      <div class="admin-nav-section">
        <div class="admin-nav-label">Manajemen</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-members')"><span class="icon">üë•</span> Members</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-whitelist')"><span class="icon">üìã</span> Whitelist</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-cs')"><span class="icon">üé≠</span> CS Requests</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-import')"><span class="icon">üì¶</span> Import Req</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-reports')"><span class="icon">üö©</span> Reports</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-bans')"><span class="icon">‚õî</span> Ban List</div>
      </div>
      <div class="admin-nav-section">
        <div class="admin-nav-label">Konten</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-announce')"><span class="icon">üì¢</span> Announcements</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-guides')"><span class="icon">üìñ</span> Guides</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-staff')"><span class="icon">üåü</span> Staff List</div>
      </div>
      <div class="admin-nav-section">
        <div class="admin-nav-label">Sistem</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-settings')"><span class="icon">‚öô</span> Settings</div>
        <div class="admin-nav-item" onclick="switchAdminTab(this,'adm-logs')"><span class="icon">üìã</span> Logs</div>
      </div>
    </div>
    <div class="admin-content">
      <div class="tab-panel active" id="adm-overview">
        <div class="admin-page-title">Overview</div>
        <div class="admin-cards">
          <div class="admin-card"><div class="ac-label">Total Member</div><div class="ac-val" id="admStatMembers">‚Äî</div></div>
          <div class="admin-card"><div class="ac-label">WL Pending</div><div class="ac-val" style="color:var(--red)" id="admStatWL">‚Äî</div></div>
          <div class="admin-card"><div class="ac-label">CS Pending</div><div class="ac-val" id="admStatCS">‚Äî</div></div>
          <div class="admin-card"><div class="ac-label">Import Pending</div><div class="ac-val" id="admStatImport">‚Äî</div></div>
          <div class="admin-card"><div class="ac-label">Report Open</div><div class="ac-val" style="color:var(--red)" id="admStatReports">‚Äî</div></div>
          <div class="admin-card"><div class="ac-label">Total Posts</div><div class="ac-val" id="admStatPosts">‚Äî</div></div>
        </div>
        <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:9px">Aktivitas Terbaru</div>
        <div class="table-wrap" id="admRecentActivity"><div style="text-align:center;padding:20px;color:var(--text3);font-size:12px">Memuat...</div></div>
      </div>
      <div class="tab-panel" id="adm-members">
        <div class="admin-page-title">Manajemen Member</div>
        <div style="display:flex;gap:8px;margin-bottom:12px;flex-wrap:wrap">
          <input type="text" class="form-input" placeholder="Cari username..." style="flex:1;min-width:160px;max-width:240px" oninput="searchMembers(this.value)">
          <select class="form-input" style="min-width:120px" onchange="filterMembersByRole(this.value)"><option value="">Semua Role</option><option>owner</option><option>admin</option><option>developer</option><option>helper</option><option>vip</option><option>member</option></select>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Username</th><th>Role</th><th>Status</th><th>Bergabung</th><th>Aksi</th></tr></thead><tbody id="membersTbody"><tr><td colspan="5" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-whitelist">
        <div class="admin-page-title">Manajemen Whitelist</div>
        <div style="margin-bottom:12px"><select class="form-input" style="min-width:140px" id="wlFilter" onchange="loadAdminWL()"><option value="">Semua Status</option><option value="pending">Pending</option><option value="process">Diproses</option><option value="accepted">Diterima</option><option value="rejected">Ditolak</option></select></div>
        <div class="table-wrap"><table><thead><tr><th>Nama</th><th>Karakter</th><th>WA</th><th>Status</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="wlAdminTbody"><tr><td colspan="6" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-cs">
        <div class="admin-page-title">CS Requests</div>
        <div class="table-wrap"><table><thead><tr><th>Karakter</th><th>Tipe</th><th>Jadwal</th><th>Status</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="csAdminTbody"><tr><td colspan="6" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-import">
        <div class="admin-page-title">Import Requests</div>
        <div class="table-wrap"><table><thead><tr><th>Karakter</th><th>Tipe</th><th>Item</th><th>Status</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="importAdminTbody"><tr><td colspan="6" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-reports">
        <div class="admin-page-title">Report Management</div>
        <div class="table-wrap"><table><thead><tr><th>Pelapor</th><th>Terlapor</th><th>Jenis</th><th>Status</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="reportsAdminTbody"><tr><td colspan="6" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-bans">
        <div class="admin-page-title">Ban List</div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <input type="text" class="form-input" placeholder="Cari..." style="max-width:220px">
          <button class="btn btn-danger" onclick="openBanModal()">+ Ban Manual</button>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Username</th><th>Alasan</th><th>Oleh</th><th>Tanggal</th><th>Durasi</th><th>Aksi</th></tr></thead><tbody id="bansAdminTbody"><tr><td colspan="6" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-announce">
        <div class="admin-page-title">Kelola Pengumuman</div>
        <div class="card" style="padding:16px;margin-bottom:14px">
          <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:10px">Buat Pengumuman Baru</div>
          <div class="form-row"><label class="form-label">Judul</label><input type="text" class="form-input" id="annTitle" placeholder="Judul pengumuman"></div>
          <div class="form-row"><label class="form-label">Isi</label><textarea class="form-input" id="annBody" rows="4" placeholder="Isi pengumuman..."></textarea></div>
          <div class="form-row"><label class="form-label">Tipe</label><select class="form-input" id="annType" style="max-width:160px"><option value="info">Info</option><option value="warning">Peringatan</option><option value="update">Update</option><option value="event">Event</option></select></div>
          <button class="btn btn-primary" onclick="postAnnouncement()">Posting</button>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Judul</th><th>Tipe</th><th>Oleh</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="annAdminTbody"><tr><td colspan="5" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-guides">
        <div class="admin-page-title">Kelola Guide</div>
        <div class="card" style="padding:16px;margin-bottom:14px">
          <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:10px">Tambah Guide Baru</div>
          <div class="form-row"><label class="form-label">Judul</label><input type="text" class="form-input" id="guideTitle" placeholder="Judul guide"></div>
          <div class="form-row"><label class="form-label">Isi</label><textarea class="form-input" id="guideBody" rows="6" placeholder="Isi guide..."></textarea></div>
          <div class="form-row"><label class="form-label">Kategori</label><select class="form-input" id="guideCategory" style="max-width:160px"><option>Pemula</option><option>Sistem IC</option><option>Organisasi</option><option>Ekonomi</option></select></div>
          <button class="btn btn-primary" onclick="postGuide()">Posting</button>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Judul</th><th>Kategori</th><th>Oleh</th><th>Tanggal</th><th>Aksi</th></tr></thead><tbody id="guideAdminTbody"><tr><td colspan="5" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-staff">
        <div class="admin-page-title">Kelola Staff List</div>
        <div class="card" style="padding:16px;margin-bottom:14px">
          <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:10px">Tambah Staff</div>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <input type="text" class="form-input" id="staffName" placeholder="Nama" style="flex:1;min-width:140px">
            <select class="form-input" id="staffRole" style="min-width:130px"><option value="owner">Owner</option><option value="admin">Admin</option><option value="developer">Developer</option><option value="helper">Helper</option></select>
            <input type="text" class="form-input" id="staffDesc" placeholder="Deskripsi / jabatan" style="flex:1;min-width:140px">
          </div>
          <button class="btn btn-primary" style="margin-top:10px" onclick="addStaff()">Tambah</button>
        </div>
        <div class="table-wrap"><table><thead><tr><th>Nama</th><th>Role</th><th>Deskripsi</th><th>Aksi</th></tr></thead><tbody id="staffAdminTbody"><tr><td colspan="4" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
      <div class="tab-panel" id="adm-settings">
        <div class="admin-page-title">Pengaturan Sistem</div>
        <div style="max-width:460px">
          <div class="form-row"><label class="form-label">Nama Server</label><input type="text" class="form-input" id="cfgServerName" placeholder="Nama server"></div>
          <div class="form-row"><label class="form-label">IP Server SA:MP</label><input type="text" class="form-input" id="cfgServerIP" placeholder="ip:port"></div>
          <div class="form-row"><label class="form-label">Link Discord</label><input type="text" class="form-input" id="cfgDiscord" placeholder="discord.gg/..."></div>
          <div class="form-row"><label class="form-label">Player Online</label><input type="number" class="form-input" id="cfgPlayersOnline" placeholder="0"></div>
          <div class="form-row"><label class="form-label">Whitelist</label><select class="form-input" id="cfgWLOpen" style="max-width:160px"><option value="1">Terbuka</option><option value="0">Ditutup</option></select></div>
          <div class="form-row"><label class="form-label">Post Cooldown (menit)</label><input type="number" class="form-input" id="cfgCooldown" value="60" style="max-width:100px"></div>
          <button class="btn btn-primary" onclick="saveConfig()">Simpan Pengaturan</button>
        </div>
      </div>
      <div class="tab-panel" id="adm-logs">
        <div class="admin-page-title">Activity Logs</div>
        <div class="table-wrap"><table><thead><tr><th>Waktu</th><th>User</th><th>Aksi</th><th>Detail</th></tr></thead><tbody id="logsAdminTbody"><tr><td colspan="4" style="text-align:center;color:var(--text3)">Memuat...</td></tr></tbody></table></div>
      </div>
    </div>
  </div>
</div>

<script type="module">
import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import{getAuth,GoogleAuthProvider,signInWithPopup,signOut,onAuthStateChanged}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import{getDatabase,ref,set,get,push,update,remove,onValue,query,orderByChild,limitToLast}from"https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GANTI DENGAN CONFIG FIREBASE KAMU ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const firebaseConfig = {
  apiKey: "AIzaSyD5JGQ3eARM5Lo2IG3mkpdx7p3uh0nrBIk",
  authDomain: "samp-miracle.firebaseapp.com",
  projectId: "samp-miracle",
  storageBucket: "samp-miracle.firebasestorage.app",
  messagingSenderId: "465126706451",
  appId: "1:465126706451:web:b94f2359a348ff7078dee6",
  measurementId: "G-ZCRVX5DCPR",
  databaseURL: "https://samp-miracle-default-rtdb.asia-southeast1.firebasedatabase.app"  // ‚Üê TAMBAH INI
};
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getDatabase(app);
const provider=new GoogleAuthProvider();

let currentUser=null,currentUserData=null,currentConvoId=null,postImageBase64=null,selectedCSSlot=null,selectedImportType=null,config={};
const STAFF_ROLES=['owner','admin','developer','gm','helper'];

// ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ
const esc=s=>String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
const val=id=>{const e=document.getElementById(id);return e?e.value.trim():''};
const setEl=(id,txt)=>{const e=document.getElementById(id);if(e)e.textContent=txt};
const setInput=(id,v)=>{const e=document.getElementById(id);if(e)e.value=v};
const cap=s=>s?s.charAt(0).toUpperCase()+s.slice(1):'';
const timeAgo=ts=>{if(!ts)return'‚Äî';const d=Date.now()-ts,m=60000,h=3600000,dy=86400000;if(d<m)return'barusan';if(d<h)return Math.floor(d/m)+' mnt lalu';if(d<dy)return Math.floor(d/h)+' jam lalu';if(d<dy*7)return Math.floor(d/dy)+' hari lalu';return new Date(ts).toLocaleDateString('id-ID')};
const shortTime=ts=>{if(!ts)return'';const d=new Date(ts),n=new Date();return d.toDateString()===n.toDateString()?d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0'):d.toLocaleDateString('id-ID',{day:'2-digit',month:'short'})};
const getRoleCls=r=>({owner:'role-owner',admin:'role-admin',developer:'role-developer',gm:'role-gm',helper:'role-helper',vip:'role-vip'})[r]||'role-member';
const getRoleBadge=r=>({admin:'rb-admin',owner:'rb-admin',helper:'rb-helper',developer:'rb-helper',vip:'rb-vip'})[r]||'rb-member';
const statusBadge=s=>({pending:'bs-pending',process:'bs-process',accepted:'bs-active',approved:'bs-active',rejected:'bs-banned',open:'bs-warn',closed:'bs-active'})[s]||'bs-pending';
const annBadge=t=>({warning:'bs-warn',update:'bs-pending',event:'bs-active',info:'bs-process'})[t]||'bs-process';
const isAdmin=()=>currentUserData&&STAFF_ROLES.includes(currentUserData.role);
const logAct=(action,user,detail)=>push(ref(db,'activity_log'),{action,user,detail,at:Date.now()});

window.showToast=(msg,type='info')=>{
  const tc=document.getElementById('toastContainer'),t=document.createElement('div');
  t.className='toast '+type;t.innerHTML=`<span>${type==='success'?'‚úì':type==='error'?'‚úï':'‚Ñπ'}</span> ${esc(msg)}`;
  tc.appendChild(t);setTimeout(()=>t.remove(),3500);
};
window.openModal=id=>document.getElementById(id).classList.add('open');
window.closeModal=id=>document.getElementById(id).classList.remove('open');
window.openMobileNav=()=>{document.getElementById('mobileNav').classList.add('open');document.getElementById('mobileOverlay').classList.add('open')};
window.closeMobileNav=()=>{document.getElementById('mobileNav').classList.remove('open');document.getElementById('mobileOverlay').classList.remove('open')};
window.copyToClip=text=>navigator.clipboard.writeText(text).then(()=>showToast('Disalin: '+text,'success'));
window.viewImage=src=>{document.getElementById('imageModalSrc').src=src;openModal('imageModal')};

window.switchTab=(btn,panelId)=>{
  const p=btn.closest('.tabs');
  p.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  const c=p.parentElement;
  c.querySelectorAll(':scope>.tab-panel').forEach(p=>p.classList.remove('active'));
  const panel=document.getElementById(panelId);
  if(panel)panel.classList.add('active');
};
window.switchAdminTab=(item,panelId)=>{
  document.querySelectorAll('.admin-nav-item').forEach(i=>i.classList.remove('active'));
  item.classList.add('active');
  document.querySelectorAll('.admin-content>.tab-panel').forEach(p=>p.classList.remove('active'));
  const panel=document.getElementById(panelId);if(panel)panel.classList.add('active');
  const lazy={adm_members:loadAdminMembers,adm_whitelist:loadAdminWL,adm_cs:loadAdminCS,adm_import:loadAdminImport,adm_reports:loadAdminReports,adm_bans:loadAdminBans,adm_announce:loadAdminAnnounce,adm_guides:loadAdminGuides,adm_staff:loadAdminStaff,adm_settings:loadAdminSettings,adm_logs:loadAdminLogs};
  const fn=lazy[panelId.replace('-','_')];if(fn)fn();
};

window.showPage=(id,el)=>{
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const pg=document.getElementById('page-'+id);if(pg)pg.classList.add('active');
  document.querySelectorAll('nav.main-nav a').forEach(a=>a.classList.remove('active'));
  if(el)el.classList.add('active');
  const pages={admin:loadAdminPage,feed:loadFeed,staff:loadStaff,leaderboard:loadLeaderboard,announcements:loadAnnouncements,guides:loadGuides,pm:loadPM,whitelist:checkWLStatus,cs:checkCSStatus,import:checkImportStatus,profile:loadProfile,report:()=>loadReportList()};
  if(pages[id])pages[id]();
};

// ‚îÄ‚îÄ AUTH ‚îÄ‚îÄ
window.loginWithGoogle=async()=>{try{await signInWithPopup(auth,provider);closeModal('loginModal')}catch(e){showToast('Login gagal: '+e.message,'error')}};
window.logoutUser=async()=>{await signOut(auth);showToast('Berhasil logout','info');showPage('forums')};

onAuthStateChanged(auth,async user=>{
  currentUser=user;
  if(user){
    const snap=await get(ref(db,'users/'+user.uid));
    if(snap.exists()){currentUserData=snap.val()}
    else{currentUserData={uid:user.uid,username:user.displayName||user.email.split('@')[0],email:user.email,photoURL:user.photoURL||'',role:'member',status:'active',joinedAt:Date.now(),postCount:0};await set(ref(db,'users/'+user.uid),currentUserData)}
    if(currentUserData.status==='banned'){showToast('Akun kamu dibanned.','error');await signOut(auth);return}
    document.getElementById('topbarRight').innerHTML=`<span style="font-size:12px;color:var(--text2)">${esc(currentUserData.username)}</span><button class="btn btn-sm" onclick="showPage('profile')">Profil</button>`;
    document.getElementById('adminNavLink').style.display=isAdmin()?'':'none';
    document.getElementById('feedComposer').style.display='';
    set(ref(db,'online/'+user.uid),{username:currentUserData.username,role:currentUserData.role,at:Date.now()});
    showToast('Halo, '+currentUserData.username+'!','success');
  }else{
    currentUser=null;currentUserData=null;
    document.getElementById('topbarRight').innerHTML='<button class="btn" onclick="openModal(\'loginModal\')">Masuk</button><button class="btn btn-primary" onclick="openModal(\'loginModal\')">Daftar</button>';
    document.getElementById('adminNavLink').style.display='none';
    document.getElementById('feedComposer').style.display='none';
  }
});

// ‚îÄ‚îÄ STATS & ONLINE ‚îÄ‚îÄ
function loadStats(){
  onValue(ref(db,'stats'),snap=>{
    const d=snap.val()||{};
    setEl('totalMembers',d.totalMembers||'‚Äî');setEl('playersOnline',d.playersOnline||'‚Äî');setEl('wlPending',d.wlPending||'0');
    setEl('statPosts',d.totalPosts||'‚Äî');setEl('statWL',d.wlPending||'0');setEl('statCS',d.csPending||'0');
    setEl('statImport',d.importPending||'0');setEl('statReports',d.reportsOpen||'0');setEl('statAnnouncements',d.totalAnnouncements||'0');
  });
}
function loadOnline(){
  onValue(ref(db,'online'),snap=>{
    const d=snap.val()||{},users=Object.values(d),count=users.length;
    setEl('onlineCount',count.toString());setEl('onlineSub',count+' member online');
    const tags=document.getElementById('onlineTags');
    if(!tags)return;
    tags.innerHTML=users.slice(0,6).map(u=>`<div class="online-tag"><div class="dot"></div>${esc(u.username)}</div>`).join('')+(count>6?`<div class="online-tag" style="color:var(--text3)">+${count-6} lainnya</div>`:'');
  });
}

// ‚îÄ‚îÄ FEED ‚îÄ‚îÄ
function loadFeed(){
  onValue(ref(db,'announcements'),snap=>{
    const ann=snap.val()||{};
    const list=Object.entries(ann).sort((a,b)=>b[1].createdAt-a[1].createdAt).slice(0,2);
    const el=document.getElementById('feedAnnouncements');if(!el)return;
    el.innerHTML=list.map(([,a])=>`<div class="feed-announce"><div class="ann-title">üì¢ ${esc(a.title)}</div><div class="ann-body">${esc(a.body)}</div><div class="ann-meta">oleh ${esc(a.author||'Staff')} ¬∑ ${timeAgo(a.createdAt)}</div></div>`).join('');
  });
  onValue(query(ref(db,'posts'),orderByChild('createdAt'),limitToLast(20)),snap=>{
    const posts=snap.val()||{};
    const list=Object.entries(posts).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const el=document.getElementById('feedList'),empty=document.getElementById('feedEmpty');if(!el)return;
    if(!list.length){el.innerHTML='';empty.style.display='';return}
    empty.style.display='none';el.innerHTML=list.map(([id,p])=>buildPostCard(id,p)).join('');
  });
  if(currentUserData){
    const a=document.getElementById('composerAvatar');
    if(a){if(currentUserData.photoURL)a.innerHTML=`<img src="${currentUserData.photoURL}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;else a.textContent=(currentUserData.username||'?')[0].toUpperCase()}
  }
  loadCooldownTimer();
}

function buildPostCard(id,p){
  const init=(p.authorName||'?')[0].toUpperCase();
  const ava=p.authorPhoto?`<img src="${p.authorPhoto}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`:init;
  const reactions=p.reactions||{};
  const myR=currentUser?(reactions[currentUser.uid]||{}):{};
  const comments=Object.entries(p.comments||{}).sort((a,b)=>a[1].at-b[1].at);
  return`<div class="post-card" id="post-${id}">
    <div class="post-header">
      <div class="post-avatar">${ava}</div>
      <div><div class="post-author ${getRoleCls(p.authorRole||'member')}">${esc(p.authorName||'?')}</div><div class="post-time">${timeAgo(p.createdAt)}</div></div>
      ${currentUser&&(currentUser.uid===p.authorUid||isAdmin())?`<button onclick="deletePost('${id}')" class="btn btn-danger btn-sm" style="margin-left:auto">‚úï</button>`:''}
    </div>
    <div class="post-body">${esc(p.body||'')}</div>
    ${p.imageUrl?`<img src="${p.imageUrl}" class="post-image" onclick="viewImage('${p.imageUrl}')">` :''}
    <div class="post-actions">
      ${['‚ù§Ô∏è','üî•','üòÇ','üòÆ','üò¢'].map(e=>{const cnt=Object.values(reactions).filter(r=>r[e]).length;return`<button class="reaction-btn ${myR[e]?'active':''}" onclick="toggleReact('${id}','${e}')">${e} ${cnt||''}</button>`}).join('')}
      <button class="reaction-btn" onclick="toggleComments('${id}')">üí¨ ${comments.length||''}</button>
    </div>
    <div class="post-comments" id="comments-${id}" style="display:none">
      ${comments.map(([,c])=>`<div class="comment-item"><div class="comment-ava">${(c.author||'?')[0].toUpperCase()}</div><div class="comment-body"><div class="comment-author">${esc(c.author||'?')}</div><div class="comment-text">${esc(c.text||'')}</div></div></div>`).join('')}
      ${currentUser?`<div class="comment-input-row"><input class="comment-input" id="ci-${id}" placeholder="Tulis komentar..." onkeydown="if(event.key==='Enter'){addComment('${id}',this.value);this.value=''}"></div>`:''}
    </div>
  </div>`;
}
window.toggleComments=id=>{const e=document.getElementById('comments-'+id);if(e)e.style.display=e.style.display==='none'?'':'none'};
window.handlePostImage=e=>{
  const file=e.target.files[0];if(!file)return;
  if(file.size>2097152){showToast('Maks 2MB','error');return}
  const r=new FileReader();r.onload=ev=>{postImageBase64=ev.target.result;document.getElementById('postImagePreview').style.display='';document.getElementById('postImgPreviewImg').src=ev.target.result};r.readAsDataURL(file);
};
window.clearPostImage=()=>{postImageBase64=null;document.getElementById('postImagePreview').style.display='none'};
window.submitPost=async()=>{
  if(!currentUser||!currentUserData){openModal('loginModal');return}
  const text=document.getElementById('composerText').value.trim();
  if(!text&&!postImageBase64){showToast('Tulis sesuatu dulu!','error');return}
  const lastPost=localStorage.getItem('lastPost_'+currentUser.uid);
  const cooldownMs=(config.postCooldown||60)*60000;
  if(lastPost&&Date.now()-parseInt(lastPost)<cooldownMs){const rem=Math.ceil((cooldownMs-(Date.now()-parseInt(lastPost)))/60000);showToast(`Cooldown aktif. Tunggu ${rem} mnt lagi.`,'error');return}
  const pRef=push(ref(db,'posts'));
  await set(pRef,{body:text,imageUrl:postImageBase64||'',authorUid:currentUser.uid,authorName:currentUserData.username,authorPhoto:currentUserData.photoURL||'',authorRole:currentUserData.role||'member',createdAt:Date.now(),reactions:{},comments:{}});
  localStorage.setItem('lastPost_'+currentUser.uid,Date.now().toString());
  document.getElementById('composerText').value='';postImageBase64=null;document.getElementById('postImagePreview').style.display='none';
  showToast('Post berhasil!','success');logAct('Post baru',currentUserData.username,text.slice(0,50));
};
window.deletePost=async id=>{if(!confirm('Hapus post ini?'))return;await remove(ref(db,'posts/'+id));showToast('Post dihapus','info')};
window.toggleReact=async(postId,emoji)=>{
  if(!currentUser){openModal('loginModal');return}
  const path=`posts/${postId}/reactions/${currentUser.uid}`;
  const snap=await get(ref(db,path));const cur=snap.val()||{};
  await update(ref(db,path),{[emoji]:!cur[emoji]});
};
window.addComment=async(postId,text)=>{
  if(!currentUser||!text.trim())return;
  await push(ref(db,`posts/${postId}/comments`),{author:currentUserData.username,authorUid:currentUser.uid,text:text.trim(),at:Date.now()});
};
function loadCooldownTimer(){
  if(!currentUser)return;
  const lastPost=localStorage.getItem('lastPost_'+currentUser.uid);
  const cooldownMs=(config.postCooldown||60)*60000;
  if(!lastPost||Date.now()-parseInt(lastPost)>=cooldownMs){document.getElementById('cooldownTimer').style.display='none';return}
  const timerEl=document.getElementById('cooldownTimer');timerEl.style.display='';
  const iv=setInterval(()=>{
    const rem=cooldownMs-(Date.now()-parseInt(lastPost));
    if(rem<=0){timerEl.style.display='none';clearInterval(iv);return}
    const m=Math.floor(rem/60000),s=Math.floor((rem%60000)/1000);
    timerEl.textContent=`Cooldown: ${m}:${s.toString().padStart(2,'0')}`;
  },1000);
}

// ‚îÄ‚îÄ WHITELIST ‚îÄ‚îÄ
window.wlNext=step=>{
  if(step===1){if(!val('wlNama')||!val('wlKarakter')||!val('wlUmur')||!val('wlWA')||!val('wlExp')){showToast('Isi semua kolom','error');return}document.getElementById('wlPage1').style.display='none';document.getElementById('wlPage2').style.display='';activateWLStep(2)}
  else if(step===2){if(!val('wlQ1')||!val('wlQ2')||!val('wlQ3')||!val('wlLatar')){showToast('Isi semua kolom','error');return}document.getElementById('wlWADisplay').textContent=val('wlWA');document.getElementById('wlPage2').style.display='none';document.getElementById('wlPage3').style.display='';activateWLStep(3)}
};
window.wlBack=step=>{document.getElementById('wlPage'+step).style.display='none';document.getElementById('wlPage'+(step-1)).style.display='';activateWLStep(step-1)};
function activateWLStep(n){for(let i=1;i<=4;i++){const s=document.getElementById('wlStep'+i);if(!s)continue;s.classList.remove('active','done');if(i<n)s.classList.add('done');else if(i===n)s.classList.add('active')}}
window.wlSubmit=async()=>{
  if(val('wlOTP')!=='123456'){showToast('Kode OTP salah','error');return}
  if(!currentUser){openModal('loginModal');return}
  const data={userId:currentUser.uid,username:currentUserData.username,nama:val('wlNama'),karakter:val('wlKarakter'),umur:val('wlUmur'),wa:val('wlWA'),exp:val('wlExp'),q1:val('wlQ1'),q2:val('wlQ2'),q3:val('wlQ3'),latar:val('wlLatar'),status:'pending',createdAt:Date.now()};
  await set(ref(db,'registrations/'+currentUser.uid),data);
  document.getElementById('wlPage3').style.display='none';document.getElementById('wlPage4').style.display='';activateWLStep(4);
  showToast('Pendaftaran berhasil dikirim!','success');logAct('WL Daftar',currentUserData.username,'Karakter: '+data.karakter);
};
window.checkWLStatus=async()=>{
  if(!currentUser)return;
  const snap=await get(ref(db,'registrations/'+currentUser.uid));if(!snap.exists())return;
  const d=snap.val();
  document.getElementById('wlFormView').style.display='none';
  const icons={pending:'‚è≥',process:'üîÑ',accepted:'‚úÖ',rejected:'‚ùå'};
  const colors={pending:'var(--blue)',process:'var(--orange)',accepted:'var(--green)',rejected:'var(--red)'};
  document.getElementById('wlStatusView').style.display='';
  document.getElementById('wlStatusView').innerHTML=`<div class="wl-status-card"><div class="wl-status-icon">${icons[d.status]||'‚è≥'}</div><div class="wl-status-title" style="color:${colors[d.status]||'#fff'}">Status: ${cap(d.status)}</div><div class="wl-status-desc">Karakter: <strong>${esc(d.karakter)}</strong><br>Didaftarkan: ${new Date(d.createdAt).toLocaleDateString('id-ID')}${d.adminNote?'<br><br>Catatan admin: '+esc(d.adminNote):''}</div>${d.status==='rejected'?`<button class="btn btn-sm" style="margin-top:14px" onclick="document.getElementById('wlStatusView').style.display='none';document.getElementById('wlFormView').style.display=''">Daftar Ulang</button>`:''}</div>`;
};

// ‚îÄ‚îÄ CS ‚îÄ‚îÄ
window.selectSlot=(el,slot)=>{if(el.classList.contains('unavailable'))return;document.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('selected'));el.classList.add('selected');selectedCSSlot=slot};
window.submitCS=async()=>{
  if(!currentUser){openModal('loginModal');return}
  if(!val('csCharName')||!val('csType')||!val('csAge')||!val('csOrigin')||!val('csBg')){showToast('Isi semua kolom','error');return}
  if(!selectedCSSlot){showToast('Pilih jadwal review','error');return}
  await set(ref(db,'cs_requests/'+currentUser.uid),{userId:currentUser.uid,username:currentUserData.username,charName:val('csCharName'),type:val('csType'),age:val('csAge'),origin:val('csOrigin'),background:val('csBg'),schedule:selectedCSSlot,status:'pending',createdAt:Date.now()});
  showToast('CS Request berhasil dikirim!','success');checkCSStatus();logAct('CS Request',currentUserData.username,val('csCharName'));
};
window.checkCSStatus=async()=>{
  if(!currentUser)return;
  const snap=await get(ref(db,'cs_requests/'+currentUser.uid));if(!snap.exists())return;
  const d=snap.val();document.getElementById('csFormView').style.display='none';document.getElementById('csMyRequest').style.display='';
  document.getElementById('csMyRequest').innerHTML=`<div class="card" style="padding:16px;margin-bottom:12px"><div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px">CS Request Kamu</div><div class="stat-row"><span>Karakter</span><span class="s-val">${esc(d.charName)}</span></div><div class="stat-row"><span>Tipe</span><span style="color:var(--text2)">${esc(d.type)}</span></div><div class="stat-row"><span>Jadwal</span><span style="color:var(--text2)">${esc(d.schedule)}</span></div><div class="stat-row"><span>Status</span><span><span class="badge-status ${statusBadge(d.status)}">${cap(d.status)}</span></span></div>${d.adminNote?`<div class="stat-row"><span>Catatan</span><span style="color:var(--text2)">${esc(d.adminNote)}</span></div>`:''} ${d.status==='pending'?`<button class="btn btn-danger btn-sm" style="margin-top:10px" onclick="cancelCS()">Batalkan</button>`:''}</div>`;
};
window.cancelCS=async()=>{if(!currentUser||!confirm('Batalkan CS Request?'))return;await remove(ref(db,'cs_requests/'+currentUser.uid));document.getElementById('csMyRequest').style.display='none';document.getElementById('csFormView').style.display='';showToast('Dibatalkan','info')};

// ‚îÄ‚îÄ IMPORT ‚îÄ‚îÄ
window.selectImportType=(el,type)=>{document.querySelectorAll('.import-type-btn').forEach(b=>b.classList.remove('selected'));el.classList.add('selected');selectedImportType=type};
window.submitImport=async()=>{
  if(!currentUser){openModal('loginModal');return}
  if(!selectedImportType||!val('importChar')||!val('importItems')||!val('importLore')){showToast('Isi semua kolom dan pilih tipe import','error');return}
  await set(ref(db,'import_requests/'+currentUser.uid),{userId:currentUser.uid,username:currentUserData.username,type:selectedImportType,charName:val('importChar'),items:val('importItems'),lore:val('importLore'),proof:val('importProof')||'',status:'pending',createdAt:Date.now()});
  showToast('Import Request dikirim!','success');checkImportStatus();logAct('Import Request',currentUserData.username,selectedImportType+' - '+val('importChar'));
};
window.checkImportStatus=async()=>{
  if(!currentUser)return;
  const snap=await get(ref(db,'import_requests/'+currentUser.uid));if(!snap.exists())return;
  const d=snap.val();document.getElementById('importFormView').style.display='none';document.getElementById('importMyRequest').style.display='';
  document.getElementById('importMyRequest').innerHTML=`<div class="card" style="padding:16px;margin-bottom:12px"><div style="font-size:13px;font-weight:700;color:var(--accent);margin-bottom:10px">Import Request Kamu</div><div class="stat-row"><span>Karakter</span><span class="s-val">${esc(d.charName)}</span></div><div class="stat-row"><span>Tipe</span><span style="color:var(--text2)">${cap(d.type)}</span></div><div class="stat-row"><span>Item</span><span style="color:var(--text2)">${esc(d.items)}</span></div><div class="stat-row"><span>Status</span><span><span class="badge-status ${statusBadge(d.status)}">${cap(d.status)}</span></span></div>${d.adminNote?`<div class="stat-row"><span>Catatan</span><span style="color:var(--text2)">${esc(d.adminNote)}</span></div>`:''}</div>`;
};

// ‚îÄ‚îÄ STAFF ‚îÄ‚îÄ
function loadStaff(){
  onValue(ref(db,'staff'),snap=>{
    const all=snap.val()||{};
    const list=Object.entries(all).sort((a,b)=>{const o=['owner','admin','developer','gm','helper'];return o.indexOf(a[1].role)-o.indexOf(b[1].role)});
    const grids={all:'staffGridAll',owner:'staffGridOwner',admin:'staffGridAdmin',dev:'staffGridDev',helper:'staffGridHelper'};
    Object.values(grids).forEach(id=>{const g=document.getElementById(id);if(g)g.innerHTML=''});
    list.forEach(([,s])=>{
      const card=`<div class="staff-card"><div class="staff-avatar">${(s.name||'?')[0].toUpperCase()}</div><div class="staff-name ${getRoleCls(s.role)}">${esc(s.name)}</div><div class="staff-role ${getRoleCls(s.role)}">${cap(s.role)}</div><div style="font-size:11px;color:var(--text3);margin-top:4px">${esc(s.desc||'')}</div></div>`;
      const ga=document.getElementById('staffGridAll');if(ga)ga.innerHTML+=card;
      const rk=s.role==='developer'?'dev':s.role;const gk=document.getElementById(grids[rk]);if(gk)gk.innerHTML+=card;
    });
    const ga=document.getElementById('staffGridAll');if(ga&&!list.length)ga.innerHTML='<div style="text-align:center;padding:30px;color:var(--text3)">Belum ada data staff.</div>';
  });
}

// ‚îÄ‚îÄ LEADERBOARD ‚îÄ‚îÄ
function loadLeaderboard(){
  onValue(ref(db,'users'),snap=>{
    const users=snap.val()||{};
    const list=Object.values(users).sort((a,b)=>(b.postCount||0)-(a.postCount||0)).slice(0,10);
    ['lbWeekList','lbMonthList','lbAllList'].forEach(id=>{
      const el=document.getElementById(id);if(!el)return;
      el.innerHTML=list.map((u,i)=>`<div class="lb-row"><div class="lb-rank ${i===0?'top1':i===1?'top2':i===2?'top3':''}">${i+1}</div><div class="lb-avatar">${(u.username||'?')[0].toUpperCase()}</div><div class="lb-info"><div class="lb-name ${getRoleCls(u.role)}">${esc(u.username||'?')}</div><div class="lb-sub">${cap(u.role||'member')} ¬∑ ${u.postCount||0} posts</div></div><div class="lb-rep">+${u.postCount||0}</div></div>`).join('')||'<div style="padding:20px;text-align:center;color:var(--text3)">Belum ada data.</div>';
    });
  });
}

// ‚îÄ‚îÄ ANNOUNCEMENTS ‚îÄ‚îÄ
function loadAnnouncements(){
  onValue(ref(db,'announcements'),snap=>{
    const data=snap.val()||{};
    const list=Object.entries(data).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const el=document.getElementById('announcementsList');if(!el)return;
    el.innerHTML=list.map(([,a])=>`<div class="card" style="padding:16px;margin-bottom:10px"><div style="display:flex;align-items:center;gap:10px;margin-bottom:8px"><div style="font-size:14px;font-weight:700;color:var(--accent)">${esc(a.title)}</div><span class="badge-status ${annBadge(a.type)}">${cap(a.type||'info')}</span></div><div style="font-size:13px;color:var(--text2);line-height:1.7">${esc(a.body||'')}</div><div style="font-size:11px;color:var(--text3);margin-top:10px">oleh ${esc(a.author||'Staff')} ¬∑ ${timeAgo(a.createdAt)}</div></div>`).join('')||'<div style="text-align:center;padding:30px;color:var(--text3)">Belum ada pengumuman.</div>';
  });
}

// ‚îÄ‚îÄ GUIDES ‚îÄ‚îÄ
function loadGuides(){
  onValue(ref(db,'guides'),snap=>{
    const data=snap.val()||{};
    const list=Object.entries(data).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const el=document.getElementById('guidesList');if(!el)return;
    el.innerHTML=list.map(([,g])=>`<div class="card" style="padding:16px;margin-bottom:10px"><div style="display:flex;align-items:center;gap:8px;margin-bottom:8px"><div style="font-size:14px;font-weight:700;color:var(--accent)">${esc(g.title)}</div><span class="badge-status bs-pending">${esc(g.category||'Umum')}</span></div><div style="font-size:13px;color:var(--text2);line-height:1.7">${esc(g.body||'')}</div><div style="font-size:11px;color:var(--text3);margin-top:10px">oleh ${esc(g.author||'Staff')} ¬∑ ${timeAgo(g.createdAt)}</div></div>`).join('')||'<div style="text-align:center;padding:30px;color:var(--text3)">Belum ada guide.</div>';
  });
}

// ‚îÄ‚îÄ REPORT ‚îÄ‚îÄ
window.submitReport=async()=>{
  if(!currentUser){openModal('loginModal');return}
  if(!val('repReporter')||!val('repTarget')||!val('repType')||!val('repKronologi')){showToast('Isi semua kolom wajib','error');return}
  const rRef=push(ref(db,'reports'));
  await set(rRef,{reporter:val('repReporter'),target:val('repTarget'),type:val('repType'),date:val('repDate'),kronologi:val('repKronologi'),bukti:val('repBukti')||'',reporterUid:currentUser.uid,status:'open',createdAt:Date.now()});
  showToast('Laporan berhasil dikirim!','success');['repReporter','repTarget','repKronologi','repBukti'].forEach(id=>{const e=document.getElementById(id);if(e)e.value=''});
  logAct('Report',currentUserData.username,val('repTarget'));
};
window.loadReportList=()=>{
  onValue(ref(db,'reports'),snap=>{
    const data=snap.val()||{};
    const list=Object.entries(data).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const el=document.getElementById('reportList');if(!el)return;
    if(!list.length){el.innerHTML='<div style="text-align:center;padding:30px;color:var(--text3)">Belum ada laporan.</div>';return}
    el.innerHTML=list.map(([,r])=>`<div class="topic-row"><div class="topic-icon">${(r.reporter||'?')[0].toUpperCase()}</div><div class="topic-main"><div class="topic-title"><span class="topic-badge ${r.status==='open'?'badge-hot':'badge-pinned'}">${r.status==='open'?'OPEN':'CLOSED'}</span>${esc('[REPORT] '+r.target)}</div><div class="topic-meta">oleh ${esc(r.reporter)} ¬∑ ${timeAgo(r.createdAt)}</div></div><div class="topic-replies"><span class="num">${esc(r.type||'?')}</span><span class="lbl">type</span></div></div>`).join('');
  });
};

// ‚îÄ‚îÄ PM ‚îÄ‚îÄ
window.loadPM=()=>{
  if(!currentUser){document.getElementById('pmConvoList').innerHTML='<div style="text-align:center;padding:20px;color:var(--text3);font-size:12px">Login untuk menggunakan PM.</div>';return}
  onValue(ref(db,'pm_convos'),snap=>{
    const all=snap.val()||{};
    const mine=Object.entries(all).filter(([,c])=>c.participants&&c.participants[currentUser.uid]);
    const el=document.getElementById('pmConvoList');if(!el)return;
    if(!mine.length){el.innerHTML='<div style="text-align:center;padding:20px;color:var(--text3);font-size:12px">Belum ada percakapan.</div>';return}
    el.innerHTML=mine.map(([id,c])=>{
      const other=Object.entries(c.participants||{}).find(([uid])=>uid!==currentUser.uid);
      const otherName=other?other[1]:'?';const unread=c.unreadCount&&c.unreadCount[currentUser.uid]>0;
      return`<div class="chat-item ${currentConvoId===id?'active':''} ${unread?'unread-item':''}" onclick="openConvo('${id}','${esc(otherName)}')"><div class="chat-ava">${otherName[0].toUpperCase()}</div><div class="chat-item-info"><div class="chat-item-name">${esc(otherName)}</div><div class="chat-item-preview">${esc(c.lastMsg||'...')}</div></div><div class="chat-item-time">${c.lastAt?shortTime(c.lastAt):''}</div>${unread?`<div class="chat-unread-badge">${c.unreadCount[currentUser.uid]}</div>`:''}</div>`;
    }).join('');
  });
};
window.openConvo=(convoId,otherName)=>{
  currentConvoId=convoId;document.getElementById('chatHeader').style.display='';document.getElementById('chatHeaderName').textContent=otherName;document.getElementById('chatHeaderAvatar').textContent=otherName[0].toUpperCase();document.getElementById('chatInputArea').style.display='';
  onValue(ref(db,'pm_convos/'+convoId+'/messages'),snap=>{
    const msgs=snap.val()||{},list=Object.entries(msgs).sort((a,b)=>a[1].at-b[1].at);
    const el=document.getElementById('chatMessages');if(!el)return;
    el.innerHTML=list.map(([,m])=>{const mine=m.senderUid===currentUser.uid;return`<div class="msg-group ${mine?'mine':''}"><div class="msg-ava">${(m.sender||'?')[0].toUpperCase()}</div><div class="msg-bubbles"><div class="msg-bubble">${esc(m.text)}</div><div class="msg-time">${shortTime(m.at)}</div></div></div>`}).join('')||'<div class="date-sep">Mulai percakapan</div>';
    el.scrollTop=el.scrollHeight;
  });
  update(ref(db,'pm_convos/'+convoId+'/unreadCount'),{[currentUser.uid]:0});
};
window.sendMessage=async()=>{
  if(!currentUser||!currentConvoId)return;const input=document.getElementById('chatInput');const text=input.value.trim();if(!text)return;
  const msgRef=push(ref(db,'pm_convos/'+currentConvoId+'/messages'));
  await set(msgRef,{text,sender:currentUserData.username,senderUid:currentUser.uid,at:Date.now()});
  await update(ref(db,'pm_convos/'+currentConvoId),{lastMsg:text,lastAt:Date.now()});
  input.value='';input.style.height='auto';
};
window.handleChatKey=e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage()}};
window.sendNewPm=async()=>{
  if(!currentUser){openModal('loginModal');return}
  const target=document.getElementById('newPmTarget').value.trim(),msg=document.getElementById('newPmMessage').value.trim();
  if(!target||!msg){showToast('Isi semua kolom','error');return}
  const snap=await get(ref(db,'users'));const users=snap.val()||{};
  const targetUser=Object.entries(users).find(([,u])=>u.username===target);
  if(!targetUser){showToast('User tidak ditemukan','error');return}
  const[targetUid,targetData]=targetUser;
  const cRef=push(ref(db,'pm_convos'));
  await set(cRef,{participants:{[currentUser.uid]:currentUserData.username,[targetUid]:targetData.username},lastMsg:msg,lastAt:Date.now(),unreadCount:{[targetUid]:1,[currentUser.uid]:0},createdAt:Date.now()});
  await push(ref(db,'pm_convos/'+cRef.key+'/messages'),{text:msg,sender:currentUserData.username,senderUid:currentUser.uid,at:Date.now()});
  closeModal('newPmModal');document.getElementById('newPmTarget').value='';document.getElementById('newPmMessage').value='';
  showToast('Pesan terkirim!','success');
};
window.filterConvos=q=>document.querySelectorAll('.chat-item').forEach(item=>{const name=item.querySelector('.chat-item-name')?.textContent||'';item.style.display=name.toLowerCase().includes(q.toLowerCase())?'':'none'});

// ‚îÄ‚îÄ PROFILE ‚îÄ‚îÄ
function loadProfile(){
  if(!currentUser||!currentUserData){openModal('loginModal');return}
  const u=currentUserData;
  setEl('profileName',u.username||'?');setEl('profileUsername',u.username||'?');setEl('profileEmail',u.email||'?');setEl('profilePosts',u.postCount||0);setEl('profileJoined',u.joinedAt?new Date(u.joinedAt).getFullYear():'‚Äî');
  document.getElementById('profileLogoutBtn').style.display='';
  document.getElementById('profileStatus').innerHTML=`<span class="badge-status ${u.status==='active'?'bs-active':'bs-banned'}">${cap(u.status||'active')}</span>`;
  const ava=document.getElementById('profileAvatar');
  if(u.photoURL)ava.innerHTML=`<img src="${u.photoURL}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;else ava.textContent=(u.username||'?')[0].toUpperCase();
  const badge=document.getElementById('profileRoleBadge');badge.className='profile-role-badge '+getRoleBadge(u.role||'member');badge.textContent=cap(u.role||'member');
  setInput('settingsDisplayName',u.username||'');
  onValue(ref(db,'posts'),snap=>{
    const all=snap.val()||{};const mine=Object.entries(all).filter(([,p])=>p.authorUid===currentUser.uid).sort((a,b)=>b[1].createdAt-a[1].createdAt).slice(0,5);
    const el=document.getElementById('profilePostsList');if(!el)return;
    el.innerHTML=mine.map(([,p])=>`<div class="topic-row"><div class="topic-main"><div class="topic-title">${esc(p.body?.slice(0,80)||'[Post]')}</div><div class="topic-meta">${timeAgo(p.createdAt)}</div></div></div>`).join('')||'<div style="text-align:center;padding:20px;color:var(--text3)">Belum ada post.</div>';
  });
}
window.saveSettings=async()=>{
  if(!currentUser)return;const name=document.getElementById('settingsDisplayName').value.trim();
  if(!name){showToast('Nama tidak boleh kosong','error');return}
  await update(ref(db,'users/'+currentUser.uid),{username:name});currentUserData.username=name;setEl('profileName',name);showToast('Tersimpan!','success');
};
window.changeAvatar=e=>{
  const file=e.target.files[0];if(!file)return;const r=new FileReader();
  r.onload=ev=>{const a=document.getElementById('profileAvatar');a.innerHTML=`<img src="${ev.target.result}" style="width:100%;height:100%;object-fit:cover;border-radius:50%">`;if(currentUser)update(ref(db,'users/'+currentUser.uid),{photoURL:ev.target.result})};
  r.readAsDataURL(file);
};

// ‚îÄ‚îÄ ADMIN ‚îÄ‚îÄ
function loadAdminPage(){if(!isAdmin()){showToast('Akses ditolak','error');showPage('forums');return}loadAdminOverview()}
function loadAdminOverview(){
  onValue(ref(db,'stats'),snap=>{
    const d=snap.val()||{};setEl('admStatMembers',d.totalMembers||'0');setEl('admStatWL',d.wlPending||'0');setEl('admStatCS',d.csPending||'0');setEl('admStatImport',d.importPending||'0');setEl('admStatReports',d.reportsOpen||'0');setEl('admStatPosts',d.totalPosts||'0');
  });
  onValue(query(ref(db,'activity_log'),orderByChild('at'),limitToLast(20)),snap=>{
    const data=snap.val()||{},list=Object.values(data).sort((a,b)=>b.at-a.at);
    const el=document.getElementById('admRecentActivity');if(!el)return;
    el.innerHTML=`<table><thead><tr><th>Waktu</th><th>User</th><th>Aksi</th><th>Detail</th></tr></thead><tbody>${list.map(l=>`<tr><td class="text-dim">${shortTime(l.at)}</td><td>${esc(l.user)}</td><td>${esc(l.action)}</td><td class="text-dim">${esc(l.detail||'')}</td></tr>`).join('')||'<tr><td colspan="4" style="text-align:center;color:var(--text3)">Belum ada aktivitas.</td></tr>'}</tbody></table>`;
  });
}
function loadAdminMembers(){
  onValue(ref(db,'users'),snap=>{
    const data=snap.val()||{},list=Object.values(data).sort((a,b)=>b.joinedAt-a.joinedAt);
    const tbody=document.getElementById('membersTbody');if(!tbody)return;
    tbody.innerHTML=list.map(u=>`<tr><td><span class="${getRoleCls(u.role)}">${esc(u.username||'?')}</span></td><td>${cap(u.role||'member')}</td><td><span class="badge-status ${u.status==='active'?'bs-active':'bs-banned'}">${cap(u.status||'active')}</span></td><td class="text-dim">${u.joinedAt?new Date(u.joinedAt).toLocaleDateString('id-ID'):'-'}</td><td><select onchange="changeRole('${u.uid}',this.value)" class="form-input" style="padding:2px 6px;font-size:11px;width:auto;display:inline">${['member','vip','helper','developer','admin','owner'].map(r=>`<option value="${r}" ${u.role===r?'selected':''}>${cap(r)}</option>`).join('')}</select><button onclick="banUser('${u.uid}','${esc(u.username)}')" class="btn btn-danger btn-sm" style="margin-left:4px">${u.status==='banned'?'Unban':'Ban'}</button></td></tr>`).join('');
  });
}
window.changeRole=async(uid,role)=>{await update(ref(db,'users/'+uid),{role});showToast('Role diubah','success');logAct('Change Role',currentUserData.username,uid+' ‚Üí '+role)};
window.banUser=async(uid,username)=>{const snap=await get(ref(db,'users/'+uid));const u=snap.val();const isBanned=u.status==='banned';await update(ref(db,'users/'+uid),{status:isBanned?'active':'banned'});showToast((isBanned?'Unban':'Ban')+' berhasil: '+username,'success');logAct(isBanned?'Unban':'Ban',currentUserData.username,username)};
window.searchMembers=q=>document.querySelectorAll('#membersTbody tr').forEach(row=>{row.style.display=row.textContent.toLowerCase().includes(q.toLowerCase())?'':'none'});
window.filterMembersByRole=role=>document.querySelectorAll('#membersTbody tr').forEach(row=>{const t=row.cells[1]?.textContent||'';row.style.display=(!role||t.toLowerCase()===role.toLowerCase())?'':'none'});

function loadAdminWL(){
  const filter=document.getElementById('wlFilter')?.value||'';
  onValue(ref(db,'registrations'),snap=>{
    let list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    if(filter)list=list.filter(([,d])=>d.status===filter);
    const tbody=document.getElementById('wlAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,d])=>`<tr><td>${esc(d.nama)}</td><td>${esc(d.karakter)}</td><td>${esc(d.wa)}</td><td><span class="badge-status ${statusBadge(d.status)}">${cap(d.status)}</span></td><td class="text-dim">${new Date(d.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="setWLStatus('${id}','process')" class="btn btn-sm">Proses</button><button onclick="setWLStatus('${id}','accepted')" class="btn btn-sm" style="color:var(--green)">‚úì</button><button onclick="setWLStatus('${id}','rejected')" class="btn btn-danger btn-sm">‚úï</button></td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--text3)">Tidak ada data.</td></tr>';
  });
}
window.loadAdminWL=loadAdminWL;
window.setWLStatus=async(id,status)=>{await update(ref(db,'registrations/'+id),{status,reviewedBy:currentUserData.username,reviewedAt:Date.now()});showToast('WL status: '+status,'success');logAct('WL Review',currentUserData.username,id+' ‚Üí '+status)};

function loadAdminCS(){
  onValue(ref(db,'cs_requests'),snap=>{
    const list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const tbody=document.getElementById('csAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,d])=>`<tr><td>${esc(d.charName)}</td><td>${esc(d.type)}</td><td>${esc(d.schedule)}</td><td><span class="badge-status ${statusBadge(d.status)}">${cap(d.status)}</span></td><td class="text-dim">${new Date(d.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="setCSStatus('${id}','approved')" class="btn btn-sm" style="color:var(--green)">‚úì</button><button onclick="setCSStatus('${id}','rejected')" class="btn btn-danger btn-sm">‚úï</button></td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--text3)">Tidak ada CS request.</td></tr>';
  });
}
window.setCSStatus=async(id,status)=>{const note=status==='rejected'?(prompt('Alasan penolakan:')||''):'';await update(ref(db,'cs_requests/'+id),{status,adminNote:note,reviewedBy:currentUserData.username});showToast('CS status: '+status,'success')};

function loadAdminImport(){
  onValue(ref(db,'import_requests'),snap=>{
    const list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const tbody=document.getElementById('importAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,d])=>`<tr><td>${esc(d.charName)}</td><td>${cap(d.type||'?')}</td><td style="max-width:150px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${esc(d.items)}</td><td><span class="badge-status ${statusBadge(d.status)}">${cap(d.status)}</span></td><td class="text-dim">${new Date(d.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="setImportStatus('${id}','approved')" class="btn btn-sm" style="color:var(--green)">‚úì</button><button onclick="setImportStatus('${id}','rejected')" class="btn btn-danger btn-sm">‚úï</button></td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--text3)">Tidak ada import request.</td></tr>';
  });
}
window.setImportStatus=async(id,status)=>{const note=status==='rejected'?(prompt('Alasan:')||''):'';await update(ref(db,'import_requests/'+id),{status,adminNote:note,reviewedBy:currentUserData.username});showToast('Import status: '+status,'success')};

function loadAdminReports(){
  onValue(ref(db,'reports'),snap=>{
    const list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const tbody=document.getElementById('reportsAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,d])=>`<tr><td>${esc(d.reporter)}</td><td>${esc(d.target)}</td><td>${esc(d.type)}</td><td><span class="badge-status ${d.status==='open'?'bs-warn':'bs-active'}">${cap(d.status)}</span></td><td class="text-dim">${new Date(d.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="setReportStatus('${id}','closed')" class="btn btn-sm">Close</button><button onclick="deleteReport('${id}')" class="btn btn-danger btn-sm">Hapus</button></td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--text3)">Tidak ada laporan.</td></tr>';
  });
}
window.setReportStatus=async(id,status)=>{await update(ref(db,'reports/'+id),{status,closedBy:currentUserData.username,closedAt:Date.now()});showToast('Report ditutup','success')};
window.deleteReport=async id=>{if(confirm('Hapus?')){await remove(ref(db,'reports/'+id));showToast('Dihapus','info')}};

function loadAdminBans(){
  onValue(ref(db,'users'),snap=>{
    const banned=Object.entries(snap.val()||{}).filter(([,u])=>u.status==='banned');
    const tbody=document.getElementById('bansAdminTbody');if(!tbody)return;
    tbody.innerHTML=banned.map(([uid,u])=>`<tr><td>${esc(u.username)}</td><td>${u.banReason||'‚Äî'}</td><td>${u.bannedBy||'‚Äî'}</td><td class="text-dim">${u.bannedAt?new Date(u.bannedAt).toLocaleDateString('id-ID'):'-'}</td><td><span class="badge-status bs-banned">Permanent</span></td><td><button onclick="banUser('${uid}','${esc(u.username)}')" class="btn btn-sm">Unban</button></td></tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:var(--text3)">Tidak ada yang dibanned.</td></tr>';
  });
}
window.openBanModal=()=>{const target=prompt('Username yang akan dibanned:');if(!target)return;const reason=prompt('Alasan ban:');if(!reason)return;banByUsername(target,reason)};
async function banByUsername(username,reason){const snap=await get(ref(db,'users'));const found=Object.entries(snap.val()||{}).find(([,u])=>u.username===username);if(!found){showToast('User tidak ditemukan','error');return}const[uid]=found;await update(ref(db,'users/'+uid),{status:'banned',banReason:reason,bannedBy:currentUserData.username,bannedAt:Date.now()});showToast('User '+username+' dibanned','success');logAct('Ban',currentUserData.username,username+': '+reason)}

function loadAdminAnnounce(){
  onValue(ref(db,'announcements'),snap=>{
    const list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const tbody=document.getElementById('annAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,a])=>`<tr><td>${esc(a.title)}</td><td><span class="badge-status ${annBadge(a.type)}">${cap(a.type||'info')}</span></td><td>${esc(a.author||'?')}</td><td class="text-dim">${new Date(a.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="deleteAnn('${id}')" class="btn btn-danger btn-sm">Hapus</button></td></tr>`).join('')||'<tr><td colspan="5" style="text-align:center;color:var(--text3)">Belum ada pengumuman.</td></tr>';
  });
}
window.postAnnouncement=async()=>{
  if(!currentUser||!isAdmin())return;const title=val('annTitle'),body=val('annBody'),type=val('annType');
  if(!title||!body){showToast('Isi judul dan isi','error');return}
  await push(ref(db,'announcements'),{title,body,type,author:currentUserData.username,createdAt:Date.now()});
  document.getElementById('annTitle').value='';document.getElementById('annBody').value='';showToast('Pengumuman diposting!','success');
};
window.deleteAnn=async id=>{if(confirm('Hapus?')){await remove(ref(db,'announcements/'+id));showToast('Dihapus','info')}};

function loadAdminGuides(){
  onValue(ref(db,'guides'),snap=>{
    const list=Object.entries(snap.val()||{}).sort((a,b)=>b[1].createdAt-a[1].createdAt);
    const tbody=document.getElementById('guideAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,g])=>`<tr><td>${esc(g.title)}</td><td>${esc(g.category||'‚Äî')}</td><td>${esc(g.author||'?')}</td><td class="text-dim">${new Date(g.createdAt).toLocaleDateString('id-ID')}</td><td><button onclick="deleteGuide('${id}')" class="btn btn-danger btn-sm">Hapus</button></td></tr>`).join('')||'<tr><td colspan="5" style="text-align:center;color:var(--text3)">Belum ada guide.</td></tr>';
  });
}
window.postGuide=async()=>{
  if(!currentUser||!isAdmin())return;const title=val('guideTitle'),body=val('guideBody'),category=val('guideCategory');
  if(!title||!body){showToast('Isi semua kolom','error');return}
  await push(ref(db,'guides'),{title,body,category,author:currentUserData.username,createdAt:Date.now()});
  document.getElementById('guideTitle').value='';document.getElementById('guideBody').value='';showToast('Guide ditambahkan!','success');
};
window.deleteGuide=async id=>{if(confirm('Hapus?')){await remove(ref(db,'guides/'+id));showToast('Dihapus','info')}};

function loadAdminStaff(){
  onValue(ref(db,'staff'),snap=>{
    const list=Object.entries(snap.val()||{});
    const tbody=document.getElementById('staffAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(([id,s])=>`<tr><td>${esc(s.name)}</td><td><span class="${getRoleCls(s.role)}">${cap(s.role)}</span></td><td>${esc(s.desc||'‚Äî')}</td><td><button onclick="removeStaff('${id}')" class="btn btn-danger btn-sm">Hapus</button></td></tr>`).join('')||'<tr><td colspan="4" style="text-align:center;color:var(--text3)">Belum ada staff.</td></tr>';
  });
}
window.addStaff=async()=>{
  const name=val('staffName'),role=val('staffRole'),desc=val('staffDesc');if(!name||!role){showToast('Isi nama dan role','error');return}
  await push(ref(db,'staff'),{name,role,desc,addedBy:currentUserData.username,at:Date.now()});
  document.getElementById('staffName').value='';document.getElementById('staffDesc').value='';showToast('Staff ditambahkan!','success');
};
window.removeStaff=async id=>{if(confirm('Hapus staff ini?')){await remove(ref(db,'staff/'+id));showToast('Staff dihapus','info')}};

async function loadAdminSettings(){
  const snap=await get(ref(db,'config'));const cfg=snap.val()||{};
  setInput('cfgServerName',cfg.serverName||'');setInput('cfgServerIP',cfg.serverIP||'');setInput('cfgDiscord',cfg.discord||'');setInput('cfgPlayersOnline',cfg.playersOnline||0);setInput('cfgCooldown',cfg.postCooldown||60);
  if(document.getElementById('cfgWLOpen'))document.getElementById('cfgWLOpen').value=cfg.wlOpen==='0'?'0':'1';
}
window.saveConfig=async()=>{
  const cfg={serverName:val('cfgServerName'),serverIP:val('cfgServerIP'),discord:val('cfgDiscord'),playersOnline:parseInt(val('cfgPlayersOnline'))||0,wlOpen:document.getElementById('cfgWLOpen')?.value||'1',postCooldown:parseInt(val('cfgCooldown'))||60};
  await set(ref(db,'config'),cfg);config=cfg;showToast('Pengaturan disimpan!','success');
};

function loadAdminLogs(){
  onValue(query(ref(db,'activity_log'),orderByChild('at'),limitToLast(50)),snap=>{
    const list=Object.values(snap.val()||{}).sort((a,b)=>b.at-a.at);
    const tbody=document.getElementById('logsAdminTbody');if(!tbody)return;
    tbody.innerHTML=list.map(l=>`<tr><td class="text-dim">${new Date(l.at).toLocaleString('id-ID')}</td><td>${esc(l.user)}</td><td>${esc(l.action)}</td><td class="text-dim">${esc(l.detail||'')}</td></tr>`).join('')||'<tr><td colspan="4" style="text-align:center;color:var(--text3)">Tidak ada log.</td></tr>';
  });
}

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ
(async()=>{
  const cfgSnap=await get(ref(db,'config'));config=cfgSnap.val()||{};
  loadStats();loadOnline();
  setTimeout(()=>document.getElementById('loader').classList.add('hidden'),1300);
})();
</script>
</body>
</html>
