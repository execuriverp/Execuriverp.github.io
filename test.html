<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic 3.1 - Integrated Admin Panel</title>
  <link rel="icon" type="image/png" href="exemusicicon.png">
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent: #00ff88; 
      --accent-admin: #f6d66f;
      --accent2: #86d5f7;
      --text: #ffffff;
      --text-dim: #b3b3b3;
      --bg: #050505;
      --card-bg: #121212;
      --card-bg-admin: #0e0e12;
      --glass: rgba(255, 255, 255, 0.05);
      --danger: #ff3333;
      --warning: #ffcc00;
      --success: #51e8a4;
      --tiktok-red: #ff0050;
      --gold: #ffd700;
      --purple: #bf00ff;
      --border: rgba(255,255,255,0.1);
      --glow: rgba(255,215,0,0.15);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
    }

    /* Admin Panel Mode */
    body.admin-mode .app-container { display: none !important; }
    body.admin-mode #adminPanel { display: flex !important; }

    /* --- BROADCAST SYSTEM --- */
    .sys-broadcast {
        position: fixed;
        top: -150px; 
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 400px;
        background: rgba(15, 15, 15, 0.95);
        border-left: 4px solid var(--accent);
        border-radius: 6px;
        padding: 15px;
        z-index: 12000;
        box-shadow: 0 10px 40px rgba(0,0,0,0.8);
        display: flex;
        flex-direction: column;
        transition: top 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        backdrop-filter: blur(10px);
    }
    .sys-broadcast.active { top: 20px; }
    .sb-content { display: flex; align-items: flex-start; gap: 12px; }
    .sb-icon { font-size: 20px; color: var(--accent); margin-top: 2px; }
    .sb-text h4 { margin: 0; font-size: 14px; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }
    .sb-text p { margin: 4px 0 0; font-size: 12px; color: #ddd; line-height: 1.4; }
    .sb-close { position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: #666; cursor: pointer; font-size: 16px; padding: 5px; }
    .sb-close:hover { color: white; }
    .sb-progress { width: 100%; height: 3px; background: #333; margin-top: 12px; border-radius: 2px; overflow: hidden; }
    .sb-bar { width: 100%; height: 100%; background: var(--accent); transform-origin: left; }
    @keyframes countDown { from { transform: scaleX(1); } to { transform: scaleX(0); } }

    /* Admin Button in Main App */
    .admin-access-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #f6d66f, #f9e56c);
      border: 2px solid rgba(246, 214, 111, 0.5);
      color: #000;
      padding: 12px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 8px 20px rgba(246, 214, 111, 0.3);
      transition: all 0.3s ease;
      z-index: 1000;
      display: none;
    }
    .admin-access-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(246, 214, 111, 0.5);
    }
    .admin-access-btn i {
      margin-right: 8px;
    }

    /* --- ADMIN PANEL STYLES --- */
    #adminPanel {
      display: none;
      width: 100vw;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      background: linear-gradient(180deg, #07070a, #0a0a10 35%, #000);
    }

    .admin-sidebar {
      width: 250px;
      background: linear-gradient(180deg, rgba(20,20,30,0.9), rgba(10,10,15,0.9));
      border-right: 1px solid rgba(255,255,255,0.08);
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: fixed;
      left: 0;
      top: 0;
      height: 100vh;
      z-index: 100;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
    }

    .admin-logo {
      font-family: 'Rajdhani', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--accent-admin);
      margin-bottom: 30px;
      text-align: center;
      padding: 15px;
      background: rgba(246, 214, 111, 0.1);
      border-radius: 12px;
      border: 1px solid rgba(246, 214, 111, 0.2);
    }

    .admin-nav-btn {
      width: 100%;
      padding: 12px;
      margin: 6px 0;
      background: rgba(255,255,255,0.02);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--text-dim);
      cursor: pointer;
      border-radius: 12px;
      text-align: left;
      transition: 0.2s;
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .admin-nav-btn:hover {
      color: var(--accent-admin);
      border-color: var(--accent-admin);
      box-shadow: 0 0 8px var(--glow);
      transform: translateY(-1px);
    }
    .admin-nav-btn.active {
      color: #000;
      border-color: var(--accent-admin);
      background: linear-gradient(180deg, #f9e56c, #f6d66f);
      box-shadow: 0 0 12px var(--glow);
    }

    .admin-exit-btn {
      margin-top: auto;
      background: linear-gradient(180deg, #ff9aa0, #ff5252);
      color: #000;
      border: none;
      padding: 12px;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      transition: 0.2s;
    }
    .admin-exit-btn:hover {
      filter: brightness(1.1);
      transform: translateY(-2px);
    }

    .admin-main-view {
      margin-left: 250px;
      flex: 1;
      overflow-y: auto;
      padding: 30px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0));
    }

    .admin-view-section {
      display: none;
    }
    .admin-view-section.active {
      display: block;
      animation: fadeIn 0.3s;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .admin-card {
      background: linear-gradient(180deg, #121218, #0b0b12);
      border-radius: 16px;
      padding: 18px;
      border: 1px solid rgba(255,255,255,0.08);
      margin-bottom: 20px;
      box-shadow: 0 8px 28px rgba(0,0,0,0.45), 0 0 14px var(--glow);
    }

    .admin-card h2 {
      font-family: 'Rajdhani', sans-serif;
      color: var(--accent-admin);
      margin-bottom: 15px;
      font-size: 20px;
    }

    .cyber-table {
      width: 100%;
      border-collapse: collapse;
      font-family: 'JetBrains Mono', monospace;
    }
    .cyber-table th {
      padding: 12px;
      color: #000;
      text-align: left;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      background: linear-gradient(180deg, #f9e56c, #f6d66f);
      font-family: 'Rajdhani', sans-serif;
      font-size: 13px;
    }
    .cyber-table td {
      padding: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      font-size: 12px;
      color: #ddd;
    }
    .cyber-table tr:hover td {
      background: rgba(255,255,255,0.03);
    }

    .admin-btn {
      padding: 8px 12px;
      border: none;
      background: linear-gradient(180deg, #f9e56c, #f6d66f);
      color: #000;
      border-radius: 8px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-size: 12px;
      transition: 0.2s;
      margin: 2px;
    }
    .admin-btn:hover {
      filter: brightness(1.1);
      transform: translateY(-1px);
    }
    .admin-btn-danger {
      background: linear-gradient(180deg, #ff9aa0, #ff5252);
    }
    .admin-btn-warn {
      background: linear-gradient(180deg, #ffeaa7, #ffcc66);
    }

    .cyber-input {
      background: rgba(10,10,15,0.8);
      border: 1px solid rgba(255,255,255,0.12);
      color: var(--text);
      padding: 10px 12px;
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      width: 100%;
      margin-bottom: 10px;
    }
    .cyber-input:focus {
      border-color: var(--accent-admin);
      box-shadow: 0 0 10px var(--glow);
    }

    .cyber-select {
      background: rgba(10,10,15,0.8);
      color: white;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px;
      border-radius: 8px;
      width: 100%;
      margin-bottom: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
    }

    .badge-tag {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: bold;
      display: inline-block;
    }
    .tag-user { background: #333; color: #fff; }
    .tag-sepuh { background: #ffcc00; color: #000; }
    .tag-vvip { background: #bf00ff; color: #fff; }
    .tag-admin { background: #ff3333; color: #fff; }
    .tag-owner { background: #00ff88; color: #000; border: 1px solid #fff; }
    .tag-developer { background: #000; color: #00ff00; border: 1px solid #00ff00; }
    .tag-sultan { background: gold; color: #000; }
    .tag-wibu { background: #ff69b4; color: #fff; }
    .tag-sadboy { background: #000080; color: #add8e6; }
    .tag-hacker { background: #000; color: #0f0; }
    .tag-verified { background: #1da1f2; color: #fff; }
    .tag-bot { background: #708090; color: #fff; }
    .tag-npc { background: #d3d3d3; color: #000; }
    .tag-dj { background: #ff00ff; color: #fff; }
    .tag-pro { background: #ff4500; color: #fff; }
    .tag-noob { background: #8b4513; color: #fff; }
    .tag-top-global { background: #00c6ff; color: #fff; }
    .tag-premium { background: #8a2387; color: #fff; }
    .tag-influencer { background: #e1306c; color: #fff; }

    /* Admin Lock Screen (Code Entry) */
    #adminLockScreen {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, #000, #0a0a12);
      z-index: 99999;
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
    }

    .lock-card {
      background: linear-gradient(180deg, #121218, #0b0b12);
      border: 1px solid rgba(246, 214, 111, 0.2);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 30px var(--glow);
      max-width: 400px;
      width: 90%;
    }

    .lock-icon {
      font-size: 60px;
      color: var(--accent-admin);
      margin-bottom: 20px;
    }

    .lock-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 24px;
      color: var(--accent-admin);
      margin-bottom: 10px;
    }

    .lock-subtitle {
      color: var(--text-dim);
      font-size: 14px;
      margin-bottom: 30px;
    }

    .code-input-container {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-bottom: 20px;
    }

    .code-digit {
      width: 50px;
      height: 60px;
      background: rgba(10,10,15,0.8);
      border: 2px solid rgba(255,255,255,0.12);
      border-radius: 12px;
      text-align: center;
      font-size: 28px;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-admin);
      font-weight: 700;
    }

    .code-digit:focus {
      border-color: var(--accent-admin);
      box-shadow: 0 0 15px var(--glow);
    }

    .lock-submit-btn {
      background: linear-gradient(180deg, #f9e56c, #f6d66f);
      border: none;
      color: #000;
      padding: 12px 40px;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 700;
      font-size: 16px;
      transition: 0.2s;
      margin-top: 10px;
    }

    .lock-submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px var(--glow);
    }

    .lock-cancel-btn {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.2);
      color: var(--text-dim);
      padding: 10px 30px;
      border-radius: 12px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      margin-left: 10px;
      transition: 0.2s;
    }

    .lock-cancel-btn:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    /* Stats Cards */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, rgba(246, 214, 111, 0.1), rgba(246, 214, 111, 0.05));
      border: 1px solid rgba(246, 214, 111, 0.2);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      color: var(--accent-admin);
      font-family: 'JetBrains Mono', monospace;
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-dim);
      margin-top: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Mobile Responsive for Admin Panel */
    @media (max-width: 768px) {
      .admin-sidebar {
        width: 200px;
      }
      .admin-main-view {
        margin-left: 200px;
        padding: 15px;
      }
      .code-digit {
        width: 40px;
        height: 50px;
        font-size: 22px;
      }
      .lock-card {
        padding: 25px;
      }
    }
  </style>
</head>
<body>

  <!-- System Broadcast -->
  <div class="sys-broadcast" id="sysBroadcast">
    <button class="sb-close" onclick="closeBroadcast()">&times;</button>
    <div class="sb-content">
      <i class="fas fa-exclamation-triangle sb-icon"></i>
      <div class="sb-text">
        <h4 id="sbTitle">SYSTEM ALERT</h4>
        <p id="sbMessage">Message here</p>
      </div>
    </div>
    <div class="sb-progress">
      <div class="sb-bar" id="sbBar"></div>
    </div>
  </div>

  <!-- Admin Access Button (Only visible for Admin/Owner) -->
  <button class="admin-access-btn" id="adminAccessBtn" onclick="showAdminLock()">
    <i class="fas fa-shield-alt"></i> Admin Panel
  </button>

  <!-- Admin Lock Screen (Code Entry) -->
  <div id="adminLockScreen">
    <div class="lock-card">
      <i class="fas fa-lock lock-icon"></i>
      <div class="lock-title">ADMIN ACCESS</div>
      <div class="lock-subtitle">Enter 5-digit security code</div>
      
      <div class="code-input-container">
        <input type="text" maxlength="1" class="code-digit" id="code1" onkeyup="moveToNext(this, 'code2')" onpaste="handlePaste(event)">
        <input type="text" maxlength="1" class="code-digit" id="code2" onkeyup="moveToNext(this, 'code3')">
        <input type="text" maxlength="1" class="code-digit" id="code3" onkeyup="moveToNext(this, 'code4')">
        <input type="text" maxlength="1" class="code-digit" id="code4" onkeyup="moveToNext(this, 'code5')">
        <input type="text" maxlength="1" class="code-digit" id="code5" onkeyup="checkCode()">
      </div>

      <button class="lock-submit-btn" onclick="checkCode()">
        <i class="fas fa-key"></i> Verify
      </button>
      <button class="lock-cancel-btn" onclick="hideAdminLock()">
        <i class="fas fa-times"></i> Cancel
      </button>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="adminPanel">
    <!-- Sidebar -->
    <div class="admin-sidebar">
      <div class="admin-logo">
        <i class="fas fa-shield-alt"></i> ADMIN PANEL
      </div>

      <button class="admin-nav-btn active" onclick="switchAdminView('dashboard')">
        <i class="fas fa-home"></i> Dashboard
      </button>
      <button class="admin-nav-btn" onclick="switchAdminView('users')">
        <i class="fas fa-users"></i> User Management
      </button>
      <button class="admin-nav-btn" onclick="switchAdminView('roles')">
        <i class="fas fa-user-tag"></i> Role Management
      </button>
      <button class="admin-nav-btn" onclick="switchAdminView('songs')">
        <i class="fas fa-music"></i> Song Management
      </button>
      <button class="admin-nav-btn" onclick="switchAdminView('broadcast')">
        <i class="fas fa-bullhorn"></i> Broadcast
      </button>

      <button class="admin-exit-btn" onclick="exitAdminPanel()">
        <i class="fas fa-sign-out-alt"></i> Exit Admin Panel
      </button>
    </div>

    <!-- Main View -->
    <div class="admin-main-view">
      <!-- Dashboard -->
      <div class="admin-view-section active" id="admin-dashboard">
        <h1 style="font-family: 'Rajdhani', sans-serif; color: var(--accent-admin); margin-bottom: 20px;">
          <i class="fas fa-chart-line"></i> Dashboard Overview
        </h1>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="totalUsers">0</div>
            <div class="stat-label">Total Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalSongs">0</div>
            <div class="stat-label">Total Songs</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="onlineUsers">0</div>
            <div class="stat-label">Online Users</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalPlays">0</div>
            <div class="stat-label">Total Plays</div>
          </div>
        </div>

        <div class="admin-card">
          <h2><i class="fas fa-clock"></i> Recent Activity</h2>
          <div id="recentActivity">Loading...</div>
        </div>
      </div>

      <!-- User Management -->
      <div class="admin-view-section" id="admin-users">
        <h1 style="font-family: 'Rajdhani', sans-serif; color: var(--accent-admin); margin-bottom: 20px;">
          <i class="fas fa-users"></i> User Management
        </h1>

        <div class="admin-card">
          <h2>All Users</h2>
          <div style="margin-bottom: 15px;">
            <input type="text" class="cyber-input" id="searchUser" placeholder="Search by username or email..." onkeyup="filterUsers()">
          </div>
          <div style="overflow-x: auto;">
            <table class="cyber-table" id="usersTable">
              <thead>
                <tr>
                  <th>Username</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Songs</th>
                  <th>Followers</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <tr><td colspan="6" style="text-align: center; padding: 20px;">Loading users...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Role Management -->
      <div class="admin-view-section" id="admin-roles">
        <h1 style="font-family: 'Rajdhani', sans-serif; color: var(--accent-admin); margin-bottom: 20px;">
          <i class="fas fa-user-tag"></i> Role Management
        </h1>

        <div class="admin-card">
          <h2>Quick Role Assignment</h2>
          <div style="display: grid; gap: 15px;">
            <div>
              <label style="display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 12px;">User Email:</label>
              <input type="email" class="cyber-input" id="roleUserEmail" placeholder="user@example.com">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 12px;">New Role:</label>
              <select class="cyber-select" id="roleSelect">
                <option value="User">User</option>
                <option value="Sepuh">Sepuh</option>
                <option value="VVIP">VVIP</option>
                <option value="Admin">Admin</option>
                <option value="Owner">Owner</option>
                <option value="Developer">Developer</option>
                <option value="Sultan">Sultan</option>
                <option value="Wibu">Wibu</option>
                <option value="Sadboy">Sadboy</option>
                <option value="Hacker">Hacker</option>
                <option value="Verified">Verified</option>
                <option value="Bot">Bot</option>
                <option value="NPC">NPC</option>
                <option value="DJ">DJ</option>
                <option value="Pro">Pro</option>
                <option value="Noob">Noob</option>
                <option value="Top Global">Top Global</option>
                <option value="Premium">Premium</option>
                <option value="Influencer">Influencer</option>
              </select>
            </div>
            <button class="admin-btn" style="padding: 12px;" onclick="quickAssignRole()">
              <i class="fas fa-check"></i> Assign Role
            </button>
          </div>
        </div>

        <div class="admin-card">
          <h2>Role Distribution</h2>
          <div id="roleDistribution">Loading...</div>
        </div>
      </div>

      <!-- Song Management -->
      <div class="admin-view-section" id="admin-songs">
        <h1 style="font-family: 'Rajdhani', sans-serif; color: var(--accent-admin); margin-bottom: 20px;">
          <i class="fas fa-music"></i> Song Management
        </h1>

        <div class="admin-card">
          <h2>All Songs</h2>
          <div style="margin-bottom: 15px;">
            <input type="text" class="cyber-input" id="searchSong" placeholder="Search songs..." onkeyup="filterSongs()">
          </div>
          <div style="overflow-x: auto;">
            <table class="cyber-table" id="songsTable">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Artist</th>
                  <th>Uploader</th>
                  <th>Plays</th>
                  <th>Duration</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="songsTableBody">
                <tr><td colspan="6" style="text-align: center; padding: 20px;">Loading songs...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Broadcast -->
      <div class="admin-view-section" id="admin-broadcast">
        <h1 style="font-family: 'Rajdhani', sans-serif; color: var(--accent-admin); margin-bottom: 20px;">
          <i class="fas fa-bullhorn"></i> Broadcast Message
        </h1>

        <div class="admin-card">
          <h2>Send System Broadcast</h2>
          <div style="display: grid; gap: 15px;">
            <div>
              <label style="display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 12px;">Title:</label>
              <input type="text" class="cyber-input" id="broadcastTitle" placeholder="SYSTEM ALERT">
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 12px;">Message:</label>
              <textarea class="cyber-input" id="broadcastMessage" rows="4" placeholder="Your broadcast message here..." style="resize: vertical;"></textarea>
            </div>
            <div>
              <label style="display: block; margin-bottom: 5px; color: var(--text-dim); font-size: 12px;">Duration (seconds):</label>
              <input type="number" class="cyber-input" id="broadcastDuration" value="10" min="3" max="30">
            </div>
            <button class="admin-btn admin-btn-warn" style="padding: 12px;" onclick="sendBroadcast()">
              <i class="fas fa-paper-plane"></i> Send Broadcast
            </button>
          </div>
        </div>

        <div class="admin-card">
          <h2>Broadcast History</h2>
          <div id="broadcastHistory">
            <div style="text-align: center; padding: 20px; color: #666;">No broadcast history</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main App Container (Original ExeMusic) -->
  <div class="app-container" id="appContainer">
    <!-- Your original ExeMusic content will go here -->
    <div style="text-align: center; padding: 40px;">
      <h1 style="color: var(--accent); font-size: 48px; margin-bottom: 20px;">
        <i class="fas fa-music"></i> ExeMusic 3.1
      </h1>
      <p style="color: var(--text-dim); font-size: 18px;">
        Integrated Admin Panel Edition
      </p>
      <p style="color: var(--text-dim); font-size: 14px; margin-top: 20px;">
        [Original ExeMusic interface akan ditampilkan di sini]
      </p>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDWHkSmovUB7V4pEMYU4jRm-OcLcVzQqto",
      authDomain: "exemusic.firebaseapp.com",
      databaseURL: "https://exemusic-default-rtdb.firebaseio.com",
      projectId: "exemusic",
      storageBucket: "exemusic.appspot.com",
      messagingSenderId: "686782300882",
      appId: "1:686782300882:web:ab2dd9fe7a6a9e78d00ea2"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    let currentUser = null;
    let userData = null;
    let adminCode = ''; // Will be generated

    // Generate random 5-digit code for admin access
    function generateAdminCode() {
      adminCode = Math.floor(10000 + Math.random() * 90000).toString();
      console.log('%cüîê ADMIN CODE: ' + adminCode, 'color: #f6d66f; font-size: 20px; font-weight: bold; background: #000; padding: 10px;');
    }

    // Auth State Listener
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        currentUser = user;
        db.ref('users/' + user.uid).once('value').then(function(snapshot) {
          userData = snapshot.val() || {};
          const userRole = (userData.role || '').toLowerCase();
          
          // Show admin button only for Admin/Owner
          if (userRole === 'admin' || userRole === 'owner') {
            document.getElementById('adminAccessBtn').style.display = 'block';
            generateAdminCode();
          }

          // Load user data and initialize app
          initializeApp();
        });
      } else {
        // Not logged in - handle accordingly
        console.log('User not logged in');
      }
    });

    function initializeApp() {
      // Initialize main app features
      console.log('App initialized for user:', userData.username);
    }

    // Admin Lock Screen Functions
    function showAdminLock() {
      document.getElementById('adminLockScreen').style.display = 'flex';
      document.getElementById('code1').focus();
      // Clear previous inputs
      for(let i=1; i<=5; i++) {
        document.getElementById('code'+i).value = '';
      }
    }

    function hideAdminLock() {
      document.getElementById('adminLockScreen').style.display = 'none';
    }

    function moveToNext(current, nextId) {
      if (current.value.length === 1) {
        if (nextId) {
          document.getElementById(nextId).focus();
        } else {
          checkCode();
        }
      }
    }

    function handlePaste(e) {
      e.preventDefault();
      const paste = (e.clipboardData || window.clipboardData).getData('text');
      const digits = paste.replace(/\D/g, '').slice(0, 5);
      
      for(let i=0; i<digits.length && i<5; i++) {
        document.getElementById('code'+(i+1)).value = digits[i];
      }
      
      if(digits.length === 5) {
        setTimeout(checkCode, 100);
      }
    }

    function checkCode() {
      let enteredCode = '';
      for(let i=1; i<=5; i++) {
        enteredCode += document.getElementById('code'+i).value;
      }

      if (enteredCode.length === 5) {
        if (enteredCode === adminCode) {
          // Correct code
          Swal.fire({
            icon: 'success',
            title: 'Access Granted',
            text: 'Welcome to Admin Panel',
            background: '#121212',
            color: '#fff',
            timer: 1500,
            showConfirmButton: false
          });
          setTimeout(() => {
            enterAdminMode();
          }, 1500);
        } else {
          // Wrong code
          Swal.fire({
            icon: 'error',
            title: 'Access Denied',
            text: 'Invalid security code',
            background: '#121212',
            color: '#fff'
          });
          // Clear inputs
          for(let i=1; i<=5; i++) {
            document.getElementById('code'+i).value = '';
          }
          document.getElementById('code1').focus();
        }
      }
    }

    function enterAdminMode() {
      hideAdminLock();
      document.body.classList.add('admin-mode');
      loadDashboardStats();
      loadUsers();
    }

    function exitAdminPanel() {
      Swal.fire({
        title: 'Exit Admin Panel?',
        text: 'Return to main application',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Exit',
        cancelButtonText: 'Cancel',
        background: '#121212',
        color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          document.body.classList.remove('admin-mode');
          generateAdminCode(); // Generate new code for next access
        }
      });
    }

    // Admin Panel Navigation
    function switchAdminView(viewName) {
      // Remove active from all nav buttons
      document.querySelectorAll('.admin-nav-btn').forEach(btn => btn.classList.remove('active'));
      
      // Hide all sections
      document.querySelectorAll('.admin-view-section').forEach(section => section.classList.remove('active'));
      
      // Show selected section
      document.getElementById('admin-' + viewName).classList.add('active');
      
      // Set active nav button
      event.target.classList.add('active');

      // Load data based on view
      switch(viewName) {
        case 'dashboard':
          loadDashboardStats();
          break;
        case 'users':
          loadUsers();
          break;
        case 'roles':
          loadRoleDistribution();
          break;
        case 'songs':
          loadSongs();
          break;
        case 'broadcast':
          loadBroadcastHistory();
          break;
      }
    }

    // Dashboard Functions
    function loadDashboardStats() {
      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        document.getElementById('totalUsers').textContent = Object.keys(users).length;
      });

      db.ref('songs').once('value').then(snapshot => {
        const songs = snapshot.val() || {};
        let totalPlays = 0;
        Object.values(songs).forEach(song => {
          totalPlays += (song.plays || 0);
        });
        document.getElementById('totalSongs').textContent = Object.keys(songs).length;
        document.getElementById('totalPlays').textContent = totalPlays;
      });

      // Mock online users for now
      document.getElementById('onlineUsers').textContent = Math.floor(Math.random() * 50) + 10;

      loadRecentActivity();
    }

    function loadRecentActivity() {
      const activityDiv = document.getElementById('recentActivity');
      activityDiv.innerHTML = `
        <div style="color: #666; font-size: 12px; padding: 20px; text-align: center;">
          Recent activity tracking coming soon...
        </div>
      `;
    }

    // User Management Functions
    function loadUsers() {
      const tbody = document.getElementById('usersTableBody');
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Loading users...</td></tr>';

      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        tbody.innerHTML = '';

        Object.entries(users).forEach(([uid, user]) => {
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${user.username || 'N/A'}</td>
            <td>${user.email || 'N/A'}</td>
            <td><span class="badge-tag tag-${(user.role || 'user').toLowerCase().replace(' ', '-')}">${user.role || 'User'}</span></td>
            <td>${user.songs ? Object.keys(user.songs).length : 0}</td>
            <td>${user.followers ? (Array.isArray(user.followers) ? user.followers.length : Object.keys(user.followers).length) : 0}</td>
            <td>
              <button class="admin-btn" onclick="editUser('${uid}')"><i class="fas fa-edit"></i></button>
              <button class="admin-btn admin-btn-warn" onclick="manageFollowers('${uid}')"><i class="fas fa-users"></i></button>
              <button class="admin-btn admin-btn-danger" onclick="deleteUser('${uid}')"><i class="fas fa-trash"></i></button>
            </td>
          `;
        });
      });
    }

    function filterUsers() {
      const searchTerm = document.getElementById('searchUser').value.toLowerCase();
      const rows = document.querySelectorAll('#usersTableBody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function editUser(uid) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const user = snapshot.val() || {};
        
        Swal.fire({
          title: 'Edit User: ' + user.username,
          html: `
            <div style="text-align: left;">
              <label style="display: block; margin: 10px 0 5px; color: #ccc; font-size: 12px;">Username:</label>
              <input id="editUsername" class="swal2-input" value="${user.username || ''}" style="width: 90%; background: #1a1a1a; border: 1px solid #333; color: #fff;">
              
              <label style="display: block; margin: 10px 0 5px; color: #ccc; font-size: 12px;">Role:</label>
              <select id="editRole" class="swal2-input" style="width: 90%; background: #1a1a1a; border: 1px solid #333; color: #fff;">
                <option value="User" ${user.role === 'User' ? 'selected' : ''}>User</option>
                <option value="Sepuh" ${user.role === 'Sepuh' ? 'selected' : ''}>Sepuh</option>
                <option value="VVIP" ${user.role === 'VVIP' ? 'selected' : ''}>VVIP</option>
                <option value="Admin" ${user.role === 'Admin' ? 'selected' : ''}>Admin</option>
                <option value="Owner" ${user.role === 'Owner' ? 'selected' : ''}>Owner</option>
              </select>
            </div>
          `,
          showCancelButton: true,
          confirmButtonText: 'Save Changes',
          background: '#121212',
          color: '#fff',
          preConfirm: () => {
            return {
              username: document.getElementById('editUsername').value,
              role: document.getElementById('editRole').value
            };
          }
        }).then((result) => {
          if (result.isConfirmed) {
            db.ref('users/' + uid).update(result.value).then(() => {
              Swal.fire('Updated!', 'User data has been updated.', 'success');
              loadUsers();
            });
          }
        });
      });
    }

    function manageFollowers(uid) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const user = snapshot.val() || {};
        let followers = [];
        if (Array.isArray(user.followers)) followers = [...user.followers];
        else if (user.followers && typeof user.followers === 'object') followers = Object.keys(user.followers);

        const fakeCount = followers.filter(f => f.toString().startsWith("User_")).length;
        const realCount = followers.length - fakeCount;

        const html = `
          <div style="text-align: left; padding: 10px;">
            <p style="margin-bottom: 15px; color: #ccc;">
              Current: ${followers.length} total (${realCount} real, ${fakeCount} fake)
            </p>
            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
              <button class="admin-btn" onclick="injectFake('${uid}', 10)" style="width: 100%; margin: 5px 0;">+10 Fake</button>
              <button class="admin-btn" onclick="injectFake('${uid}', 50)" style="width: 100%; margin: 5px 0;">+50 Fake</button>
              <button class="admin-btn" onclick="injectFake('${uid}', 100)" style="width: 100%; margin: 5px 0;">+100 Fake</button>
              <button class="admin-btn admin-btn-danger" onclick="clearFake('${uid}')" style="width: 100%; margin: 5px 0;">Clear All Fake</button>
            </div>
            <hr style="border-color: rgba(255,255,255,0.1); margin: 15px 0;">
            <label style="color: #ccc; font-size: 12px; display: block; margin-bottom: 5px;">Custom Amount:</label>
            <input id="mfCount" class="cyber-input" placeholder="Enter number" type="number">
            <select id="mfMode" class="cyber-select">
              <option value="add">Add Followers</option>
              <option value="remove">Remove Followers</option>
            </select>
            <button class="admin-btn admin-btn-warn" onclick="confirmApplyFollowers('${uid}')" style="width: 100%; padding: 12px; margin-top: 10px;">Apply Changes</button>
          </div>
        `;

        Swal.fire({
          title: 'Manage Followers',
          html: html,
          background: '#121212',
          color: '#fff',
          showConfirmButton: false,
          width: '500px'
        });
      });
    }

    function injectFake(uid, amount) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const user = snapshot.val() || {};
        let followers = [];
        if (Array.isArray(user.followers)) followers = [...user.followers];
        else if (user.followers && typeof user.followers === 'object') followers = Object.keys(user.followers);

        for (let i = 0; i < amount; i++) {
          followers.push("User_" + Math.floor(Math.random() * 999999));
        }

        db.ref('users/' + uid).update({ followers }).then(() => {
          Swal.fire('Success', `Added ${amount} fake followers`, 'success');
          loadUsers();
        });
      });
    }

    function clearFake(uid) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const user = snapshot.val() || {};
        let followers = [];
        if (Array.isArray(user.followers)) followers = [...user.followers];
        else if (user.followers && typeof user.followers === 'object') followers = Object.keys(user.followers);

        followers = followers.filter(f => !f.toString().startsWith("User_"));

        db.ref('users/' + uid).update({ followers }).then(() => {
          Swal.fire('Cleared', 'All fake followers removed', 'success');
          loadUsers();
        });
      });
    }

    function confirmApplyFollowers(uid) {
      const count = parseInt(document.getElementById('mfCount').value, 10);
      const mode = document.getElementById('mfMode').value;

      if (isNaN(count) || count <= 0) {
        Swal.fire('Error', 'Please enter a valid number', 'error');
        return;
      }

      const delta = mode === 'add' ? count : -count;

      Swal.fire({
        title: 'Confirm Changes',
        text: `Apply ${delta > 0 ? '+' + delta : delta} followers?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Apply',
        background: '#121212',
        color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          applyFakeDelta(uid, delta);
        }
      });
    }

    function applyFakeDelta(uid, delta) {
      db.ref('users/' + uid).once('value').then(snapshot => {
        const user = snapshot.val() || {};
        let followers = [];
        if (Array.isArray(user.followers)) followers = [...user.followers];
        else if (user.followers && typeof user.followers === 'object') followers = Object.keys(user.followers);

        if (delta > 0) {
          for (let i = 0; i < delta; i++) {
            followers.push("User_" + Math.floor(Math.random() * 999999));
          }
        } else {
          let toRemove = Math.abs(delta);
          for (let i = followers.length - 1; i >= 0 && toRemove > 0; i--) {
            if (followers[i].toString().startsWith("User_")) {
              followers.splice(i, 1);
              toRemove--;
            }
          }
        }

        db.ref('users/' + uid).update({ followers }).then(() => {
          Swal.fire('Done', 'Followers updated successfully', 'success');
          loadUsers();
        });
      });
    }

    function deleteUser(uid) {
      Swal.fire({
        title: 'Delete User?',
        text: 'This action cannot be undone!',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, Delete',
        confirmButtonColor: '#ff5252',
        background: '#121212',
        color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref('users/' + uid).remove().then(() => {
            Swal.fire('Deleted!', 'User has been deleted.', 'success');
            loadUsers();
          });
        }
      });
    }

    // Role Management Functions
    function quickAssignRole() {
      const email = document.getElementById('roleUserEmail').value.trim();
      const newRole = document.getElementById('roleSelect').value;

      if (!email) {
        Swal.fire('Error', 'Please enter user email', 'error');
        return;
      }

      // Find user by email
      db.ref('users').orderByChild('email').equalTo(email).once('value').then(snapshot => {
        if (snapshot.exists()) {
          const userData = snapshot.val();
          const uid = Object.keys(userData)[0];

          db.ref('users/' + uid).update({ role: newRole }).then(() => {
            Swal.fire('Success', `Role changed to ${newRole}`, 'success');
            document.getElementById('roleUserEmail').value = '';
            loadRoleDistribution();
          });
        } else {
          Swal.fire('Error', 'User not found', 'error');
        }
      });
    }

    function loadRoleDistribution() {
      const distDiv = document.getElementById('roleDistribution');
      
      db.ref('users').once('value').then(snapshot => {
        const users = snapshot.val() || {};
        const roleCounts = {};

        Object.values(users).forEach(user => {
          const role = user.role || 'User';
          roleCounts[role] = (roleCounts[role] || 0) + 1;
        });

        let html = '<div style="display: grid; gap: 10px;">';
        Object.entries(roleCounts).sort((a, b) => b[1] - a[1]).forEach(([role, count]) => {
          html += `
            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
              <span class="badge-tag tag-${role.toLowerCase().replace(' ', '-')}">${role}</span>
              <span style="color: var(--accent-admin); font-family: 'JetBrains Mono', monospace; font-size: 18px; font-weight: 700;">${count}</span>
            </div>
          `;
        });
        html += '</div>';

        distDiv.innerHTML = html;
      });
    }

    // Song Management Functions
    function loadSongs() {
      const tbody = document.getElementById('songsTableBody');
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 20px;">Loading songs...</td></tr>';

      db.ref('songs').once('value').then(snapshot => {
        const songs = snapshot.val() || {};
        tbody.innerHTML = '';

        Object.entries(songs).forEach(([songId, song]) => {
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${song.title || 'Unknown'}</td>
            <td>${song.artist || 'Unknown'}</td>
            <td>${song.uploaderName || 'Unknown'}</td>
            <td>${song.plays || 0}</td>
            <td>${formatDuration(song.duration || 0)}</td>
            <td>
              <button class="admin-btn" onclick="playSong('${songId}')"><i class="fas fa-play"></i></button>
              <button class="admin-btn admin-btn-danger" onclick="deleteSong('${songId}')"><i class="fas fa-trash"></i></button>
            </td>
          `;
        });
      });
    }

    function filterSongs() {
      const searchTerm = document.getElementById('searchSong').value.toLowerCase();
      const rows = document.querySelectorAll('#songsTableBody tr');
      
      rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      });
    }

    function formatDuration(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    function playSong(songId) {
      Swal.fire('Info', 'Song playback feature coming soon', 'info');
    }

    function deleteSong(songId) {
      Swal.fire({
        title: 'Delete Song?',
        text: 'This will permanently remove the song',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Yes, Delete',
        confirmButtonColor: '#ff5252',
        background: '#121212',
        color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          db.ref('songs/' + songId).remove().then(() => {
            Swal.fire('Deleted!', 'Song has been deleted.', 'success');
            loadSongs();
          });
        }
      });
    }

    // Broadcast Functions
    function sendBroadcast() {
      const title = document.getElementById('broadcastTitle').value.trim();
      const message = document.getElementById('broadcastMessage').value.trim();
      const duration = parseInt(document.getElementById('broadcastDuration').value);

      if (!title || !message) {
        Swal.fire('Error', 'Please fill in all fields', 'error');
        return;
      }

      Swal.fire({
        title: 'Send Broadcast?',
        text: 'All users will see this message',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Yes, Send',
        background: '#121212',
        color: '#fff'
      }).then((result) => {
        if (result.isConfirmed) {
          // Save to broadcast history
          const broadcastData = {
            title: title,
            message: message,
            duration: duration,
            timestamp: Date.now(),
            sender: userData.username
          };

          db.ref('broadcasts').push(broadcastData).then(() => {
            Swal.fire('Sent!', 'Broadcast message sent to all users', 'success');
            
            // Clear form
            document.getElementById('broadcastTitle').value = 'SYSTEM ALERT';
            document.getElementById('broadcastMessage').value = '';
            document.getElementById('broadcastDuration').value = '10';
            
            loadBroadcastHistory();

            // Show broadcast on current screen
            showBroadcastMessage(title, message, duration);
          });
        }
      });
    }

    function loadBroadcastHistory() {
      const historyDiv = document.getElementById('broadcastHistory');
      
      db.ref('broadcasts').limitToLast(10).once('value').then(snapshot => {
        const broadcasts = [];
        snapshot.forEach(child => {
          broadcasts.unshift({ id: child.key, ...child.val() });
        });

        if (broadcasts.length === 0) {
          historyDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">No broadcast history</div>';
          return;
        }

        let html = '<div style="display: grid; gap: 10px;">';
        broadcasts.forEach(broadcast => {
          const date = new Date(broadcast.timestamp);
          html += `
            <div style="background: rgba(255,255,255,0.03); padding: 12px; border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <strong style="color: var(--accent-admin);">${broadcast.title}</strong>
                <span style="color: #666; font-size: 11px;">${date.toLocaleString()}</span>
              </div>
              <p style="color: #ccc; font-size: 12px; margin: 5px 0;">${broadcast.message}</p>
              <div style="color: #666; font-size: 11px; margin-top: 5px;">
                By: ${broadcast.sender} ‚Ä¢ Duration: ${broadcast.duration}s
              </div>
            </div>
          `;
        });
        html += '</div>';

        historyDiv.innerHTML = html;
      });
    }

    // Broadcast System
    function showBroadcastMessage(title, message, duration = 10) {
      const broadcast = document.getElementById('sysBroadcast');
      const titleEl = document.getElementById('sbTitle');
      const messageEl = document.getElementById('sbMessage');
      const bar = document.getElementById('sbBar');

      titleEl.textContent = title;
      messageEl.textContent = message;

      broadcast.classList.add('active');
      bar.style.animation = `countDown ${duration}s linear forwards`;

      setTimeout(() => {
        closeBroadcast();
      }, duration * 1000);
    }

    function closeBroadcast() {
      const broadcast = document.getElementById('sysBroadcast');
      broadcast.classList.remove('active');
    }

    // Disable right-click
    document.addEventListener('contextmenu', event => event.preventDefault());
  </script>
</body>
</html>
