<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <title>ExeMusic 3.2.3</title>
  <link rel="icon" type="image/png" href="exemusicicon.png">
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Exo+2:wght@400;600;800;900&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --accent: #00ff88;
      --accent2: #00d4ff;
      --text: #ffffff;
      --text-dim: #b3b3b3;
      --bg: #040408;
      --card-bg: #0d0d15;
      --glass: rgba(255,255,255,0.05);
      --danger: #ff3333;
      --warning: #ffcc00;
      --tiktok-red: #ff0050;
      --gold: #ffd700;
      --purple: #bf00ff;
      --pink: #ff69b4;
      --deep-pink: #ff1493;
      --ml-blue: #1a237e;
      --ml-gold: #ffc107;
      --ml-red: #b71c1c;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

    body {
      font-family: 'Exo 2', 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      display: flex; justify-content: center; align-items: center;
      overflow: hidden;
    }

    /* ============================================================
       LOADING SCREEN - GAME STYLE
    ============================================================ */
    #gameLoadScreen {
      position: fixed; inset: 0; z-index: 99999;
      background: radial-gradient(ellipse at 50% -20%, rgba(0,212,255,0.15), transparent 60%),
                  radial-gradient(ellipse at 80% 100%, rgba(0,255,136,0.1), transparent 50%),
                  linear-gradient(180deg, #030308 0%, #06060f 50%, #030308 100%);
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
    #gameLoadScreen.fade-out {
      opacity: 0;
      transform: scale(1.05);
      pointer-events: none;
    }

    .load-logo-wrap {
      position: relative;
      margin-bottom: 40px;
    }
    .load-logo-ring {
      width: 110px; height: 110px; border-radius: 50%;
      border: 2px solid transparent;
      background: linear-gradient(#030308, #030308) padding-box,
                  linear-gradient(135deg, var(--accent), var(--accent2), var(--purple)) border-box;
      display: flex; align-items: center; justify-content: center;
      position: relative;
      animation: ringPulse 2s ease-in-out infinite;
    }
    @keyframes ringPulse {
      0%, 100% { box-shadow: 0 0 15px rgba(0,255,136,0.3), inset 0 0 15px rgba(0,255,136,0.05); }
      50% { box-shadow: 0 0 35px rgba(0,255,136,0.6), 0 0 60px rgba(0,212,255,0.2), inset 0 0 25px rgba(0,255,136,0.1); }
    }
    .load-logo-ring-outer {
      position: absolute; inset: -8px; border-radius: 50%;
      border: 1px solid rgba(0,255,136,0.2);
      animation: ringOuterSpin 8s linear infinite;
    }
    @keyframes ringOuterSpin {
      to { transform: rotate(360deg); }
    }
    .load-logo-ring-outer::before {
      content: '';
      position: absolute; top: -2px; left: 50%; transform: translateX(-50%);
      width: 6px; height: 6px; border-radius: 50%;
      background: var(--accent);
      box-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent);
    }
    .load-logo-icon {
      font-size: 40px; color: var(--accent);
      text-shadow: 0 0 20px var(--accent);
    }

    .load-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 32px; font-weight: 700;
      letter-spacing: 6px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      text-transform: uppercase;
      margin-bottom: 6px;
    }
    .load-subtitle {
      font-size: 11px; color: rgba(255,255,255,0.3);
      letter-spacing: 3px; text-transform: uppercase;
      font-family: 'JetBrains Mono', monospace;
      margin-bottom: 50px;
    }

    .load-bar-wrap {
      width: 320px; max-width: 90vw;
      margin-bottom: 16px;
    }
    .load-bar-track {
      width: 100%; height: 6px;
      background: rgba(255,255,255,0.06);
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .load-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent));
      background-size: 200% 100%;
      border-radius: 10px;
      width: 0%;
      transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      animation: barShimmer 1.5s linear infinite;
    }
    @keyframes barShimmer {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    .load-bar-fill::after {
      content: '';
      position: absolute; right: 0; top: 50%; transform: translateY(-50%);
      width: 12px; height: 12px; border-radius: 50%;
      background: white;
      box-shadow: 0 0 10px var(--accent), 0 0 20px var(--accent2);
    }
    .load-bar-glow {
      position: absolute; inset: 0;
      background: linear-gradient(90deg, transparent, rgba(0,255,136,0.15), transparent);
      animation: glowSlide 1.5s ease-in-out infinite;
    }
    @keyframes glowSlide {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .load-info-row {
      display: flex; justify-content: space-between;
      align-items: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
    }
    .load-status { color: rgba(255,255,255,0.4); letter-spacing: 1px; }
    .load-percent {
      font-weight: 700; font-size: 16px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .load-dots {
      display: flex; gap: 8px; margin-top: 30px;
    }
    .load-dot {
      width: 6px; height: 6px; border-radius: 50%;
      background: rgba(255,255,255,0.15);
      animation: dotPulse 1.2s ease-in-out infinite;
    }
    .load-dot:nth-child(1) { animation-delay: 0s; }
    .load-dot:nth-child(2) { animation-delay: 0.2s; }
    .load-dot:nth-child(3) { animation-delay: 0.4s; }
    @keyframes dotPulse {
      0%, 100% { background: rgba(255,255,255,0.15); transform: scale(1); }
      50% { background: var(--accent); transform: scale(1.4); box-shadow: 0 0 8px var(--accent); }
    }

    /* corner decorations */
    .load-corner {
      position: absolute;
      width: 30px; height: 30px;
      border-color: rgba(0,255,136,0.3);
      border-style: solid;
    }
    .load-corner.tl { top: 20px; left: 20px; border-width: 2px 0 0 2px; }
    .load-corner.tr { top: 20px; right: 20px; border-width: 2px 2px 0 0; }
    .load-corner.bl { bottom: 20px; left: 20px; border-width: 0 0 2px 2px; }
    .load-corner.br { bottom: 20px; right: 20px; border-width: 0 2px 2px 0; }

    /* ============================================================
       VELLY TAG - PINK HEARTS EFFECT
    ============================================================ */
    .tag-velly {
      background:
        radial-gradient(circle at 0 0, rgba(255,182,193,0.55), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255,192,203,0.45), transparent 55%),
        linear-gradient(135deg, #ff1493, #ff69b4, #ff1493);
      color: #fff;
      border: 1px solid rgba(255,255,255,0.7);
      font-weight: 900;
      letter-spacing: 1px;
      box-shadow: 0 0 14px rgba(255,20,147,0.9), 0 0 28px rgba(255,105,180,0.7);
      position: relative;
      overflow: visible;
      border-radius: 999px;
      animation: vellyPulse 1.7s ease-in-out infinite;
    }
    .tag-velly::before,
    .tag-velly::after {
      content: '❤';
      position: absolute;
      top: -6px;
      font-size: 9px;
      opacity: 0.9;
    }
    .tag-velly::before {
      left: -4px;
      transform: rotate(-12deg);
    }
    .tag-velly::after {
      right: -4px;
      transform: rotate(10deg);
    }
    @keyframes vellyPulse {
      0%, 100% { box-shadow: 0 0 12px rgba(255,20,147,0.6), inset 0 0 8px rgba(255,255,255,0.2); }
      50% { box-shadow: 0 0 22px rgba(255,20,147,0.9), 0 0 40px rgba(255,105,180,0.4), inset 0 0 12px rgba(255,255,255,0.3); }
    }

    /* floating hearts around velly tag */
    .hearts-container {
      position: fixed; pointer-events: none; z-index: 99990;
      width: 100vw; height: 100vh; top: 0; left: 0;
      overflow: hidden;
      display: none;
    }
    .hearts-container.active { display: block; }
    
    .heart-particle {
      position: absolute;
      bottom: -30px;
      font-size: 14px;
      animation: floatHeart linear infinite;
      opacity: 0;
    }
    @keyframes floatHeart {
      0% { transform: translateY(0) rotate(0deg) scale(0.5); opacity: 0; }
      10% { opacity: 1; }
      80% { opacity: 0.8; }
      100% { transform: translateY(-100vh) rotate(360deg) scale(1.2); opacity: 0; }
    }

    /* ============================================================
       RAMADHAN THEME - KETUPAT & LEBARAN EFFECTS
    ============================================================ */
    body.ramadan-active {
      background: #000 url('bg ramadhan.png') center/cover no-repeat fixed !important;
    }
    .ramadan-active .app {
      background: rgba(0, 0, 0, 0.3) !important;
      backdrop-filter: blur(5px) !important;
      border: 1px solid rgba(255, 255, 255, 0.05) !important;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3) !important;
    }
    .ramadan-active .cover-box,
    .ramadan-active .song-info,
    .ramadan-active .controls {
      opacity: 0.3 !important;
      pointer-events: none !important;
    }
    
    /* Ramadan Decorations */
    .ramadan-decoration {
      position: fixed;
      pointer-events: none;
      z-index: 99990;
      font-size: 40px;
      opacity: 0;
    }
    .ramadan-moon {
      animation: moonFloat 8s ease-in-out infinite;
      filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
    }
    @keyframes moonFloat {
      0%, 100% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.9;
      }
      50% {
        transform: translateY(-20px) rotate(5deg);
        opacity: 1;
      }
    }
    .ramadan-mosque {
      animation: mosqueGlow 4s ease-in-out infinite;
      filter: drop-shadow(0 0 15px rgba(0, 255, 136, 0.6));
    }
    @keyframes mosqueGlow {
      0%, 100% {
        opacity: 0.8;
        filter: drop-shadow(0 0 15px rgba(0, 255, 136, 0.6));
      }
      50% {
        opacity: 1;
        filter: drop-shadow(0 0 30px rgba(0, 255, 136, 0.9));
      }
    }
    .ramadan-ketupat {
      animation: ketupatSpin 6s linear infinite;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
    }
    @keyframes ketupatSpin {
      0% {
        transform: rotate(0deg) scale(1);
        opacity: 0.85;
      }
      50% {
        transform: rotate(180deg) scale(1.1);
        opacity: 1;
      }
      100% {
        transform: rotate(360deg) scale(1);
        opacity: 0.85;
      }
    }

    /* ============================================================
       BROADCAST SYSTEM
    ============================================================ */
    .sys-broadcast {
        position: fixed; top: -150px; left: 50%; transform: translateX(-50%);
        width: 90%; max-width: 400px;
        background: rgba(15,15,20,0.97);
        border-left: 4px solid var(--accent);
        border-radius: 8px; padding: 15px; z-index: 12000;
        box-shadow: 0 10px 40px rgba(0,0,0,0.8), 0 0 20px rgba(0,255,136,0.1);
        display: flex; flex-direction: column;
        transition: top 0.5s cubic-bezier(0.175,0.885,0.32,1.275), opacity 0.4s ease;
        backdrop-filter: blur(15px);
    }
    .sys-broadcast.active { top: 20px; }
    .sb-content { display: flex; align-items: flex-start; gap: 12px; }
    .sb-icon { font-size: 20px; color: var(--accent); margin-top: 2px; }
    .sb-text h4 { margin: 0; font-size: 14px; color: var(--accent); text-transform: uppercase; letter-spacing: 1px; }
    .sb-text p { margin: 4px 0 0; font-size: 12px; color: #ddd; line-height: 1.4; }
    .sb-close { position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: #666; cursor: pointer; font-size: 16px; padding: 5px; }
    .sb-close:hover { color: white; }
    .sb-progress { width: 100%; height: 3px; background: #333; margin-top: 12px; border-radius: 2px; overflow: hidden; }
    .sb-bar { width: 100%; height: 100%; background: var(--accent); transform-origin: left; }
    @keyframes countDown { from { transform: scaleX(1); } to { transform: scaleX(0); } }
    .sys-broadcast.sb-closing { top: -180px !important; opacity: 0; transition: top 0.4s ease, opacity 0.4s ease; }
    .sb-dev-name { color: #00d4ff; font-weight: 700; text-shadow: 0 0 8px #00d4ff; }

    .tag-unlock-banner {
      position: fixed;
      bottom: 82px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2600;
      background: linear-gradient(135deg, #020617, #020617);
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.8);
      padding: 10px 14px;
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: 0 14px 35px rgba(0,0,0,0.7);
      font-size: 11px;
      color: #e5e7eb;
    }
    .tag-unlock-banner.show {
      display: flex;
      animation: notifPanelIn 0.25s ease;
    }

    /* ============================================================
       EVENT BANNER - v3.2.3
    ============================================================ */
    .event-banner-global {
      position: fixed;
      bottom: 82px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2700;
      background: linear-gradient(135deg, rgba(236,72,153,0.95), rgba(168,85,247,0.95));
      border-radius: 14px;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 12px 16px;
      display: none;
      align-items: center;
      gap: 12px;
      box-shadow: 0 0 40px rgba(236,72,153,0.8), 0 14px 35px rgba(0,0,0,0.7);
      font-size: 12px;
      color: #fff;
      min-width: 320px;
      max-width: 90vw;
    }
    .event-banner-global.show {
      display: flex;
      animation: eventBannerIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
    }
    @keyframes eventBannerIn {
      from {
        opacity: 0;
        transform: translate(-50%, 20px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translate(-50%, 0) scale(1);
      }
    }
    .event-banner-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255,255,255,0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      animation: eventIconPulse 1.5s ease-in-out infinite;
    }
    @keyframes eventIconPulse {
      0%, 100% {
        transform: scale(1);
        box-shadow: 0 0 10px rgba(255,255,255,0.3);
      }
      50% {
        transform: scale(1.1);
        box-shadow: 0 0 20px rgba(255,255,255,0.6);
      }
    }
    .event-banner-main {
      flex: 1;
      min-width: 0;
    }
    .event-banner-title {
      font-size: 13px;
      font-weight: 800;
      margin-bottom: 4px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 1px;
    }
    .event-banner-desc {
      font-size: 11px;
      opacity: 0.9;
    }
    .event-banner-timer {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }
    .event-banner-time {
      font-size: 16px;
      font-weight: 800;
      font-family: 'JetBrains Mono', monospace;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .event-banner-label {
      font-size: 9px;
      opacity: 0.8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .event-banner-close {
      border: none;
      background: rgba(255,255,255,0.2);
      color: #fff;
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
    }
    .event-banner-close:hover {
      background: rgba(255,255,255,0.3);
      transform: rotate(90deg);
    }
    .event-banner-actions {
      display: flex;
      gap: 6px;
      margin-top: 8px;
    }
    .event-banner-btn {
      padding: 4px 10px;
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.15);
      color: #fff;
      font-size: 10px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .event-banner-btn:hover {
      background: rgba(255,255,255,0.25);
      transform: translateY(-1px);
    }
    @media (max-width: 480px) {
      .event-banner-global {
        bottom: 70px;
        padding: 10px 12px;
        min-width: auto;
      }
      .event-banner-icon {
        width: 32px;
        height: 32px;
        font-size: 16px;
      }
      .event-banner-title {
        font-size: 11px;
      }
      .event-banner-desc {
        font-size: 10px;
      }
    }
    .tag-unlock-icon {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 0 0, rgba(34,197,94,0.32), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(56,189,248,0.28), transparent 60%),
        #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #bbf7d0;
      flex-shrink: 0;
    }
    .tag-unlock-main {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .tag-unlock-text {
      font-size: 11px;
      font-weight: 700;
    }
    .tag-unlock-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }
    .tag-unlock-tags .user-tag {
      font-size: 10px;
      padding: 3px 8px;
    }
    .tag-unlock-close {
      border: none;
      background: none;
      color: #9ca3af;
      cursor: pointer;
      font-size: 14px;
      padding: 4px;
    }

    /* ============================================================
       ADMIN FLOAT CHAT (GLOBAL)
    ============================================================ */
    .admin-float-chat {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      max-width: 420px;
      width: calc(100% - 40px);
      padding: 10px 14px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, rgba(0,212,255,0.35), transparent 55%),
                  radial-gradient(circle at 100% 0, rgba(0,255,136,0.35), transparent 55%),
                  rgba(5,5,15,0.96);
      border: 1px solid rgba(0,255,136,0.3);
      box-shadow: 0 14px 40px rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      gap: 8px;
      z-index: 12500;
      pointer-events: none;
      overflow: hidden;
    }
    .admin-float-chat.show {
      display: flex;
      animation: floatChatIn 0.25s ease-out;
    }
    .admin-float-name {
      font-size: 11px;
      font-weight: 700;
      color: #e0f2ff;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .admin-float-name i {
      color: #1da1f2;
    }
    .admin-float-msg {
      font-size: 12px;
      color: #f5f5f5;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
      flex: 1;
    }
    .admin-float-timer {
      font-size: 10px;
      color: #9ca3af;
      margin-left: 6px;
      white-space: nowrap;
    }
    @media (max-width: 480px) {
      .admin-float-chat {
        top: 60px;
        padding: 8px 10px;
        width: calc(100% - 24px);
      }
      .admin-float-name {
        font-size: 10px;
      }
      .admin-float-msg {
        font-size: 11px;
      }
    }
    @keyframes floatChatIn {
      from { opacity: 0; transform: translate(-50%, -10px); }
      to { opacity: 1; transform: translate(-50%, 0); }
    }

    /* ============================================================
       OVERLAYS
    ============================================================ */
    .full-overlay {
      position: fixed; inset: 0; background: #000; z-index: 10000;
      display: none; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; padding: 30px;
    }
    .full-overlay i { font-size: 60px; margin-bottom: 20px; }
    .full-overlay h1 { font-size: 24px; color: var(--accent); }
    .full-overlay p { color: var(--text-dim); margin-top: 10px; }
    #bannedScreen h1 { color: var(--danger); }

    /* ============================================================
       MAIN APP - MOBILE LEGENDS STYLE
    ============================================================ */
    .app {
      background: linear-gradient(145deg, rgba(13,13,21,0.9) 0%, rgba(8,8,16,0.95) 100%);
      backdrop-filter: blur(40px);
      -webkit-backdrop-filter: blur(40px);
      border: 1px solid rgba(0,255,136,0.12);
      border-radius: 28px;
      width: 95%; max-width: 400px;
      height: 95vh;
      display: flex; flex-direction: column;
      padding: 22px;
      position: relative;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7), 0 0 40px rgba(0,255,136,0.05), inset 0 1px 0 rgba(255,255,255,0.06);
      overflow: hidden;
    }
    .app::before {
      content: '';
      position: absolute; top: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent), var(--accent2), transparent);
      opacity: 0.6;
    }

    /* ML Corner Decorations */
    .ml-corner {
      position: absolute; width: 16px; height: 16px; pointer-events: none;
    }
    .ml-corner::before, .ml-corner::after { content: ''; position: absolute; background: var(--accent); opacity: 0.5; }
    .ml-corner-tl { top: 12px; left: 12px; }
    .ml-corner-tl::before { top: 0; left: 0; width: 100%; height: 2px; }
    .ml-corner-tl::after { top: 0; left: 0; width: 2px; height: 100%; }
    .ml-corner-tr { top: 12px; right: 12px; }
    .ml-corner-tr::before { top: 0; right: 0; width: 100%; height: 2px; }
    .ml-corner-tr::after { top: 0; right: 0; width: 2px; height: 100%; }
    .ml-corner-bl { bottom: 12px; left: 12px; }
    .ml-corner-bl::before { bottom: 0; left: 0; width: 100%; height: 2px; }
    .ml-corner-bl::after { bottom: 0; left: 0; width: 2px; height: 100%; }
    .ml-corner-br { bottom: 12px; right: 12px; }
    .ml-corner-br::before { bottom: 0; right: 0; width: 100%; height: 2px; }
    .ml-corner-br::after { bottom: 0; right: 0; width: 2px; height: 100%; }

    /* ============================================================
       HEADER
    ============================================================ */
    .header { display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; margin-bottom: 15px; }
    .header img { width: 100px; cursor: pointer; transition: 0.3s; filter: drop-shadow(0 0 8px rgba(0,255,136,0.3)); }
    .header img:active { transform: scale(0.9); }
    .header-right { display: flex; align-items: center; gap: 8px; }

    #btnNotif {
      position: relative; width: 40px; height: 40px;
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 50%; color: white; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 17px; transition: 0.2s;
    }
    #btnNotif:hover { background: var(--accent); color: black; border-color: var(--accent); }
    #btnNotif .notif-badge { position: absolute; top: -2px; right: -2px; min-width: 17px; height: 17px; background: var(--danger); border-radius: 9px; font-size: 9px; font-weight: 700; display: none; align-items: center; justify-content: center; padding: 0 3px; }
    #btnNotif .notif-badge.show { display: flex; }
    #btnEvent {
      width: 40px; height: 40px;
      background: rgba(76,81,191,0.15);
      border: 1px solid rgba(76,81,191,0.4);
      border-radius: 50%; color: #c4b5fd; cursor: pointer;
      display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s;
    }
    #btnEvent:hover { background: rgba(76,81,191,0.5); color: #fff; box-shadow: 0 0 18px rgba(76,81,191,0.6); }

    #btnAdmin {
      display: none;
      width: 40px; height: 40px;
      background: linear-gradient(135deg, rgba(255,193,7,0.15), rgba(255,152,0,0.08));
      border: 1px solid rgba(255,193,7,0.25);
      border-radius: 50%; color: var(--ml-gold); cursor: pointer;
      align-items: center; justify-content: center; font-size: 16px; transition: 0.2s;
      box-shadow: 0 0 10px rgba(255,193,7,0.1);
    }
    #btnAdmin:hover { background: var(--ml-gold); color: black; box-shadow: 0 0 20px rgba(255,193,7,0.4); }
    #btnAdmin.show { display: flex; }

    #topLoginBtn {
      width: 40px; height: 40px;
      background: linear-gradient(135deg, rgba(0,255,136,0.12), rgba(0,212,255,0.08));
      border: 1px solid rgba(0,255,136,0.25);
      border-radius: 50%;
      color: var(--accent);
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
      transition: 0.2s;
      position: relative;
      overflow: hidden;
    }
    #topLoginBtn:hover {
      background: linear-gradient(135deg, rgba(0,255,136,0.25), rgba(0,212,255,0.15));
      border-color: var(--accent);
      box-shadow: 0 0 18px rgba(0,255,136,0.3);
      transform: scale(1.05);
    }
    #topLoginBtn.logged-in {
      border-color: rgba(0,255,136,0.4);
      box-shadow: 0 0 10px rgba(0,255,136,0.15);
    }

    /* ============================================================
       NOTIF PANEL
    ============================================================ */
    .notif-panel {
      position: fixed;
      top: 70px; right: 10px; /* fallback, overridden by JS */
      width: min(calc(100vw - 20px), 360px);
      max-height: min(72vh, 600px);
      background: rgba(8,8,18,0.98); border: 1px solid rgba(0,255,136,0.18);
      border-radius: 20px; box-shadow: 0 15px 50px rgba(0,0,0,0.8), 0 0 30px rgba(0,255,136,0.08);
      z-index: 9000; display: none; flex-direction: column; overflow: hidden;
      backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
      animation: notifPanelIn 0.25s ease;
    }
    .notif-panel.show { display: flex; }
    @keyframes notifPanelIn { from { opacity: 0; transform: translateY(-15px); } to { opacity: 1; transform: translateY(0); } }
    .notif-panel-header { padding: 16px 18px; border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
    .notif-panel-header h3 { margin: 0; font-size: 15px; color: var(--accent); display: flex; align-items: center; gap: 8px; font-family: 'Rajdhani', sans-serif; letter-spacing: 1px; }
    .notif-panel-close { background: none; border: none; color: #888; font-size: 17px; cursor: pointer; padding: 4px; }
    .notif-panel-close:hover { color: white; }
    .notif-list { overflow-y: auto; flex: 1; padding: 8px 0; min-height: 120px; max-height: 60vh; }
    .notif-list::-webkit-scrollbar { width: 4px; }
    .notif-list::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 10px; }
    .notif-item { padding: 13px 18px; border-bottom: 1px solid rgba(255,255,255,0.04); display: flex; gap: 12px; align-items: flex-start; transition: background 0.2s; }
    .notif-item:hover { background: rgba(255,255,255,0.03); }
    .notif-item-icon { width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
    .notif-item-icon.admin { background: rgba(255,51,51,0.15); color: #ff6b6b; }
    .notif-item-icon.violation { background: rgba(255,204,0,0.15); color: var(--warning); }
    .notif-item-icon.upload { background: rgba(0,255,136,0.1); color: var(--accent); }
    .notif-item-icon.follow { background: rgba(255,0,80,0.1); color: var(--tiktok-red); }
    .notif-item-icon.system { background: rgba(0,212,255,0.1); color: #00d4ff; }
    .notif-item-body { flex: 1; min-width: 0; }
    .notif-item-body .n-text { font-size: 12px; color: #ddd; line-height: 1.4; }
    .notif-item-body .n-time { font-size: 10px; color: #555; margin-top: 3px; }
    .notif-empty { padding: 30px 20px; text-align: center; color: #444; font-size: 12px; }

    /* ============================================================
       EVENT CENTER (MLBB STYLE)
    ============================================================ */
    .event-center-sheet {
      margin: 40px auto;
      max-width: 900px;
      width: calc(100% - 32px);
      padding: 18px 20px;
      background: linear-gradient(180deg, #111827, #020617);
      border-radius: 20px;
      border: 1px solid rgba(37,99,235,0.7);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: calc(100vh - 80px);
      overflow-y: auto;
    }
    .event-center-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(148,163,184,0.35);
    }
    .event-center-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 1.1px;
      font-size: 15px;
      color: #e5e7eb;
      text-transform: uppercase;
    }
    .event-center-title i {
      padding: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, rgba(250,204,21,0.2), transparent),
                  linear-gradient(135deg, #22c55e, #0ea5e9);
      color: #0b1120;
      box-shadow: 0 0 18px rgba(56,189,248,0.7);
    }
    .event-center-coins {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: radial-gradient(circle at 0 0, rgba(250,204,21,0.16), transparent 60%),
                  rgba(15,23,42,0.98);
      border: 1px solid rgba(250,204,21,0.7);
      box-shadow: 0 0 20px rgba(250,204,21,0.35);
    }
    .event-coins-icon {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, #fff7c2, #f59e0b);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #92400e;
      box-shadow: 0 0 12px rgba(250,204,21,0.6);
      animation: coinPulse 2.4s ease-in-out infinite;
    }
    .event-coins-icon.gain {
      animation: coinGain 0.6s ease-out;
    }
    .event-coins-body {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
    }
    .event-coins-label {
      font-size: 9px;
      text-transform: uppercase;
      color: #fef9c3;
      opacity: 0.9;
    }
    .event-coins-value {
      font-size: 16px;
      font-weight: 800;
      color: #facc15;
      text-shadow: 0 0 8px rgba(245,158,11,0.9);
    }
    @keyframes coinPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.06); }
    }
    @keyframes coinGain {
      0% { transform: scale(1); text-shadow: 0 0 8px rgba(245,158,11,0.9); }
      40% { transform: scale(1.18); text-shadow: 0 0 16px rgba(250,204,21,1); }
      100% { transform: scale(1); text-shadow: 0 0 8px rgba(245,158,11,0.9); }
    }
    .event-center-layout {
      display: grid;
      grid-template-columns: minmax(0, 1.7fr) minmax(0, 1fr);
      gap: 14px;
      align-items: flex-start;
    }
    .event-center-sidebar {
      display: none;
    }
    .event-tab-btn {
      border-radius: 18px;
      border: 1px solid rgba(30,64,175,0.9);
      background: radial-gradient(circle at 0 0, rgba(56,189,248,0.12), transparent 60%),
                  rgba(15,23,42,0.98);
      color: #9ca3af;
      font-size: 11px;
      padding: 7px 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      outline: none;
      transition: 0.18s;
      font-weight: 600;
    }
    .event-center-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }
    .event-tab-view {
      display: none;
    }
    .event-tab-view.active {
      display: block;
    }
    .event-tab-btn i {
      font-size: 13px;
    }
    .event-tab-btn.active {
      background: linear-gradient(135deg, rgba(34,197,94,0.3), rgba(56,189,248,0.3));
      border-color: rgba(56,189,248,0.9);
      color: #e5e7eb;
      box-shadow:
        0 0 0 1px rgba(15,23,42,0.9),
        0 0 20px rgba(34,197,94,0.7);
    }
    .event-center-main {
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.16), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(34,197,94,0.16), transparent 55%),
        rgba(15,23,42,0.97);
      border-radius: 18px;
      border: 1px solid rgba(30,64,175,0.9);
      padding: 10px 12px 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      box-shadow: 0 0 24px rgba(15,23,42,0.8);
    }
    .event-tab-caption {
      font-size: 10px;
      color: #9ca3af;
      margin-bottom: 4px;
    }
    .event-quest-list {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .event-quest-list::-webkit-scrollbar {
      width: 4px;
    }
    .event-quest-list::-webkit-scrollbar-thumb {
      background: linear-gradient(to bottom, #22c55e, #38bdf8);
      border-radius: 999px;
    }
    .event-quest-card {
      padding: 6px 4px;
      border-radius: 12px;
      border: 1px solid rgba(148,163,184,0.4);
      border-bottom: 1px solid rgba(31,41,55,0.9);
      display: grid;
      grid-template-columns: minmax(0,1.6fr) 120px 120px;
      gap: 6px;
      align-items: center;
      background: 
        radial-gradient(circle at 0 0, rgba(56,189,248,0.08), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(34,197,94,0.08), transparent 60%),
        rgba(15,23,42,0.96);
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      animation: eventCardIn 0.35s cubic-bezier(0.175,0.885,0.32,1.275);
      transform-origin: center top;
      transition: all 0.3s ease;
      margin-bottom: 8px;
    }
    .event-quest-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      border-color: rgba(34,197,94,0.5);
    }
    .event-quest-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .event-quest-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }
    .event-quest-title {
      font-size: 12px;
      color: #e5e7eb;
      font-weight: 600;
    }
    .event-quest-reward {
      font-size: 11px;
      color: #fbbf24;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    @keyframes eventCardIn {
      from {
        opacity: 0;
        transform: translateY(6px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    .event-quest-reward i {
      font-size: 11px;
    }
    .event-quest-desc {
      font-size: 10px;
      color: #9ca3af;
    }
    .event-quest-progress-wrap {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 1px;
    }
    .event-quest-progress-bar {
      position: relative;
      flex: 1;
      height: 3px;
      border-radius: 999px;
      background: rgba(31,41,55,0.9);
      overflow: hidden;
    }
    .event-quest-progress-fill {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, #22c55e, #38bdf8);
      transform-origin: left;
      transform: scaleX(0);
      transition: transform 0.2s ease-out;
    }
    .event-quest-progress-text {
      font-size: 10px;
      color: #9ca3af;
      white-space: nowrap;
    }
    .event-quest-action {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
    }
    .event-quest-badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 999px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #e5e7eb;
      background: rgba(37,99,235,0.25);
      border: 1px solid rgba(59,130,246,0.7);
    }
    .event-quest-btn {
      font-size: 10px;
      padding: 6px 12px;
      border-radius: 12px;
      border: 1px solid rgba(34,197,94,0.6);
      cursor: pointer;
      font-weight: 700;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: linear-gradient(135deg, rgba(34,197,94,0.3), rgba(56,189,248,0.2));
      color: #bbf7d0;
      box-shadow: 0 0 15px rgba(34,197,94,0.4);
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .event-quest-btn:hover {
      box-shadow: 0 0 25px rgba(34,197,94,0.7), 0 0 40px rgba(56,189,248,0.3);
      transform: translateY(-2px);
      border-color: rgba(34,197,94,0.9);
    }
    .event-quest-btn:active {
      transform: scale(0.95) translateY(0);
    }
    .event-quest-btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
      box-shadow: none;
      background: rgba(15,23,42,0.9);
      border-color: rgba(75,85,99,0.5);
    }
    .event-quest-btn.secondary {
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      box-shadow: none;
      border: 1px solid rgba(75,85,99,0.95);
    }
    .event-quest-btn.secondary:hover {
      background: rgba(34,197,94,0.15);
      border-color: rgba(34,197,94,0.5);
      box-shadow: 0 0 15px rgba(34,197,94,0.3);
    }
    .event-center-sidepanel {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .event-side-card {
      border-radius: 16px;
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.18), transparent 70%),
        rgba(15,23,42,0.98);
      border: 1px solid rgba(37,99,235,0.9);
      padding: 9px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      box-shadow: 0 0 18px rgba(15,23,42,0.9);
    }
    .event-side-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #9ca3af;
    }
    .event-side-body {
      font-size: 11px;
      color: #e5e7eb;
    }
    .event-side-main {
      font-weight: 600;
    }
    .event-side-sub {
      font-size: 10px;
      color: #9ca3af;
      margin-top: 2px;
    }
    .event-side-timer {
      font-size: 10px;
      color: #f97316;
      margin-top: 4px;
    }
    .event-side-tips {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 10px;
      color: #9ca3af;
    }
    .event-side-tips li::before {
      content: '•';
      color: #22c55e;
      display: inline-block;
      margin-right: 4px;
    }
    .event-shop-section {
      border-radius: 12px;
      border: 1px solid rgba(30,64,175,0.5);
      background: rgba(15,23,42,0.98);
      padding: 6px 10px 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      box-shadow: 0 0 12px rgba(15,23,42,0.8);
    }
    .event-shop-section-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.7px;
      color: #e5e7eb;
      border-left: 3px solid #38bdf8;
      padding-left: 6px;
    }
    .event-shop-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .event-shop-card {
      padding: 6px 4px;
      border-radius: 0;
      border: none;
      border-bottom: 1px solid rgba(31,41,55,0.9);
      display: grid;
      grid-template-columns: minmax(0,1.6fr) 90px 120px;
      gap: 6px;
      align-items: center;
      background: transparent;
    }
    .event-shop-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .event-shop-title-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 4px;
    }
    .event-shop-title {
      font-size: 12px;
      color: #e5e7eb;
      font-weight: 600;
    }
    .event-shop-price {
      font-size: 11px;
      color: #fbbf24;
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    .event-shop-desc {
      font-size: 10px;
      color: #9ca3af;
    }
    .event-shop-progress-wrap {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-top: 1px;
    }
    .event-shop-progress-bar {
      position: relative;
      flex: 1;
      height: 3px;
      border-radius: 999px;
      background: rgba(31,41,55,0.9);
      overflow: hidden;
    }
    .event-shop-progress-fill {
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, #22c55e, #38bdf8);
      transform-origin: left;
      transform: scaleX(0);
      transition: transform 0.2s ease-out;
    }
    .event-shop-progress-text {
      font-size: 10px;
      color: #9ca3af;
      white-space: nowrap;
    }
    .event-shop-action {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 3px;
    }
    .event-shop-badge {
      font-size: 9px;
      padding: 2px 6px;
      border-radius: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: #e5e7eb;
      background: rgba(37,99,235,0.15);
      border: 1px solid rgba(59,130,246,0.7);
    }
    .event-shop-btn {
      font-size: 10px;
      padding: 4px 8px;
      border-radius: 12px;
      border: none;
      cursor: default;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: rgba(15,23,42,0.95);
      color: #e5e7eb;
      border: 1px solid rgba(75,85,99,0.95);
    }
    @media (max-width: 900px) {
      .event-center-layout {
        grid-template-columns: minmax(0, 1fr);
      }
      .event-center-sidepanel {
        margin-top: 10px;
      }
    }
    @media (max-width: 640px) {
      .event-center-sheet {
        margin: 20px auto;
        max-width: 100%;
        width: calc(100% - 20px);
        padding: 14px 12px;
        border-radius: 16px;
      }
      .event-quest-card,
      .event-shop-card {
        grid-template-columns: minmax(0, 1fr);
      }
      .event-quest-action,
      .event-shop-action {
        align-items: flex-start;
      }
    }

    /* ============================================================
       LEADERBOARD SYSTEM - v3.2.3
    ============================================================ */
    .leaderboard-sheet {
      margin: 40px auto;
      max-width: 900px;
      width: calc(100% - 32px);
      padding: 18px 20px;
      background: linear-gradient(180deg, #0f172a, #020617);
      border-radius: 20px;
      border: 1px solid rgba(251,191,36,0.7);
      box-shadow: 0 18px 40px rgba(0,0,0,0.8);
      display: flex;
      flex-direction: column;
      gap: 16px;
      max-height: calc(100vh - 80px);
      overflow-y: auto;
    }
    .leaderboard-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(251,191,36,0.35);
    }
    .leaderboard-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 1.1px;
      font-size: 15px;
      color: #fbbf24;
      text-transform: uppercase;
    }
    .leaderboard-title i {
      padding: 7px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 20%, rgba(250,204,21,0.3), transparent),
                  linear-gradient(135deg, #fbbf24, #f59e0b);
      color: #0b1120;
      box-shadow: 0 0 18px rgba(251,191,36,0.7);
    }
    .leaderboard-refresh {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(251,191,36,0.1);
      border: 1px solid rgba(251,191,36,0.4);
      color: #fbbf24;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    .leaderboard-refresh i {
      font-size: 11px;
      animation: refreshSpin 2s linear infinite;
    }
    @keyframes refreshSpin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .leaderboard-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 6px;
    }
    .leaderboard-tab-btn {
      border-radius: 18px;
      border: 1px solid rgba(251,191,36,0.5);
      background: radial-gradient(circle at 0 0, rgba(251,191,36,0.12), transparent 60%),
                  rgba(15,23,42,0.98);
      color: #9ca3af;
      font-size: 11px;
      padding: 7px 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      outline: none;
      transition: 0.18s;
      font-weight: 600;
    }
    .leaderboard-tab-btn i {
      font-size: 13px;
    }
    .leaderboard-tab-btn.active {
      background: linear-gradient(135deg, rgba(251,191,36,0.3), rgba(245,158,11,0.3));
      border-color: rgba(251,191,36,0.9);
      color: #fbbf24;
      box-shadow: 0 0 0 1px rgba(15,23,42,0.9), 0 0 20px rgba(251,191,36,0.5);
    }
    .leaderboard-tab-view {
      display: none;
    }
    .leaderboard-tab-view.active {
      display: block;
    }
    .leaderboard-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .leaderboard-item {
      padding: 12px 14px;
      border-radius: 14px;
      background: radial-gradient(circle at 0 0, rgba(251,191,36,0.08), transparent 60%),
                  rgba(15,23,42,0.97);
      border: 1px solid rgba(148,163,184,0.4);
      display: flex;
      align-items: center;
      gap: 12px;
      transition: all 0.3s ease;
      animation: leaderboardItemIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275);
    }
    .leaderboard-item:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.6);
      border-color: rgba(251,191,36,0.6);
    }
    @keyframes leaderboardItemIn {
      from {
        opacity: 0;
        transform: translateY(10px) scale(0.98);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    .leaderboard-item.rank-1 {
      background: radial-gradient(circle at 0 0, rgba(255,215,0,0.25), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(255,193,7,0.2), transparent 60%),
                  rgba(15,23,42,0.97);
      border: 2px solid rgba(255,215,0,0.8);
      box-shadow: 0 0 30px rgba(255,215,0,0.4), inset 0 0 20px rgba(255,215,0,0.05);
    }
    .leaderboard-item.rank-2 {
      background: radial-gradient(circle at 0 0, rgba(192,192,192,0.25), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(148,163,184,0.2), transparent 60%),
                  rgba(15,23,42,0.97);
      border: 2px solid rgba(192,192,192,0.7);
      box-shadow: 0 0 25px rgba(192,192,192,0.3), inset 0 0 15px rgba(192,192,192,0.05);
    }
    .leaderboard-item.rank-3 {
      background: radial-gradient(circle at 0 0, rgba(205,127,50,0.25), transparent 60%),
                  radial-gradient(circle at 100% 100%, rgba(180,100,30,0.2), transparent 60%),
                  rgba(15,23,42,0.97);
      border: 2px solid rgba(205,127,50,0.7);
      box-shadow: 0 0 25px rgba(205,127,50,0.3), inset 0 0 15px rgba(205,127,50,0.05);
    }
    .leaderboard-rank {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      flex-shrink: 0;
      position: relative;
    }
    .leaderboard-item.rank-1 .leaderboard-rank {
      animation: goldPulse 2s ease-in-out infinite;
    }
    .leaderboard-item.rank-2 .leaderboard-rank {
      animation: silverPulse 2s ease-in-out infinite;
    }
    .leaderboard-item.rank-3 .leaderboard-rank {
      animation: bronzePulse 2s ease-in-out infinite;
    }
    @keyframes goldPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 8px rgba(255,215,0,0.6));
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 20px rgba(255,215,0,1));
        transform: scale(1.1);
      }
    }
    @keyframes silverPulse {
      0%, 100% { 
        filter: drop-shadow(0 0 8px rgba(192,192,192,0.6));
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 18px rgba(192,192,192,0.9));
        transform: scale(1.08);
      }
    }
    @keyframes bronzePulse {
      0%, 100% { 
        filter: drop-shadow(0 0 8px rgba(205,127,50,0.6));
        transform: scale(1);
      }
      50% { 
        filter: drop-shadow(0 0 18px rgba(205,127,50,0.9));
        transform: scale(1.08);
      }
    }
    .leaderboard-rank-number {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(148,163,184,0.2);
      border: 1px solid rgba(148,163,184,0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      font-weight: 800;
      color: #94a3b8;
      font-family: 'Rajdhani', sans-serif;
    }
    .leaderboard-user {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .leaderboard-username {
      font-size: 14px;
      font-weight: 700;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .leaderboard-item.rank-1 .leaderboard-username {
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255,215,0,0.6);
    }
    .leaderboard-item.rank-2 .leaderboard-username {
      color: #c0c0c0;
      text-shadow: 0 0 10px rgba(192,192,192,0.6);
    }
    .leaderboard-item.rank-3 .leaderboard-username {
      color: #cd7f32;
      text-shadow: 0 0 10px rgba(205,127,50,0.6);
    }
    .leaderboard-stats {
      font-size: 10px;
      color: #9ca3af;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .leaderboard-value {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 2px;
    }
    .leaderboard-value-number {
      font-size: 20px;
      font-weight: 800;
      color: #fbbf24;
      font-family: 'Rajdhani', sans-serif;
      text-shadow: 0 0 10px rgba(251,191,36,0.4);
    }
    .leaderboard-item.rank-1 .leaderboard-value-number {
      color: #ffd700;
      text-shadow: 0 0 15px rgba(255,215,0,0.8);
    }
    .leaderboard-item.rank-2 .leaderboard-value-number {
      color: #c0c0c0;
      text-shadow: 0 0 15px rgba(192,192,192,0.8);
    }
    .leaderboard-item.rank-3 .leaderboard-value-number {
      color: #cd7f32;
      text-shadow: 0 0 15px rgba(205,127,50,0.8);
    }
    .leaderboard-value-label {
      font-size: 9px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .leaderboard-empty {
      padding: 40px 20px;
      text-align: center;
      color: #6b7280;
      font-size: 12px;
    }
    @media (max-width: 640px) {
      .leaderboard-sheet {
        margin: 20px auto;
        width: calc(100% - 20px);
        padding: 14px 12px;
      }
      .leaderboard-item {
        padding: 10px 12px;
        gap: 10px;
      }
      .leaderboard-rank {
        width: 40px;
        height: 40px;
        font-size: 26px;
      }
      .leaderboard-rank-number {
        width: 32px;
        height: 32px;
        font-size: 14px;
      }
      .leaderboard-username {
        font-size: 12px;
      }
      .leaderboard-value-number {
        font-size: 16px;
      }
    }

    /* ============================================================
       CREATOR PANEL V2 - v3.2.3 (Side Panel - Draggable)
    ============================================================ */
    .creator-panel-overlay {
      position: fixed;
      inset: 0;
      z-index: 5500;
      display: none;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 70px 16px 16px;
      pointer-events: none;
    }
    .creator-panel-overlay.show {
      display: flex;
      pointer-events: auto;
    }
    .creator-panel {
      width: 360px;
      max-width: 400px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      background:
        radial-gradient(circle at 0 0, rgba(236,72,153,0.12), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(168,85,247,0.10), transparent 55%),
        linear-gradient(180deg, #0f172a, #0f172a);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 16px 50px rgba(0,0,0,0.85);
      border: 1px solid rgba(236,72,153,0.35);
    }
    .creator-header {
      background: linear-gradient(135deg, rgba(236,72,153,0.12), rgba(168,85,247,0.08));
      border-bottom: 1px solid rgba(236,72,153,0.2);
      padding: 14px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
      cursor: grab;
    }
    .creator-header:active { cursor: grabbing; }
    .creator-header-title {
      display: flex;
      align-items: center;
      gap: 8px;
      font-family: 'Rajdhani', sans-serif;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: 2px;
      color: #ec4899;
      text-shadow: 0 0 12px rgba(236,72,153,0.5);
    }
    .creator-header-title i {
      font-size: 18px;
    }
    .creator-header-tools {
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .creator-header-btn {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.16);
      color: #ccc;
      width: 28px; height: 28px;
      border-radius: 50%;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 12px;
      transition: 0.16s;
    }
    .creator-header-btn:hover { background: rgba(236,72,153,0.2); color: #ec4899; }
    .creator-header-close {
      background: rgba(239,68,68,0.15);
      border: 1px solid rgba(239,68,68,0.3);
      color: #ef4444;
      width: 28px; height: 28px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
    }
    .creator-header-close:hover {
      background: #ef4444;
      color: #fff;
    }
    .creator-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    .creator-content::-webkit-scrollbar { width: 3px; }
    .creator-content::-webkit-scrollbar-thumb { background: rgba(236,72,153,0.3); border-radius: 10px; }
    .creator-section {
      background: rgba(15,23,42,0.95);
      border: 1px solid rgba(236,72,153,0.2);
      border-radius: 12px;
      padding: 14px;
      margin-bottom: 12px;
    }
    .creator-section-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 13px;
      font-weight: 800;
      color: #ec4899;
      letter-spacing: 1.5px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 8px;
      text-transform: uppercase;
    }
    .creator-section-title i {
      color: #ec4899;
      text-shadow: 0 0 6px rgba(236,72,153,0.5);
    }
    .creator-input {
      width: 100%;
      padding: 10px 12px;
      background: rgba(0,0,0,0.35);
      color: white;
      border: 1px solid rgba(236,72,153,0.25);
      border-radius: 8px;
      font-size: 12px;
      margin-bottom: 8px;
      font-family: 'JetBrains Mono', monospace;
      transition: border-color 0.2s;
    }
    .creator-input:focus {
      border-color: #ec4899;
      box-shadow: 0 0 0 2px rgba(236,72,153,0.15);
    }
    .creator-textarea {
      width: 100%;
      padding: 10px 12px;
      background: rgba(0,0,0,0.35);
      color: white;
      border: 1px solid rgba(236,72,153,0.25);
      border-radius: 8px;
      font-size: 12px;
      margin-bottom: 8px;
      font-family: 'JetBrains Mono', monospace;
      resize: vertical;
      min-height: 60px;
      transition: border-color 0.2s;
    }
    .creator-textarea:focus {
      border-color: #ec4899;
      box-shadow: 0 0 0 2px rgba(236,72,153,0.15);
    }
    .creator-btn {
      width: 100%;
      padding: 10px 14px;
      border: none;
      border-radius: 8px;
      font-family: 'Rajdhani', sans-serif;
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      transition: 0.2s;
      text-transform: uppercase;
    }
    .creator-btn-primary {
      background: linear-gradient(135deg, #ec4899, #a855f7);
      color: #fff;
    }
    .creator-btn-primary:hover { opacity: 0.9; }
    .creator-btn-secondary {
      background: linear-gradient(135deg, #3b82f6, #06b6d4);
      color: #fff;
    }
    .creator-btn-secondary:hover { opacity: 0.9; }
    .creator-btn-success {
      background: linear-gradient(135deg, #10b981, #059669);
      color: #fff;
    }
    .creator-btn-success:hover { opacity: 0.9; }
    .creator-stats-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-bottom: 10px;
    }
    .creator-stat-box {
      background: rgba(0,0,0,0.25);
      border-radius: 8px;
      padding: 10px;
      border: 1px solid rgba(236,72,153,0.15);
      text-align: center;
    }
    .creator-stat-value {
      font-size: 20px;
      font-weight: 800;
      font-family: 'Rajdhani', sans-serif;
      color: #ec4899;
    }
    .creator-stat-label {
      font-size: 9px;
      color: #9ca3af;
      letter-spacing: 1px;
      margin-top: 2px;
      text-transform: uppercase;
    }
    .creator-event-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 6px;
    }
    .creator-event-btn {
      padding: 8px 10px;
      border: 1px solid rgba(236,72,153,0.25);
      border-radius: 8px;
      background: rgba(236,72,153,0.08);
      color: #ec4899;
      font-size: 11px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 3px;
    }
    .creator-event-btn:hover {
      background: rgba(236,72,153,0.15);
      border-color: #ec4899;
    }
    .creator-event-btn i { font-size: 18px; }
    .creator-label {
      font-size: 10px;
      color: #9ca3af;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    /* Creator Panel - Minimize mode */
    .creator-panel.creator-mini {
      width: 220px;
      max-width: 240px;
    }
    .creator-panel.creator-mini .creator-content { display: none; }
    .creator-overlay-mini {
      align-items: flex-end;
      justify-content: flex-end;
      padding: 0 16px 16px;
    }
    /* Creator Panel - Full mode */
    .creator-panel.creator-full {
      width: 100%;
      max-width: none;
      max-height: 100vh;
    }
    @media (max-width: 640px) {
      .creator-panel {
        width: 100%;
        max-width: 100%;
        border-radius: 0;
      }
      .creator-stats-grid { grid-template-columns: 1fr; }
      .creator-event-grid { grid-template-columns: 1fr; }
    }

    #btnCreatorPanel {
      display: none;
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, rgba(236,72,153,0.2), rgba(168,85,247,0.15));
      border: 1px solid rgba(236,72,153,0.4);
      border-radius: 50%;
      color: #ec4899;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: 0.2s;
      box-shadow: 0 0 10px rgba(236,72,153,0.2);
    }
    #btnCreatorPanel:hover {
      background: linear-gradient(135deg, #ec4899, #a855f7);
      color: #fff;
      box-shadow: 0 0 20px rgba(236,72,153,0.6);
    }
    #btnCreatorPanel.show {
      display: flex;
    }

    /* ============================================================
       COVER BOX
    ============================================================ */
    .cover-box {
      flex: 1; width: 100%; border-radius: 20px;
      background: radial-gradient(ellipse at 30% 30%, rgba(0,255,136,0.05), transparent 50%),
                  radial-gradient(ellipse at 70% 70%, rgba(0,212,255,0.05), transparent 50%),
                  #050510;
      display: flex; align-items: center; justify-content: center;
      margin-bottom: 18px;
      border: 1px solid rgba(255,255,255,0.04);
      overflow: hidden; position: relative; z-index: 10;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4), inset 0 0 30px rgba(0,0,0,0.3);
    }
    .cover-box::before {
      content: '';
      position: absolute; inset: 0;
      background: repeating-linear-gradient(0deg, transparent, transparent 30px, rgba(0,255,136,0.01) 30px, rgba(0,255,136,0.01) 31px),
                  repeating-linear-gradient(90deg, transparent, transparent 30px, rgba(0,255,136,0.01) 30px, rgba(0,255,136,0.01) 31px);
    }
    .eq { display: flex; align-items: flex-end; gap: 5px; height: 60px; position: relative; z-index: 15; }
    .eq span { width: 6px; background: linear-gradient(to top, var(--accent), var(--accent2)); border-radius: 10px; height: 10px; transition: height 0.2s ease; box-shadow: 0 0 10px var(--accent); }
    .playing span { animation: wave 0.8s infinite ease-in-out; }
    .playing span:nth-child(1) { animation-delay: 0.1s; }
    .playing span:nth-child(2) { animation-delay: 0.3s; }
    .playing span:nth-child(3) { animation-delay: 0.2s; }
    .playing span:nth-child(4) { animation-delay: 0.4s; }
    .playing span:nth-child(5) { animation-delay: 0.15s; }
    @keyframes wave { 0%, 100% { height: 10px; } 50% { height: 50px; } }

    /* ============================================================
       TRACK INFO
    ============================================================ */
    .track-info { margin-bottom: 16px; flex-shrink: 0; text-align: left; }
    #title { font-size: 20px; font-weight: 800; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-bottom: 5px; font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px; }
    .user-row { display: flex; align-items: center; gap: 10px; }
    #by { color: var(--accent); font-size: 13px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 4px; }
    #btnFav { background: none; border: none; color: var(--text-dim); font-size: 14px; cursor: pointer; transition: 0.2s; }
    #btnFav:hover { color: var(--tiktok-red); transform: scale(1.1); }
    #btnFav.active { color: var(--tiktok-red); animation: heartBeat 0.3s ease-in-out; }
    @keyframes heartBeat { 0% { transform: scale(1); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    #btnFollow { font-size: 12px; background: var(--tiktok-red); color: white; border: none; width: 22px; height: 22px; border-radius: 50%; font-weight: bold; cursor: pointer; display: none; transition: 0.2s; align-items: center; justify-content: center; }
    #btnFollow:active { transform: scale(0.9); }

    /* ============================================================
       SYS CONTAINER (TOOLS)
    ============================================================ */
    .sys-container {
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.05);
      border-radius: 16px; padding: 12px; margin-bottom: 14px; flex-shrink: 0; z-index: 5;
    }
    .sys-tools { display: flex; justify-content: space-between; margin-bottom: 10px; padding: 0 6px; }
    .sys-tools button { background: none; border: none; color: var(--text-dim); cursor: pointer; font-size: 17px; opacity: 0.7; transition: 0.2s; padding: 4px; }
    .sys-tools button:hover { opacity: 1; transform: translateY(-2px); color: var(--accent); }
    .vol-row { display: flex; align-items: center; gap: 10px; padding: 0 5px; }
    #vol { flex: 1; height: 4px; accent-color: var(--accent); cursor: pointer; border-radius: 2px; }

    /* ============================================================
       PROGRESS
    ============================================================ */
    .prog-area { margin-bottom: 16px; flex-shrink: 0; z-index: 5; }
    #seek { width: 100%; height: 5px; accent-color: var(--accent); cursor: pointer; display: block; border-radius: 2px; }
    .time { display: flex; justify-content: space-between; font-size: 11px; color: var(--text-dim); margin-top: 6px; font-weight: 500; align-items: center; font-family: 'JetBrains Mono', monospace; }
    .loading-spinner { width: 11px; height: 11px; border: 2px solid rgba(0,255,136,0.2); border-top: 2px solid var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; display: none; }
    .loading-spinner.show { display: block; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .dur-wrapper { display: flex; align-items: center; gap: 6px; }

    /* ============================================================
       CONTROLS
    ============================================================ */
    .main-ctrl { display: flex; justify-content: space-between; align-items: center; padding: 0 15px; margin-bottom: 18px; flex-shrink: 0; position: relative; z-index: 110; }
    .btn-play {
      width: 62px; height: 62px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border: none; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: black; font-size: 22px; cursor: pointer;
      box-shadow: 0 0 25px rgba(0,255,136,0.4), 0 0 50px rgba(0,255,136,0.15), inset 0 1px 0 rgba(255,255,255,0.3);
      transition: 0.2s;
    }
    .btn-play:active { transform: scale(0.95); box-shadow: 0 0 10px rgba(0,255,136,0.4); }
    .btn-sec { background: none; border: none; color: rgba(255,255,255,0.8); font-size: 26px; cursor: pointer; padding: 10px; opacity: 0.9; transition: 0.2s; }
    .btn-sec:hover { color: var(--accent); opacity: 1; }
    .btn-sec:active { transform: scale(0.9); }

    /* ============================================================
       FOOTER NAV
    ============================================================ */
    .footer {
      margin-top: auto; display: flex; justify-content: space-between;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,255,0.05);
      padding: 13px 25px; border-radius: 20px; flex-shrink: 0; z-index: 10;
    }
    .footer button { background: none; border: none; color: white; font-size: 17px; opacity: 0.4; cursor: pointer; transition: 0.2s; }
    .footer button:hover { opacity: 0.8; }
    .active-btn { color: var(--accent) !important; opacity: 1 !important; text-shadow: 0 0 10px var(--accent); }

    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: none; z-index: 2000; backdrop-filter: blur(8px); }
    .sheet {
      position: absolute; bottom: 0; width: 100%; max-width: 400px; left: 50%; transform: translateX(-50%);
      background: linear-gradient(180deg, #121220, #0a0a16);
      border-radius: 28px 28px 0 0; padding: 24px; max-height: 88vh; overflow-y: auto;
      box-shadow: 0 -10px 50px rgba(0,0,0,0.6), 0 -1px 0 rgba(0,255,136,0.1);
      border-top: 1px solid rgba(0,255,136,0.1);
      animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1);
    }
    @keyframes slideUp { from { transform: translate(-50%, 100%); } to { transform: translate(-50%, 0); } }
    .sheet::-webkit-scrollbar { width: 4px; }
    .sheet::-webkit-scrollbar-thumb { background: rgba(0,255,136,0.3); border-radius: 10px; }

    .upload-queue-section {
      margin-top: 12px;
      padding-top: 8px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    .upload-queue-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px;
      font-size: 11px;
    }
    .upload-queue-title-label {
      font-weight: 600;
      color: #fff;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    .upload-queue-info {
      color: #aaa;
      font-size: 10px;
    }
    .upload-queue-list {
      max-height: 150px;
      overflow-y: auto;
      border-radius: 10px;
      background: rgba(8,8,20,0.9);
      border: 1px solid rgba(255,255,255,0.04);
    }
    .upload-queue-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 7px 10px;
      font-size: 11px;
      border-bottom: 1px solid rgba(255,255,255,0.04);
      gap: 10px;
    }
    .upload-queue-item:last-child {
      border-bottom: none;
    }
    .upload-queue-main {
      flex: 1;
      min-width: 0;
    }
    .upload-queue-title {
      margin-right: 4px;
      color: #ddd;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .upload-queue-time {
      font-size: 10px;
      color: #888;
    }
    .upload-queue-actions {
      display: flex;
      align-items: center;
      gap: 4px;
    }
    .upload-queue-status {
      font-size: 9px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(255,255,255,0.06);
      color: #ccc;
      white-space: nowrap;
    }
    .upload-queue-status.status-queued {
      background: rgba(0,255,136,0.08);
      color: #7bffb9;
    }
    .upload-queue-status.status-processing {
      background: rgba(0,212,255,0.08);
      color: #7be9ff;
    }
    .upload-queue-status.status-done {
      background: rgba(120,120,120,0.2);
      color: #bbb;
    }
    .upload-queue-btn {
      border: none;
      background: rgba(255,255,255,0.06);
      color: #fff;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      cursor: pointer;
    }
    .upload-queue-btn:hover {
      background: rgba(255,255,255,0.12);
    }

    .upload-cd-card {
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: radial-gradient(circle at 0 0, rgba(0,255,136,0.12), transparent 55%),
                  radial-gradient(circle at 100% 100%, rgba(0,212,255,0.1), transparent 55%),
                  rgba(6,6,18,0.95);
      border: 1px solid rgba(0,255,136,0.3);
      display: none;
    }
    .upload-cd-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
    }
    .upload-cd-label {
      font-size: 10px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #a3a3ff;
    }
    .upload-cd-timer {
      font-family: 'JetBrains Mono', monospace;
      font-size: 16px;
      font-weight: 700;
      color: #00ff88;
    }
    .upload-cd-sub {
      margin-top: 4px;
      font-size: 10px;
      color: #888;
    }

    /* ============================================================
       PROFILE UI
    ============================================================ */
    .modern-profile-header {
      display: flex; flex-direction: column; align-items: center;
      padding: 32px 24px 20px;
      background: linear-gradient(180deg, rgba(0,255,136,0.06), rgba(0,212,255,0.02), transparent);
      position: relative;
      gap: 2px;
    }
    .modern-profile-header.vip {
      background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,152,0,0.06), rgba(255,255,255,0.02));
    }
    .modern-profile-header.vip::after {
      content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
      background: radial-gradient(circle at 30% 30%, rgba(255,215,0,0.07), transparent 40%);
      animation: vipShine 6s linear infinite; pointer-events: none;
    }
    .modern-profile-header.pink-profile {
      background: linear-gradient(135deg,
        rgba(255,20,147,0.10) 0%,
        rgba(255,105,180,0.06) 40%,
        rgba(15,23,42,1) 100%
      );
    }
    .modern-profile-header.pink-profile::before {
      content: ''; position: absolute; inset: 0; pointer-events: none;
      background:
        radial-gradient(circle at 10% 0%, rgba(255,182,193,0.2), transparent 55%),
        radial-gradient(circle at 90% 0%, rgba(244,114,182,0.18), transparent 55%);
      opacity: 0.8;
    }
    .modern-profile-header.gamers-profile {
      background:
        radial-gradient(circle at 0 0, rgba(34,197,94,0.16), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(56,189,248,0.14), transparent 55%),
        linear-gradient(180deg, #020617, #020617);
    }
    .modern-profile-header.legend-profile {
      background:
        radial-gradient(circle at 0 0, rgba(251,191,36,0.14), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(249,115,22,0.16), transparent 55%),
        linear-gradient(180deg, #111827, #020617);
    }
    .modern-profile-header.frost-profile {
      background:
        radial-gradient(circle at 0 0, rgba(148,163,184,0.32), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(56,189,248,0.26), transparent 55%),
        linear-gradient(180deg, #020617, #0f172a);
    }
    .modern-profile-header.frost-profile::before {
      content: '';
      position: absolute;
      inset: 0;
      background-image:
        radial-gradient(circle at 10% 0%, rgba(191,219,254,0.35), transparent 55%),
        radial-gradient(circle at 90% 100%, rgba(56,189,248,0.3), transparent 55%);
      opacity: 0.9;
      pointer-events: none;
    }
    .modern-profile-header.blaze-profile {
      background:
        radial-gradient(circle at 0 0, rgba(239,68,68,0.3), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(249,115,22,0.28), transparent 55%),
        linear-gradient(180deg, #111827, #020617);
    }
    .modern-profile-header.cosmic-profile {
      background:
        radial-gradient(circle at 0 0, rgba(129,140,248,0.34), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(56,189,248,0.28), transparent 55%),
        linear-gradient(180deg, #020617, #020617);
    }
    .modern-profile-header.neon-profile {
      background:
        radial-gradient(circle at 0 0, rgba(236,72,153,0.34), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(56,189,248,0.28), transparent 55%),
        linear-gradient(180deg, #020617, #020617);
    }
    .modern-profile-header.elite-profile {
      background:
        radial-gradient(circle at 0 0, rgba(250,204,21,0.22), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(234,179,8,0.24), transparent 55%),
        linear-gradient(180deg, #020617, #111827);
    }
    @keyframes vipShine { 0% { transform: translate(0,0) rotate(0deg); } 50% { transform: translate(10%,10%) rotate(20deg); } 100% { transform: translate(0,0) rotate(0deg); } }

    .mp-avatar-container { position: relative; margin-bottom: 16px; }
    .mp-avatar {
      width: 90px; height: 90px; border-radius: 50%; object-fit: cover;
      border: 3px solid var(--accent);
      box-shadow: 0 0 0 4px rgba(0,255,136,0.08), 0 8px 30px rgba(0,255,136,0.15);
      transition: 0.3s;
    }
    .mp-avatar:hover { transform: scale(1.05); box-shadow: 0 0 0 4px rgba(0,255,136,0.15), 0 12px 35px rgba(0,255,136,0.25); }
    .modern-profile-header.vip .mp-avatar { border-color: var(--gold); box-shadow: 0 0 0 4px rgba(255,215,0,0.1), 0 8px 30px rgba(255,215,0,0.2); }
    
    /* Admin Badge */
    .mp-admin-badge {
      position: absolute;
      bottom: -5px;
      left: 50%;
      transform: translateX(-50%);
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      border: 3px solid #0d0d15;
      z-index: 10;
      animation: adminBadgePulse 2s ease-in-out infinite;
    }
    .mp-admin-badge.admin {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      color: #fff;
      box-shadow: 0 0 15px rgba(239,68,68,0.6), 0 0 30px rgba(239,68,68,0.3);
    }
    .mp-admin-badge.creator {
      background: linear-gradient(135deg, #a855f7, #7c3aed);
      color: #fff;
      box-shadow: 0 0 15px rgba(168,85,247,0.6), 0 0 30px rgba(168,85,247,0.3);
    }
    .mp-admin-badge.admin-creator {
      background: linear-gradient(135deg, #fbbf24, #f59e0b, #ef4444);
      color: #000;
      box-shadow: 0 0 20px rgba(251,191,36,0.6), 0 0 40px rgba(245,158,11,0.3);
    }
    @keyframes adminBadgePulse {
      0%, 100% { transform: translateX(-50%) scale(1); }
      50% { transform: translateX(-50%) scale(1.1); }
    }
    
    /* Admin Avatar Border */
    .mp-avatar-container.has-admin .mp-avatar {
      border-color: #ef4444;
      box-shadow: 0 0 0 4px rgba(239,68,68,0.15), 0 0 25px rgba(239,68,68,0.3), 0 8px 30px rgba(0,0,0,0.3);
      animation: adminBorderGlow 3s ease-in-out infinite;
    }
    .mp-avatar-container.has-creator .mp-avatar {
      border-color: #a855f7;
      box-shadow: 0 0 0 4px rgba(168,85,247,0.15), 0 0 25px rgba(168,85,247,0.3), 0 8px 30px rgba(0,0,0,0.3);
      animation: creatorBorderGlow 3s ease-in-out infinite;
    }
    .mp-avatar-container.has-admin-creator .mp-avatar {
      border-color: #fbbf24;
      box-shadow: 0 0 0 4px rgba(251,191,36,0.2), 0 0 30px rgba(251,191,36,0.4), 0 0 50px rgba(245,158,11,0.2), 0 8px 30px rgba(0,0,0,0.3);
      animation: adminCreatorBorderGlow 2s ease-in-out infinite;
    }
    @keyframes adminBorderGlow {
      0%, 100% { box-shadow: 0 0 0 4px rgba(239,68,68,0.15), 0 0 25px rgba(239,68,68,0.3), 0 8px 30px rgba(0,0,0,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(239,68,68,0.2), 0 0 35px rgba(239,68,68,0.5), 0 0 60px rgba(239,68,68,0.2), 0 8px 30px rgba(0,0,0,0.3); }
    }
    @keyframes creatorBorderGlow {
      0%, 100% { box-shadow: 0 0 0 4px rgba(168,85,247,0.15), 0 0 25px rgba(168,85,247,0.3), 0 8px 30px rgba(0,0,0,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(168,85,247,0.2), 0 0 35px rgba(168,85,247,0.5), 0 0 60px rgba(168,85,247,0.2), 0 8px 30px rgba(0,0,0,0.3); }
    }
    @keyframes adminCreatorBorderGlow {
      0%, 100% { box-shadow: 0 0 0 4px rgba(251,191,36,0.2), 0 0 30px rgba(251,191,36,0.4), 0 0 50px rgba(245,158,11,0.2), 0 8px 30px rgba(0,0,0,0.3); }
      50% { box-shadow: 0 0 0 6px rgba(251,191,36,0.3), 0 0 45px rgba(251,191,36,0.6), 0 0 70px rgba(245,158,11,0.3), 0 8px 30px rgba(0,0,0,0.3); }
    }
    
    .mp-edit-badge {
      position: absolute; bottom: 2px; right: 2px;
      background: linear-gradient(135deg, #1a1a2e, #0f172a);
      color: var(--accent); width: 28px; height: 28px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid rgba(0,255,136,0.3); cursor: pointer; font-size: 11px;
      transition: 0.2s;
    }
    .mp-edit-badge:hover { background: var(--accent); color: #000; border-color: var(--accent); }
    .mp-name-row { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; justify-content: center; }
    .mp-name { font-size: 20px; font-weight: 800; color: #fff; font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px; }
    .mp-handle { font-size: 11px; color: #888; margin-bottom: 12px; letter-spacing: 0.3px; }
    .mp-stats {
      display: flex; gap: 0; margin-bottom: 18px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      border-radius: 12px;
      overflow: hidden;
    }
    .mp-stat-item {
      text-align: center; cursor: pointer; flex: 1;
      padding: 12px 16px;
      transition: 0.2s;
      position: relative;
    }
    .mp-stat-item:not(:last-child)::after {
      content: ''; position: absolute; right: 0; top: 20%; height: 60%;
      width: 1px; background: rgba(255,255,255,0.06);
    }
    .mp-stat-item:hover { background: rgba(0,255,136,0.04); }
    .mp-stat-val { display: block; font-size: 18px; font-weight: 800; color: #fff; font-family: 'Rajdhani', sans-serif; line-height: 1.2; }
    .mp-stat-label { font-size: 9px; color: #888; letter-spacing: 0.8px; text-transform: uppercase; margin-top: 2px; }
    .mp-actions {
      display: flex; gap: 6px; width: 100%; margin-bottom: 16px;
      flex-wrap: nowrap; overflow-x: auto;
      padding: 8px 10px; border-radius: 12px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.06);
      justify-content: flex-start;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: rgba(0,255,136,0.2) transparent;
    }
    .mp-actions::-webkit-scrollbar { height: 3px; }
    .mp-actions::-webkit-scrollbar-track { background: transparent; }
    .mp-actions::-webkit-scrollbar-thumb { background: rgba(0,255,136,0.2); border-radius: 10px; }
    .mp-actions::-webkit-scrollbar-thumb:hover { background: rgba(0,255,136,0.4); }
    .mp-btn {
      flex: 0 0 auto; padding: 8px 12px; border-radius: 8px; border: none;
      font-weight: 700; font-size: 11px; cursor: pointer; transition: 0.2s;
      display: flex; align-items: center; justify-content: center; gap: 5px;
      font-family: 'Rajdhani', sans-serif; letter-spacing: 0.5px;
    }
    .mp-btn:hover { transform: translateY(-1px); }
    .mp-btn-primary { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #000; }
    .mp-btn-sec { background: rgba(255,255,255,0.06); color: #ddd; border: 1px solid rgba(255,255,255,0.08); }
    .mp-btn-sec:hover { background: rgba(255,255,255,0.12); color: #fff; border-color: rgba(255,255,255,0.15); }
    .mp-btn-pink { background: linear-gradient(135deg, #ff1493, #ff69b4); color: #fff; }
    .mp-tabs {
      display: flex; width: 100%;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      margin-bottom: 0;
      background: rgba(255,255,255,0.02);
    }
    .mp-tab {
      flex: 1; padding: 14px 12px; text-align: center; color: #666;
      cursor: pointer; font-size: 11px; font-weight: 700;
      position: relative; transition: 0.2s;
      font-family: 'Rajdhani', sans-serif; letter-spacing: 1.2px;
    }
    .mp-tab:hover { color: #999; background: rgba(255,255,255,0.02); }
    .mp-tab.active { color: var(--accent); background: rgba(0,255,136,0.03); }
    .mp-tab.active::after {
      content: ''; position: absolute; bottom: 0; left: 15%; width: 70%; height: 2px;
      background: linear-gradient(90deg, transparent, var(--accent), transparent);
      border-radius: 2px;
    }
    .mp-list { display: flex; flex-direction: column; gap: 4px; padding: 8px 12px 18px; max-height: 280px; overflow-y: auto; }
    .mp-list::-webkit-scrollbar { width: 3px; }
    .mp-list::-webkit-scrollbar-thumb { background: rgba(0,255,136,0.2); border-radius: 10px; }
    .mp-song-item {
      display: flex; align-items: center; gap: 10px; padding: 10px 12px;
      border-radius: 10px; background: rgba(255,255,255,0.02);
      cursor: pointer; border: 1px solid transparent; transition: 0.2s;
    }
    .mp-song-item:hover { background: rgba(255,255,255,0.05); border-color: rgba(0,255,136,0.1); transform: translateX(2px); }
    .mp-song-icon {
      width: 34px; height: 34px; border-radius: 8px;
      background: linear-gradient(135deg, rgba(0,255,136,0.08), rgba(0,212,255,0.05));
      display: flex; align-items: center; justify-content: center;
      font-size: 13px; color: var(--accent); flex-shrink: 0;
    }
    .mp-song-info { flex: 1; min-width: 0; }
    .mp-song-title { font-size: 12px; font-weight: 700; color: #eee; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .mp-song-artist { font-size: 10px; color: #666; margin-top: 1px; }

    /* ============================================================
       SONG LIST
    ============================================================ */
    .song-item { padding: 13px; border-bottom: 1px solid rgba(255,255,255,0.04); cursor: pointer; display: flex; align-items: center; justify-content: space-between; border-radius: 10px; transition: 0.2s; }
    .song-item:hover { background: rgba(255,255,255,0.04); }

    /* ============================================================
       INPUTS & BUTTONS
    ============================================================ */
    .inp-dark {
      width:100%; padding:13px; margin-bottom:10px;
      background: rgba(0,0,0,0.4); color:white;
      border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; font-size: 13px;
      transition: border-color 0.2s;
    }
    .inp-dark:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(0,255,136,0.08); }
    .btn-act {
      width:100%; padding:13px; background: linear-gradient(135deg, var(--accent), var(--accent2));
      border:none; border-radius:12px; font-weight:800; color:black; cursor: pointer; margin-top: 5px;
      font-size: 14px; text-transform: uppercase; letter-spacing: 1.5px; font-family: 'Rajdhani', sans-serif;
      box-shadow: 0 5px 20px rgba(0,255,136,0.3);
      transition: 0.2s;
    }
    .btn-act:hover { transform: translateY(-1px); box-shadow: 0 8px 28px rgba(0,255,136,0.4); }

  .user-tag {
    font-size: 9px; padding: 2px 6px; border-radius: 4px; font-weight: 800;
    text-transform: uppercase; margin-left: 4px; vertical-align: middle; letter-spacing: 0.5px;
    font-family: 'Rajdhani', sans-serif;
  }
  .tag-vip {
    background: linear-gradient(135deg, #ffd700, #ff9800);
    color: #000;
    box-shadow: 0 0 10px rgba(255,215,0,0.6);
    border: 1px solid rgba(0,0,0,0.3);
  }
  .tag-newbie {
    background: linear-gradient(135deg, #0f172a, #1e293b);
    color: #7dd3fc;
    border: 1px solid rgba(125,211,252,0.4);
  }
  .tag-admin { background: #ff3333; color: #fff; }
  .tag-staff { background: #0088ff; color: #fff; }
  .tag-execurive { background: #aa00ff; color: #fff; }
  .tag-user { background: #2a2a3a; color: #999; border: 1px solid rgba(255,255,255,0.1); }
  .tag-sepuh { background: #1a1a2e; color: var(--accent); border: 1px solid var(--accent); }
  .tag-rich { background: linear-gradient(45deg, gold, #fff9c4); color: #000; }
  .tag-galau { background: #2a2a3a; color: #aaa; font-style: italic; }
  .tag-cheater { background: #ff0050; color: #fff; text-decoration: line-through; }
  .tag-vvip { background: var(--purple); color: #fff; box-shadow: 0 0 8px var(--purple); }
  .tag-owner { background: linear-gradient(135deg, var(--accent), var(--accent2)); color: #000; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 0 10px var(--accent); font-weight: 900; }
  .tag-developer { background: #000; color: #00ff00; border: 1px solid #00ff00; font-family: 'JetBrains Mono', monospace; letter-spacing: 1px; text-shadow: 0 0 6px #0f0; }
  .tag-sultan { background: linear-gradient(135deg, #ffd700, #fbf5b7, #ffd700); color: #000; border: 1px solid #b8860b; font-weight: bold; }
  .tag-wibu { background: #ff69b4; color: #fff; border: 1px solid #ff1493; }
  .tag-sadboy { background: #000080; color: #add8e6; border: 1px solid #add8e6; font-style: italic; }
  .tag-hacker { background: #000; color: #0f0; text-shadow: 0 0 5px #0f0; font-family: 'JetBrains Mono', monospace; }
  .tag-verified { background: #1da1f2; color: #fff; }
  .tag-bot { background: #708090; color: #fff; }
  .tag-npc { background: #d3d3d3; color: #000; }
  .tag-dj { background: #ff00ff; color: #fff; box-shadow: 0 0 8px #ff00ff; }
  .tag-pro { background: linear-gradient(135deg, #ff4500, #ff6b35); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
  .tag-noob { background: #8b4513; color: #fff; border: 1px dashed #deb887; }
  .tag-mythic {
    background: linear-gradient(135deg, #4c1d95, #7c3aed, #f97316);
    color: #fff;
    box-shadow: 0 0 12px rgba(124,58,237,0.7);
    border: 1px solid rgba(249,115,22,0.7);
  }
  .tag-top-global { background: linear-gradient(90deg, #00c6ff, #0072ff); color: #fff; font-weight: bold; box-shadow: 0 0 5px #00c6ff; }
  .tag-premium { background: linear-gradient(45deg, #8a2387, #e94057, #f27121); color: #fff; font-weight: bold; }
  .tag-influencer { background: linear-gradient(45deg, #405de6, #833ab4, #c13584, #e1306c, #fd1d1d); color: #fff; }
  .tag-gamers {
    background:
      radial-gradient(circle at 0 0, #22c55e, transparent 60%),
      radial-gradient(circle at 100% 100%, #0ea5e9, transparent 60%),
      #020617;
    color: #bbf7d0;
    border: 1px solid rgba(34,197,94,0.8);
    box-shadow: 0 0 10px rgba(34,197,94,0.6);
  }
  .tag-frost {
    background: linear-gradient(135deg, #0f172a, #1e3a8a, #38bdf8);
    color: #e0f7fa;
    border: 1px solid rgba(148,163,184,0.6);
    border-radius: 999px;
  }
  .tag-blaze {
    background: linear-gradient(135deg, #7f1d1d, #b91c1c, #f97316);
    color: #fff7ed;
    border-radius: 999px;
    border: 1px solid rgba(248,113,113,0.8);
  }
  .tag-cosmic {
    background: radial-gradient(circle at 0 0, rgba(147,51,234,0.5), transparent 55%), linear-gradient(135deg, #020617, #111827, #1e293b);
    color: #e5e7eb;
    border-radius: 999px;
    border: 1px solid rgba(129,140,248,0.6);
  }
  .tag-elite {
    position: relative;
    background: linear-gradient(135deg, #111827, #000000);
    color: #fef3c7;
    border-radius: 999px;
    border: 1px solid rgba(253,224,71,0.85);
    padding: 2px 10px 2px 16px;
  }
  .tag-elite::before {
    content: '👑';
    position: absolute;
    left: 4px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
  }
  .tag-content-creator {
    position: relative;
    background: 
      radial-gradient(circle at 0 0, rgba(236,72,153,0.4), transparent 60%),
      radial-gradient(circle at 100% 100%, rgba(168,85,247,0.4), transparent 60%),
      linear-gradient(135deg, #ec4899, #a855f7, #ec4899);
    color: #fff;
    border-radius: 999px;
    border: 1px solid rgba(236,72,153,0.8);
    box-shadow: 0 0 15px rgba(236,72,153,0.6), 0 0 25px rgba(168,85,247,0.3);
    padding: 2px 10px 2px 18px;
    font-weight: 900;
    animation: contentCreatorPulse 2s ease-in-out infinite;
  }
  .tag-content-creator::before {
    content: '🎬';
    position: absolute;
    left: 3px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    animation: creatorIconSpin 3s linear infinite;
  }
  @keyframes contentCreatorPulse {
    0%, 100% { 
      box-shadow: 0 0 12px rgba(236,72,153,0.5), 0 0 20px rgba(168,85,247,0.2);
    }
    50% { 
      box-shadow: 0 0 20px rgba(236,72,153,0.8), 0 0 35px rgba(168,85,247,0.5);
    }
  }
  @keyframes creatorIconSpin {
    0%, 100% { transform: translateY(-50%) rotate(0deg); }
    25% { transform: translateY(-50%) rotate(-10deg); }
    75% { transform: translateY(-50%) rotate(10deg); }
  }
  .tag-neon {
    background: linear-gradient(135deg, #020617, #111827);
    color: #f9fafb;
    border-radius: 999px;
    border: 1px solid rgba(236,72,153,0.8);
    box-shadow: 0 0 10px rgba(236,72,153,0.6);
  }
  /* NEW TAGS */
  .tag-legend { background: linear-gradient(135deg, #ff6b00, #ffd700, #ff6b00); color: #000; font-weight: 900; box-shadow: 0 0 10px rgba(255,107,0,0.5); animation: legendFlicker 2s ease-in-out infinite; }
  @keyframes legendFlicker { 0%,100% { box-shadow: 0 0 10px rgba(255,107,0,0.5); } 50% { box-shadow: 0 0 20px rgba(255,215,0,0.8), 0 0 35px rgba(255,107,0,0.4); } }
  .tag-mythic { background: linear-gradient(135deg, #9c27b0, #673ab7, #3f51b5); color: #fff; font-weight: 900; box-shadow: 0 0 12px rgba(156,39,176,0.6); border: 1px solid rgba(255,255,255,0.2); }
  .tag-godlike { background: linear-gradient(135deg, #ffd700, #ff8c00, #ffd700); color: #000; font-weight: 900; border: 1px solid #fff; box-shadow: 0 0 15px rgba(255,215,0,0.7), 0 0 30px rgba(255,140,0,0.4); animation: godPulse 1.5s ease-in-out infinite; }
  @keyframes godPulse { 0%,100% { box-shadow: 0 0 15px rgba(255,215,0,0.7); } 50% { box-shadow: 0 0 25px rgba(255,215,0,1), 0 0 45px rgba(255,140,0,0.6); } }
  .tag-savage { background: #000; color: #ff0050; border: 2px solid #ff0050; font-weight: 900; text-shadow: 0 0 8px #ff0050; letter-spacing: 2px; animation: savageFlash 0.8s ease-in-out infinite; }
  @keyframes savageFlash { 0%,100% { border-color: #ff0050; text-shadow: 0 0 8px #ff0050; } 50% { border-color: #ff6b6b; text-shadow: 0 0 16px #ff0050, 0 0 30px #ff0050; } }
  .tag-maniac { background: linear-gradient(135deg, #e91e63, #9c27b0); color: #fff; font-weight: 900; box-shadow: 0 0 10px rgba(233,30,99,0.5); }
  .tag-ultra { background: linear-gradient(135deg, #00bcd4, #009688, #4caf50); color: #fff; font-weight: 900; box-shadow: 0 0 10px rgba(0,188,212,0.5); border: 1px solid rgba(255,255,255,0.3); }
  .tag-terkeren {
    background: linear-gradient(135deg, #00f5ff, #7c3aed);
    color: #fff;
    box-shadow: 0 0 12px rgba(124,58,237,0.7);
    border: 1px solid rgba(59,130,246,0.7);
  }
  .tag-tersulit {
    background: linear-gradient(135deg, #ff0050, #ff8c00);
    color: #fff;
    box-shadow: 0 0 12px rgba(255,92,92,0.7);
    border: 1px solid rgba(248,113,113,0.8);
  }

    .v-badge { color: #1da1f2; font-size: 12px; margin-left: 3px; }

    /* ============================================================
       VIP TRIAL SYSTEM
    ============================================================ */
    .vip-trial-banner {
      background: linear-gradient(135deg, rgba(255,215,0,0.16), rgba(255,152,0,0.1));
      border: 1px solid rgba(255,215,0,0.4);
      border-radius: 10px;
      padding: 10px 14px;
      margin-bottom: 8px;
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }
    .vip-trial-banner.show { display: flex; }
    .vip-trial-banner i { color: var(--gold); font-size: 18px; flex-shrink: 0; }
    .vip-trial-info { flex: 1; }
    .vip-trial-info .vt-label { font-size: 10px; color: var(--gold); font-weight: 800; letter-spacing: 1px; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; }
    .vip-trial-info .vt-timer { font-size: 13px; font-weight: 700; color: #fff; font-family: 'JetBrains Mono', monospace; }
    .vip-trial-close {
      margin-left: 8px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      cursor: pointer;
    }

    /* ============================================================
       LEBARAN COUNTDOWN
    ============================================================ */
    .event-countdown {
      background: linear-gradient(135deg, rgba(0,212,255,0.18), rgba(0,150,136,0.12));
      border: 1px solid rgba(0,212,255,0.4);
      border-radius: 10px;
      padding: 9px 14px;
      margin-bottom: 12px;
      display: none;
      align-items: center;
      gap: 8px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.45);
    }
    .event-countdown.show { display: flex; }
    .event-countdown .ec-main { display: flex; flex-direction: column; gap: 2px; }
    .event-countdown .ec-label {
      font-size: 10px; font-weight: 800; letter-spacing: 1px;
      text-transform: uppercase; color: #00d4ff; font-family: 'Rajdhani', sans-serif;
    }
    .event-countdown .ec-time {
      font-size: 13px; font-weight: 700; color: #fff; font-family: 'JetBrains Mono', monospace;
    }
    .event-countdown .ec-badge {
      margin-left: auto; padding: 4px 10px;
      border-radius: 999px;
      font-size: 10px; font-weight: 700; letter-spacing: 1px;
      text-transform: uppercase;
      background: rgba(0,0,0,0.5);
      color: #ffd700;
      border: 1px solid rgba(255,215,0,0.4);
    }
    .event-countdown .ec-close {
      margin-left: 6px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      cursor: pointer;
    }
    .global-countdown {
      background: linear-gradient(135deg, rgba(56,189,248,0.22), rgba(34,197,94,0.16));
      border: 1px solid rgba(56,189,248,0.55);
      border-radius: 10px;
      padding: 9px 14px;
      margin-bottom: 10px;
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: 0 10px 28px rgba(0,0,0,0.52);
      font-size: 11px;
      color: #e5e7eb;
    }
    .global-countdown.show { display: flex; }
    .global-countdown-icon {
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #22c55e, #0ea5e9);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b1120;
      flex-shrink: 0;
    }
    .global-countdown-main {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }
    .global-countdown-label {
      font-size: 11px;
      font-weight: 700;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .global-countdown-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      font-weight: 700;
      color: #bbf7d0;
      display: flex;
      gap: 4px;
      align-items: center;
    }
    .countdown-segment {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      min-width: 32px;
    }
    .countdown-number {
      font-size: 16px;
      font-weight: 800;
      color: #22c55e;
      text-shadow: 0 0 10px rgba(34,197,94,0.6);
      animation: countdownPulse 1s ease-in-out infinite;
    }
    .countdown-label {
      font-size: 7px;
      color: #6b7280;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    @keyframes countdownPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .player-badges {
      margin-top: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    .player-badges .vip-trial-banner,
    .player-badges .event-countdown,
    .player-badges .global-countdown {
      padding: 4px 8px;
      margin-bottom: 0;
      box-shadow: none;
      border-radius: 8px;
    }
    .player-badges .vip-trial-info .vt-label {
      font-size: 9px;
    }
    .player-badges .vip-trial-info .vt-timer {
      font-size: 10px;
    }
    .player-badges .event-countdown .ec-label {
      font-size: 9px;
    }
    .player-badges .event-countdown .ec-time {
      font-size: 10px;
    }
    .player-badges .global-countdown {
      font-size: 9px;
      gap: 6px;
    }
    .player-badges .global-countdown-icon {
      width: 18px;
      height: 18px;
      font-size: 10px;
    }
    .player-badges .global-countdown-label {
      font-size: 9px;
    }
    .player-badges .global-countdown-time {
      font-size: 10px;
    }
    .global-countdown-close {
      margin-left: 6px;
      background: transparent;
      border: none;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      cursor: pointer;
    }
    .event-banner {
      position: fixed;
      top: 70px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 2600;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.12);
      padding: 10px 14px;
      display: none;
      align-items: center;
      gap: 10px;
      box-shadow: 0 14px 35px rgba(0,0,0,0.55);
      font-size: 11px;
      color: #e5e7eb;
      pointer-events: auto;
    }
    .event-banner.show {
      display: flex;
      animation: notifPanelIn 0.25s ease;
    }
    .event-banner-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #38bdf8, #1e40af);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 16px;
      flex-shrink: 0;
    }
    .event-banner-body {
      min-width: 0;
    }
    .event-banner-title {
      font-size: 12px;
      font-weight: 700;
      color: #e5e7eb;
      margin-bottom: 2px;
    }
    .event-banner-sub {
      font-size: 10px;
      color: #9ca3af;
    }
    .event-banner-timer {
      font-size: 11px;
      font-weight: 700;
      color: #facc15;
      margin-left: 8px;
    }
    .event-banner-close {
      border: none;
      background: none;
      color: #6b7280;
      cursor: pointer;
      font-size: 14px;
      padding: 4px;
    }
    @media (max-width: 480px) {
      .event-banner {
        top: 62px;
        width: 94vw;
        max-width: 94vw;
        padding: 9px 10px;
        gap: 8px;
      }
      .event-banner-title {
        font-size: 11px;
        white-space: normal;
      }
      .event-banner-sub {
        font-size: 9px;
      }
      .event-banner-timer {
        font-size: 10px;
      }
    }
    .event-countdown.celebrate {
      background: linear-gradient(135deg, rgba(255,215,0,0.25), rgba(255,152,0,0.24));
      border-color: rgba(255,215,0,0.8);
    }

    /* ============================================================
       ADMIN PANEL (built-in)
    ============================================================ */
    .admin-panel-overlay {
      position: fixed;
      inset: 0;
      z-index: 5000;
      display: none;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 70px 16px 16px;
      pointer-events: none;
      background: rgba(0,0,0,0.6);
    }
    .admin-panel-overlay.show { display: flex; pointer-events: auto; }

    .admin-panel {
      width: 380px;
      max-width: 420px;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      background: linear-gradient(180deg, #0a0a14, #0a0a14);
      border-radius: 14px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.5);
      border: 1px solid rgba(255,193,7,0.2);
    }

    .admin-header {
      background: linear-gradient(135deg, rgba(255,193,7,0.12), rgba(255,152,0,0.06));
      border-bottom: 1px solid rgba(255,193,7,0.2);
      padding: 15px 20px;
      display: flex; align-items: center; justify-content: space-between;
      flex-shrink: 0;
    }
    .admin-header-title {
      font-family: 'Rajdhani', sans-serif; font-size: 20px; font-weight: 800;
      letter-spacing: 3px; color: var(--ml-gold);
      text-shadow: 0 0 15px rgba(255,193,7,0.5);
      display: flex; align-items: center; gap: 10px;
    }
    .admin-header-close {
      background: rgba(255,51,51,0.15); border: 1px solid rgba(255,51,51,0.3);
      color: #ff6b6b; width: 36px; height: 36px; border-radius: 50%;
      cursor: pointer; font-size: 16px; display: flex; align-items: center; justify-content: center;
      transition: 0.2s;
    }
    .admin-header-close:hover { background: var(--danger); color: #fff; }
    .admin-header-tools {
      display: flex; align-items: center; gap: 6px;
    }
    .admin-header-btn {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.16);
      color: #ccc;
      width: 30px; height: 30px;
      border-radius: 50%;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      font-size: 13px;
      transition: 0.16s;
    }
    .admin-header-btn:hover { background: rgba(255,255,255,0.14); color: #fff; }
    #btnRamadanTheme { transition: 0.3s; }
    #btnRamadanTheme:hover { background: rgba(255,215,0,0.2) !important; color: #ffd700 !important; }
    .admin-panel.admin-full {
      width: 100%;
      max-width: none;
      max-height: 100vh;
    }
    .admin-panel.admin-mini {
      width: 230px;
      max-width: 260px;
    }
    .admin-overlay-mini {
      align-items: flex-end;
      justify-content: flex-end;
      padding: 0 16px 16px;
    }
    .admin-panel.admin-mini .admin-nav,
    .admin-panel.admin-mini .admin-content {
      display: none;
    }

    .admin-nav {
      display: flex; padding: 12px 15px 0;
      gap: 6px; flex-shrink: 0;
      overflow-x: auto;
      overflow-y: hidden;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,193,7,0.3) transparent;
    }
    .admin-nav::-webkit-scrollbar { height: 3px; }
    .admin-nav::-webkit-scrollbar-track { background: transparent; }
    .admin-nav::-webkit-scrollbar-thumb { background: rgba(255,193,7,0.3); border-radius: 10px; }
    .admin-nav-btn {
      flex: 0 0 auto; padding: 8px 14px;
      background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
      color: #888; border-radius: 10px 10px 0 0; border-bottom: none;
      font-family: 'Rajdhani', sans-serif; font-size: 12px; font-weight: 700;
      letter-spacing: 1px; cursor: pointer; transition: 0.2s; white-space: nowrap;
    }
    .admin-nav-btn:hover { color: var(--ml-gold); border-color: rgba(255,193,7,0.3); }
    .admin-nav-btn.active { background: rgba(255,193,7,0.1); border-color: rgba(255,193,7,0.3); color: var(--ml-gold); }

    .admin-content {
      flex: 1; overflow-y: auto; padding: 18px;
    }
    .admin-content::-webkit-scrollbar { width: 4px; }
    .admin-content::-webkit-scrollbar-thumb { background: rgba(255,193,7,0.3); border-radius: 10px; }

    .admin-view { display: none; }
    .admin-view.active { display: block; }

    .admin-card {
      background:
        radial-gradient(circle at 0 0, rgba(56,189,248,0.12), transparent 60%),
        radial-gradient(circle at 100% 100%, rgba(234,179,8,0.12), transparent 60%),
        rgba(15,23,42,0.96);
      border: 1px solid rgba(148,163,184,0.55);
      border-radius: 14px;
      padding: 16px;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden;
    }
    .admin-card h3 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #e5e7eb;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .admin-card h3 i {
      color: var(--ml-gold);
      text-shadow: 0 0 8px rgba(252,211,77,0.7);
    }
    .tag-selector-sheet {
      max-width: 640px;
    }
    .tag-selector-layout {
      display: flex;
      gap: 12px;
      margin-top: 6px;
    }
    .tag-selector-col {
      flex: 1;
      min-width: 0;
    }
    .tag-section-title {
      font-size: 11px;
      color: #aaa;
      margin-bottom: 6px;
    }
    .tag-current-text {
      font-size: 12px;
      color: #ddd;
      margin-bottom: 8px;
    }
    .tag-chip-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag-chip {
      border: none;
      background: rgba(255,255,255,0.05);
      border-radius: 999px;
      padding: 4px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #eee;
      transition: 0.16s;
    }
    .tag-chip:hover {
      background: rgba(255,255,255,0.12);
      transform: translateY(-1px);
    }
    .tag-chip-none {
      background: rgba(255,80,80,0.1);
    }
    .tag-meta-list {
      max-height: 220px;
      overflow-y: auto;
      padding-right: 4px;
    }
    .tag-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(255,255,255,0.05);
    }
    .tag-meta-desc {
      font-size: 10px;
      color: #999;
      text-align: right;
    }
    @media (max-width: 768px) {
      .tag-selector-layout {
        flex-direction: column;
      }
    }
    .admin-two-col {
      display: flex;
      gap: 10px;
    }
    .admin-two-col > div {
      flex: 1;
      min-width: 0;
    }
    .admin-label {
      font-size: 10px;
      color: #888;
      margin-bottom: 4px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .admin-users-layout {
      display: flex;
      gap: 12px;
    }
    .admin-users-left {
      flex: 1.2;
      min-width: 0;
    }
    .admin-users-right {
      flex: 1;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .admin-tag-active-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
    }
    .admin-tag-user-name {
      font-size: 13px;
      font-weight: 700;
      color: #fff;
    }
    .admin-tag-current {
      font-size: 11px;
      color: #aaa;
    }
    .admin-tag-chip-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .admin-tag-chip {
      border: none;
      background: rgba(255,255,255,0.04);
      border-radius: 999px;
      padding: 4px 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 10px;
      color: #eee;
      transition: 0.16s;
    }
    .admin-tag-chip:hover {
      background: rgba(255,255,255,0.12);
      transform: translateY(-1px);
    }
    .admin-tag-meta-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px dashed rgba(255,255,255,0.05);
    }
    .admin-tag-meta-desc {
      font-size: 10px;
      color: #999;
      text-align: right;
    }
    @media (max-width: 768px) {
      .admin-users-layout {
        flex-direction: column;
      }
      .admin-panel {
        background: #05050c;
        box-shadow: 0 14px 40px rgba(0,0,0,0.75);
      }
    }
    .admin-card::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px;
      background: linear-gradient(90deg, transparent, var(--ml-gold), transparent);
      opacity: 0.3;
    }
    .admin-card h3 {
      font-family: 'Rajdhani', sans-serif; font-size: 14px; font-weight: 800;
      color: var(--ml-gold); letter-spacing: 1.5px; margin-bottom: 12px;
      display: flex; align-items: center; gap: 7px;
    }
    .admin-stat-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 10px; margin-bottom: 15px;
    }
    .admin-stat-box {
      background: rgba(0,0,0,0.3); border-radius: 10px; padding: 12px;
      border: 1px solid rgba(255,255,255,0.05); text-align: center;
    }
    .admin-stat-box .sv { font-size: 28px; font-weight: 800; font-family: 'Rajdhani', sans-serif; color: #fff; }
    .admin-stat-box .sl { font-size: 10px; color: #555; letter-spacing: 1px; margin-top: 3px; }

    .admin-inp {
      width: 100%; padding: 11px 13px; background: rgba(0,0,0,0.4);
      color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
      font-size: 12px; margin-bottom: 8px; font-family: 'JetBrains Mono', monospace;
      transition: border-color 0.2s;
    }
    .admin-inp:focus { border-color: var(--ml-gold); box-shadow: 0 0 0 2px rgba(255,193,7,0.1); }
    .admin-sel {
      width: 100%; padding: 11px 13px; background: rgba(0,0,0,0.6);
      color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px;
      font-size: 12px; margin-bottom: 8px; font-family: 'JetBrains Mono', monospace;
    }
    .admin-btn {
      padding: 10px 16px; border: none; border-radius: 10px;
      font-family: 'Rajdhani', sans-serif; font-size: 13px; font-weight: 700;
      letter-spacing: 1px; cursor: pointer; transition: 0.2s;
    }
    .admin-btn-gold { background: linear-gradient(135deg, var(--ml-gold), #ff8c00); color: #000; box-shadow: 0 4px 15px rgba(255,193,7,0.3); }
    .admin-btn-gold:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(255,193,7,0.4); }
    .admin-btn-red { background: linear-gradient(135deg, #ff5252, #d32f2f); color: #fff; }
    .admin-btn-blue { background: linear-gradient(135deg, #42a5f5, #1565c0); color: #fff; }
    .admin-btn-green { background: linear-gradient(135deg, var(--accent), #00a86b); color: #000; }
    .admin-btn-full { width: 100%; padding: 12px; }

    .user-row-admin {
      background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px; padding: 12px; margin-bottom: 8px;
      display: flex; flex-direction: column; gap: 8px;
    }
    .user-row-admin .ur-top { display: flex; align-items: center; gap: 10px; }
    .user-row-admin .ur-name { font-weight: 800; font-family: 'Rajdhani', sans-serif; font-size: 14px; }
    .user-row-admin .ur-uid { font-size: 10px; color: #444; font-family: 'JetBrains Mono', monospace; }
    .user-row-admin .ur-actions { display: flex; gap: 6px; flex-wrap: wrap; }
    .admin-search { width: 100%; padding: 11px 13px; background: rgba(0,0,0,0.4); color: #fff; border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; font-size: 12px; margin-bottom: 12px; }

    /* ============================================================
       ADMIN LOCK / CAPTCHA GATE
    ============================================================ */
    .admin-lock-gate {
      position: fixed; inset: 0;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      padding: 30px 20px;
      background:
        radial-gradient(ellipse at 30% 0%, rgba(0,212,255,0.12), transparent 50%),
        radial-gradient(ellipse at 70% 100%, rgba(255,193,7,0.1), transparent 50%),
        linear-gradient(180deg, #030308, #05050f);
      z-index: 5010;
      transition: opacity 0.4s ease, transform 0.4s ease;
      overflow-y: auto;
    }
    .admin-lock-gate.unlocked {
      opacity: 0; transform: scale(1.04) translateY(-15px);
      pointer-events: none;
    }

    .alg-badge {
      width: 80px; height: 80px; border-radius: 50%;
      background: radial-gradient(circle, rgba(255,193,7,0.15), rgba(0,0,0,0));
      border: 2px solid rgba(255,193,7,0.3);
      display: flex; align-items: center; justify-content: center;
      font-size: 32px; margin-bottom: 20px;
      position: relative;
      animation: alg-pulse 2.5s ease-in-out infinite;
    }
    @keyframes alg-pulse {
      0%,100% { box-shadow: 0 0 15px rgba(255,193,7,0.2), inset 0 0 15px rgba(255,193,7,0.05); }
      50% { box-shadow: 0 0 35px rgba(255,193,7,0.5), inset 0 0 25px rgba(255,193,7,0.1); }
    }
    .alg-badge::before {
      content: '';
      position: absolute; inset: -8px; border-radius: 50%;
      border: 1px solid rgba(255,193,7,0.15);
      animation: alg-spin 6s linear infinite;
    }
    .alg-badge::after {
      content: '';
      position: absolute; top: -9px; left: 50%; transform: translateX(-50%);
      width: 7px; height: 7px; border-radius: 50%;
      background: var(--ml-gold);
      box-shadow: 0 0 10px var(--ml-gold), 0 0 20px rgba(255,193,7,0.5);
      animation: alg-spin 6s linear infinite;
      transform-origin: 0 50px;
    }
    @keyframes alg-spin { to { transform: rotate(360deg); } }

    .alg-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 22px; font-weight: 800;
      letter-spacing: 4px; color: var(--ml-gold);
      text-shadow: 0 0 20px rgba(255,193,7,0.4);
      margin-bottom: 4px; text-transform: uppercase;
    }
    .alg-sub {
      font-size: 10px; color: rgba(255,255,255,0.25);
      letter-spacing: 3px; font-family: 'JetBrains Mono', monospace;
      text-transform: uppercase; margin-bottom: 28px;
    }

    /* captcha canvas area */
    .alg-cap-box {
      background: radial-gradient(circle, #05101a, #000);
      border: 1px solid rgba(0,212,255,0.35);
      border-radius: 12px; padding: 8px;
      margin-bottom: 14px;
      box-shadow: 0 0 20px rgba(0,212,255,0.2), inset 0 0 20px rgba(0,0,0,0.5);
      width: 100%; max-width: 300px;
    }
    #algCapCanvas {
      display: block; width: 100%; height: 80px;
      border-radius: 8px;
      filter: drop-shadow(0 0 6px rgba(0,212,255,0.4));
    }
    .alg-code-display {
      color: #00ff88; font-family: 'JetBrains Mono', monospace;
      letter-spacing: 6px; font-size: 20px; font-weight: bold;
      text-shadow: 0 0 12px rgba(0,255,136,0.6);
      text-align: center; padding: 6px 14px;
      border: 1px solid rgba(0,255,136,0.3);
      border-radius: 999px; background: rgba(0,0,0,0.5);
      margin-bottom: 8px;
    }
    .alg-refresh {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      color: #888; font-size: 11px; padding: 6px 14px; border-radius: 8px;
      cursor: pointer; transition: 0.2s; font-family: 'Rajdhani', sans-serif;
      font-weight: 600; letter-spacing: 1px; display: flex; align-items: center; gap: 6px;
      margin: 0 auto 18px;
    }
    .alg-refresh:hover { color: var(--ml-gold); border-color: rgba(255,193,7,0.4); }

    .alg-inp {
      width: 100%; max-width: 300px;
      padding: 13px; margin-bottom: 12px;
      background: rgba(0,0,0,0.5); color: white;
      border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
      font-size: 18px; font-weight: 800; letter-spacing: 5px;
      text-align: center; font-family: 'JetBrains Mono', monospace;
      text-transform: uppercase; transition: 0.2s;
    }
    .alg-inp:focus { border-color: var(--ml-gold); box-shadow: 0 0 0 3px rgba(255,193,7,0.12); }

    .alg-enter-btn {
      width: 100%; max-width: 300px;
      padding: 14px; font-size: 15px; font-weight: 800;
      background: linear-gradient(135deg, var(--ml-gold), #ff8c00);
      border: none; border-radius: 12px; color: #000;
      cursor: pointer; font-family: 'Rajdhani', sans-serif;
      letter-spacing: 2px; text-transform: uppercase;
      box-shadow: 0 5px 20px rgba(255,193,7,0.3);
      transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .alg-enter-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 28px rgba(255,193,7,0.45); }
    .alg-enter-btn:active { transform: scale(0.98); }
    @keyframes algShake {
      0%,100% { transform: translateX(0); }
      20% { transform: translateX(-8px); }
      40% { transform: translateX(8px); }
      60% { transform: translateX(-6px); }
      80% { transform: translateX(6px); }
    }

    .alg-error {
      font-size: 12px; color: #ff6b6b; text-align: center;
      font-family: 'JetBrains Mono', monospace; margin-bottom: 10px;
      min-height: 18px; letter-spacing: 0.5px;
    }

    /* corner ML decorations on lock gate */
    .alg-corner { position: absolute; width: 22px; height: 22px; }
    .alg-corner::before, .alg-corner::after { content: ''; position: absolute; background: rgba(255,193,7,0.4); }
    .alg-tl { top: 15px; left: 15px; }
    .alg-tl::before { top:0; left:0; width:100%; height:2px; }
    .alg-tl::after  { top:0; left:0; width:2px; height:100%; }
    .alg-tr { top: 15px; right: 15px; }
    .alg-tr::before { top:0; right:0; width:100%; height:2px; }
    .alg-tr::after  { top:0; right:0; width:2px; height:100%; }
    .alg-bl { bottom: 15px; left: 15px; }
    .alg-bl::before { bottom:0; left:0; width:100%; height:2px; }
    .alg-bl::after  { bottom:0; left:0; width:2px; height:100%; }
    .alg-br { bottom: 15px; right: 15px; }
    .alg-br::before { bottom:0; right:0; width:100%; height:2px; }
    .alg-br::after  { bottom:0; right:0; width:2px; height:100%; }

    /* song rows in admin */
    .admin-song-row {
      display: flex; align-items: center; gap: 10px;
      background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.05);
      border-radius: 10px; padding: 10px 12px; margin-bottom: 6px;
    }
    .admin-song-row .as-info { flex: 1; min-width: 0; }
    .admin-song-row .as-title { font-size: 13px; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .admin-song-row .as-by { font-size: 10px; color: #555; }

    /* log terminal */
    .log-terminal {
      background: #000; border: 1px solid rgba(0,255,136,0.15); border-radius: 10px;
      padding: 14px; height: 300px; overflow-y: auto; font-family: 'JetBrains Mono', monospace;
      font-size: 11px; color: var(--accent);
    }
    .log-terminal::-webkit-scrollbar { width: 4px; }
    .log-terminal::-webkit-scrollbar-thumb { background: rgba(0,255,136,0.3); }
    .log-line { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 3px; }
    .log-time { color: #444; }

    /* ============================================================
       TOAST
    ============================================================ */
    #toast-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 99999;
      pointer-events: none;
    }
    .toast {
      background: rgba(10,10,18,0.95);
      border: 1px solid rgba(255,255,255,0.08);
      border-left: 3px solid var(--accent);
      color: #fff;
      padding: 9px 18px;
      border-radius: 8px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 9px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.5);
      animation: toastIn 0.3s cubic-bezier(0.68,-0.55,0.27,1.55);
      backdrop-filter: blur(10px);
      white-space: nowrap;
      pointer-events: auto;
    }
    .toast.hide { animation: toastOut 0.3s forwards; }
    .toast.toast-success { border-left-color: #22c55e; }
    .toast.toast-error { border-left-color: #f97316; }
    .toast.toast-event { border-left-color: #38bdf8; }
    @keyframes toastIn {
      from { opacity: 0; transform: translateY(20px) scale(0.96); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }
    @keyframes toastOut {
      from { opacity: 1; transform: translateY(0) scale(1); }
      to { opacity: 0; transform: translateY(-12px) scale(0.96); }
    }

    .global-event-pill {
      position: fixed;
      top: 64px;
      right: 16px;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15,23,42,0.9);
      border: 1px solid rgba(148,163,184,0.6);
      box-shadow: 0 0 16px rgba(56,189,248,0.5);
      backdrop-filter: blur(14px);
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      color: #e5f4ff;
      opacity: 0;
      transform: translateY(-8px);
      transition: opacity 0.25s ease, transform 0.25s ease, box-shadow 0.25s ease, border-color 0.25s ease, color 0.25s ease;
      z-index: 9999;
      pointer-events: none;
    }
    .global-event-pill.show {
      opacity: 1;
      transform: translateY(0);
    }
    .global-event-pill .pill-icon {
      font-size: 13px;
    }
    .global-event-pill .pill-time {
      font-family: 'JetBrains Mono', monospace;
      letter-spacing: 0.5px;
    }
    .global-event-pill.pulse {
      animation: pillPulse 5s ease-in-out infinite;
    }
    .global-event-pill.urgent {
      border-color: rgba(248,113,113,0.9);
      box-shadow: 0 0 20px rgba(248,113,113,0.9);
      color: #fee2e2;
    }
    @keyframes pillPulse {
      0%, 95% {
        box-shadow: 0 0 16px rgba(56,189,248,0.5);
      }
      97% {
        box-shadow: 0 0 22px rgba(56,189,248,0.8);
      }
      100% {
        box-shadow: 0 0 16px rgba(56,189,248,0.5);
      }
    }

    /* Modal messages */
    .modal-msg { text-align: center; font-size: 12px; margin-top: 10px; padding: 9px; border-radius: 8px; display: none; }
    .modal-msg.show { display: block; }
    .modal-msg.success { color: var(--accent); background: rgba(0,255,136,0.08); border: 1px solid rgba(0,255,136,0.2); }
    .modal-msg.error { color: #ff6b6b; background: rgba(255,107,107,0.08); border: 1px solid rgba(255,107,107,0.2); }

    .rules-warn { background: rgba(255,51,51,0.08); border-left: 3px solid var(--danger); padding: 10px; margin: 10px 0; border-radius: 4px; font-size: 12px; }
    .tutorial-link { color: #3498db; text-decoration: underline; cursor: pointer; font-weight: 600; }

    /* Tutorial */
    .tutorial-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(10px); z-index: 10001; display: none; align-items: center; justify-content: center; padding: 20px; }
    .tutorial-card { background: #141422; border-radius: 18px; padding: 22px; width: 100%; max-width: 500px; border: 1px solid rgba(255,255,255,0.08); position: relative; animation: slideIn 0.4s cubic-bezier(0.175,0.885,0.32,1.275); }
    @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }
    .tutorial-card .close-btn { position: absolute; top: 14px; right: 14px; background: rgba(255,255,255,0.08); border: none; color: #fff; width: 28px; height: 28px; border-radius: 50%; cursor: pointer; font-size: 15px; display: flex; align-items: center; justify-content: center; }
    .tutorial-card .close-btn:hover { background: var(--danger); }
    .tutorial-card h3 { color: var(--accent); margin-bottom: 14px; font-size: 18px; font-family: 'Rajdhani', sans-serif; }
    .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 10px; margin-bottom: 14px; }
    .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; }

    /* About */
    .about-box { font-size: 12px; line-height: 1.6; color: #ccc; }
    .about-box h3 { color: var(--accent); margin-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.08); padding-bottom: 5px; font-family: 'Rajdhani', sans-serif; font-size: 18px; }
    .about-box p { margin-bottom: 10px; }
    .about-box b { color: #fff; }
    .about-features { margin: 8px 0 12px 16px; padding: 0; }
    .about-features li { margin-bottom: 7px; }
    .about-dev-link { color: #00d4ff; font-weight: 700; text-decoration: none; text-shadow: 0 0 10px #00d4ff; }
    .about-dev-link:hover { color: #7df9ff; }

    /* ============================================================
       GAMING STYLE ENHANCEMENTS - v3.2.3
    ============================================================ */
    .event-quest-btn-gaming {
      background: linear-gradient(135deg, rgba(34,197,94,0.3), rgba(56,189,248,0.2)) !important;
      border: 1px solid rgba(34,197,94,0.6) !important;
      color: #bbf7d0 !important;
      box-shadow: 0 0 15px rgba(34,197,94,0.4) !important;
      transition: all 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
    }
    .event-quest-btn-gaming:hover {
      box-shadow: 0 0 25px rgba(34,197,94,0.7), 0 0 40px rgba(56,189,248,0.3) !important;
      transform: translateY(-2px) !important;
      border-color: rgba(34,197,94,0.9) !important;
    }
    .event-quest-btn-gaming:active {
      transform: scale(0.95) translateY(0) !important;
    }
    .gaming-card-enhanced {
      box-shadow: 0 8px 24px rgba(0,0,0,0.6) !important;
      transition: all 0.3s ease !important;
    }
    .gaming-card-enhanced:hover {
      transform: translateY(-3px) !important;
      box-shadow: 0 12px 32px rgba(0,0,0,0.8) !important;
      border-color: rgba(34,197,94,0.6) !important;
    }
    .event-quest-progress-fill {
      background: linear-gradient(90deg, #22c55e, #38bdf8, #22c55e) !important;
      background-size: 200% 100% !important;
      animation: progressShine 2s linear infinite !important;
    }
    @keyframes progressShine {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* ============================================================
       RAMADHAN EVENT TAGS - v3.2.3 RESPONSIVE
    ============================================================ */
    .tag-ramadhan-1447h {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: #000;
      font-weight: 900;
      border: 1px solid rgba(245,158,11,0.8);
      position: relative;
      padding: 2px 18px 2px 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    .tag-ramadhan-1447h::before,
    .tag-ramadhan-1447h::after {
      content: '🎋';
      position: absolute;
      font-size: 10px;
      top: 50%;
      transform: translateY(-50%);
    }
    .tag-ramadhan-1447h::before {
      left: -8px;
    }
    .tag-ramadhan-1447h::after {
      right: -8px;
    }
    @media (max-width: 480px) {
      .tag-ramadhan-1447h {
        font-size: 8px;
        padding: 2px 14px 2px 4px;
        max-width: 120px;
      }
      .tag-ramadhan-1447h::before,
      .tag-ramadhan-1447h::after {
        font-size: 8px;
      }
    }
    .tag-night-tarawih {
      background: linear-gradient(135deg, #064e3b, #059669);
      color: #d1fae5;
      border: 1px solid rgba(16,185,129,0.8);
      box-shadow: 0 0 12px rgba(16,185,129,0.6);
      animation: tarawihGlow 2s ease-in-out infinite;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    @keyframes tarawihGlow {
      0%, 100% {
        box-shadow: 0 0 12px rgba(16,185,129,0.6);
      }
      50% {
        box-shadow: 0 0 20px rgba(16,185,129,0.9), 0 0 30px rgba(16,185,129,0.4);
      }
    }
    @media (max-width: 480px) {
      .tag-night-tarawih {
        font-size: 8px;
        max-width: 120px;
      }
    }
    .tag-lailat-mode {
      background: linear-gradient(135deg, #fbbf24, #f59e0b, #fbbf24);
      background-size: 200% 100%;
      color: #000;
      font-weight: 900;
      border: 1px solid rgba(245,158,11,0.8);
      animation: lailatShine 3s linear infinite;
      box-shadow: 0 0 15px rgba(251,191,36,0.6);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    @keyframes lailatShine {
      0% {
        background-position: 200% 0;
      }
      100% {
        background-position: -200% 0;
      }
    }
    @media (max-width: 480px) {
      .tag-lailat-mode {
        font-size: 8px;
        max-width: 120px;
      }
    }

    /* ============================================================
       SECRET TAG: EXE-SAHUR - v3.2.3 RESPONSIVE
    ============================================================ */
    .tag-exe-sahur {
      background: linear-gradient(135deg, #1e3a8a, #0ea5e9, #fbbf24);
      color: #fff;
      border: 1px solid rgba(251,191,36,0.8);
      box-shadow: 0 0 15px rgba(251,191,36,0.6);
      animation: sahurGlow 2s ease-in-out infinite;
      position: relative;
      padding-left: 20px;
      font-weight: 900;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 150px;
    }
    .tag-exe-sahur::before {
      content: '🌙';
      position: absolute;
      left: 2px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 12px;
      animation: moonFloat 3s ease-in-out infinite;
    }
    @keyframes sahurGlow {
      0%, 100% {
        box-shadow: 0 0 15px rgba(251,191,36,0.6);
      }
      50% {
        box-shadow: 0 0 30px rgba(251,191,36,0.9), 0 0 50px rgba(14,165,233,0.4);
      }
    }
    @keyframes moonFloat {
      0%, 100% {
        transform: translateY(-50%) rotate(0deg);
      }
      50% {
        transform: translateY(-55%) rotate(10deg);
      }
    }
    @media (max-width: 480px) {
      .tag-exe-sahur {
        font-size: 8px;
        padding-left: 16px;
        max-width: 120px;
      }
      .tag-exe-sahur::before {
        font-size: 10px;
      }
    }

    /* ============================================================
       TAG UNLOCK FULLSCREEN ANIMATION - v3.2.3 (VIDEO STYLE)
    ============================================================ */
    .tag-unlock-fullscreen {
      position: fixed;
      inset: 0;
      z-index: 99999;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .tag-unlock-fullscreen.show {
      display: flex;
    }
    
    /* Dynamic Background */
    .tag-unlock-bg {
      position: absolute;
      inset: 0;
      background: 
        radial-gradient(ellipse at 20% 20%, rgba(34,197,94,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(0,212,255,0.15) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(168,85,247,0.1) 0%, transparent 70%),
        linear-gradient(180deg, #030308 0%, #0a0a18 50%, #030308 100%);
      animation: bgPulse 3s ease-in-out infinite;
    }
    @keyframes bgPulse {
      0%, 100% { opacity: 0.8; filter: brightness(1); }
      50% { opacity: 1; filter: brightness(1.2); }
    }
    
    /* Grid Lines */
    .tag-unlock-grid {
      position: absolute;
      inset: 0;
      background-image: 
        linear-gradient(rgba(34,197,94,0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(34,197,94,0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
    }
    @keyframes gridMove {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }
    
    /* Particle Effects */
    .tag-unlock-particles {
      position: absolute;
      inset: 0;
      overflow: hidden;
    }
    .tag-unlock-particle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      animation: particleFloat 3s ease-in-out infinite;
    }
    @keyframes particleFloat {
      0%, 100% { 
        transform: translateY(100vh) scale(0); 
        opacity: 0; 
      }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { 
        transform: translateY(-100px) scale(1); 
        opacity: 0; 
      }
    }
    
    /* Main Card */
    .tag-unlock-card {
      position: relative;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a1a2e 50%, #0a0a1a 100%);
      border: 2px solid rgba(34,197,94,0.6);
      border-radius: 32px;
      padding: 50px 40px;
      text-align: center;
      box-shadow: 
        0 0 80px rgba(34,197,94,0.4),
        0 0 120px rgba(0,212,255,0.2),
        inset 0 0 60px rgba(34,197,94,0.05);
      animation: cardEnter 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      max-width: 480px;
      width: 90%;
      z-index: 10;
      overflow: hidden;
    }
    .tag-unlock-card::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 32px;
      padding: 2px;
      background: linear-gradient(135deg, #22c55e, #0ea5e9, #a855f7, #22c55e);
      background-size: 300% 300%;
      animation: borderGlow 3s ease infinite;
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      z-index: -1;
    }
    @keyframes borderGlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    @keyframes cardEnter {
      0% {
        opacity: 0;
        transform: scale(0.5) translateY(50px);
      }
      60% {
        transform: scale(1.05) translateY(-10px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
      }
    }
    
    /* Glow Rings */
    .tag-unlock-ring {
      position: absolute;
      border-radius: 50%;
      border: 2px solid rgba(34,197,94,0.5);
      animation: ringExpand 2s ease-out forwards;
    }
    .tag-unlock-ring:nth-child(1) { width: 100px; height: 100px; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: 0s; }
    .tag-unlock-ring:nth-child(2) { width: 180px; height: 180px; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: 0.3s; }
    .tag-unlock-ring:nth-child(3) { width: 260px; height: 260px; top: 50%; left: 50%; transform: translate(-50%, -50%); animation-delay: 0.6s; }
    @keyframes ringExpand {
      0% { opacity: 1; transform: translate(-50%, -50%) scale(0.5); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
    }
    
    .tag-unlock-icon-big {
      font-size: 80px;
      color: #22c55e;
      margin-bottom: 20px;
      animation: iconBounce 1s ease-in-out infinite;
      position: relative;
      z-index: 2;
    }
    .tag-unlock-icon-big::after {
      content: '';
      position: absolute;
      inset: -20px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(34,197,94,0.3) 0%, transparent 70%);
      animation: iconGlow 2s ease-in-out infinite;
      z-index: -1;
    }
    @keyframes iconBounce {
      0%, 100% { transform: scale(1) translateY(0); }
      50% { transform: scale(1.1) translateY(-10px); }
    }
    @keyframes iconGlow {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.3); opacity: 1; }
    }
    .tag-unlock-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 32px;
      font-weight: 900;
      background: linear-gradient(135deg, #22c55e, #0ea5e9, #a855f7);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 8px;
      letter-spacing: 3px;
      text-transform: uppercase;
      animation: titleShine 3s ease infinite;
    }
    @keyframes titleShine {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .tag-unlock-subtitle {
      font-size: 14px;
      color: #9ca3af;
      margin-bottom: 25px;
    }
    
    /* Tag Display */
    .tag-unlock-tag-display {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      animation: tagSlideIn 0.6s ease 0.3s both;
    }
    @keyframes tagSlideIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .tag-unlock-tag-display .user-tag {
      font-size: 16px;
      padding: 8px 20px;
      animation: tagPop 0.5s ease 0.5s both, tagFloat 2s ease-in-out 1s infinite;
    }
    @keyframes tagPop {
      0% { transform: scale(0); }
      60% { transform: scale(1.2); }
      100% { transform: scale(1); }
    }
    @keyframes tagFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    /* CSS Code Display */
    .tag-unlock-css-section {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 25px;
      text-align: left;
      animation: cssSlideIn 0.6s ease 0.6s both;
    }
    @keyframes cssSlideIn {
      from { opacity: 0; transform: translateX(-20px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .tag-unlock-css-title {
      font-size: 10px;
      color: #22c55e;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .tag-unlock-css-title i {
      font-size: 12px;
    }
    .tag-unlock-css-code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      color: #a5f3fc;
      background: rgba(34,197,94,0.1);
      padding: 12px;
      border-radius: 8px;
      overflow-x: auto;
      white-space: pre-wrap;
      line-height: 1.6;
      border-left: 3px solid #22c55e;
    }
    .tag-unlock-css-code .css-prop {
      color: #f472b6;
    }
    .tag-unlock-css-code .css-value {
      color: #a5f3fc;
    }
    .tag-unlock-css-code .css-selector {
      color: #fbbf24;
    }
    
    .tag-unlock-close-btn {
      background: linear-gradient(135deg, #22c55e, #10b981);
      border: none;
      color: #000;
      padding: 14px 40px;
      border-radius: 16px;
      font-weight: 900;
      font-size: 16px;
      cursor: pointer;
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 2px;
      text-transform: uppercase;
      transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      box-shadow: 0 4px 20px rgba(34,197,94,0.4);
      animation: btnPulse 2s ease-in-out infinite;
    }
    @keyframes btnPulse {
      0%, 100% { box-shadow: 0 4px 20px rgba(34,197,94,0.4); }
      50% { box-shadow: 0 8px 30px rgba(34,197,94,0.6); }
    }
    .tag-unlock-close-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 12px 40px rgba(34,197,94,0.6);
    }
    .tag-unlock-close-btn:active {
      transform: translateY(0) scale(0.98);
    }
    
    /* Confetti */
    .tag-unlock-confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      animation: confettiFall 3s ease-out forwards;
    }
    @keyframes confettiFall {
      0% { transform: translateY(-100px) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    /* ============================================================
       PROFILE MUSIC PLAYER WITH COUNTDOWN RING - v3.2.3
    ============================================================ */
    .profile-music-player {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 50px;
      height: 50px;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 10;
    }
    .profile-music-player.active {
      display: flex;
    }
    .pmp-ring-container {
      position: relative;
      width: 50px;
      height: 50px;
    }
    .pmp-ring-bg {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      background: rgba(0,0,0,0.6);
      border: 2px solid rgba(255,255,255,0.1);
    }
    .pmp-ring-progress {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 3px solid transparent;
      border-top-color: #ff3333;
      border-right-color: #ff3333;
      transform: rotate(-90deg);
      transition: border-color 0.3s ease;
    }
    .pmp-ring-progress.warning {
      border-top-color: #ffcc00;
      border-right-color: #ffcc00;
      animation: pmpPulse 1s ease-in-out infinite;
    }
    .pmp-ring-progress.critical {
      border-top-color: #ff0050;
      border-right-color: #ff0050;
      animation: pmpFlash 0.5s ease-in-out infinite;
    }
    @keyframes pmpPulse {
      0%, 100% { transform: rotate(-90deg) scale(1); }
      50% { transform: rotate(-90deg) scale(1.05); }
    }
    @keyframes pmpFlash {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
    .pmp-icon {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .pmp-icon:hover {
      transform: scale(1.1);
    }
    .pmp-timer {
      position: absolute;
      bottom: -18px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 9px;
      font-family: 'JetBrains Mono', monospace;
      color: #ff3333;
      font-weight: 700;
      white-space: nowrap;
      text-shadow: 0 0 8px rgba(255,51,51,0.6);
    }
    @media (max-width: 480px) {
      .profile-music-player {
        width: 42px;
        height: 42px;
        top: 10px;
        right: 10px;
      }
      .pmp-ring-container {
        width: 42px;
        height: 42px;
      }
      .pmp-icon {
        font-size: 18px;
      }
    }

    /* ============================================================
       KETUPAT PARTICLES FOR RAMADHAN TAGS - v3.2.3
    ============================================================ */
    .ketupat-container {
      position: fixed;
      pointer-events: none;
      z-index: 99990;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      overflow: hidden;
      display: none;
    }
    .ketupat-container.active {
      display: block;
    }
    .ketupat-particle {
      position: absolute;
      bottom: -30px;
      font-size: 16px;
      animation: floatKetupat linear infinite;
      opacity: 0;
    }
    @keyframes floatKetupat {
      0% {
        transform: translateY(0) rotate(0deg) scale(0.5);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      80% {
        opacity: 0.8;
      }
      100% {
        transform: translateY(-100vh) rotate(360deg) scale(1.2);
        opacity: 0;
      }
    }

    /* ============================================================
       HEART CANVAS EFFECT FOR VALENTINE/LOVE TAGS - v3.2.3
    ============================================================ */
    .heart-canvas-container {
      position: fixed;
      pointer-events: none;
      z-index: 99990;
      width: 100vw;
      height: 100vh;
      top: 0;
      left: 0;
      overflow: hidden;
      display: none;
      background: rgba(0,0,0,0.15);
    }
    .heart-canvas-container.active {
      display: block;
    }
    #heartCanvas {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
    }
    .heart-particle {
      position: absolute;
      bottom: -30px;
      font-size: 18px;
      animation: floatHeart linear infinite;
      opacity: 0;
    }
    @keyframes floatHeart {
      0% {
        transform: translateY(0) rotate(0deg) scale(0.5);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      80% {
        opacity: 0.8;
      }
      100% {
        transform: translateY(-100vh) rotate(20deg) scale(1);
        opacity: 0;
      }
    }

    /* ============================================================
       RAMADHAN PROFILE THEME - v3.2.3
    ============================================================ */
    .modern-profile-header.ramadhan-profile {
      background:
        radial-gradient(circle at 0 0, rgba(251,191,36,0.18), transparent 55%),
        radial-gradient(circle at 100% 0, rgba(34,197,94,0.16), transparent 55%),
        linear-gradient(180deg, #111827, #020617);
    }
    .modern-profile-header.ramadhan-profile::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 0%, rgba(251,191,36,0.2), transparent 55%),
        radial-gradient(circle at 90% 0%, rgba(34,197,94,0.18), transparent 55%);
      opacity: 0.8;
    }

    /* ============================================================
       HEART/VALENTINE PROFILE THEME - v3.2.3
    ============================================================ */
    .modern-profile-header.heart-profile {
      background:
        radial-gradient(circle at 50% 0%, rgba(236,72,153,0.2), transparent 60%),
        radial-gradient(circle at 0% 100%, rgba(168,85,247,0.15), transparent 50%),
        radial-gradient(circle at 100% 100%, rgba(244,63,94,0.15), transparent 50%),
        linear-gradient(180deg, #1a0a15, #0f0510);
    }
    .modern-profile-header.heart-profile::before {
      content: '';
      position: absolute;
      inset: 0;
      pointer-events: none;
      background:
        radial-gradient(circle at 20% 20%, rgba(236,72,153,0.25), transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(168,85,247,0.2), transparent 50%);
      opacity: 0.9;
    }

    /* ============================================================
       FIRST TIME TUTORIAL - v3.2.3
    ============================================================ */
    .first-time-tutorial {
      position: fixed;
      inset: 0;
      z-index: 99998;
      background: rgba(0,0,0,0.95);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      backdrop-filter: blur(10px);
    }
    .first-time-tutorial.show {
      display: flex;
    }
    .ftt-card {
      background: linear-gradient(180deg, #111827, #020617);
      border: 1px solid rgba(34,197,94,0.3);
      border-radius: 20px;
      padding: 24px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.9);
      animation: fttSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    @keyframes fttSlideIn {
      from {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    .ftt-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .ftt-header h3 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: #22c55e;
      margin: 0;
    }
    .ftt-close {
      background: rgba(255,255,255,0.05);
      border: none;
      color: #9ca3af;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.2s;
    }
    .ftt-close:hover {
      background: rgba(255,255,255,0.1);
      color: #e5e7eb;
    }
    .ftt-body {
      display: flex;
      flex-direction: column;
      gap: 16px;
      margin-bottom: 20px;
    }
    .ftt-section {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.05);
    }
    .ftt-icon {
      font-size: 24px;
      flex-shrink: 0;
    }
    .ftt-content h4 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      font-weight: 700;
      color: #e5e7eb;
      margin: 0 0 4px 0;
    }
    .ftt-content p {
      font-size: 12px;
      color: #9ca3af;
      margin: 0;
      line-height: 1.5;
    }
    .ftt-btn {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #22c55e, #10b981);
      border: none;
      border-radius: 12px;
      color: #000;
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      font-weight: 700;
      letter-spacing: 1px;
      cursor: pointer;
      transition: 0.2s;
    }
    .ftt-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(34,197,94,0.4);
    }

    .mp-tag-showcase {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin: 15px 0;
      padding: 15px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.06);
    }
    .mp-tag-showcase-title {
      width: 100%;
      text-align: center;
      font-size: 10px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }
    .mp-tag-item {
      animation: tagFadeIn 0.3s ease;
    }
    @keyframes tagFadeIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }
      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* ============================================================
       ADMIN RAMADHAN CONTROL - v3.2.3
    ============================================================ */
    .admin-ramadhan-section {
      background: rgba(251,191,36,0.05);
      border: 1px solid rgba(251,191,36,0.2);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    .admin-ramadhan-cycle {
      background: rgba(0,0,0,0.3);
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      border-left: 3px solid #fbbf24;
    }
    .admin-ramadhan-cycle h4 {
      font-size: 13px;
      color: #fbbf24;
      margin-bottom: 8px;
      font-family: 'Rajdhani', sans-serif;
      letter-spacing: 1px;
    }
    .admin-ramadhan-req {
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
      padding-left: 12px;
    }
    .admin-ramadhan-req::before {
      content: '•';
      color: #22c55e;
      margin-right: 6px;
    }

    .about-dev-link:hover { color: #7df9ff; }

    /* ============================================================
       RESPONSIVE FIX - v3.2.3 UPDATED
    ============================================================ */
    @media (max-width: 480px) {
      .app { 
        width: 100vw !important;
        max-width: 100vw !important;
        height: 100vh !important;
        border-radius: 0 !important;
        padding: 16px !important;
      }
      .event-center-sheet {
        width: calc(100vw - 20px) !important;
        max-width: calc(100vw - 20px) !important;
        margin: 16px auto !important;
        padding: 14px !important;
      }
      .event-quest-card,
      .event-shop-card {
        grid-template-columns: 1fr !important;
        padding: 12px !important;
      }
      .capsule-menu-panel {
        width: calc(100vw - 32px) !important;
        right: 16px !important;
      }
      body {
        overflow-x: hidden !important;
      }
      * {
        max-width: 100vw !important;
      }
    }
    @media (min-width: 481px) and (max-width: 768px) {
      .app {
        max-width: 420px !important;
        width: 95% !important;
      }
    }
    @media (min-width: 769px) {
      .app {
        max-width: 400px !important;
        width: 95% !important;
      }
    }

    /* ============================================================
       STORY POPUP - EXECURIVE ORIGIN
    ============================================================ */
    #storyPopup {
      position: fixed;
      inset: 0;
      z-index: 999998;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(20px);
      display: flex;
      align-items: center;
      justify-content: center;
      animation: storyFadeIn 0.5s ease;
      padding: 20px;
    }
    #storyPopup.hidden {
      display: none;
    }
    @keyframes storyFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .story-container {
      position: relative;
      max-width: 600px;
      width: 100%;
      background: linear-gradient(135deg, #0f172a, #1e293b);
      border-radius: 24px;
      border: 2px solid rgba(0, 255, 136, 0.3);
      box-shadow: 0 0 60px rgba(0, 255, 136, 0.4), 0 20px 80px rgba(0, 0, 0, 0.8);
      overflow: hidden;
      animation: storySlideUp 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    @keyframes storySlideUp {
      from { 
        opacity: 0;
        transform: translateY(50px) scale(0.9);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    .story-header {
      background: linear-gradient(135deg, rgba(0, 255, 136, 0.15), rgba(0, 212, 255, 0.1));
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .story-title {
      font-family: 'Exo 2', sans-serif;
      font-size: 20px;
      font-weight: 900;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
      text-transform: uppercase;
    }
    .story-close {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 51, 51, 0.1);
      border: 2px solid rgba(255, 51, 51, 0.3);
      color: #ff6666;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
    }
    .story-close:hover {
      background: rgba(255, 51, 51, 0.2);
      border-color: #ff3333;
      color: #ff3333;
      transform: rotate(90deg) scale(1.1);
      box-shadow: 0 0 20px rgba(255, 51, 51, 0.5);
    }
    .story-body {
      padding: 24px;
    }
    .story-image-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: auto;
      margin-bottom: 20px;
      border: 2px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
      cursor: zoom-in;
      transition: all 0.3s ease;
      max-height: 70vh;
    }
    .story-image-wrapper:hover {
      border-color: rgba(0, 255, 136, 0.3);
      box-shadow: 0 8px 32px rgba(0, 255, 136, 0.3);
    }
    .story-image-wrapper.zoomed {
      cursor: grab;
      overflow: auto;
    }
    .story-image-wrapper.zoomed:active {
      cursor: grabbing;
    }
    .story-image {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 14px;
      transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    .story-image.zoomed {
      transform: scale(2);
      cursor: grab;
      transform-origin: top left;
    }
    .story-image.zoomed:active {
      cursor: grabbing;
    }
    .story-text {
      background: rgba(255, 255, 255, 0.03);
      border-left: 3px solid var(--accent);
      padding: 16px 20px;
      border-radius: 12px;
      line-height: 1.6;
      color: #e5e7eb;
      font-size: 14px;
    }
    .story-text strong {
      color: var(--accent);
      font-weight: 700;
    }
    .story-footer {
      margin-top: 20px;
      text-align: center;
      font-size: 11px;
      color: #6b7280;
      font-style: italic;
    }
    
    /* Thank You Animation */
    #thankYouOverlay {
      position: fixed;
      inset: 0;
      z-index: 999999;
      background: rgba(0, 0, 0, 0.98);
      display: none;
      align-items: center;
      justify-content: center;
      animation: thankYouFadeIn 0.5s ease;
    }
    #thankYouOverlay.show {
      display: flex;
    }
    @keyframes thankYouFadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .thank-you-text {
      font-family: 'Exo 2', sans-serif;
      font-size: 48px;
      font-weight: 900;
      text-align: center;
      background: linear-gradient(135deg, var(--accent), var(--accent2), var(--purple));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: thankYouScale 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
      text-transform: uppercase;
      letter-spacing: 3px;
      line-height: 1.4;
    }
    @keyframes thankYouScale {
      0% {
        opacity: 0;
        transform: scale(0.3) rotate(-5deg);
      }
      50% {
        opacity: 1;
        transform: scale(1.1) rotate(2deg);
      }
      70% {
        transform: scale(0.95) rotate(-1deg);
      }
      100% {
        opacity: 1;
        transform: scale(1) rotate(0deg);
      }
    }
    .thank-you-sparkles {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: var(--accent);
      border-radius: 50%;
      animation: sparkleFloat 2s ease-out forwards;
      box-shadow: 0 0 10px var(--accent);
    }
    @keyframes sparkleFloat {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(-200px) scale(0);
      }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .thank-you-text {
        font-size: 32px;
        letter-spacing: 2px;
        padding: 0 20px;
      }
    }
    @media (max-width: 480px) {
      .thank-you-text {
        font-size: 24px;
        letter-spacing: 1px;
      }
    }
    
    /* Mobile Responsive */
    @media (max-width: 768px) {
      .story-container {
        max-width: 95%;
        border-radius: 20px;
      }
      .story-header {
        padding: 16px 20px;
      }
      .story-title {
        font-size: 16px;
      }
      .story-close {
        width: 36px;
        height: 36px;
        font-size: 18px;
      }
      .story-body {
        padding: 20px;
      }
      .story-text {
        font-size: 13px;
        padding: 14px 16px;
      }
    }
  </style>
</head>
<body>

  <!-- STORY POPUP - EXECURIVE ORIGIN -->
  <div id="storyPopup" class="hidden">
    <div class="story-container">
      <div class="story-header">
        <div class="story-title">🎵 ExeMusic Origin</div>
        <button class="story-close" onclick="closeStoryPopup()">×</button>
      </div>
      <div class="story-body">
        <div class="story-image-wrapper" onclick="toggleImageZoom()">
          <img src="ssrplastexecurive.png" alt="Execurive RP" class="story-image" id="storyImage">
        </div>
      </div>
    </div>
  </div>

  <!-- THANK YOU OVERLAY -->
  <div id="thankYouOverlay">
    <div class="thank-you-sparkles" id="sparklesContainer"></div>
    <div class="thank-you-text">
      Terimakasih<br>Execurive
    </div>
  </div>

  <!-- LOADING SCREEN -->
  <div id="gameLoadScreen">
    <div class="load-corner tl"></div>
    <div class="load-corner tr"></div>
    <div class="load-corner bl"></div>
    <div class="load-corner br"></div>
    <div class="load-logo-wrap">
      <div class="load-logo-ring">
        <div class="load-logo-ring-outer"></div>
        <div class="load-logo-icon"><i class="fas fa-music"></i></div>
      </div>
    </div>
    <div class="load-title">ExeMusic</div>
    <div class="load-subtitle">v3.2.3 · Premium Audio</div>
    <div class="load-bar-wrap">
      <div class="load-bar-track">
        <div class="load-bar-fill" id="loadBarFill"></div>
        <div class="load-bar-glow"></div>
      </div>
    </div>
    <div class="load-info-row load-bar-wrap">
      <span class="load-status" id="loadStatus">INITIALIZING...</span>
      <span class="load-percent" id="loadPercent">0%</span>
    </div>
    <div class="load-dots">
      <div class="load-dot"></div>
      <div class="load-dot"></div>
      <div class="load-dot"></div>
    </div>
  </div>

  <!-- FIRST TIME TUTORIAL -->
  <div id="firstTimeTutorial" class="first-time-tutorial">
    <div class="ftt-card">
      <div class="ftt-header">
        <h3>🎉 Selamat Datang di ExeMusic!</h3>
        <button class="ftt-close" onclick="closeFirstTimeTutorial()">×</button>
      </div>
      <div class="ftt-body">
        <div class="ftt-section">
          <div class="ftt-icon">🔗</div>
          <div class="ftt-content">
            <h4>Copy URL Audio</h4>
            <p>Tombol <i class="fas fa-link"></i> untuk copy link MP3 langsung</p>
          </div>
        </div>
        <div class="ftt-section">
          <div class="ftt-icon">📤</div>
          <div class="ftt-content">
            <h4>Share Link</h4>
            <p>Tombol <i class="fas fa-share-alt"></i> untuk share lagu ke teman</p>
          </div>
        </div>
        <div class="ftt-section">
          <div class="ftt-icon">⬇️</div>
          <div class="ftt-content">
            <h4>Download</h4>
            <p>Tombol <i class="fas fa-download"></i> untuk download lagu</p>
          </div>
        </div>
        <div class="ftt-section">
          <div class="ftt-icon">➕</div>
          <div class="ftt-content">
            <h4>Upload Lagu</h4>
            <p>Tombol <i class="fas fa-plus-circle"></i> untuk upload lagu baru</p>
          </div>
        </div>
      </div>
      <button class="ftt-btn" onclick="closeFirstTimeTutorial()">MENGERTI!</button>
    </div>
  </div>

  <!-- FLOATING HEARTS (for velly) -->
  <div class="hearts-container" id="heartsContainer"></div>

  <!-- KETUPAT PARTICLES (for ramadhan tags) -->
  <div class="ketupat-container" id="ketupatContainer"></div>
  
  <!-- HEART CANVAS EFFECT (for love/valentine tags) -->
  <div class="heart-canvas-container" id="heartCanvasContainer">
    <canvas id="heartCanvas"></canvas>
  </div>

  <!-- BROADCAST -->
  <div id="sysBroadcast" class="sys-broadcast">
    <button class="sb-close" onclick="closeBroadcast()"><i class="fas fa-times"></i></button>
    <div class="sb-content">
      <i class="fas fa-bullhorn sb-icon"></i>
      <div class="sb-text">
        <h4>Announcement</h4>
        <p id="sbMessage">Loading...</p>
      </div>
    </div>
    <div class="sb-progress"><div id="sbBar" class="sb-bar"></div></div>
  </div>

  <div id="tagUnlockBanner" class="tag-unlock-banner">
    <div class="tag-unlock-icon"><i class="fas fa-tags"></i></div>
    <div class="tag-unlock-main">
      <div id="tagUnlockText" class="tag-unlock-text">Kamu membuka tag baru</div>
      <div id="tagUnlockTags" class="tag-unlock-tags"></div>
    </div>
    <button class="tag-unlock-close" onclick="closeTagUnlockBanner()"><i class="fas fa-times"></i></button>
  </div>

  <!-- EVENT BANNER -->
  <div id="eventBannerGlobal" class="event-banner-global">
    <div class="event-banner-icon" id="eventBannerIcon">
      <i class="fas fa-gift"></i>
    </div>
    <div class="event-banner-main">
      <div class="event-banner-title" id="eventBannerTitle">EVENT ACTIVE</div>
      <div class="event-banner-desc" id="eventBannerDesc">Event description</div>
    </div>
    <div class="event-banner-timer" id="eventBannerTimer" style="display:none">
      <div class="event-banner-time" id="eventBannerTime">00:00</div>
      <div class="event-banner-label">Remaining</div>
    </div>
    <button class="event-banner-close" onclick="closeEventBanner()">×</button>
  </div>

  <!-- MAINTENANCE / BANNED -->
  <div id="mtScreen" class="full-overlay"><i class="fas fa-tools" style="color:var(--accent)"></i><h1>Server Maintenance</h1><p>Kami sedang melakukan pembaruan sistem.<br>Mohon tunggu sebentar lagi.</p></div>
  <div id="bannedScreen" class="full-overlay"><i class="fas fa-user-slash" style="color:var(--danger)"></i><h1>Access Denied</h1><p>Akun anda telah diblokir secara permanen.</p></div>

  <div id="toastLegacy" style="display:none"></div>

    <!-- Notif Panel — OUTSIDE .app to avoid overflow:hidden clipping -->
    <div id="notifPanel" class="notif-panel">
      <div class="notif-panel-header">
        <h3><i class="fas fa-comment-dots"></i> Notifikasi</h3>
        <button class="notif-panel-close" onclick="openClearNotifConfirm()" style="margin-right:8px" title="Hapus notif"><i class="fas fa-trash"></i></button>
        <button class="notif-panel-close" onclick="closeNotifPanel()"><i class="fas fa-times"></i></button>
      </div>
      <div id="notifList" class="notif-list"><div class="notif-empty">Memuat...</div></div>
    </div>

  <!-- Tag Unlock Fullscreen - v3.2.3 (Video Style) -->
  <div id="tagUnlockFullscreen" class="tag-unlock-fullscreen">
    <div class="tag-unlock-bg"></div>
    <div class="tag-unlock-grid"></div>
    <div class="tag-unlock-particles" id="tagUnlockParticles"></div>
    <div class="tag-unlock-ring"></div>
    <div class="tag-unlock-ring"></div>
    <div class="tag-unlock-ring"></div>
    <div class="tag-unlock-card">
      <div class="tag-unlock-icon-big">
        <i class="fas fa-trophy"></i>
      </div>
      <div class="tag-unlock-title">TAG UNLOCKED!</div>
      <div class="tag-unlock-subtitle">🎉 Selamat! Kamu berhasil membuka tag baru</div>
      <div class="tag-unlock-tag-display" id="tagUnlockFullscreenTags"></div>
      <div class="tag-unlock-css-section" id="tagUnlockCssSection" style="display: none;">
        <div class="tag-unlock-css-title"><i class="fas fa-code"></i> Tag CSS</div>
        <pre class="tag-unlock-css-code" id="tagUnlockCssCode"></pre>
      </div>
      <button class="tag-unlock-close-btn" onclick="closeTagUnlockFullscreen()">
        <i class="fas fa-check"></i> Awesome!
      </button>
    </div>
  </div>

  <!-- MAIN APP -->
  <div class="app">
  <div class="ml-corner-tl ml-corner"></div>
    <div class="ml-corner-tr ml-corner"></div>
    <div class="ml-corner-bl ml-corner"></div>
    <div class="ml-corner-br ml-corner"></div>

  <div id="adminFloatChat" class="admin-float-chat">
    <div class="admin-float-name">
      <i class="fas fa-check-circle"></i>
      <span id="adminFloatName"></span>
    </div>
    <div class="admin-float-msg" id="adminFloatMsg"></div>
    <div class="admin-float-timer" id="adminFloatTimer"></div>
  </div>

    <div class="header">
      <img src="exemusic.png" alt="Logo" onclick="openAbout()">
      <div class="header-right">
        <button id="btnNotif" onclick="toggleNotifPanel()" title="Notifikasi">
          <i class="fas fa-bell"></i>
          <span id="notifBadge" class="notif-badge"></span>
        </button>
        <button id="btnEvent" onclick="openEventCenter()" title="Event">
          <i class="fas fa-calendar-alt"></i>
        </button>
        <button id="btnAdmin" onclick="openAdminPanel()" title="Admin Panel">
          <i class="fas fa-shield-alt"></i>
        </button>
        <button id="btnCreatorPanel" onclick="openCreatorPanel()" title="Creator Panel">
          <i class="fas fa-star"></i>
        </button>
        <button id="topLoginBtn" onclick="openProfile()" title="Profile">👤</button>
      </div>
    </div>

    <div class="cover-box">
      <div class="eq" id="eq"><span></span><span></span><span></span><span></span><span></span></div>
    </div>

    <div class="track-info">
      <div id="title">Loading Lagu...</div>
      <div class="user-row">
        <div id="by" onclick="viewCreator()">@system</div>
        <button id="btnFav" onclick="toggleFavorite()"><i class="far fa-heart"></i></button>
        <button id="btnFollow" onclick="followUser()"><i class="fas fa-plus"></i></button>
      </div>
      <div class="player-badges">
        <div class="vip-trial-banner" id="vipTrialBanner">
          <i class="fas fa-crown"></i>
          <div class="vip-trial-info">
            <div class="vt-label">VIP TRIAL AKTIF</div>
            <div class="vt-timer" id="vipTrialTimer">--:--:--</div>
          </div>
          <button class="vip-trial-close" onclick="closeVipTrialBanner()">×</button>
        </div>
        <div class="event-countdown" id="lebaranCountdown">
          <div class="ec-main">
            <div class="ec-label">Countdown Lebaran</div>
            <div class="ec-time" id="lebaranTimer">--:--:--</div>
          </div>
          <div class="ec-badge">Idulfitri</div>
          <button class="ec-close" onclick="closeLebaranCountdown()">×</button>
        </div>
        <div class="global-countdown" id="globalCountdown">
          <div class="global-countdown-icon"><i class="fas fa-bolt"></i></div>
          <div class="global-countdown-main">
            <div class="global-countdown-label" id="globalCountdownLabel">Admin Event</div>
            <div class="global-countdown-time" id="globalCountdownTimer">--:--</div>
          </div>
          <button class="global-countdown-close" onclick="closeGlobalCountdown()">×</button>
        </div>
      </div>
    </div>

    <div class="sys-container">
      <div class="sys-tools">
        <button onclick="copyRawUrl()" title="Copy URL Audio"><i class="fas fa-link"></i></button>
        <button onclick="openCopyLink()" title="Share Link"><i class="fas fa-share-alt"></i></button>
        <button onclick="downloadSong()" title="Download"><i class="fas fa-download"></i></button>
        <button onclick="openReq()" title="Upload"><i class="fas fa-plus-circle"></i></button>
      </div>
      <div class="vol-row">
        <i class="fas fa-volume-down" style="font-size:12px; color:#555"></i>
        <input type="range" id="vol" min="0" max="1" step="0.01" value="0.8">
        <i class="fas fa-volume-up" style="font-size:12px; color:#888"></i>
      </div>
    </div>

    <div class="prog-area">
      <input type="range" id="seek" value="0">
      <div class="time">
        <span id="cur">0:00</span>
        <div class="dur-wrapper">
          <div class="loading-spinner" id="loadSpinner"></div>
          <span id="dur">0:00</span>
        </div>
      </div>
    </div>

    <div class="main-ctrl">
      <button class="btn-sec" onclick="prev()"><i class="fas fa-step-backward"></i></button>
      <button class="btn-play" onclick="toggle()" id="playBtn"><i class="fas fa-play"></i></button>
      <button class="btn-sec" onclick="next()"><i class="fas fa-step-forward"></i></button>
    </div>

    <div class="footer">
      <button id="shuf" onclick="toggleShuffle()"><i class="fas fa-random"></i></button>
      <button onclick="openList(false)"><i class="fas fa-list-ul"></i></button>
      <button onclick="openList(true)"><i class="fas fa-heart"></i></button>
      <button id="rep" onclick="toggleRepeat()"><i class="fas fa-redo"></i></button>
    </div>
  </div>

  <!-- ADMIN PANEL (Built-in) -->
    <div class="admin-panel-overlay" id="adminPanelOverlay">
    <div class="admin-panel" id="adminPanelInner" style="display:none; flex:1; flex-direction:column">
      <div class="admin-header" onmousedown="startAdminDrag(event)">
        <div class="admin-header-title">
          <i class="fas fa-shield-alt"></i> ADMIN PANEL
        </div>
        <div class="admin-header-tools">
          <button class="admin-header-btn" id="btnRamadanTheme" onclick="toggleRamadanTheme()" title="Ramadan Theme"><i class="fas fa-moon"></i></button>
          <button class="admin-header-btn" onclick="toggleAdminSize('mini')" title="Minimize"><i class="fas fa-minus"></i></button>
          <button class="admin-header-btn" onclick="toggleAdminSize('full')" title="Full"><i class="fas fa-expand"></i></button>
          <button class="admin-header-close" onclick="closeAdminPanel()"><i class="fas fa-times"></i></button>
        </div>
      </div>
      <div class="admin-nav">
        <button class="admin-nav-btn active" onclick="switchAdminView('dash', this)"><i class="fas fa-th-large"></i> DASH</button>
        <button class="admin-nav-btn" onclick="switchAdminView('users', this)"><i class="fas fa-users"></i> USERS</button>
        <button class="admin-nav-btn" onclick="switchAdminView('songs', this)"><i class="fas fa-music"></i> SONGS</button>
        <button class="admin-nav-btn" onclick="switchAdminView('notif', this)"><i class="fas fa-paper-plane"></i> NOTIF</button>
        <button class="admin-nav-btn" onclick="switchAdminView('visual', this)"><i class="fas fa-palette"></i> VISUAL</button>
        <button class="admin-nav-btn" onclick="switchAdminView('theme', this)"><i class="fas fa-moon"></i> THEME</button>
        <button class="admin-nav-btn" onclick="switchAdminView('logs', this)"><i class="fas fa-terminal"></i> LOGS</button>
      </div>
      <div class="admin-content">

        <!-- DASH -->
        <div id="adv-dash" class="admin-view active">
          <div class="admin-stat-grid">
            <div class="admin-stat-box"><div class="sv" id="adCountU">0</div><div class="sl">USERS</div></div>
            <div class="admin-stat-box"><div class="sv" id="adCountS">0</div><div class="sl">SONGS</div></div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-broadcast-tower"></i> GLOBAL BROADCAST</h3>
            <textarea class="admin-inp" id="adBcInput" rows="3" placeholder="Isi pengumuman..."></textarea>
            <div style="display:flex; gap:8px">
              <button class="admin-btn admin-btn-gold" onclick="adSendBC()">SEND</button>
              <button class="admin-btn admin-btn-red" onclick="adClearBC()">CLEAR</button>
              <button class="admin-btn admin-btn-blue" style="margin-left:auto" onclick="adToggleMT()">MAINTENANCE</button>
            </div>
            <div style="margin-top:10px">
              <div class="admin-label">Admin Float Chat (15s, global)</div>
              <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:4px">
                <input class="admin-inp" id="adFloatMsg" placeholder="Contoh: who want free tag?" style="flex:1; min-width:0">
                <button class="admin-btn admin-btn-blue" style="white-space:nowrap" onclick="adSendFloatChat()">SEND CHAT</button>
              </div>
            </div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-cog"></i> SYSTEM TOOLS</h3>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button class="admin-btn admin-btn-green" onclick="openCopyUrlCard()">COPY DEEP LINK</button>
              <button class="admin-btn admin-btn-red" onclick="adOpenClearNotif()">CLEAR MY NOTIFS</button>
            </div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-gift"></i> EVENT TAG DROP</h3>
            <div class="admin-two-col">
              <div>
                <div class="admin-label">Tag drop</div>
                <select class="admin-sel" id="adTagDropName"></select>
              </div>
              <div>
                <div class="admin-label">Chance (%)</div>
                <input class="admin-inp" id="adTagDropChance" type="number" min="0" max="100" step="1" value="10">
              </div>
            </div>
          <div class="admin-two-col" style="margin-top:8px">
            <div>
              <div class="admin-label">Durasi event (detik)</div>
              <input class="admin-inp" id="adTagDropDuration" type="number" min="10" step="10" value="1800">
            </div>
            <div>
              <div class="admin-label">Maks. pemenang (0 = unlimited)</div>
              <input class="admin-inp" id="adTagDropMax" type="number" min="0" step="1" value="0">
            </div>
          </div>
          <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px">
            <button class="admin-btn admin-btn-gold" onclick="adSaveTagDrop()">START EVENT</button>
            <button class="admin-btn admin-btn-blue" onclick="adPreviewTagDrop()">TEST</button>
            <button class="admin-btn admin-btn-red" onclick="adClearTagDrop()">STOP</button>
          </div>
            <div id="adTagDropStatus" style="font-size:11px;color:#888;margin-top:6px"></div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-bolt"></i> ADMIN EVENT COUNTDOWN</h3>
            <p style="font-size:11px; color:#888; margin-bottom:8px">Atur judul dan waktu untuk event spesial agar muncul di semua user.</p>
            <input class="admin-inp" id="adGlobalTitle" placeholder="Judul event, misalnya: Event Tag Drop Spesial">
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
              <input class="admin-inp" id="adGlobalDate" type="date" style="flex:1 1 140px">
              <input class="admin-inp" id="adGlobalTime" type="time" value="00:00" style="flex:1 1 100px">
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
              <button class="admin-btn admin-btn-gold" onclick="adSaveGlobalCountdown()">SAVE</button>
              <button class="admin-btn admin-btn-red" onclick="adClearGlobalCountdown()">CLEAR</button>
            </div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-moon"></i> LEBARAN COUNTDOWN</h3>
            <p style="font-size:11px; color:#888; margin-bottom:8px">Atur tanggal Idulfitri supaya countdown muncul untuk semua user.</p>
            <input class="admin-inp" id="adLebaranDate" type="date">
            <input class="admin-inp" id="adLebaranTime" type="time" value="00:00">
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button class="admin-btn admin-btn-gold" onclick="adSaveLebaran()">SAVE</button>
              <button class="admin-btn admin-btn-red" onclick="adClearLebaran()">CLEAR</button>
            </div>
          </div>
          <div class="admin-card admin-ramadhan-section">
            <h3><i class="fas fa-moon-crescent"></i> RAMADHAN EVENT CONTROL</h3>
            <p style="font-size:11px; color:#9ca3af; margin-bottom:12px">Kelola event Ramadhan dengan 3 cycle quest. User yang menyelesaikan quest akan mendapat tag eksklusif.</p>
            
            <div class="admin-ramadhan-cycle">
              <h4>🌅 CYCLE 1 - Awal Ramadhan</h4>
              <div class="admin-ramadhan-req">Login 3 hari berturut</div>
              <div class="admin-ramadhan-req">Play 10 lagu total</div>
              <div class="admin-ramadhan-req">Online minimal 30 menit akumulasi</div>
              <div style="margin-top:8px; font-size:10px; color:#fbbf24">Reward: Tag RAMADHAN 1447H (clean gold)</div>
            </div>
            
            <div class="admin-ramadhan-cycle">
              <h4>🌙 CYCLE 2 - Mid Ramadhan</h4>
              <div class="admin-ramadhan-req">Online jam 18:00-20:00 minimal 2 hari</div>
              <div class="admin-ramadhan-req">Share 2 lagu</div>
              <div class="admin-ramadhan-req">Like 5 lagu</div>
              <div style="margin-top:8px; font-size:10px; color:#10b981">Reward: Tag NIGHT TARAWIH (soft green glow)</div>
            </div>
            
            <div class="admin-ramadhan-cycle">
              <h4>🕌 CYCLE 3 - 10 Hari Terakhir</h4>
              <div class="admin-ramadhan-req">Login 7 hari dalam 10 hari terakhir</div>
              <div class="admin-ramadhan-req">Total playtime 120 menit</div>
              <div class="admin-ramadhan-req">Aktif minimal 1 hari di atas jam 23:00</div>
              <div style="margin-top:8px; font-size:10px; color:#fbbf24">Reward: Tag LAILAT MODE (animated gold shine)</div>
            </div>
            
            <div style="margin-top:12px">
              <div class="admin-label">Tanggal Mulai Ramadhan</div>
              <input class="admin-inp" id="adRamadhanStart" type="date">
              <div class="admin-label">Tanggal Selesai Ramadhan</div>
              <input class="admin-inp" id="adRamadhanEnd" type="date">
              <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
                <button class="admin-btn admin-btn-gold" onclick="adSaveRamadhanEvent()">AKTIFKAN EVENT</button>
                <button class="admin-btn admin-btn-red" onclick="adClearRamadhanEvent()">NONAKTIFKAN</button>
                <button class="admin-btn admin-btn-blue" onclick="adViewRamadhanProgress()">LIHAT PROGRESS</button>
              </div>
            </div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-moon"></i> SECRET TAG: EXE-SAHUR</h3>
            <p style="font-size:11px; color:#888; margin-bottom:8px">Tag rahasia yang otomatis diberikan ke user yang upload lagu jam 03:00-05:00 (waktu sahur).</p>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button class="admin-btn admin-btn-gold" onclick="adEnableSahurTag()">ENABLE AUTO</button>
              <button class="admin-btn admin-btn-red" onclick="adDisableSahurTag()">DISABLE AUTO</button>
            </div>
            <div id="adSahurStatus" style="font-size:11px; color:#888; margin-top:8px">Status: Checking...</div>
          </div>
        </div>

        <!-- USERS -->
        <div id="adv-users" class="admin-view">
          <div class="admin-users-layout">
            <div class="admin-users-left">
              <input class="admin-search" placeholder="Cari user..." id="adUserSearch" oninput="adFilterUsers(this.value)">
              <div id="adUserList"><div style="text-align:center; padding:30px; color:#444; font-size:13px">Loading...</div></div>
            </div>
            <div class="admin-users-right">
              <div class="admin-card">
                <h3><i class="fas fa-id-badge"></i> EDIT TAG USER</h3>
                <div id="adTagEditorEmpty" style="font-size:12px;color:#777;padding:10px 0">Pilih user di kiri dulu.</div>
                <div id="adTagEditor" style="display:none">
                  <div class="admin-tag-active-row">
                    <div id="adTagUserName" class="admin-tag-user-name"></div>
                    <div id="adTagCurrentDisplay" class="admin-tag-current"></div>
                  </div>
                  <div id="adTagChipGrid" class="admin-tag-chip-grid"></div>
                </div>
              </div>
              <div class="admin-card">
                <h3><i class="fas fa-tags"></i> ALL TAG & CARA DAPET</h3>
                <div id="adAllTagInfo"></div>
                <div style="margin-top:12px; padding-top:12px; border-top:1px solid rgba(255,255,255,0.06)">
                  <div class="admin-label">Testing Tag (Grant ke diri sendiri)</div>
                  <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:8px">
                    <select class="admin-sel" id="adTestTagSelect" style="flex:1; margin:0">
                      <option value="">Pilih tag untuk testing...</option>
                    </select>
                    <button class="admin-btn admin-btn-gold" onclick="adGrantTestTag()" style="white-space:nowrap">GRANT TAG</button>
                  </div>
                  <p style="font-size:10px; color:#888; margin-top:6px">⚠️ Fitur ini untuk testing saja. Tag akan masuk ke alltag dan bisa dipilih di profile.</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SONGS -->
        <div id="adv-songs" class="admin-view">
          <div class="admin-card">
            <h3><i class="fas fa-plus-circle"></i> ADD SONG MANUAL</h3>
            <input class="admin-inp" id="adAddTitle" placeholder="Judul Lagu - Artist">
            <input class="admin-inp" id="adAddUrl" placeholder="URL MP3">
            <button class="admin-btn admin-btn-green admin-btn-full" onclick="adManualAdd()">UPLOAD TO DATABASE</button>
          </div>
          <input class="admin-search" placeholder="Cari lagu..." id="adSongSearch" oninput="adFilterSongs(this.value)">
          <div id="adSongList"></div>
        </div>

        <!-- NOTIF -->
        <div id="adv-notif" class="admin-view">
          <div class="admin-card">
            <h3><i class="fas fa-paper-plane"></i> KIRIM NOTIFIKASI</h3>
            <select class="admin-sel" id="adNType">
              <option value="admin">🔴 ADMIN MSG</option>
              <option value="violation">⚠️ VIOLATION</option>
              <option value="system">🔵 SYSTEM INFO</option>
              <option value="upload">🎵 UPLOAD</option>
            </select>
            <input class="admin-inp" id="adNTarget" placeholder="UID target (kosong = global)">
            <textarea class="admin-inp" id="adNMsg" rows="3" placeholder="Isi pesan..."></textarea>
            <button class="admin-btn admin-btn-gold admin-btn-full" onclick="adSendNotif()">SEND NOTIFICATION</button>
          </div>
        </div>

        <!-- VISUAL / DISCO -->
        <div id="adv-visual" class="admin-view">
          <div class="admin-card">
            <h3><i class="fas fa-palette"></i> ACCENT COLOR</h3>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px">
              <button class="admin-btn admin-btn-green" onclick="adSetAccent('#00ff88')">DEFAULT GREEN</button>
              <button class="admin-btn admin-btn-blue" onclick="adSetAccent('#00d4ff')">ICE BLUE</button>
              <button class="admin-btn" style="background:linear-gradient(135deg,#ff1493,#ff69b4);color:#fff" onclick="adSetAccent('#ff1493')">PINK</button>
              <button class="admin-btn" style="background:linear-gradient(135deg,#ffd700,#ff8c00);color:#000" onclick="adSetAccent('#ffd700')">GOLD</button>
              <button class="admin-btn" style="background:linear-gradient(135deg,#bf00ff,#6600cc);color:#fff" onclick="adSetAccent('#bf00ff')">PURPLE</button>
            </div>
            <div style="display:flex; gap:8px; margin-bottom:10px">
              <button class="admin-btn" style="background:linear-gradient(135deg,#ff0050,#ff69b4);color:#fff;flex:1" onclick="toggleHeartTheme()"><i class="fas fa-heart"></i> TOGGLE HEART THEME</button>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <input class="admin-inp" id="adCustomColor" placeholder="#00ff88" style="margin:0;flex:1">
              <button class="admin-btn admin-btn-gold" onclick="adSetAccent(document.getElementById('adCustomColor').value)">APPLY</button>
            </div>
          </div>
          <div class="admin-card">
            <h3><i class="fas fa-bolt"></i> DISCO MODE</h3>
            <select class="admin-sel" id="adDiscoVariant">
              <option value="minimal">Minimal</option>
              <option value="heartbeat">Heartbeat</option>
              <option value="rainbow">Rainbow</option>
              <option value="ice">Ice</option>
            </select>
            <input class="admin-inp" id="adDiscoColor" placeholder="#00ff88" value="#00ff88">
            <div style="display:flex;gap:8px">
              <button class="admin-btn admin-btn-gold" onclick="adStartDisco()">START DISCO</button>
              <button class="admin-btn admin-btn-red" onclick="adStopDisco()">STOP</button>
            </div>
          </div>
        <!-- THEME -->
 </div>

               <div id="adv-theme" class="admin-view">
          <div class="admin-card">
            <h3><i class="fas fa-moon"></i> RAMADHAN THEME</h3>
            <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px">
              <span style="color:#ccc;font-size:12px">Ketupat & Ornamen Ramadan</span>
              <button class="admin-btn" id="ramadanToggleBtn" onclick="toggleRamadanTheme()" style="min-width:70px">OFF</button>
            </div>
            <p style="font-size:10px;color:#666;margin-bottom:8px">Aktifkan tema Ramadan dengan efek ketupat warna hijau-emas</p>
          </div>
        </div>

        <!-- LOGS -->
        <div id="adv-logs" class="admin-view">
          <div class="admin-card">
            <h3><i class="fas fa-terminal"></i> SYSTEM LOGS</h3>
            <div class="log-terminal" id="adLogBox"><div style="color:#444">Loading logs...</div></div>
            <button class="admin-btn admin-btn-red" style="margin-top:10px" onclick="adClearLogs()">CLEAR LOGS</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- MODALS -->
  <div class="modal" id="modalAuth" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 id="authTitle" style="text-align:center; margin-bottom:18px; color:var(--accent); font-family:'Rajdhani',sans-serif; letter-spacing:1px">LOGIN EXEMUSIC</h3>
      <div id="usernameSection" style="display:none; margin-bottom:14px;">
        <p style="font-size:12px; color:#888; text-align:center; margin-bottom:10px;">👋 Buat username Anda:</p>
        <input id="authUser" class="inp-dark" placeholder="Username (min 3 karakter)">
      </div>
      <button onclick="handleGoogleAuth()" id="googleAuthBtn" class="btn-act" style="background:#fff; color:#000; display:flex; align-items:center; justify-content:center; gap:10px; font-weight:700; margin-bottom:10px;">
        <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>
        <span id="googleBtnText">Masuk dengan Google</span>
      </button>
      <p style="font-size:11px; color:#666; text-align:center;">🔒 Login aman dengan Google</p>
    </div>
  </div>

  <div class="modal" id="modalProfile" onclick="if(event.target==this)closeProfileModal()">
    <div class="sheet" style="padding:0; overflow:hidden">
      <div class="modern-profile-header" id="profileHeader">
        <!-- Profile Music Player -->
        <div class="profile-music-player" id="profileMusicPlayer">
          <div class="pmp-ring-container">
            <div class="pmp-ring-bg"></div>
            <svg class="pmp-ring-progress" id="pmpRingSvg" width="50" height="50" style="position:absolute;inset:0">
              <circle cx="25" cy="25" r="22" fill="none" stroke="#ff3333" stroke-width="3" 
                      stroke-dasharray="138.23" stroke-dashoffset="0" 
                      transform="rotate(-90 25 25)" id="pmpCircle"/>
            </svg>
            <div class="pmp-icon" onclick="toggleProfileMusic()">🎵</div>
          </div>
          <div class="pmp-timer" id="pmpTimer">0:00</div>
        </div>
        
        <div class="mp-avatar-container" id="pAvatarContainer">
          <img id="pAvatarImg" src="https://via.placeholder.com/150" class="mp-avatar">
          <div class="mp-edit-badge" onclick="document.getElementById('avatarInp').click()"><i class="fas fa-camera"></i></div>
          <div id="pAdminBadge" class="mp-admin-badge" style="display:none"></div>
        </div>
        <input type="file" id="avatarInp" style="display:none" accept="image/*" onchange="uploadAvatar(this)">
        <div class="mp-name-row">
          <span id="pUsername" class="mp-name">User</span>
          <span id="pBadge"></span>
        </div>
        <span id="pEmail" class="mp-handle">user@email.com</span>
        <div id="pTagDisplay" style="margin-bottom:8px"></div>
        <div class="mp-stats">
          <div class="mp-stat-item"><span id="pFol" class="mp-stat-val">0</span><span class="mp-stat-label">Followers</span></div>
          <div class="mp-stat-item"><span id="pFollowing" class="mp-stat-val">0</span><span class="mp-stat-label">Following</span></div>
        </div>
        <div class="mp-actions">
          <button class="mp-btn mp-btn-sec" onclick="openChangeNameModal()"><i class="fas fa-edit"></i> Edit</button>
          <button class="mp-btn mp-btn-sec" onclick="openChangePasswordModal()"><i class="fas fa-lock"></i> Pass</button>
          <button class="mp-btn mp-btn-sec" onclick="openTagSelector()"><i class="fas fa-tag"></i> Tag</button>
          <button class="mp-btn mp-btn-sec" id="btnProfileMusic" style="display:none" onclick="toggleProfileMusicInput()"><i class="fas fa-music"></i> Music</button>
          <button class="mp-btn mp-btn-sec" onclick="shareProfile(auth.currentUser&&auth.currentUser.uid, userData&&userData.username)"><i class="fas fa-share"></i> Share</button>
          <button class="mp-btn" style="background:rgba(239,68,68,0.15); color:#ef4444; border:1px solid rgba(239,68,68,0.2)" onclick="auth.signOut(); location.reload()"><i class="fas fa-sign-out-alt"></i></button>
        </div>
        <div id="profileMusicRow" style="width:100%; padding:0 18px 8px; display:none">
          <input id="profileMusicUrl" class="inp-dark" placeholder="Link MP3 khusus profil" style="border-radius:8px">
          <button class="btn-act" style="margin-top:8px; width:100%; border-radius:8px" onclick="saveProfileMusic()">SIMPAN MUSIC PROFIL</button>
        </div>
        <div style="font-size:10px; color:#555; margin-top:4px; padding:4px 12px; background:rgba(255,255,255,0.02); border-radius:6px; border:1px solid rgba(255,255,255,0.04)" id="pVipStatus">Status: NONVIP</div>
      </div>
      <div class="mp-tabs">
        <div class="mp-tab active" onclick="switchProfileTab('posts')" id="tabPosts"><i class="fas fa-music" style="margin-right:4px"></i> MY UPLOADS</div>
        <div class="mp-tab" onclick="switchProfileTab('likes')" id="tabLikes"><i class="fas fa-heart" style="margin-right:4px"></i> FAVORITES</div>
      </div>
      <div id="myPostList" class="mp-list"></div>
      <div id="myLikeList" class="mp-list" style="display:none"></div>
    </div>
  </div>

  <div class="modal" id="modalCreator" onclick="if(event.target==this)closeCreatorModal()">
    <div class="sheet" style="padding:0; overflow:hidden">
      <div class="modern-profile-header">
        <div class="mp-avatar-container" id="vAvatarContainer"><img id="vAvatarImg" src="https://via.placeholder.com/150" class="mp-avatar"><div id="vAdminBadge" class="mp-admin-badge" style="display:none"></div></div>
        <div class="mp-name-row"><span id="vName" class="mp-name">@creator</span></div>
        <div id="vTagDisplay" style="margin-bottom:10px; display:flex; gap:5px; justify-content:center"></div>
        <div class="mp-stats">
          <div class="mp-stat-item"><span id="vFol" class="mp-stat-val">0</span><span class="mp-stat-label">Followers</span></div>
          <div class="mp-stat-item"><span id="vFollowing" class="mp-stat-val">0</span><span class="mp-stat-label">Following</span></div>
        </div>
        <div class="mp-actions" style="justify-content:center">
          <button id="vCreatorFollowBtn" class="mp-btn mp-btn-primary" onclick="followCreator()">Follow</button>
          <button class="mp-btn mp-btn-sec" onclick="shareProfile(document.getElementById('modalCreator').dataset.creatorUid, document.getElementById('vName').textContent)"><i class="fas fa-share"></i></button>
        </div>
      </div>
      <div style="padding:12px 14px 4px; font-size:11px; color:#555; font-weight:700; letter-spacing:1px">UPLOADED SONGS</div>
      <div id="creatorPostList" class="mp-list"></div>
    </div>
  </div>

  <div class="modal" id="modalReq" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--accent); font-family:'Rajdhani',sans-serif; letter-spacing:1px">UPLOAD LAGU</h3>
      <div class="rules-warn"><b>⚠️ PERHATIAN:</b> Dilarang upload konten SARA, pornografi audio, atau earrape. Pelanggaran = <b>BANNED PERMANENT</b>!</div>
      <p style="font-size:12px; color:#88c; margin:10px 0">Belum tau cara buat Top4Top? <span class="tutorial-link" onclick="openTutorial()">klik disini</span></p>
      <div id="uploadFormUser" style="display:none">
        <input id="rLagu" class="inp-dark" placeholder="Judul Lagu - Artist">
        <input id="rUrl" class="inp-dark" placeholder="Link MP3 (Top4Top)">
        <button onclick="confirmAndSave()" class="btn-act">POST SEKARANG</button>
        <div id="uploadQueueSection" class="upload-queue-section" style="display:none">
          <div class="upload-queue-header">
            <span class="upload-queue-title-label">UPLOAD QUEUE</span>
            <span id="uploadQueueInfo" class="upload-queue-info"></span>
          </div>
          <div id="uploadQueueList" class="upload-queue-list"></div>
        </div>
        <div id="uploadCdCard" class="upload-cd-card">
          <div class="upload-cd-row">
            <span class="upload-cd-label">COOLDOWN</span>
            <span id="uploadCdTimer" class="upload-cd-timer">00:00</span>
          </div>
          <div class="upload-cd-sub" id="uploadCdSub">Menunggu...</div>
        </div>
      </div>
      <div id="uploadFormGuest">
        <input id="guestName" class="inp-dark" placeholder="Nama Anda">
        <input id="guestLagu" class="inp-dark" placeholder="Judul Lagu - Artist">
        <input id="guestUrl" class="inp-dark" placeholder="Link MP3 Top4Top">
        <button onclick="sendWA()" class="btn-act" style="background:#25D366; color:white">WHATSAPP REQUEST</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalList" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <input type="text" id="searchSongInput" class="inp-dark" placeholder="🔍 Cari lagu..." 
             oninput="filterSongList(this.value)" style="margin-bottom:12px; width: 100%;">
      <div id="songContainer"></div>
    </div>
  </div>

  <div class="modal" id="modalAbout" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <div class="about-box">
        <h3>🎵 ExeMusic 3.2.3</h3>
        <p>Platform musik untuk para creator url berbagi dan menikmati musik berkualitas tinggi.</p>
        <p><b>Fitur Platform</b></p>
        <ul class="about-features">
          <li><b>High-Fidelity Streaming</b> – Audio lossless tanpa kompresi berlebihan</li>
          <li><b>Smart Social System</b> – Follow creator favorit & bangun komunitas</li>
          <li><b>VIP Trial System</b> – Nikmati VIP sementara dengan cooldown 15 menit</li>
          <li><b>Badge System</b> – Verifikasi otomatis di 50+ followers</li>
          <li><b>Built-in Admin Panel</b> – Kelola platform langsung dari aplikasi</li>
          <li><b>Real-time Sync</b> – Followers, likes, playlist real-time</li>
        </ul>
        <div class="rules-warn">
          <b>PERATURAN KETAT:</b><br>Konten SARA, pornografi audio, earrape, ujaran kebencian →<br>
          <strong>⚠️ DIHAPUS & BANNED PERMANENT</strong>
        </div>
        <p style="margin-top:12px; color:#ddd">
          📱 WhatsApp — <a href="https://wa.me/62895329018240" target="_blank" class="about-dev-link">click here</a><br>
          📋 Changelogs — <a href="https://execuriverp.github.io/changelogs" target="_blank" class="about-dev-link">click here</a><br>
          📻 Use Boombox — <a href="javascript:void(0)" onclick="openBoomboxTutorial()" class="about-dev-link">click here</a>
        </p>
        <p style="font-size:11px; color:#555; margin-top:10px">Dibuat oleh <a href="?profile_userid=GsU6ThLD9gb5P3k8RS87ro553Ks2" class="about-dev-link">Hexky</a><br>© 2025 ExeMusic</p>
        <button onclick="closeModal()" class="btn-act">SAYA MENGERTI</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalEventCenter" onclick="if(event.target==this)this.style.display='none'">
    <div class="event-center-sheet">
      <div class="event-center-header">
        <div class="event-center-title">
          <i class="fas fa-gamepad"></i>
          <span>EVENT & QUEST EXEMUSIC</span>
        </div>
        <div class="event-center-coins">
          <div class="event-coins-icon">
            <i class="fas fa-coins"></i>
          </div>
          <div class="event-coins-body">
            <div class="event-coins-label">EXECOIN</div>
            <div class="event-coins-value" id="evCoinBalance">0</div>
          </div>
        </div>
      </div>
      <div class="event-center-layout">
        <div class="event-center-main">
          <div class="event-center-tabs">
            <button class="event-tab-btn active" data-tab="daily" onclick="switchEventTab('daily', this)"><i class="fas fa-sun"></i> Tugas Harian</button>
            <button class="event-tab-btn" data-tab="weekly" onclick="switchEventTab('weekly', this)"><i class="fas fa-calendar-week"></i> Misi Mingguan</button>
            <button class="event-tab-btn" data-tab="ramadhan" onclick="switchEventTab('ramadhan', this)"><i class="fas fa-moon"></i> Event Ramadhan</button>
            <button class="event-tab-btn" data-tab="shop" onclick="switchEventTab('shop', this)"><i class="fas fa-store"></i> Toko ExeCoin</button>
          </div>
          <div style="margin-top:10px; display:flex; justify-content:center">
            <button class="event-tab-btn" style="background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.15)); border-color: rgba(251,191,36,0.6); color: #fbbf24" onclick="openLeaderboard()">
              <i class="fas fa-trophy"></i> Lihat Leaderboard Top 5
            </button>
          </div>
          <div id="evTabDaily" class="event-tab-view active">
            <div class="event-tab-caption">Reset tiap 24 jam untuk semua akun.</div>
            <div id="evDailyList" class="event-quest-list"></div>
          </div>
          <div id="evTabWeekly" class="event-tab-view">
            <div class="event-tab-caption">Reset tiap 7 hari. Cocok untuk misi jangka panjang.</div>
            <div id="evWeeklyList" class="event-quest-list"></div>
          </div>
          <div id="evTabRamadhan" class="event-tab-view">
            <div class="event-tab-caption">🌙 Event spesial Ramadhan dengan 3 cycle quest. Selesaikan untuk dapat tag eksklusif!</div>
            <div id="evRamadhanList" class="event-quest-list">
              <!-- Cycle 1 -->
              <div class="event-quest-card gaming-card-enhanced">
                <div class="event-quest-main">
                  <div class="event-quest-title-row">
                    <div class="event-quest-title">🌅 Cycle 1 - Awal Ramadhan</div>
                    <div class="event-quest-reward"><i class="fas fa-trophy"></i> RAMADHAN 1447H</div>
                  </div>
                  <div class="event-quest-desc">Login 3 hari berturut • Play 10 lagu • Online 30 menit</div>
                  <div class="event-quest-progress-wrap">
                    <div class="event-quest-progress-bar">
                      <div class="event-quest-progress-fill" id="ramCycle1Progress" style="transform:scaleX(0)"></div>
                    </div>
                    <div class="event-quest-progress-text" id="ramCycle1Text">0%</div>
                  </div>
                </div>
                <div class="event-quest-action">
                  <div class="event-quest-badge" id="ramCycle1Badge">LOCKED</div>
                  <button class="event-quest-btn event-quest-btn-gaming" id="ramCycle1Btn" disabled>CLAIM</button>
                </div>
              </div>
              <!-- Cycle 2 -->
              <div class="event-quest-card gaming-card-enhanced">
                <div class="event-quest-main">
                  <div class="event-quest-title-row">
                    <div class="event-quest-title">🌙 Cycle 2 - Mid Ramadhan</div>
                    <div class="event-quest-reward"><i class="fas fa-trophy"></i> NIGHT TARAWIH</div>
                  </div>
                  <div class="event-quest-desc">Online jam 18-20 (2 hari) • Share 2 lagu • Like 5 lagu</div>
                  <div class="event-quest-progress-wrap">
                    <div class="event-quest-progress-bar">
                      <div class="event-quest-progress-fill" id="ramCycle2Progress" style="transform:scaleX(0)"></div>
                    </div>
                    <div class="event-quest-progress-text" id="ramCycle2Text">0%</div>
                  </div>
                </div>
                <div class="event-quest-action">
                  <div class="event-quest-badge" id="ramCycle2Badge">LOCKED</div>
                  <button class="event-quest-btn event-quest-btn-gaming" id="ramCycle2Btn" disabled>CLAIM</button>
                </div>
              </div>
              <!-- Cycle 3 -->
              <div class="event-quest-card gaming-card-enhanced">
                <div class="event-quest-main">
                  <div class="event-quest-title-row">
                    <div class="event-quest-title">🕌 Cycle 3 - 10 Hari Terakhir</div>
                    <div class="event-quest-reward"><i class="fas fa-trophy"></i> LAILAT MODE</div>
                  </div>
                  <div class="event-quest-desc">Login 7/10 hari terakhir • 120 menit playtime • Aktif jam 23+</div>
                  <div class="event-quest-progress-wrap">
                    <div class="event-quest-progress-bar">
                      <div class="event-quest-progress-fill" id="ramCycle3Progress" style="transform:scaleX(0)"></div>
                    </div>
                    <div class="event-quest-progress-text" id="ramCycle3Text">0%</div>
                  </div>
                </div>
                <div class="event-quest-action">
                  <div class="event-quest-badge" id="ramCycle3Badge">LOCKED</div>
                  <button class="event-quest-btn event-quest-btn-gaming" id="ramCycle3Btn" disabled>CLAIM</button>
                </div>
              </div>
            </div>
          </div>
          <div id="evTabShop" class="event-tab-view">
            <div class="event-tab-caption">Tukar ExeCoin dengan tag eksklusif dan VIP.</div>
            <div id="evShopList" class="event-quest-list"></div>
          </div>
        </div>
        <div class="event-center-sidepanel">
          <div class="event-side-card">
            <div class="event-side-label">Event Status</div>
            <div id="evTagDropStatusBox" class="event-side-body">
              <div class="event-side-main" id="evTagDropMain">Tidak ada event tag drop aktif</div>
              <div class="event-side-sub" id="evTagDropSub">Tunggu admin mengaktifkan event.</div>
              <div class="event-side-timer" id="evTagDropTimer">--:--</div>
            </div>
          </div>
          <div class="event-side-card">
            <div class="event-side-label">Tips ExeCoin</div>
            <ul class="event-side-tips">
              <li>Upload rutin untuk ambil semua Tugas Harian.</li>
              <li>Aktif dengerin lagu sambil tab aktif.</li>
              <li>Pakai Toko ExeCoin untuk beli tag eksklusif.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="eventTagBanner" class="event-banner">
    <div class="event-banner-icon"><i class="fas fa-bolt"></i></div>
    <div class="event-banner-body">
      <div class="event-banner-title" id="eventTagBannerTitle">TAG DROP EVENT</div>
      <div class="event-banner-sub" id="eventTagBannerSub">Tag spesial lagi drop untuk user online!</div>
    </div>
    <div class="event-banner-timer" id="eventTagBannerTimer">--:--</div>
    <button class="event-banner-close" onclick="closeEventTagBanner()">×</button>
  </div>
  <div class="modal" id="modalChangeNames" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:18px; color:var(--accent); font-family:'Rajdhani',sans-serif">✏️ UBAH NAMA</h3>
      <input id="cnPass" type="password" class="inp-dark" placeholder="Password Saat Ini">
      <input id="cnNewName" class="inp-dark" placeholder="Nama Pengguna Baru">
      <button onclick="handleChangeName()" class="btn-act">UBAH NAMA</button>
      <div id="cnMsg" class="modal-msg"></div>
    </div>
  </div>

  <div class="modal" id="modalChangePass" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:18px; color:var(--accent); font-family:'Rajdhani',sans-serif">🔐 UBAH PASSWORD</h3>
      <input id="cpOldPass" type="password" class="inp-dark" placeholder="Password Lama">
      <input id="cpNewPass" type="password" class="inp-dark" placeholder="Password Baru (Min. 6)">
      <input id="cpConfirm" type="password" class="inp-dark" placeholder="Konfirmasi Password Baru">
      <button onclick="handleChangePassword()" class="btn-act">UBAH PASSWORD</button>
      <div id="cpMsg" class="modal-msg"></div>
    </div>
  </div>

  <div class="modal" id="modalClearNotif" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--accent); font-family:'Rajdhani',sans-serif">KONFIRMASI</h3>
      <p style="text-align:center; color:#ccc; margin-bottom:14px; font-size:13px">Yakin ingin menghapus semua notifikasi?</p>
      <div style="display:flex; gap:8px">
        <button class="btn-act" onclick="confirmClearNotif()">CONFIRM</button>
        <button class="btn-act" style="background:rgba(255,255,255,0.1); color:#fff; box-shadow:none" onclick="document.getElementById('modalClearNotif').style.display='none'">BATAL</button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCopyLink" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--accent); font-family:'Rajdhani',sans-serif">SHARE LINK</h3>
      <div id="copyLinkText" style="background:#050510; border:1px solid rgba(0,255,136,0.2); border-radius:10px; padding:12px; color:#00d4ff; font-family:'JetBrains Mono',monospace; font-size:11px; word-break:break-all; margin-bottom:12px">URL belum dibuat</div>
      <div style="display:flex; gap:8px">
        <button class="btn-act" onclick="copyBuiltLink()">COPY</button>
        <button class="btn-act" style="background:#25D366; color:#fff; box-shadow:none" onclick="shareToWhatsApp()">WHATSAPP</button>
        <button class="btn-act" style="background:rgba(255,255,255,0.1); color:#fff; box-shadow:none; flex:0" onclick="document.getElementById('modalCopyLink').style.display='none'"><i class="fas fa-arrow-left"></i></button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalCopyAudio" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--accent); font-family:'Rajdhani',sans-serif">URL AUDIO MP3</h3>
      <div id="copyAudioText" style="background:#050510; border:1px solid rgba(0,255,136,0.2); border-radius:10px; padding:12px; color:#00d4ff; font-family:'JetBrains Mono',monospace; font-size:11px; word-break:break-all; margin-bottom:12px">URL belum dibuat</div>
      <div style="display:flex; gap:8px">
        <button class="btn-act" onclick="copyBuiltAudio()">COPY</button>
        <button class="btn-act" style="background:rgba(255,255,255,0.1); color:#fff; box-shadow:none; flex:0" onclick="document.getElementById('modalCopyAudio').style.display='none'"><i class="fas fa-arrow-left"></i></button>
      </div>
    </div>
  </div>

  <div class="modal" id="modalSocialList" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:12px; color:var(--accent); font-family:'Rajdhani',sans-serif" id="socialTitle">Social</h3>
      <div id="socialList" class="mp-list"></div>
    </div>
  </div>

  <div class="modal" id="modalBoombox" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--accent); font-family:'Rajdhani',sans-serif">HOW TO USE TOP4TOP</h3>
      <div style="font-size:13px; color:#ddd; line-height:1.8; margin-bottom:14px">
        <p>1. Pastikan kamu sudah punya boombox.</p>
        <p>2. Pakai command /placebb untuk menaruh boombox.</p>
        <p>3. Pakai command /setbb untuk memulai music.</p>
        <p>4. Pilih url paling bawah dan masukan url top4top.</p>
        <p style="color:#888; font-size:12px">Note: jika tidak bunyi, hapus 's' di https → http. Pastikan url adalah top4top.</p>
      </div>
      <button class="btn-act" onclick="document.getElementById('modalBoombox').style.display='none'">CLOSE</button>
    </div>
  </div>

  <!-- Admin Copy URL Modal -->
  <div class="modal" id="modalAdminCopyUrl" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet">
      <h3 style="text-align:center; margin-bottom:10px; color:var(--ml-gold); font-family:'Rajdhani',sans-serif">COPY DEEP LINK</h3>
      <input id="adCopySongId" class="inp-dark" placeholder="ID lagu (contoh: 0)" oninput="adUpdateDeepLink(this.value)">
      <div id="adCopyUrlText" style="background:#050510; border:1px solid rgba(255,193,7,0.2); border-radius:10px; padding:12px; color:#00d4ff; font-family:'JetBrains Mono',monospace; font-size:11px; word-break:break-all; margin-bottom:12px">URL belum dibuat</div>
      <div style="display:flex; gap:8px">
        <button class="btn-act" style="background:linear-gradient(135deg,var(--ml-gold),#ff8c00); color:#000" onclick="adCopyDeepLink()">COPY</button>
        <button class="btn-act" style="background:rgba(255,255,255,0.1); color:#fff; box-shadow:none; flex:0" onclick="document.getElementById('modalAdminCopyUrl').style.display='none'"><i class="fas fa-times"></i></button>
      </div>
    </div>
  </div>

  <div id="globalEventPill" class="global-event-pill">
    <span class="pill-icon">🎁</span>
    <span class="pill-time" id="globalEventPillTime">--:--</span>
  </div>
  <div id="toast-container"></div>

  <!-- CREATOR PANEL (Side Panel - Draggable) -->
  <div class="creator-panel-overlay" id="creatorPanelOverlay">
    <div class="creator-panel" id="creatorPanelInner" style="display:none; flex:1; flex-direction:column">
      <div class="creator-header" onmousedown="startCreatorDrag(event)" ontouchstart="startCreatorDragTouch(event)">
        <div class="creator-header-title">
          <i class="fas fa-star"></i> CREATOR
        </div>
        <div class="creator-header-tools">
          <button class="creator-header-btn" onclick="toggleCreatorSize('mini')" title="Minimize"><i class="fas fa-minus"></i></button>
          <button class="creator-header-btn" onclick="toggleCreatorSize('full')" title="Full"><i class="fas fa-expand"></i></button>
          <button class="creator-header-close" onclick="closeCreatorPanel()"><i class="fas fa-times"></i></button>
        </div>
      </div>
      
      <div class="creator-content">
        <div class="creator-section">
          <div class="creator-section-title">
            <i class="fas fa-comment-dots"></i> FLOAT CHAT
          </div>
          <div class="creator-label">Chat global (max 100 karakter)</div>
          <input class="creator-input" id="cpFloatMsg" placeholder="Pesan float chat..." maxlength="100">
          <button class="creator-btn creator-btn-secondary" onclick="sendCreatorFloatChat()">
            <i class="fas fa-comments"></i> SEND CHAT
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- LEADERBOARD MODAL -->
  <div class="modal" id="modalLeaderboard" onclick="if(event.target==this)this.style.display='none'">
    <div class="leaderboard-sheet">
      <div class="leaderboard-header">
        <div class="leaderboard-title">
          <i class="fas fa-trophy"></i>
          <span>LEADERBOARD TOP 5</span>
        </div>
        <div class="leaderboard-refresh">
          <i class="fas fa-sync-alt"></i>
          <span id="lbRefreshTimer">60s</span>
        </div>
      </div>
      
      <div class="leaderboard-tabs">
        <button class="leaderboard-tab-btn active" onclick="switchLeaderboardTab('followers', this)">
          <i class="fas fa-users"></i> Followers
        </button>
        <button class="leaderboard-tab-btn" onclick="switchLeaderboardTab('tags', this)">
          <i class="fas fa-tags"></i> Tags
        </button>
        <button class="leaderboard-tab-btn" onclick="switchLeaderboardTab('uploads', this)">
          <i class="fas fa-music"></i> Uploads
        </button>
        <button class="leaderboard-tab-btn" onclick="switchLeaderboardTab('execoin', this)">
          <i class="fas fa-coins"></i> ExeCoin
        </button>
      </div>

      <!-- Followers Tab -->
      <div id="lbTabFollowers" class="leaderboard-tab-view active">
        <div class="leaderboard-list" id="lbFollowersList">
          <div class="leaderboard-empty">
            <i class="fas fa-spinner fa-spin" style="font-size:24px;color:#fbbf24;margin-bottom:10px"></i>
            <div>Memuat data...</div>
          </div>
        </div>
      </div>

      <!-- Tags Tab -->
      <div id="lbTabTags" class="leaderboard-tab-view">
        <div class="leaderboard-list" id="lbTagsList">
          <div class="leaderboard-empty">
            <i class="fas fa-spinner fa-spin" style="font-size:24px;color:#fbbf24;margin-bottom:10px"></i>
            <div>Memuat data...</div>
          </div>
        </div>
      </div>

      <!-- Uploads Tab -->
      <div id="lbTabUploads" class="leaderboard-tab-view">
        <div class="leaderboard-list" id="lbUploadsList">
          <div class="leaderboard-empty">
            <i class="fas fa-spinner fa-spin" style="font-size:24px;color:#fbbf24;margin-bottom:10px"></i>
            <div>Memuat data...</div>
          </div>
        </div>
      </div>

      <!-- ExeCoin Tab -->
      <div id="lbTabExecoin" class="leaderboard-tab-view">
        <div class="leaderboard-list" id="lbExecoinList">
          <div class="leaderboard-empty">
            <i class="fas fa-spinner fa-spin" style="font-size:24px;color:#fbbf24;margin-bottom:10px"></i>
            <div>Memuat data...</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tutorial-overlay" id="tutorialOverlay">
    <div class="tutorial-card">
      <button class="close-btn" onclick="closeTutorial()">&times;</button>
      <h3>Tutorial Upload via Top4Top</h3>
      <div class="video-container">
        <iframe id="tutorialVideo" src="https://www.youtube.com/embed/eLNvOj2lFNk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
      <p style="font-size:13px; color:#888; text-align:center">Video oleh: Hexky</p>
    </div>
  </div>

  <div class="modal" id="modalTagSelector" onclick="if(event.target==this)this.style.display='none'">
    <div class="sheet tag-selector-sheet">
      <h3 style="text-align:center; margin-bottom:8px; color:var(--accent); font-family:'Rajdhani',sans-serif; letter-spacing:1px">PILIH TAG</h3>
      <div class="tag-selector-layout">
        <div class="tag-selector-col">
          <div class="tag-section-title">EDIT TAG</div>
          <div id="tagSelectorCurrent" class="tag-current-text"></div>
          <div id="tagSelectorChipGrid" class="tag-chip-grid"></div>
        </div>
        <div class="tag-selector-col">
          <div class="tag-section-title">ALL TAG & CARA DAPET</div>
          <div id="tagSelectorAllInfo" class="tag-meta-list"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ============================================================
    // STORY POPUP FUNCTIONS
    // ============================================================
    function closeStoryPopup() {
      const popup = document.getElementById('storyPopup');
      if (popup) {
        popup.style.animation = 'storyFadeIn 0.3s ease reverse';
        setTimeout(() => {
          popup.classList.add('hidden');
          // Show thank you animation
          showThankYouAnimation();
        }, 300);
      }
    }

    function showThankYouAnimation() {
      const overlay = document.getElementById('thankYouOverlay');
      const sparklesContainer = document.getElementById('sparklesContainer');
      
      if (overlay) {
        overlay.classList.add('show');
        
        // Create sparkles
        if (sparklesContainer) {
          for (let i = 0; i < 30; i++) {
            setTimeout(() => {
              const sparkle = document.createElement('div');
              sparkle.className = 'sparkle';
              sparkle.style.left = Math.random() * 100 + '%';
              sparkle.style.top = 50 + Math.random() * 20 + '%';
              sparkle.style.animationDelay = Math.random() * 0.5 + 's';
              sparklesContainer.appendChild(sparkle);
              
              setTimeout(() => sparkle.remove(), 2500);
            }, i * 50);
          }
        }
        
        // Hide after 3 seconds
        setTimeout(() => {
          overlay.style.animation = 'thankYouFadeIn 0.5s ease reverse';
          setTimeout(() => {
            overlay.classList.remove('show');
            overlay.style.animation = '';
          }, 500);
        }, 3000);
      }
    }

    function toggleImageZoom() {
      const img = document.getElementById('storyImage');
      const wrapper = img?.parentElement;
      if (img && wrapper) {
        img.classList.toggle('zoomed');
        wrapper.classList.toggle('zoomed');
      }
    }

    function showStoryPopup() {
      const popup = document.getElementById('storyPopup');
      if (popup) {
        popup.classList.remove('hidden');
        // Auto close after 15 seconds if user doesn't close manually
        setTimeout(() => {
          if (!popup.classList.contains('hidden')) {
            closeStoryPopup();
          }
        }, 15000);
      }
    }

    const firebaseConfig = {
      apiKey: "AIzaSyCVJYSR4nHeoRA9WTMZa3-2xliKQRrd5g4",
      authDomain: "exemusic-execuriverp.firebaseapp.com",
      databaseURL: "https://exemusic-execuriverp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "exemusic-execuriverp",
      storageBucket: "exemusic-execuriverp.firebasestorage.app",
      messagingSenderId: "722057744401",
      appId: "1:722057744401:web:cd6a6a103692059bda61b0",
      measurementId: "G-2P56Y7QQ18"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    const storage = firebase.storage();

    // ============================================================
    // LOADING SCREEN LOGIC
    // ============================================================
    const loadSteps = [
      { pct: 8, msg: 'INITIALIZING...' },
      { pct: 20, msg: 'CONNECTING DATABASE...' },
      { pct: 38, msg: 'LOADING AUDIO ENGINE...' },
      { pct: 55, msg: 'FETCHING SONGS...' },
      { pct: 72, msg: 'SYNCING PROFILE...' },
      { pct: 88, msg: 'PREPARING UI...' },
      { pct: 100, msg: 'READY!' }
    ];
    let loadIdx = 0;
    function advanceLoader(targetPct, msg) {
      const bar = document.getElementById('loadBarFill');
      const pctEl = document.getElementById('loadPercent');
      const statusEl = document.getElementById('loadStatus');
      if (statusEl) statusEl.textContent = msg;
      if (bar) bar.style.width = targetPct + '%';
      if (pctEl) pctEl.textContent = targetPct + '%';
    }
    function runLoadSequence() {
      let idx = 0;
      function next() {
        if (idx >= loadSteps.length) return;
        const s = loadSteps[idx++];
        advanceLoader(s.pct, s.msg);
        if (idx < loadSteps.length) setTimeout(next, 350 + Math.random() * 200);
      }
      next();
    }
    function dismissLoader() {
      advanceLoader(100, 'READY!');
      setTimeout(() => {
        const screen = document.getElementById('gameLoadScreen');
        if (screen) {
          screen.classList.add('fade-out');
          setTimeout(() => { 
            screen.style.display = 'none';
            // Show story popup after loading completes
            showStoryPopup();
          }, 800);
        }
      }, 400);
    }
    runLoadSequence();

    let heartsInterval = null;
    let heartsMode = 'love';
    let ketupatInterval = null;
    let profileMusicInterval = null;
    let profileMusicDuration = 0;
    let profileMusicElapsed = 0;
    
    function createHeart() {
      const c = document.getElementById('heartsContainer');
      if (!c) return;
      const h = document.createElement('div');
      h.className = 'heart-particle';
      let set = ['❤️','💗','💓','💕','💖','🩷'];
      if (heartsMode === 'game') {
        set = ['🎮','🕹️','🎧','🎲','🎯','💿'];
      }
      h.textContent = set[Math.floor(Math.random() * set.length)];
      h.style.left = Math.random() * 100 + 'vw';
      h.style.fontSize = (10 + Math.random() * 16) + 'px';
      h.style.animationDuration = (4 + Math.random() * 4) + 's';
      h.style.animationDelay = (Math.random() * 1) + 's';
      c.appendChild(h);
      setTimeout(() => h.remove(), 9000);
    }
    function startHearts(mode) {
      const c = document.getElementById('heartsContainer');
      if (!c) return;
      heartsMode = mode || 'love';
      c.classList.add('active');
      if (heartsInterval) return;
      heartsInterval = setInterval(createHeart, 600);
    }
    function stopHearts() {
      const c = document.getElementById('heartsContainer');
      if (c) c.classList.remove('active');
      if (heartsInterval) { clearInterval(heartsInterval); heartsInterval = null; }
    }
    
    function createKetupat() {
      const c = document.getElementById('ketupatContainer');
      if (!c) return;
      const k = document.createElement('div');
      k.className = 'ketupat-particle';
      const ketupatEmojis = ['🎋','🌾','🍃','✨','⭐'];
      k.textContent = ketupatEmojis[Math.floor(Math.random() * ketupatEmojis.length)];
      k.style.left = Math.random() * 100 + 'vw';
      k.style.fontSize = (12 + Math.random() * 18) + 'px';
      k.style.animationDuration = (5 + Math.random() * 5) + 's';
      k.style.animationDelay = (Math.random() * 1) + 's';
      c.appendChild(k);
      setTimeout(() => k.remove(), 11000);
    }
    function startKetupat() {
      const c = document.getElementById('ketupatContainer');
      if (!c) return;
      c.classList.add('active');
      if (ketupatInterval) return;
      ketupatInterval = setInterval(createKetupat, 700);
    }
    function stopKetupat() {
      const c = document.getElementById('ketupatContainer');
      if (c) c.classList.remove('active');
      if (ketupatInterval) { clearInterval(ketupatInterval); ketupatInterval = null; }
    }
    
    // ============================================================
    // HEART CANVAS EFFECT - v3.2.3
    // ============================================================
    let heartInterval = null;
    let heartAnimationId = null;
    
    function initHeartCanvas() {
      var canvas = document.getElementById('heartCanvas');
      if (!canvas) return;
      var ctx = canvas.getContext('2d');
      var width = canvas.width = window.innerWidth;
      var height = canvas.height = window.innerHeight;
      
      var heartPosition = function (rad) {
        return [Math.pow(Math.sin(rad), 3), -(15 * Math.cos(rad) - 5 * Math.cos(2 * rad) - 2 * Math.cos(3 * rad) - Math.cos(4 * rad))];
      };
      var scaleAndTranslate = function (pos, sx, sy, dx, dy) {
        return [dx + pos[0] * sx, dy + pos[1] * sy];
      };
      
      var pointsOrigin = [];
      var i;
      var dr = 0.1;
      for (i = 0; i < Math.PI * 2; i += dr) pointsOrigin.push(scaleAndTranslate(heartPosition(i), 210, 13, 0, 0));
      for (i = 0; i < Math.PI * 2; i += dr) pointsOrigin.push(scaleAndTranslate(heartPosition(i), 150, 9, 0, 0));
      for (i = 0; i < Math.PI * 2; i += dr) pointsOrigin.push(scaleAndTranslate(heartPosition(i), 90, 5, 0, 0));
      var heartPointsCount = pointsOrigin.length;
      
      var targetPoints = [];
      var pulse = function (kx, ky) {
        for (i = 0; i < pointsOrigin.length; i++) {
          targetPoints[i] = [];
          targetPoints[i][0] = kx * pointsOrigin[i][0] + width / 2;
          targetPoints[i][1] = ky * pointsOrigin[i][1] + height / 2;
        }
      };
      
      var e = [];
      for (i = 0; i < heartPointsCount; i++) {
        var x = Math.random() * width;
        var y = Math.random() * height;
        e[i] = {
          vx: 0, vy: 0, R: 2, speed: Math.random() + 5,
          q: ~~(Math.random() * heartPointsCount),
          D: 2 * (i % 2) - 1,
          force: 0.2 * Math.random() + 0.7,
          f: "hsla(0," + ~~(40 * Math.random() + 60) + "%," + ~~(60 * Math.random() + 20) + "%,.3)",
          trace: []
        };
        for (var k = 0; k < 50; k++) e[i].trace[k] = {x: x, y: y};
      }
      
      var config = { traceK: 0.4, timeDelta: 0.01 };
      var time = 0;
      
      var loop = function () {
        var n = -Math.cos(time);
        pulse((1 + n) * .5, (1 + n) * .5);
        time += ((Math.sin(time)) < 0 ? 9 : (n > 0.8) ? .2 : 1) * config.timeDelta;
        ctx.fillStyle = "rgba(0,0,0,.1)";
        ctx.fillRect(0, 0, width, height);
        
        for (i = e.length; i--;) {
          var u = e[i];
          var q = targetPoints[u.q];
          var dx = u.trace[0].x - q[0];
          var dy = u.trace[0].y - q[1];
          var length = Math.sqrt(dx * dx + dy * dy);
          
          if (10 > length) {
            if (0.95 < Math.random()) u.q = ~~(Math.random() * heartPointsCount);
            else {
              if (0.99 < Math.random()) u.D *= -1;
              u.q += u.D;
              u.q %= heartPointsCount;
              if (0 > u.q) u.q += heartPointsCount;
            }
          }
          u.vx += -dx / length * u.speed;
          u.vy += -dy / length * u.speed;
          u.trace[0].x += u.vx;
          u.trace[0].y += u.vy;
          u.vx *= u.force;
          u.vy *= u.force;
          
          for (k = 0; k < u.trace.length - 1;) {
            var T = u.trace[k];
            var N = u.trace[++k];
            N.x -= config.traceK * (N.x - T.x);
            N.y -= config.traceK * (N.y - T.y);
          }
          ctx.fillStyle = u.f;
          for (k = 0; k < u.trace.length; k++) {
            ctx.fillRect(u.trace[k].x, u.trace[k].y, 1, 1);
          }
        }
        
        heartAnimationId = window.requestAnimationFrame(loop, canvas);
      };
      loop();
    }
    
    function startHeartEffect() {
      const c = document.getElementById('heartCanvasContainer');
      if (!c) return;
      c.classList.add('active');
      if (!heartAnimationId) {
        initHeartCanvas();
      }
    }
    
    function stopHeartEffect() {
      const c = document.getElementById('heartCanvasContainer');
      if (c) c.classList.remove('active');
      if (heartAnimationId) {
        window.cancelAnimationFrame(heartAnimationId);
        heartAnimationId = null;
      }
    }
    
    // Toggle Heart Theme (Admin)
    function toggleHeartTheme() {
      const current = document.body.classList.contains('heart-theme-active');
      if (current) {
        document.body.classList.remove('heart-theme-active');
        stopHeartEffect();
        db.ref('settings').update({ heartTheme: false });
        showToast('Heart Theme dinonaktifkan');
      } else {
        document.body.classList.add('heart-theme-active');
        startHeartEffect();
        db.ref('settings').update({ heartTheme: true });
        showToast('Heart Theme diaktifkan! 💕');
      }
    }
    
    // Check and apply heart theme on load
    function checkHeartTheme() {
      db.ref('settings/heartTheme').once('value', snap => {
        if (snap.val() === true) {
          document.body.classList.add('heart-theme-active');
          startHeartEffect();
        }
      });
    }
    
    // ============================================================
    // FIRST TIME TUTORIAL - v3.2.3
    // ============================================================
    function showFirstTimeTutorial() {
      const tutorial = document.getElementById('firstTimeTutorial');
      if (tutorial) tutorial.classList.add('show');
    }
    
    function closeFirstTimeTutorial() {
      const tutorial = document.getElementById('firstTimeTutorial');
      if (tutorial) tutorial.classList.remove('show');
      localStorage.setItem('exeTutorialSeen', '1');
    }
    
    function startProfileMusicCountdown(duration) {
      profileMusicDuration = duration;
      profileMusicElapsed = 0;
      const player = document.getElementById('profileMusicPlayer');
      if (player) player.classList.add('active');
      
      if (profileMusicInterval) clearInterval(profileMusicInterval);
      profileMusicInterval = setInterval(() => {
        profileMusicElapsed++;
        const remaining = profileMusicDuration - profileMusicElapsed;
        const pct = (profileMusicElapsed / profileMusicDuration) * 100;
        
        // Update timer
        const mins = Math.floor(remaining / 60);
        const secs = remaining % 60;
        const timerEl = document.getElementById('pmpTimer');
        if (timerEl) timerEl.textContent = `${mins}:${secs.toString().padStart(2,'0')}`;
        
        // Update ring
        const circle = document.getElementById('pmpCircle');
        const circumference = 138.23;
        const offset = circumference * (1 - (pct / 100));
        if (circle) {
          circle.setAttribute('stroke-dashoffset', offset);
          // Change color based on remaining time
          if (remaining <= 3) {
            circle.setAttribute('stroke', '#ff0050');
            circle.parentElement.classList.add('critical');
          } else if (remaining <= 10) {
            circle.setAttribute('stroke', '#ffcc00');
            circle.parentElement.classList.add('warning');
            circle.parentElement.classList.remove('critical');
          } else {
            circle.setAttribute('stroke', '#ff3333');
            circle.parentElement.classList.remove('warning', 'critical');
          }
        }
        
        if (remaining <= 0) {
          stopProfileMusicCountdown();
        }
      }, 1000);
    }
    
    function stopProfileMusicCountdown() {
      if (profileMusicInterval) {
        clearInterval(profileMusicInterval);
        profileMusicInterval = null;
      }
      const player = document.getElementById('profileMusicPlayer');
      if (player) player.classList.remove('active');
      if (profileAudio) {
        profileAudio.pause();
        profileAudio.currentTime = 0;
      }
    }
    
    function toggleProfileMusic() {
      if (profileAudio && !profileAudio.paused) {
        stopProfileMusicCountdown();
      } else if (profileAudio && profileAudio.src) {
        profileAudio.play();
        // Get duration and start countdown
        profileAudio.addEventListener('loadedmetadata', () => {
          startProfileMusicCountdown(Math.floor(profileAudio.duration));
        }, { once: true });
      }
    }

    // ============================================================
    // STATE
    // ============================================================
    let songs = [], i = 0, isLoginMode = true;
    let repeatMode = parseInt(localStorage.getItem('exeRepeat') || '0');
    let isShuf = localStorage.getItem('exeShuffle') === 'true';
    let fav = JSON.parse(localStorage.getItem('exeFav') || '[]');
    let savedVol = parseFloat(localStorage.getItem('exeVolume') || '0.8');
    let userData = null;
    let profileAudio = null;
    let broadcastTimeout;
    let notifList = [], _globalNotifs = [], _userNotifs = [];
    const lastReadNotifTimeKey = 'exeNotifRead';
    let userCache = {};
    let isFirstTimeUser = false;
    let adAllUsers = [], adAllSongs = [];
    let adminLoaded = false;
    let adminDrag = { active: false, offsetX: 0, offsetY: 0 };
    let adminMode = 'normal';
    let creatorDrag = { active: false, offsetX: 0, offsetY: 0 };
    let creatorMode = 'normal';
    let tagDropInterval = null;
    let tagDropBannerInterval = null;
    let currentTagDrop = null;
    let lastTagDropToastKey = null;
    let lebaranInterval = null;
    let globalCountdownInterval = null;
    let tagUnlockTimeout = null;
    let vipTrialBannerClosed = false;
    let uploadQueueInterval = null;
    let uploadQueueListenerUid = null;
    let uploadCooldownInterval = null;
    let isAdminUnlocked = localStorage.getItem('exeAdminUnlocked') === '1';
    let currentProfileUid = null;
    let adminFloatInterval = null;
    let userQuestState = { daily: {}, weekly: {} };
    let listenDailySeconds = 0;
    let listenWeeklySeconds = 0;
    let lastListenTick = 0;

    const audio = new Audio();
    audio.volume = savedVol;

    // Init UI
    window.addEventListener('DOMContentLoaded', () => {
      const repBtn = document.getElementById('rep');
      if (repBtn) {
        if (repeatMode === 1) {
          repBtn.classList.add('active-btn');
          repBtn.innerHTML = '<i class="fas fa-redo"></i><span style="font-size:7px;position:absolute;top:7px;right:5px;font-weight:bold">1</span>';
        } else if (repeatMode === 2) {
          repBtn.classList.add('active-btn');
        }
      }
      document.getElementById('shuf').classList.toggle('active-btn', isShuf);
      document.getElementById('vol').value = savedVol;
      
      // Close capsule menu when clicking outside - v3.2.3
      document.addEventListener('click', (e) => {
        const capsuleMenu = document.getElementById('capsuleMenuPanel');
        const capsuleBtn = document.getElementById('btnMenu');
        if (capsuleMenu && capsuleBtn) {
          if (!capsuleMenu.contains(e.target) && !capsuleBtn.contains(e.target)) {
            capsuleMenu.classList.remove('show');
          }
        }
      });
    });

    // ============================================================
    // HELPERS
    // ============================================================
    function escapeHtml(text) {
      const d = document.createElement('div'); d.textContent = text; return d.innerHTML;
    }
    function getTagHTML(tag) {
      if (!tag || tag === 'none') return '';
      const t = tag.toLowerCase();
      return `<span class="user-tag tag-${t}">${tag.toUpperCase()}</span>`;
    }
    
    // Admin/Creator Badge System
    function updateAdminBadge(prefix, role, admpanel) {
      const container = document.getElementById(prefix + 'AvatarContainer');
      const badge = document.getElementById(prefix + 'AdminBadge');
      if (!container || !badge) return;
      
      const isAdmin = role === 'admin';
      const isCreator = admpanel === true;
      
      container.classList.remove('has-admin', 'has-creator', 'has-admin-creator');
      badge.classList.remove('admin', 'creator', 'admin-creator');
      
      if (isAdmin && isCreator) {
        container.classList.add('has-admin-creator');
        badge.classList.add('admin-creator');
        badge.innerHTML = '<i class="fas fa-crown"></i>';
        badge.style.display = 'flex';
      } else if (isAdmin) {
        container.classList.add('has-admin');
        badge.classList.add('admin');
        badge.innerHTML = '<i class="fas fa-shield-alt"></i>';
        badge.style.display = 'flex';
      } else if (isCreator) {
        container.classList.add('has-creator');
        badge.classList.add('creator');
        badge.innerHTML = '<i class="fas fa-star"></i>';
        badge.style.display = 'flex';
      } else {
        badge.style.display = 'none';
      }
    }
    
    function buyShopItem(id) {
      if (!auth.currentUser || !userData) {
        msg('Login dulu untuk tukar ExeCoin');
        return;
      }
      const uid = auth.currentUser.uid;
      const items = [
        { id: 'shop_tag_gamers', type: 'tag', tag: 'gamers', price: 100 },
        { id: 'shop_tag_legend', type: 'tag', tag: 'legend', price: 500 },
        { id: 'shop_tag_execurive', type: 'tag', tag: 'execurive', price: 1000 },
        { id: 'shop_vip_3', type: 'vip', days: 3, price: 200 },
        { id: 'shop_vip_7', type: 'vip', days: 7, price: 500 },
        { id: 'shop_vip_30', type: 'vip', days: 30, price: 1200 }
      ];
      const it = items.find(x => x.id === id);
      if (!it) return;
      const coinsRef = db.ref('users/' + uid + '/coins');
      coinsRef.transaction(cur => {
        const base = typeof cur === 'number' ? cur : 0;
        if (base < it.price) return;
        return base - it.price;
      }).then(res => {
        if (!res.committed) {
          showToast('ExeCoin belum cukup');
          return;
        }
        if (it.type === 'tag') {
          const tagLower = String(it.tag || '').toLowerCase();
          const updates = {};
          updates['users/' + uid + '/tag'] = tagLower;
          updates['users/' + uid + '/alltag/' + tagLower] = true;
          db.ref().update(updates).then(() => {
            userData.tag = tagLower;
            if (!userData.alltag) userData.alltag = {};
            userData.alltag[tagLower] = true;
            const tagEl = document.getElementById('pTagDisplay');
            if (tagEl) tagEl.innerHTML = getTagHTML(userData.tag);
            showToast('Tag ' + tagLower.toUpperCase() + ' berhasil ditukar');
            showTagUnlockBanner([tagLower]);
          });
        } else if (it.type === 'vip') {
          const now = Date.now();
          const ms = (it.days || 0) * 24 * 60 * 60 * 1000;
          const expireAt = now + ms;
          db.ref('users/' + uid + '/trialvip').set({ expireAt }).then(() => {
            if (!userData.trialvip) userData.trialvip = {};
            userData.trialvip.expireAt = expireAt;
            showToast('VIP Trial ' + it.days + ' hari aktif');
            updateVipTrialBanner(expireAt);
          });
        }
        return coinsRef.once('value').then(csnap => {
          userData.coins = csnap.val() || 0;
          renderEventCenter();
        });
      });
    }
    function showTagUnlockBanner(tags) {
      const wrap = document.getElementById('tagUnlockBanner');
      const listEl = document.getElementById('tagUnlockTags');
      if (!wrap || !listEl) return;
      listEl.innerHTML = '';
      (tags || []).forEach(raw => {
        const t = String(raw || '').toLowerCase();
        if (!t) return;
        const span = document.createElement('span');
        span.className = 'user-tag tag-' + t;
        span.textContent = t.toUpperCase();
        listEl.appendChild(span);
      });
      wrap.classList.add('show');
      if (tagUnlockTimeout) {
        clearTimeout(tagUnlockTimeout);
        tagUnlockTimeout = null;
      }
      tagUnlockTimeout = setTimeout(() => {
        wrap.classList.remove('show');
      }, 5000);
    }
    function closeTagUnlockBanner() {
      const wrap = document.getElementById('tagUnlockBanner');
      if (wrap) wrap.classList.remove('show');
      if (tagUnlockTimeout) {
        clearTimeout(tagUnlockTimeout);
        tagUnlockTimeout = null;
      }
    }
    function playProfileMusic(url) {
      if (!url) return;
      if (!profileAudio) profileAudio = new Audio();
      if (!audio.paused) {
        audio.pause();
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
        document.getElementById('eq').classList.remove('playing');
      }
      profileAudio.src = url;
      profileAudio.loop = true;
      profileAudio.play().catch(() => {});
    }
    function stopProfileMusic() {
      if (profileAudio) {
        profileAudio.pause();
        profileAudio.currentTime = 0;
      }
    }
    function getVipStatus(u) {
      const now = Date.now();
      if (u && u.vip) return 'permanent';
      if (u && u.trialvip && u.trialvip.expireAt && now < u.trialvip.expireAt) return 'trial';
      return false;
    }
    function computeQuestTags(u, folCount, flgCount) {
      const tags = {};
      tags.user = true;
      const vipType = getVipStatus(u);
      if (vipType) tags.vip = true;
      if (typeof folCount === 'number') {
        if (folCount >= 10) tags.newbie = true;
        if (folCount >= 50) tags.pro = true;
        if (folCount >= 150) { tags.terkeren = true; tags.tersulit = true; }
      }
      return tags;
    }
    function syncUserQuestTags(uid, u, folCount, flgCount) {
      if (!uid || !u) return;
      const quest = computeQuestTags(u, folCount, flgCount);
      const existing = u.alltag || {};
      const merged = {};
      let changed = false;
      let newCount = 0;
      Object.keys(existing).forEach(k => {
        merged[k] = existing[k];
      });
      Object.keys(quest).forEach(k => {
        if (!merged[k]) {
          merged[k] = true;
          changed = true;
          newCount++;
        }
      });
      if (changed) {
        db.ref('users/' + uid + '/alltag').set(merged);
        if (newCount > 0) {
          updateQuestProgress('weekly', 'weekly_new_tags_2', newCount, uid);
        }
      }
    }
    function ensureCurrentTagInAlltag(uid, u) {
      if (!uid || !u) return;
      const t = (u.tag || '').toLowerCase();
      if (!t || t === 'none') return;
      const all = u.alltag || {};
      if (all[t]) return;
      db.ref('users/' + uid + '/alltag/' + t).set(true);
    }
    function setupTagDropWatcher() {
      if (tagDropInterval) {
        clearInterval(tagDropInterval);
        tagDropInterval = null;
      }
      if (tagDropBannerInterval) {
        clearInterval(tagDropBannerInterval);
        tagDropBannerInterval = null;
      }
      const banner = document.getElementById('eventTagBanner');
      const pill = document.getElementById('globalEventPill');
      const pillTime = document.getElementById('globalEventPillTime');
      if (!auth.currentUser || !userData || !currentTagDrop || !currentTagDrop.active || !currentTagDrop.tag || !currentTagDrop.chance) {
        if (banner) banner.classList.remove('show');
        if (pill) {
          pill.classList.remove('show', 'urgent', 'pulse');
        }
        if (pillTime) pillTime.textContent = '--:--';
        updateEventSideFromTagDrop();
        return;
      }
      if (banner) banner.classList.remove('show');
      const eventKey = String(currentTagDrop.tag || '') + '|' + String(currentTagDrop.endAt || 0);
      if (eventKey && lastTagDropToastKey !== eventKey) {
        lastTagDropToastKey = eventKey;
        showToast('🎁 Tag Drop Event has started!', 'event');
        const chancePct = Math.round((currentTagDrop.chance || 0) * 100);
        const tagName = String(currentTagDrop.tag || '').toUpperCase();
        const winnersText = currentTagDrop.maxWinners ? `only ${currentTagDrop.maxWinners} winners` : 'unlimited winners';
        showToast(`tag drop: ${chancePct}% chance, tag: ${tagName}, ${winnersText}`, 'event');
      }
      if (pill && pillTime) {
        const updatePill = () => {
          const now = Date.now();
          const diff = currentTagDrop.endAt ? currentTagDrop.endAt - now : 0;
          if (!currentTagDrop.endAt || diff <= 0) {
            pill.classList.remove('show', 'urgent', 'pulse');
            pillTime.textContent = '0:00';
            if (tagDropBannerInterval) {
              clearInterval(tagDropBannerInterval);
              tagDropBannerInterval = null;
            }
            updateEventSideFromTagDrop();
            return;
          }
          const totalSec = Math.floor(diff / 1000);
          const m = Math.floor(totalSec / 60);
          const s = totalSec % 60;
          pillTime.textContent = `${m}:${String(s).padStart(2, '0')}`;
          pill.classList.add('show', 'pulse');
          if (totalSec <= 10) pill.classList.add('urgent');
          else pill.classList.remove('urgent');
        };
        updatePill();
        tagDropBannerInterval = setInterval(updatePill, 1000);
      }
      updateEventSideFromTagDrop();
      tagDropInterval = setInterval(() => {
        if (!auth.currentUser || !userData || !currentTagDrop || !currentTagDrop.active) return;
        if (currentTagDrop.maxWinners && currentTagDrop.obtainedCount >= currentTagDrop.maxWinners) return;
        if (Math.random() < currentTagDrop.chance) {
          const tag = String(currentTagDrop.tag).toLowerCase();
          const all = userData.alltag || {};
          if (!all[tag]) {
            const updates = {};
            updates['users/' + auth.currentUser.uid + '/alltag/' + tag] = true;
            const countRef = db.ref('settings/tagDrop/obtainedCount');
            countRef.transaction(cur => {
              const base = typeof cur === 'number' ? cur : 0;
              if (currentTagDrop.maxWinners && base >= currentTagDrop.maxWinners) return;
              return base + 1;
            }).then(res => {
              if (!res.committed) return;
              currentTagDrop.obtainedCount = res.snapshot.val() || 0;
              db.ref().update(updates).then(() => {
                showToast('🎉 You won the ' + tag.toUpperCase() + ' tag!', 'success');
                updateQuestProgress('weekly', 'weekly_new_tags_2', 1, auth.currentUser.uid);
                showTagUnlockBanner([tag]);
                const payload = {
                  type: 'event',
                  text: 'Kamu mendapatkan tag ' + tag.toUpperCase() + ' dari event Tag Drop',
                  fromName: 'System',
                  timestamp: Date.now()
                };
                db.ref('users/' + auth.currentUser.uid + '/notifications').push(payload);
              });
            });
          }
        }
      }, 30000);
    }
    function updateUploadCooldownCard() {
      const card = document.getElementById('uploadCdCard');
      const timerEl = document.getElementById('uploadCdTimer');
      const subEl = document.getElementById('uploadCdSub');
      if (!card || !timerEl || !subEl || !userData) return;
      const lastUpload = userData.lastUpload || 0;
      const now = Date.now();
      const vipType = getVipStatus(userData);
      const isAdmin = userData.role === 'admin';
      const cooldown = isAdmin ? 0 : (vipType ? 15 : 30);
      if (!cooldown) {
        card.style.display = 'none';
        return;
      }
      const nextAt = lastUpload + cooldown * 60 * 1000;
      const diffMs = nextAt - now;
      if (diffMs <= 0) {
        card.style.display = 'none';
        return;
      }
      card.style.display = 'block';
      const totalSec = Math.floor(diffMs / 1000);
      const m = String(Math.floor(totalSec / 60)).padStart(2, '0');
      const s = String(totalSec % 60).padStart(2, '0');
      timerEl.textContent = m + ':' + s;
      if (vipType) subEl.textContent = 'VIP cooldown 15 menit';
      else subEl.textContent = 'Non-VIP cooldown 30 menit';
    }
    function startUploadCooldownWatcher() {
      if (uploadCooldownInterval) clearInterval(uploadCooldownInterval);
      updateUploadCooldownCard();
      uploadCooldownInterval = setInterval(updateUploadCooldownCard, 1000);
    }
    function stopUploadCooldownWatcher() {
      if (uploadCooldownInterval) {
        clearInterval(uploadCooldownInterval);
        uploadCooldownInterval = null;
      }
      const card = document.getElementById('uploadCdCard');
      if (card) card.style.display = 'none';
    }
    function closeEventTagBanner() {
      const el = document.getElementById('eventTagBanner');
      if (el) el.classList.remove('show');
    }
    function openEventCenter() {
      const modal = document.getElementById('modalEventCenter');
      if (!auth.currentUser || !userData) {
        msg('Login dulu untuk akses event');
        return;
      }
      if (!modal) return;
      modal.style.display = 'block';
      loadUserQuests().then(() => {
        renderEventCenter();
      });
    }
    function switchEventTab(id, btn) {
      document.querySelectorAll('.event-tab-view').forEach(v => v.classList.remove('active'));
      document.querySelectorAll('.event-tab-btn').forEach(b => b.classList.remove('active'));
      const tabMap = {
        'daily': 'evTabDaily',
        'weekly': 'evTabWeekly',
        'ramadhan': 'evTabRamadhan',
        'shop': 'evTabShop'
      };
      const tab = document.getElementById(tabMap[id] || 'evTabDaily');
      if (tab) tab.classList.add('active');
      if (btn) btn.classList.add('active');
      if (id === 'ramadhan') {
        updateRamadhanProgress();
      }
      renderEventCenter();
    }

    // ============================================================
    // LEADERBOARD SYSTEM - v3.2.3
    // ============================================================
    let leaderboardRefreshInterval = null;
    let leaderboardRefreshCountdown = 60;

    function openLeaderboard() {
      const eventModal = document.getElementById('modalEventCenter');
      const lbModal = document.getElementById('modalLeaderboard');
      
      if (!auth.currentUser || !userData) {
        msg('Login dulu untuk akses leaderboard');
        return;
      }
      
      // Close event center, open leaderboard
      if (eventModal) eventModal.style.display = 'none';
      if (lbModal) lbModal.style.display = 'block';
      
      // Load leaderboard data
      loadLeaderboardData();
      
      // Start refresh timer
      startLeaderboardRefresh();
    }

    function switchLeaderboardTab(category, btn) {
      document.querySelectorAll('.leaderboard-tab-view').forEach(v => v.classList.remove('active'));
      document.querySelectorAll('.leaderboard-tab-btn').forEach(b => b.classList.remove('active'));
      
      const tabMap = {
        'followers': 'lbTabFollowers',
        'tags': 'lbTabTags',
        'uploads': 'lbTabUploads',
        'execoin': 'lbTabExecoin'
      };
      
      const tab = document.getElementById(tabMap[category]);
      if (tab) tab.classList.add('active');
      if (btn) btn.classList.add('active');
    }

    function startLeaderboardRefresh() {
      // Clear existing interval
      if (leaderboardRefreshInterval) {
        clearInterval(leaderboardRefreshInterval);
      }
      
      leaderboardRefreshCountdown = 60;
      const timerEl = document.getElementById('lbRefreshTimer');
      
      leaderboardRefreshInterval = setInterval(() => {
        leaderboardRefreshCountdown--;
        if (timerEl) timerEl.textContent = leaderboardRefreshCountdown + 's';
        
        if (leaderboardRefreshCountdown <= 0) {
          leaderboardRefreshCountdown = 60;
          loadLeaderboardData();
        }
      }, 1000);
    }

    async function loadLeaderboardData() {
      try {
        // Get all users data
        const usersSnapshot = await db.ref('users').once('value');
        
        // Get all songs to count uploads per user
        const songsSnapshot = await db.ref('songs').once('value');
        const uploadCounts = {};
        
        songsSnapshot.forEach(snap => {
          const song = snap.val();
          if (song && song.uid) {
            uploadCounts[song.uid] = (uploadCounts[song.uid] || 0) + 1;
          }
        });
        
        const users = [];
        
        usersSnapshot.forEach(snap => {
          const data = snap.val();
          if (!data || !data.username) return;
          
          const uid = snap.key;
          
          // Count followers
          const followersCount = data.followers 
            ? (Array.isArray(data.followers) ? data.followers.length : Object.keys(data.followers).length)
            : 0;
          
          // Count tags
          const tagsCount = data.alltag 
            ? (Array.isArray(data.alltag) ? data.alltag.length : Object.keys(data.alltag).length)
            : 0;
          
          // Get uploads count from songs collection
          const uploadsCount = uploadCounts[uid] || 0;
          
          // Get execoin
          const execoin = data.coins || 0;
          
          users.push({
            uid: uid,
            username: data.username,
            tag: data.tag || 'user',
            followers: followersCount,
            tags: tagsCount,
            uploads: uploadsCount,
            execoin: execoin
          });
        });
        
        // Render each category
        renderLeaderboardCategory('followers', users, 'lbFollowersList');
        renderLeaderboardCategory('tags', users, 'lbTagsList');
        renderLeaderboardCategory('uploads', users, 'lbUploadsList');
        renderLeaderboardCategory('execoin', users, 'lbExecoinList');
        
      } catch (error) {
        console.error('Error loading leaderboard:', error);
        showToast('Gagal memuat leaderboard');
      }
    }

    function renderLeaderboardCategory(category, users, containerId) {
      const container = document.getElementById(containerId);
      if (!container) return;
      
      // Sort users by category
      const sorted = users.sort((a, b) => b[category] - a[category]).slice(0, 5);
      
      if (sorted.length === 0 || sorted[0][category] === 0) {
        container.innerHTML = `
          <div class="leaderboard-empty">
            <i class="fas fa-trophy" style="font-size:32px;color:#6b7280;margin-bottom:10px;opacity:0.3"></i>
            <div>Belum ada data untuk kategori ini</div>
          </div>
        `;
        return;
      }
      
      const medals = ['🥇', '🥈', '🥉'];
      const rankClasses = ['rank-1', 'rank-2', 'rank-3'];
      
      const labels = {
        followers: 'Followers',
        tags: 'Tags',
        uploads: 'Uploads',
        execoin: 'ExeCoin'
      };
      
      let html = '';
      sorted.forEach((user, index) => {
        const rank = index + 1;
        const rankClass = index < 3 ? rankClasses[index] : '';
        const medal = index < 3 ? medals[index] : '';
        const isCurrentUser = auth.currentUser && user.uid === auth.currentUser.uid;
        
        html += `
          <div class="leaderboard-item ${rankClass}" style="animation-delay: ${index * 0.1}s">
            <div class="leaderboard-rank">
              ${medal || `<div class="leaderboard-rank-number">${rank}</div>`}
            </div>
            <div class="leaderboard-user">
              <div class="leaderboard-username">
                ${user.username}
                ${isCurrentUser ? '<i class="fas fa-star" style="color:#fbbf24;font-size:10px"></i>' : ''}
                <span class="user-tag tag-${user.tag}">${user.tag.toUpperCase()}</span>
              </div>
              <div class="leaderboard-stats">
                <span>Rank #${rank}</span>
                ${isCurrentUser ? '<span style="color:#fbbf24">• You</span>' : ''}
              </div>
            </div>
            <div class="leaderboard-value">
              <div class="leaderboard-value-number">${user[category].toLocaleString()}</div>
              <div class="leaderboard-value-label">${labels[category]}</div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // ============================================================
    // PROFILE RANKING BADGE - v3.2.3
    // ============================================================
    async function updateProfileRankingBadge(uid) {
      const profHeader = document.getElementById('profileHeader');
      if (!profHeader || !uid) return;
      
      // Remove existing badge
      const existingBadge = profHeader.querySelector('.mp-ranking-badge');
      if (existingBadge) existingBadge.remove();
      
      try {
        // Get all users data
        const usersSnapshot = await db.ref('users').once('value');
        
        // Get all songs to count uploads per user
        const songsSnapshot = await db.ref('songs').once('value');
        const uploadCounts = {};
        
        songsSnapshot.forEach(snap => {
          const song = snap.val();
          if (song && song.uid) {
            uploadCounts[song.uid] = (uploadCounts[song.uid] || 0) + 1;
          }
        });
        
        const allUsers = [];
        
        usersSnapshot.forEach(snap => {
          const u = snap.val();
          if (!u) return;
          const followers = u.followers ? Object.keys(u.followers).length : 0;
          const tags = u.alltag ? Object.keys(u.alltag).length : 0;
          const uploads = uploadCounts[snap.key] || 0;
          const execoin = u.coins || 0;
          allUsers.push({
            uid: snap.key,
            username: u.username || 'User',
            followers,
            tags,
            uploads,
            execoin
          });
        });
        
        // Check ranking in each category
        const categories = ['followers', 'tags', 'uploads', 'execoin'];
        let bestRank = null;
        let bestCategory = null;
        
        categories.forEach(cat => {
          const sorted = allUsers.sort((a, b) => b[cat] - a[cat]);
          const rank = sorted.findIndex(u => u.uid === uid) + 1;
          if (rank > 0 && rank <= 5) {
            if (!bestRank || rank < bestRank) {
              bestRank = rank;
              bestCategory = cat;
            }
          }
        });
        
        // If user is in top 5, show badge
        if (bestRank && bestCategory) {
          const categoryLabels = {
            followers: 'Followers',
            tags: 'Tags',
            uploads: 'Uploads',
            execoin: 'ExeCoin'
          };
          
          const badge = document.createElement('div');
          badge.className = `mp-ranking-badge rank-${bestRank}`;
          badge.innerHTML = `
            <span class="mp-ranking-icon">🔥</span>
            <span class="mp-ranking-text">#${bestRank} ${categoryLabels[bestCategory]}</span>
          `;
          profHeader.appendChild(badge);
        }
      } catch (err) {
        console.error('Error loading ranking badge:', err);
      }
    }

    // Close leaderboard when modal closes
    document.addEventListener('DOMContentLoaded', () => {
      const lbModal = document.getElementById('modalLeaderboard');
      if (lbModal) {
        lbModal.addEventListener('click', (e) => {
          if (e.target === lbModal) {
            if (leaderboardRefreshInterval) {
              clearInterval(leaderboardRefreshInterval);
              leaderboardRefreshInterval = null;
            }
          }
        });
      }
    });

    // ============================================================
    // CREATOR PANEL V2 - v3.2.3
    // ============================================================
    function openCreatorPanel() {
      const overlay = document.getElementById('creatorPanelOverlay');
      const inner = document.getElementById('creatorPanelInner');
      if (!auth.currentUser || !userData) {
        showToast('Login dulu untuk akses creator panel');
        return;
      }
      if (!userData.admpanel) {
        showToast('Kamu tidak punya akses ke Creator Panel');
        return;
      }
      if (overlay) {
        overlay.classList.add('show');
        if (inner) { inner.style.display = 'flex'; }
      }
    }

    function closeCreatorPanel() {
      const overlay = document.getElementById('creatorPanelOverlay');
      const inner = document.getElementById('creatorPanelInner');
      if (!overlay || !inner) return;
      overlay.classList.remove('show');
      inner.style.display = 'none';
      creatorMode = 'normal';
      inner.classList.remove('creator-full', 'creator-mini');
      overlay.classList.remove('creator-overlay-mini');
      inner.style.position = '';
      inner.style.top = '';
      inner.style.left = '';
      inner.style.right = '';
      inner.style.bottom = '';
    }

    function startCreatorDrag(e) {
      const panel = document.getElementById('creatorPanelInner');
      if (!panel || creatorMode === 'full') return;
      if (e.target.closest('button')) return;
      creatorDrag.active = true;
      const rect = panel.getBoundingClientRect();
      creatorDrag.offsetX = e.clientX - rect.left;
      creatorDrag.offsetY = e.clientY - rect.top;
      document.addEventListener('mousemove', onCreatorDrag);
      document.addEventListener('mouseup', stopCreatorDrag);
    }
    function startCreatorDragTouch(e) {
      const panel = document.getElementById('creatorPanelInner');
      if (!panel || creatorMode === 'full') return;
      if (e.target.closest('button')) return;
      const touch = e.touches[0];
      creatorDrag.active = true;
      const rect = panel.getBoundingClientRect();
      creatorDrag.offsetX = touch.clientX - rect.left;
      creatorDrag.offsetY = touch.clientY - rect.top;
      document.addEventListener('touchmove', onCreatorDragTouch, { passive: false });
      document.addEventListener('touchend', stopCreatorDragTouch);
    }
    function onCreatorDrag(e) {
      if (!creatorDrag.active) return;
      const panel = document.getElementById('creatorPanelInner');
      if (!panel) return;
      panel.style.position = 'fixed';
      panel.style.top = (e.clientY - creatorDrag.offsetY) + 'px';
      panel.style.left = (e.clientX - creatorDrag.offsetX) + 'px';
      panel.style.right = 'auto';
      panel.style.bottom = 'auto';
    }
    function onCreatorDragTouch(e) {
      if (!creatorDrag.active) return;
      e.preventDefault();
      const touch = e.touches[0];
      const panel = document.getElementById('creatorPanelInner');
      if (!panel) return;
      panel.style.position = 'fixed';
      panel.style.top = (touch.clientY - creatorDrag.offsetY) + 'px';
      panel.style.left = (touch.clientX - creatorDrag.offsetX) + 'px';
      panel.style.right = 'auto';
      panel.style.bottom = 'auto';
    }
    function stopCreatorDrag() {
      creatorDrag.active = false;
      document.removeEventListener('mousemove', onCreatorDrag);
      document.removeEventListener('mouseup', stopCreatorDrag);
    }
    function stopCreatorDragTouch() {
      creatorDrag.active = false;
      document.removeEventListener('touchmove', onCreatorDragTouch);
      document.removeEventListener('touchend', stopCreatorDragTouch);
    }
    function toggleCreatorSize(mode) {
      const overlay = document.getElementById('creatorPanelOverlay');
      const panel = document.getElementById('creatorPanelInner');
      if (!overlay || !panel) return;
      if (mode === 'full') {
        creatorMode = creatorMode === 'full' ? 'normal' : 'full';
      } else if (mode === 'mini') {
        creatorMode = creatorMode === 'mini' ? 'normal' : 'mini';
      }
      panel.classList.remove('creator-full', 'creator-mini');
      overlay.classList.remove('creator-overlay-mini');
      if (creatorMode === 'full') {
        panel.classList.add('creator-full');
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      } else if (creatorMode === 'mini') {
        panel.classList.add('creator-mini');
        overlay.classList.add('creator-overlay-mini');
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      } else {
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      }
    }

    async function sendCreatorBroadcast() {
      const msgText = document.getElementById('cpBroadcastMsg').value.trim();
      if (!msgText) {
        showToast('Tulis pesan dulu!');
        return;
      }
      
      try {
        // Send to broadcast collection (same as admin panel)
        await db.ref('broadcast').set({
          message: msgText,
          from: userData.username,
          timestamp: Date.now(),
          type: 'creator'
        });
        
        showToast('✅ Broadcast terkirim ke semua user!', 'success');
        document.getElementById('cpBroadcastMsg').value = '';
      } catch (error) {
        showToast('Gagal kirim broadcast');
        console.error(error);
      }
    }

    async function sendCreatorFloatChat() {
      const msgText = document.getElementById('cpFloatMsg').value.trim();
      if (!msgText) {
        showToast('Tulis pesan dulu!');
        return;
      }
      
      try {
        const now = Date.now();
        const data = {
          name: userData.username || 'Creator',
          msg: msgText,
          createdAt: now,
          expireAt: now + 15000 // 15 seconds for creator panel
        };
        
        console.log('Creator Panel sending:', data);
        
        // Send to adminFloatChat/current (same path as admin panel)
        await db.ref('adminFloatChat/current').set(data);
        
        showToast('✅ Float chat terkirim!', 'success');
        document.getElementById('cpFloatMsg').value = '';
      } catch (error) {
        showToast('Gagal kirim float chat');
        console.error(error);
      }
    }

    async function spawnRainCoins() {
      try {
        // Create notification for all users
        const notifData = {
          type: 'system',
          title: '💰 RAIN COINS EVENT!',
          message: `${userData.username} spawned Rain Coins! Semua user dapat 50 ExeCoin gratis!`,
          timestamp: Date.now(),
          icon: 'coins'
        };
        
        await db.ref('globalNotifications').push(notifData);
        
        // Give 50 execoin to all users
        const usersSnap = await db.ref('users').once('value');
        const updates = {};
        
        usersSnap.forEach(snap => {
          const uid = snap.key;
          const currentExecoin = snap.val().execoin || 0;
          updates[`users/${uid}/execoin`] = currentExecoin + 50;
          updates[`users/${uid}/notifications/${Date.now()}_${uid}`] = {
            type: 'system',
            text: '💰 Rain Coins Event! Kamu dapat 50 ExeCoin gratis!',
            fromName: 'CREATOR',
            timestamp: Date.now()
          };
        });
        
        await db.ref().update(updates);
        
        showToast('🎉 Rain Coins event spawned! Semua user dapat 50 ExeCoin!', 'success');
      } catch (error) {
        showToast('Gagal spawn event');
        console.error(error);
      }
    }

    async function spawnBonusExecoin() {
      try {
        const notifData = {
          type: 'system',
          title: '💎 BONUS EXECOIN EVENT!',
          message: `${userData.username} activated Bonus ExeCoin! Upload lagu sekarang dapat 2x ExeCoin!`,
          timestamp: Date.now(),
          icon: 'gem'
        };
        
        await db.ref('globalNotifications').push(notifData);
        
        // Set bonus multiplier in settings
        await db.ref('settings/bonusExecoin').set({
          active: true,
          multiplier: 2,
          startTime: Date.now(),
          duration: 3600000, // 1 hour
          createdBy: userData.username
        });
        
        showToast('🎉 Bonus ExeCoin event spawned! Upload dapat 2x ExeCoin selama 1 jam!', 'success');
      } catch (error) {
        showToast('Gagal spawn event');
        console.error(error);
      }
    }

    async function spawnDoubleXP() {
      try {
        const notifData = {
          type: 'system',
          title: '🔥 DOUBLE XP EVENT!',
          message: `${userData.username} activated Double XP! Semua quest memberikan 2x reward selama 1 jam!`,
          timestamp: Date.now(),
          icon: 'fire'
        };
        
        await db.ref('globalNotifications').push(notifData);
        
        // Set double XP in settings
        await db.ref('settings/doubleXP').set({
          active: true,
          multiplier: 2,
          startTime: Date.now(),
          duration: 3600000, // 1 hour
          createdBy: userData.username
        });
        
        showToast('🎉 Double XP event spawned! Quest dapat 2x reward selama 1 jam!', 'success');
      } catch (error) {
        showToast('Gagal spawn event');
        console.error(error);
      }
    }

    async function spawnLuckyDraw() {
      try {
        const usersSnap = await db.ref('users').once('value');
        const allUsers = [];
        
        usersSnap.forEach(snap => {
          allUsers.push({
            uid: snap.key,
            username: snap.val().username,
            execoin: snap.val().execoin || 0
          });
        });
        
        // Shuffle and pick 10 random winners
        const shuffled = allUsers.sort(() => 0.5 - Math.random());
        const winners = shuffled.slice(0, 10);
        
        const updates = {};
        const winnerNames = [];
        
        winners.forEach(winner => {
          updates[`users/${winner.uid}/execoin`] = winner.execoin + 500;
          updates[`users/${winner.uid}/notifications/${Date.now()}_${winner.uid}`] = {
            type: 'system',
            text: '🎲 SELAMAT! Kamu menang Lucky Draw dan dapat 500 ExeCoin!',
            fromName: 'CREATOR',
            timestamp: Date.now()
          };
          winnerNames.push(winner.username);
        });
        
        await db.ref().update(updates);
        
        // Send global notification
        const notifData = {
          type: 'system',
          title: '🎲 LUCKY DRAW EVENT!',
          message: `${userData.username} spawned Lucky Draw! 10 user beruntung dapat 500 ExeCoin! Winners: ${winnerNames.slice(0, 3).join(', ')}...`,
          timestamp: Date.now(),
          icon: 'dice'
        };
        
        await db.ref('globalNotifications').push(notifData);
        
        showToast(`🎉 Lucky Draw spawned! 10 winners: ${winnerNames.slice(0, 3).join(', ')}...`, 'success');
      } catch (error) {
        showToast('Gagal spawn event');
        console.error(error);
      }
    }

    async function giveCreatorReward() {
      const username = document.getElementById('cpRewardUsername').value.trim();
      const amount = parseInt(document.getElementById('cpRewardAmount').value) || 0;
      
      if (!username) {
        showToast('Masukkan username!');
        return;
      }
      
      if (amount <= 0) {
        showToast('Jumlah harus lebih dari 0!');
        return;
      }
      
      try {
        // Find user by username
        const usersSnap = await db.ref('users').orderByChild('username').equalTo(username).once('value');
        
        if (!usersSnap.exists()) {
          showToast('User tidak ditemukan!');
          return;
        }
        
        let targetUid = null;
        usersSnap.forEach(snap => {
          targetUid = snap.key;
        });
        
        if (!targetUid) {
          showToast('User tidak ditemukan!');
          return;
        }
        
        // Get current execoin
        const userSnap = await db.ref('users/' + targetUid).once('value');
        const currentExecoin = userSnap.val().execoin || 0;
        
        // Give reward
        await db.ref('users/' + targetUid).update({
          execoin: currentExecoin + amount
        });
        
        // Send notification
        await db.ref('users/' + targetUid + '/notifications').push({
          type: 'system',
          text: `🎁 Kamu dapat ${amount} ExeCoin dari Creator ${userData.username}!`,
          fromName: 'CREATOR',
          timestamp: Date.now()
        });
        
        showToast(`✅ Berhasil kirim ${amount} ExeCoin ke ${username}!`, 'success');
        document.getElementById('cpRewardUsername').value = '';
      } catch (error) {
        showToast('Gagal memberikan reward');
        console.error(error);
      }
    }
    function applyProfileUrl(push = false) {
      try {
        const base = window.location.protocol + '//' + window.location.host + window.location.pathname;
        let newUrl;
        if (currentProfileUid) newUrl = base + '?profile_userid=' + encodeURIComponent(currentProfileUid);
        else newUrl = base + '?id=' + i;
        if (push) window.history.pushState({ path: newUrl }, '', newUrl);
        else window.history.replaceState({ path: newUrl }, '', newUrl);
      } catch (e) {}
    }
    function fmt(s) { if (isNaN(s)) return '0:00'; let m = Math.floor(s / 60), sec = Math.floor(s % 60); return m + ':' + (sec < 10 ? '0' + sec : sec); }
    function addLog(msg) { db.ref('logs').push({ msg, time: new Date().toLocaleTimeString() }); }

    function renderEventCenter() {
      if (!auth.currentUser || !userData) return;
      const coinsEl = document.getElementById('evCoinBalance');
      if (coinsEl) coinsEl.textContent = String(userData.coins || 0);
      const dailyEl = document.getElementById('evDailyList');
      const weeklyEl = document.getElementById('evWeeklyList');
      const shopEl = document.getElementById('evShopList');
      if (dailyEl) dailyEl.innerHTML = buildDailyQuestsHtml();
      if (weeklyEl) weeklyEl.innerHTML = buildWeeklyQuestsHtml();
      if (shopEl) shopEl.innerHTML = buildShopHtml();
      updateEventSideFromTagDrop();
    }
    function getDailyKey() {
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth() + 1).padStart(2, '0');
      const day = String(d.getDate()).padStart(2, '0');
      return y + '-' + m + '-' + day;
    }
    function getWeeklyKey() {
      const d = new Date();
      const onejan = new Date(d.getFullYear(), 0, 1);
      const week = Math.ceil((((d - onejan) / 86400000) + onejan.getDay() + 1) / 7);
      return d.getFullYear() + '-w' + String(week).padStart(2, '0');
    }
    function loadUserQuests() {
      if (!auth.currentUser) return Promise.resolve();
      return db.ref('userQuests/' + auth.currentUser.uid).once('value').then(snap => {
        const val = snap.val() || {};
        userQuestState.daily = val.daily || {};
        userQuestState.weekly = val.weekly || {};
        listenDailySeconds = 0;
        listenWeeklySeconds = 0;
        lastListenTick = 0;
      }).catch(() => {
        userQuestState = { daily: {}, weekly: {} };
        listenDailySeconds = 0;
        listenWeeklySeconds = 0;
        lastListenTick = 0;
      });
    }
   function buildDailyQuestsHtml() {
    const defs = [
      { id: 'daily_first_upload', title: 'First Upload', desc: 'Upload 1 music', reward: 5, max: 1, type: 'daily', enabled: true },
      { id: 'daily_music_producer', title: 'Music Producer', desc: 'Upload 5 music', reward: 10, max: 5, type: 'daily', enabled: true },
      { id: 'daily_top_listener_1', title: 'Top Listener I', desc: 'Dengarkan musik 30 menit', reward: 5, max: 30, type: 'daily', enabled: true },
      { id: 'daily_follower_boost', title: 'Follower Boost', desc: 'Dapatkan 5 followers', reward: 5, max: 5, type: 'daily', enabled: true }
    ];
      const key = getDailyKey();
      return defs.map(def => {
        const st = (userQuestState.daily && userQuestState.daily[def.id]) || {};
        const samePeriod = st.periodKey === key;
        const cur = samePeriod ? (st.cur || 0) : 0;
        const claimed = samePeriod && !!st.claimed;
        return renderQuestCard({
          id: def.id,
          title: def.title,
          desc: def.desc,
          reward: def.reward,
          max: def.max,
          cur,
          claimed,
          type: def.type,
          enabled: def.enabled
        });
      }).join('');
    }
  function buildWeeklyQuestsHtml() {
    const defs = [
      { id: 'weekly_social_hunter', title: 'Social Hunter', desc: 'Follow 2 url creator', reward: 25, max: 2, type: 'weekly', enabled: true },
      { id: 'weekly_top_listener_2', title: 'Top Listener II', desc: 'Dengarkan musik 2 jam total', reward: 25, max: 120, type: 'weekly', enabled: true },
      { id: 'weekly_followers_20', title: 'Rising Followers', desc: 'Dapatkan 20 followers', reward: 50, max: 20, type: 'weekly', enabled: true },
      { id: 'weekly_followers_50', title: 'Popular Creator', desc: 'Dapatkan 50 followers', reward: 100, max: 50, type: 'weekly', enabled: true },
      { id: 'weekly_new_tags_2', title: 'Tag Collector', desc: 'Dapatkan 2 tag baru', reward: 50, max: 2, type: 'weekly', enabled: true },
      { id: 'weekly_active_creator', title: 'Active Creator', desc: 'Upload 10 music', reward: 50, max: 10, type: 'weekly', enabled: true },
      { id: 'weekly_ultra_uploader', title: 'Ultra Uploader', desc: 'Upload 20 music', reward: 120, max: 20, type: 'weekly', enabled: true }
    ];
      const key = getWeeklyKey();
      return defs.map(def => {
        const st = (userQuestState.weekly && userQuestState.weekly[def.id]) || {};
        const samePeriod = st.periodKey === key;
        const cur = samePeriod ? (st.cur || 0) : 0;
        const claimed = samePeriod && !!st.claimed;
        return renderQuestCard({
          id: def.id,
          title: def.title,
          desc: def.desc,
          reward: def.reward,
          max: def.max,
          cur,
          claimed,
          type: def.type,
          enabled: def.enabled
        });
      }).join('');
    }
    function buildShopHtml() {
      const tags = [
        { id: 'shop_tag_gamers', title: 'Tag [GAMERS]', desc: 'Profile dark + aksen neon green', price: 100, badge: 'Tag ExeCoin' },
        { id: 'shop_tag_legend', title: 'Tag [LEGEND]', desc: 'Nama glow + border emas', price: 500, badge: 'Tag Premium' },
        { id: 'shop_tag_execurive', title: 'Tag [EXECUrIVE]', desc: 'Boost visibility dan akses VIP', price: 1000, badge: 'Tag Ultra' }
      ];
      const vips = [
        { id: 'shop_vip_3', title: 'VIP 3 Hari', desc: 'Akses VIP sementara', price: 200, badge: 'VIP Bronze' },
        { id: 'shop_vip_7', title: 'VIP 7 Hari', desc: 'Durasi VIP lebih lama', price: 500, badge: 'VIP Silver' },
        { id: 'shop_vip_30', title: 'VIP 30 Hari', desc: 'Paket VIP bulanan', price: 1200, badge: 'VIP Gold' }
      ];
      const renderItem = it => {
        const coins = userData.coins || 0;
        const progressText = coins + '/' + it.price;
        const pct = Math.max(0, Math.min(1, coins / it.price));
        const canBuy = coins >= it.price;
        const btnAttrs = canBuy ? ('onclick="buyShopItem(\'' + it.id + '\')"') : 'disabled';
        const btnLabel = canBuy ? 'Tukar sekarang' : 'Coin belum cukup';
        return '<div class="event-shop-card">' +
          '<div class="event-shop-main">' +
            '<div class="event-shop-title-row">' +
              '<div class="event-shop-title">' + escapeHtml(it.title) + '</div>' +
              '<div class="event-shop-price"><i class="fas fa-coins"></i>' + it.price + '</div>' +
            '</div>' +
            '<div class="event-shop-desc">' + escapeHtml(it.desc) + '</div>' +
            '<div class="event-shop-progress-wrap">' +
              '<div class="event-shop-progress-bar"><div class="event-shop-progress-fill" style="transform:scaleX(' + pct + ')"></div></div>' +
              '<div class="event-shop-progress-text">' + escapeHtml(progressText) + '</div>' +
            '</div>' +
          '</div>' +
          '<div class="event-shop-action">' +
            '<div class="event-shop-badge">' + escapeHtml(it.badge) + '</div>' +
            '<button class="event-shop-btn" ' + btnAttrs + '>' + escapeHtml(btnLabel) + '</button>' +
          '</div>' +
        '</div>';
      };
      let html = '';
      html += '<div class="event-shop-section">' +
                '<div class="event-shop-section-title">Tag Eksklusif</div>' +
                '<div class="event-shop-list">' +
                  tags.map(renderItem).join('') +
                '</div>' +
              '</div>';
      html += '<div class="event-shop-section">' +
                '<div class="event-shop-section-title">Paket VIP</div>' +
                '<div class="event-shop-list">' +
                  vips.map(renderItem).join('') +
                '</div>' +
              '</div>';
      return html;
    }
  function getQuestDef(type, id) {
    if (type === 'daily') {
      if (id === 'daily_first_upload') return { id, type, title: 'First Upload', reward: 5, max: 1, enabled: true };
      if (id === 'daily_music_producer') return { id, type, title: 'Music Producer', reward: 10, max: 5, enabled: true };
      if (id === 'daily_top_listener_1') return { id, type, title: 'Top Listener I', reward: 5, max: 30, enabled: true };
      if (id === 'daily_follower_boost') return { id, type, title: 'Follower Boost', reward: 5, max: 5, enabled: true };
    } else if (type === 'weekly') {
      if (id === 'weekly_social_hunter') return { id, type, title: 'Social Hunter', reward: 25, max: 2, enabled: true };
      if (id === 'weekly_top_listener_2') return { id, type, title: 'Top Listener II', reward: 25, max: 120, enabled: true };
      if (id === 'weekly_followers_20') return { id, type, title: 'Rising Followers', reward: 50, max: 20, enabled: true };
      if (id === 'weekly_followers_50') return { id, type, title: 'Popular Creator', reward: 100, max: 50, enabled: true };
      if (id === 'weekly_new_tags_2') return { id, type, title: 'Tag Collector', reward: 50, max: 2, enabled: true };
      if (id === 'weekly_active_creator') return { id, type, title: 'Active Creator', reward: 50, max: 10, enabled: true };
      if (id === 'weekly_ultra_uploader') return { id, type, title: 'Ultra Uploader', reward: 120, max: 20, enabled: true };
    }
    return null;
  }
    function updateQuestProgress(type, id, delta, uidOverride) {
      if (!auth || !auth.currentUser || !delta) return;
      const def = getQuestDef(type, id);
      if (!def || def.enabled === false) return;
      const uid = uidOverride || auth.currentUser.uid;
      const periodKey = type === 'daily' ? getDailyKey() : getWeeklyKey();
      const ref = db.ref('userQuests/' + uid + '/' + type + '/' + id);
      return ref.transaction(cur => {
        if (!cur || cur.periodKey !== periodKey) {
          const curVal = Math.min(delta, def.max);
          return { periodKey, cur: curVal, claimed: false };
        }
        const curVal = cur.cur || 0;
        const nextVal = Math.min(curVal + delta, def.max);
        if (nextVal === curVal) return cur;
        
        // Check if quest just completed
        if (curVal < def.max && nextVal >= def.max) {
          // Quest completed! Show toast
          const questNames = {
            'daily_first_upload': 'First Upload',
            'daily_music_producer': 'Music Producer',
            'daily_listener': 'Active Listener',
            'weekly_active_creator': 'Active Creator',
            'weekly_social_butterfly': 'Social Butterfly',
            'weekly_music_explorer': 'Music Explorer'
          };
          const name = questNames[id] || id;
          const typeLabel = type === 'daily' ? 'Harian' : 'Mingguan';
          showToast(`[Misi ${typeLabel}] ${name} Selesai! 🎉`, 'success');
        }
        
        return { ...cur, cur: nextVal };
      }).then(res => {
        if (!res.committed) return;
        if (uid === (auth.currentUser && auth.currentUser.uid)) {
          if (!userQuestState[type]) userQuestState[type] = {};
          userQuestState[type][id] = res.snapshot.val() || {};
        }
      }).catch(() => {});
    }
    function grantCoins(uid, amount) {
      if (!uid || !amount || amount <= 0) return Promise.resolve();
      let remaining = amount;
      const step = () => {
        if (remaining <= 0) return Promise.resolve();
        const chunk = remaining > 10 ? 10 : remaining;
        remaining -= chunk;
        const ref = db.ref('users/' + uid + '/coins');
        return ref.transaction(cur => {
          const base = typeof cur === 'number' ? cur : 0;
          return base + chunk;
        }).then(res => {
          if (!res.committed) {
            remaining += chunk;
            return Promise.resolve();
          }
          return step();
        });
      };
      return step();
    }
    function claimQuest(type, id) {
      if (!auth || !auth.currentUser || !userData) return msg('Login dulu!');
      const def = getQuestDef(type, id);
      if (!def) return;
      if (def.enabled === false) { showToast('Quest belum aktif'); return; }
      const uid = auth.currentUser.uid;
      const periodKey = type === 'daily' ? getDailyKey() : getWeeklyKey();
      const ref = db.ref('userQuests/' + uid + '/' + type + '/' + id);
      ref.once('value').then(snap => {
        const st = snap.val() || {};
        if (st.periodKey !== periodKey) { showToast('Quest sudah reset'); return; }
        const cur = st.cur || 0;
        if (cur < def.max) { showToast('Progress belum penuh'); return; }
        if (st.claimed) { showToast('Quest sudah diklaim'); return; }
        return grantCoins(uid, def.reward).then(() => {
          return ref.update({ claimed: true, claimedAt: Date.now(), periodKey, cur });
        }).then(() => {
          return db.ref('users/' + uid + '/coins').once('value');
        }).then(csnap => {
          const newCoins = csnap.val() || 0;
          userData.coins = newCoins;
          if (!userQuestState[type]) userQuestState[type] = {};
          userQuestState[type][id] = { periodKey, cur, claimed: true };
          renderEventCenter();
          const iconEl = document.querySelector('.event-coins-icon');
          if (iconEl) {
            iconEl.classList.add('gain');
            setTimeout(() => iconEl.classList.remove('gain'), 600);
          }
          showToast('Kamu mendapatkan ' + def.reward + ' ExeCoin dari quest ' + def.title);
        });
      }).catch(() => {
        showToast('Gagal klaim quest');
      });
    }
    function renderQuestCard(q) {
      const pct = Math.max(0, Math.min(1, q.max ? (q.cur || 0) / q.max : 0));
      const progressText = (q.cur || 0) + '/' + q.max;
      const completed = (q.cur || 0) >= q.max;
      const claimed = !!q.claimed;
      const enabled = q.enabled !== false;
      let badgeText = 'Berjalan';
      if (!enabled) badgeText = 'Segera hadir';
      else if (claimed) badgeText = 'Selesai';
      else if (completed) badgeText = 'Siap diklaim';
      let btnLabel = 'Progress ' + progressText;
      let btnAttrs = 'disabled';
      if (!enabled) {
        btnLabel = 'Belum tersedia';
      } else if (claimed) {
        btnLabel = 'Sudah diklaim';
      } else if (completed) {
        btnLabel = 'Klaim ' + q.reward + ' ExeCoin';
        btnAttrs = 'onclick="claimQuest(\'' + q.type + '\', \'' + q.id + '\')"';
      }
      return '<div class="event-quest-card">' +
        '<div class="event-quest-main">' +
          '<div class="event-quest-title-row">' +
            '<div class="event-quest-title">' + escapeHtml(q.title) + '</div>' +
            '<div class="event-quest-reward"><i class="fas fa-coins"></i>' + q.reward + '</div>' +
          '</div>' +
          '<div class="event-quest-desc">' + escapeHtml(q.desc) + '</div>' +
        '</div>' +
        '<div class="event-quest-progress-wrap">' +
          '<div class="event-quest-progress-bar"><div class="event-quest-progress-fill" style="transform:scaleX(' + pct + ')"></div></div>' +
          '<div class="event-quest-progress-text">' + escapeHtml(progressText) + '</div>' +
        '</div>' +
        '<div class="event-quest-action">' +
          '<div class="event-quest-badge">' + escapeHtml(badgeText) + '</div>' +
          '<button class="event-quest-btn secondary" ' + btnAttrs + '>' + escapeHtml(btnLabel) + '</button>' +
        '</div>' +
      '</div>';
    }
    function updateEventSideFromTagDrop() {
      const mainEl = document.getElementById('evTagDropMain');
      const subEl = document.getElementById('evTagDropSub');
      const timerEl = document.getElementById('evTagDropTimer');
      if (!mainEl || !subEl || !timerEl) return;
      if (!currentTagDrop || !currentTagDrop.active) {
        mainEl.textContent = 'Tidak ada event tag drop aktif';
        subEl.textContent = 'Tunggu admin mengaktifkan event.';
        timerEl.textContent = '--:--';
        return;
      }
      mainEl.textContent = 'TAG DROP: ' + String(currentTagDrop.tag || '').toUpperCase();
      subEl.textContent = currentTagDrop.desc || 'Tag spesial lagi drop untuk user online!';
      if (currentTagDrop.endAt) {
        const diff = currentTagDrop.endAt - Date.now();
        if (diff <= 0) {
          timerEl.textContent = 'EVENT SELESAI';
        } else {
          const totalSec = Math.floor(diff / 1000);
          const m = String(Math.floor(totalSec / 60)).padStart(2, '0');
          const s = String(totalSec % 60).padStart(2, '0');
          timerEl.textContent = m + ':' + s;
        }
      } else {
        timerEl.textContent = 'LIVE';
      }
    }

    // ============================================================
    // TOAST
    // ============================================================
    function showToast(text, type = 'info') {
      const container = document.getElementById('toast-container');
      if (!container) return;
      if (container.children.length >= 3) {
        container.removeChild(container.firstElementChild);
      }
      const el = document.createElement('div');
      el.className = 'toast';
      let icon = 'fa-info-circle';
      if (type === 'success') icon = 'fa-check-circle';
      else if (type === 'error') icon = 'fa-exclamation-triangle';
      else if (type === 'event') icon = 'fa-bolt';
      else {
        if (text.includes('Playing')) icon = 'fa-music';
        else if (text.includes('Favorit') || text.includes('heart') || text.includes('❤')) icon = 'fa-heart';
        else if (text.includes('Shuffle') || text.includes('🔀')) icon = 'fa-random';
        else if (text.includes('Repeat') || text.includes('🔁')) icon = 'fa-redo';
        else if (text.includes('✅') || text.includes('berhasil')) icon = 'fa-check-circle';
        else if (text.includes('Error') || text.includes('❌')) icon = 'fa-exclamation-triangle';
      }
      el.classList.add('toast-' + type);
      el.innerHTML = `<i class="fas ${icon}"></i> <span>${text}</span>`;
      container.appendChild(el);
      setTimeout(() => el.classList.add('hide'), 2500);
      setTimeout(() => el.remove(), 2900);
    }
    function msg(m) { showToast(m); }
    function closeModal() {
      document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
      stopHearts();
      stopProfileMusic();
      currentProfileUid = null;
      applyProfileUrl(true);
    }

    // ============================================================
    // CAPSULE MENU - v3.2.3
    // ============================================================
    function toggleCapsuleMenu() {
      const panel = document.getElementById('capsuleMenuPanel');
      if (!panel) return;
      panel.classList.toggle('show');
    }
    function handleLogout() {
      if (!auth.currentUser) return;
      if (confirm('Yakin ingin logout?')) {
        auth.signOut().then(() => {
          localStorage.clear();
          location.reload();
        });
      }
    }

    // ============================================================
    // TAG UNLOCK FULLSCREEN - v3.2.3 (VIDEO STYLE)
    // ============================================================
    function showTagUnlockFullscreen(tags) {
      const wrap = document.getElementById('tagUnlockFullscreen');
      const listEl = document.getElementById('tagUnlockFullscreenTags');
      const cssSection = document.getElementById('tagUnlockCssSection');
      const cssCode = document.getElementById('tagUnlockCssCode');
      const particlesEl = document.getElementById('tagUnlockParticles');
      if (!wrap || !listEl) return;
      listEl.innerHTML = '';
      cssCode.innerHTML = '';
      let hasRamadhanTag = false;
      let tagCssData = {};
      (tags || []).forEach(raw => {
        const t = String(raw || '').toLowerCase();
        if (!t) return;
        const span = document.createElement('span');
        span.className = 'user-tag tag-' + t;
        span.textContent = t.toUpperCase();
        listEl.appendChild(span);
        // Get CSS for this tag
        tagCssData = getTagCss(t);
        // Check if ramadhan tag
        if (t.includes('ramadhan') || t.includes('tarawih') || t.includes('lailat')) {
          hasRamadhanTag = true;
        }
      });
      // Show CSS code
      if (tagCssData && tagCssData.css) {
        cssSection.style.display = 'block';
        const formattedCss = formatCssForDisplay(tagCssData);
        cssCode.innerHTML = formattedCss;
      } else {
        cssSection.style.display = 'none';
      }
      // Create particles
      createTagUnlockParticles(particlesEl);
      // Create confetti
      createTagConfetti(wrap);
      wrap.classList.add('show');
      // Start ketupat if ramadhan tag
      if (hasRamadhanTag) {
        startKetupat();
        setTimeout(() => stopKetupat(), 8000);
      }
    }
    
    // Get CSS properties for a tag
    function getTagCss(tagName) {
      const tagMeta = {
        'vip': { title: 'VIP Member', bg: 'linear-gradient(135deg, #ffd700, #ff8c00)', color: '#000', border: '1px solid rgba(255,215,0,0.8)', shadow: '0 0 15px rgba(255,215,0,0.6)' },
        'premium': { title: 'Premium', bg: 'linear-gradient(135deg, #a855f7, #6366f1)', color: '#fff', border: '1px solid rgba(168,85,247,0.8)', shadow: '0 0 12px rgba(168,85,247,0.5)' },
        'pro': { title: 'Pro', bg: 'linear-gradient(135deg, #3b82f6, #1d4ed8)', color: '#fff', border: '1px solid rgba(59,130,246,0.8)', shadow: '0 0 10px rgba(59,130,246,0.5)' },
        'admin': { title: 'Admin', bg: 'linear-gradient(135deg, #ef4444, #dc2626)', color: '#fff', border: '1px solid rgba(239,68,68,0.8)', shadow: '0 0 15px rgba(239,68,68,0.6)' },
        'moderator': { title: 'Moderator', bg: 'linear-gradient(135deg, #22c55e, #16a34a)', color: '#fff', border: '1px solid rgba(34,197,94,0.8)', shadow: '0 0 12px rgba(34,197,94,0.5)' },
        'legend': { title: 'Legend', bg: 'linear-gradient(135deg, #ff6b00, #ffd700, #ff6b00)', color: '#000', border: '1px solid rgba(255,215,0,0.8)', shadow: '0 0 20px rgba(255,107,0,0.7)' },
        'mythic': { title: 'Mythic', bg: 'linear-gradient(135deg, #9c27b0, #673ab7, #3f51b5)', color: '#fff', border: '1px solid rgba(255,255,255,0.2)', shadow: '0 0 15px rgba(156,39,176,0.6)' },
        'godlike': { title: 'Godlike', bg: 'linear-gradient(135deg, #ffd700, #ff8c00, #ffd700)', color: '#000', border: '1px solid #fff', shadow: '0 0 25px rgba(255,215,0,0.8)' },
        'savage': { title: 'Savage', bg: '#000', color: '#ff0050', border: '2px solid #ff0050', shadow: '0 0 15px rgba(255,0,80,0.7)', textShadow: '0 0 8px #ff0050' },
        'maniac': { title: 'Maniac', bg: 'linear-gradient(135deg, #e91e63, #9c27b0)', color: '#fff', border: '1px solid rgba(233,30,99,0.8)', shadow: '0 0 12px rgba(233,30,99,0.5)' },
        'ultra': { title: 'Ultra', bg: 'linear-gradient(135deg, #00bcd4, #009688, #4caf50)', color: '#fff', border: '1px solid rgba(255,255,255,0.3)', shadow: '0 0 15px rgba(0,188,212,0.6)' },
        'terkeren': { title: 'Terkeren', bg: 'linear-gradient(135deg, #00f5ff, #7c3aed)', color: '#fff', border: '1px solid rgba(59,130,246,0.7)', shadow: '0 0 12px rgba(124,58,237,0.7)' },
        'tersulit': { title: 'Tersulit', bg: 'linear-gradient(135deg, #ff0050, #ff8c00)', color: '#fff', border: '1px solid rgba(248,113,113,0.8)', shadow: '0 0 12px rgba(255,92,92,0.7)' },
        'ramadhan-1447h': { title: 'Ramadhan 1447H', bg: 'linear-gradient(135deg, #fbbf24, #f59e0b)', color: '#000', border: '1px solid rgba(245,158,11,0.8)', shadow: '0 0 15px rgba(251,191,36,0.6)' },
        'night-tarawih': { title: 'Night Tarawih', bg: 'linear-gradient(135deg, #064e3b, #059669)', color: '#d1fae5', border: '1px solid rgba(16,185,129,0.8)', shadow: '0 0 20px rgba(16,185,129,0.7)' },
        'valentine': { title: 'Valentine', bg: 'linear-gradient(135deg, #ff1493, #ff69b4)', color: '#fff', border: '1px solid rgba(255,105,180,0.8)', shadow: '0 0 20px rgba(255,20,147,0.6)' },
        'love-story': { title: 'Love Story', bg: 'linear-gradient(135deg, #ec4899, #f43f5e)', color: '#fff', border: '1px solid rgba(236,72,153,0.8)', shadow: '0 0 15px rgba(236,72,153,0.6)' },
        'heartbreaker': { title: 'Heartbreaker', bg: 'linear-gradient(135deg, #1f2937, #111827)', color: '#f43f5e', border: '1px solid rgba(244,63,94,0.8)', shadow: '0 0 12px rgba(244,63,94,0.5)' },
        'exe-sahur': { title: 'Exe Sahur', bg: 'linear-gradient(135deg, #1e3a5f, #0f172a)', color: '#38bdf8', border: '1px solid rgba(56,189,248,0.8)', shadow: '0 0 15px rgba(56,189,248,0.6)' },
        'content-creator': { title: 'Content Creator', bg: 'linear-gradient(135deg, #ec4899, #a855f7, #ec4899)', color: '#fff', border: '1px solid rgba(236,72,153,0.8)', shadow: '0 0 20px rgba(236,72,153,0.6)' }
      };
      return tagMeta[tagName] || null;
    }
    
    // Format CSS for display
    function formatCssForDisplay(tagData) {
      if (!tagData) return '';
      let css = `<span class="css-selector">.tag-${tagData.title.toLowerCase().replace(/\s+/g, '-')}</span> {\n`;
      if (tagData.bg) css += `  <span class="css-prop">background</span>: <span class="css-value">${tagData.bg}</span>;\n`;
      if (tagData.color) css += `  <span class="css-prop">color</span>: <span class="css-value">${tagData.color}</span>;\n`;
      if (tagData.border) css += `  <span class="css-prop">border</span>: <span class="css-value">${tagData.border}</span>;\n`;
      if (tagData.shadow) css += `  <span class="css-prop">box-shadow</span>: <span class="css-value">${tagData.shadow}</span>;\n`;
      if (tagData.textShadow) css += `  <span class="css-prop">text-shadow</span>: <span class="css-value">${tagData.textShadow}</span>;\n`;
      css += `  <span class="css-prop">font-weight</span>: <span class="css-value">900</span>;\n`;
      css += `}`;
      return css;
    }
    
    // Create particle effects
    function createTagUnlockParticles(container) {
      if (!container) return;
      container.innerHTML = '';
      const colors = ['#22c55e', '#0ea5e9', '#a855f7', '#fbbf24', '#f472b6'];
      for (let i = 0; i < 30; i++) {
        const particle = document.createElement('div');
        particle.className = 'tag-unlock-particle';
        particle.style.left = Math.random() * 100 + '%';
        particle.style.background = colors[Math.floor(Math.random() * colors.length)];
        particle.style.animationDelay = Math.random() * 3 + 's';
        particle.style.animationDuration = (2 + Math.random() * 2) + 's';
        container.appendChild(particle);
      }
    }
    
    // Create confetti
    function createTagConfetti(container) {
      if (!container) return;
      const colors = ['#22c55e', '#0ea5e9', '#a855f7', '#fbbf24', '#f472b6', '#ffd700'];
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'tag-unlock-confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.top = '-20px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDelay = Math.random() * 2 + 's';
        confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        container.appendChild(confetti);
      }
    }
    
    function closeTagUnlockFullscreen() {
      const wrap = document.getElementById('tagUnlockFullscreen');
      const particles = document.getElementById('tagUnlockParticles');
      if (wrap) {
        wrap.classList.remove('show');
      }
      if (particles) {
        particles.innerHTML = '';
      }
    }

    // ============================================================
    // RAMADHAN EVENT SYSTEM - v3.2.3
    // ============================================================
    let ramadhanProgress = {
      cycle1: { loginDays: 0, songsPlayed: 0, onlineMinutes: 0, completed: false },
      cycle2: { eveningDays: 0, shares: 0, likes: 0, completed: false },
      cycle3: { loginDays: 0, playtimeMinutes: 0, lateNightDays: 0, completed: false }
    };
    
    function checkRamadhanProgress() {
      if (!auth.currentUser || !userData) return;
      const uid = auth.currentUser.uid;
      
      // Cycle 1 - Awal Ramadhan
      if (!ramadhanProgress.cycle1.completed) {
        if (ramadhanProgress.cycle1.loginDays >= 3 && 
            ramadhanProgress.cycle1.songsPlayed >= 10 && 
            ramadhanProgress.cycle1.onlineMinutes >= 30) {
          grantRamadhanTag(uid, 'ramadhan-1447h');
          ramadhanProgress.cycle1.completed = true;
        }
      }
      
      // Cycle 2 - Mid Ramadhan
      if (!ramadhanProgress.cycle2.completed) {
        if (ramadhanProgress.cycle2.eveningDays >= 2 && 
            ramadhanProgress.cycle2.shares >= 2 && 
            ramadhanProgress.cycle2.likes >= 5) {
          grantRamadhanTag(uid, 'night-tarawih');
          ramadhanProgress.cycle2.completed = true;
        }
      }
      
      // Cycle 3 - 10 Hari Terakhir
      if (!ramadhanProgress.cycle3.completed) {
        if (ramadhanProgress.cycle3.loginDays >= 7 && 
            ramadhanProgress.cycle3.playtimeMinutes >= 120 && 
            ramadhanProgress.cycle3.lateNightDays >= 1) {
          grantRamadhanTag(uid, 'lailat-mode');
          ramadhanProgress.cycle3.completed = true;
        }
      }
    }
    
    function grantRamadhanTag(uid, tagName) {
      const updates = {};
      updates['users/' + uid + '/alltag/' + tagName] = true;
      db.ref().update(updates).then(() => {
        showTagUnlockFullscreen([tagName]);
        showToast('🎉 Kamu mendapat tag ' + tagName.toUpperCase() + '!');
      });
    }
    
    function checkSahurTime() {
      const now = new Date();
      const hour = now.getHours();
      // Jam 03:00 - 05:00
      if (hour >= 3 && hour < 5) {
        return true;
      }
      return false;
    }
    
    function grantSahurTag(uid) {
      if (!uid) return;
      const updates = {};
      updates['users/' + uid + '/alltag/exe-sahur'] = true;
      db.ref().update(updates).then(() => {
        showTagUnlockFullscreen(['exe-sahur']);
        showToast('🌙 SECRET TAG! Exe-Sahur unlocked!');
      });
    }
    
    function updateRamadhanProgress() {
      if (!auth.currentUser || !userData) return;
      
      // Update Cycle 1
      const c1Total = 43; // 3 + 10 + 30
      const c1Current = (ramadhanProgress.cycle1.loginDays || 0) + 
                        (ramadhanProgress.cycle1.songsPlayed || 0) + 
                        (ramadhanProgress.cycle1.onlineMinutes || 0);
      const c1Pct = Math.min(100, Math.round((c1Current / c1Total) * 100));
      
      const c1Fill = document.getElementById('ramCycle1Progress');
      const c1Text = document.getElementById('ramCycle1Text');
      const c1Badge = document.getElementById('ramCycle1Badge');
      const c1Btn = document.getElementById('ramCycle1Btn');
      
      if (c1Fill) c1Fill.style.transform = `scaleX(${c1Pct / 100})`;
      if (c1Text) c1Text.textContent = c1Pct + '%';
      if (ramadhanProgress.cycle1.completed) {
        if (c1Badge) c1Badge.textContent = 'COMPLETED';
        if (c1Btn) {
          c1Btn.textContent = 'CLAIMED';
          c1Btn.disabled = true;
        }
      } else if (c1Pct >= 100) {
        if (c1Badge) c1Badge.textContent = 'READY';
        if (c1Btn) {
          c1Btn.textContent = 'CLAIM';
          c1Btn.disabled = false;
          c1Btn.onclick = () => claimRamadhanCycle(1);
        }
      }
      
      // Update Cycle 2
      const c2Total = 9; // 2 + 2 + 5
      const c2Current = (ramadhanProgress.cycle2.eveningDays || 0) + 
                        (ramadhanProgress.cycle2.shares || 0) + 
                        (ramadhanProgress.cycle2.likes || 0);
      const c2Pct = Math.min(100, Math.round((c2Current / c2Total) * 100));
      
      const c2Fill = document.getElementById('ramCycle2Progress');
      const c2Text = document.getElementById('ramCycle2Text');
      const c2Badge = document.getElementById('ramCycle2Badge');
      const c2Btn = document.getElementById('ramCycle2Btn');
      
      if (c2Fill) c2Fill.style.transform = `scaleX(${c2Pct / 100})`;
      if (c2Text) c2Text.textContent = c2Pct + '%';
      if (ramadhanProgress.cycle2.completed) {
        if (c2Badge) c2Badge.textContent = 'COMPLETED';
        if (c2Btn) {
          c2Btn.textContent = 'CLAIMED';
          c2Btn.disabled = true;
        }
      } else if (c2Pct >= 100) {
        if (c2Badge) c2Badge.textContent = 'READY';
        if (c2Btn) {
          c2Btn.textContent = 'CLAIM';
          c2Btn.disabled = false;
          c2Btn.onclick = () => claimRamadhanCycle(2);
        }
      }
      
      // Update Cycle 3
      const c3Total = 128; // 7 + 120 + 1
      const c3Current = (ramadhanProgress.cycle3.loginDays || 0) + 
                        (ramadhanProgress.cycle3.playtimeMinutes || 0) + 
                        (ramadhanProgress.cycle3.lateNightDays || 0);
      const c3Pct = Math.min(100, Math.round((c3Current / c3Total) * 100));
      
      const c3Fill = document.getElementById('ramCycle3Progress');
      const c3Text = document.getElementById('ramCycle3Text');
      const c3Badge = document.getElementById('ramCycle3Badge');
      const c3Btn = document.getElementById('ramCycle3Btn');
      
      if (c3Fill) c3Fill.style.transform = `scaleX(${c3Pct / 100})`;
      if (c3Text) c3Text.textContent = c3Pct + '%';
      if (ramadhanProgress.cycle3.completed) {
        if (c3Badge) c3Badge.textContent = 'COMPLETED';
        if (c3Btn) {
          c3Btn.textContent = 'CLAIMED';
          c3Btn.disabled = true;
        }
      } else if (c3Pct >= 100) {
        if (c3Badge) c3Badge.textContent = 'READY';
        if (c3Btn) {
          c3Btn.textContent = 'CLAIM';
          c3Btn.disabled = false;
          c3Btn.onclick = () => claimRamadhanCycle(3);
        }
      }
    }
    
    function claimRamadhanCycle(cycle) {
      if (!auth.currentUser) return;
      const uid = auth.currentUser.uid;
      const tagMap = {
        1: 'ramadhan-1447h',
        2: 'night-tarawih',
        3: 'lailat-mode'
      };
      const tag = tagMap[cycle];
      if (!tag) return;
      
      grantRamadhanTag(uid, tag);
      ramadhanProgress['cycle' + cycle].completed = true;
      updateRamadhanProgress();
    }

    // ============================================================
    // SETTINGS LISTENER
    // ============================================================
    db.ref('settings').on('value', s => {
      const val = s.val();
      if (!val) return;
      
      // Load Ramadhan Theme globally
      if (val.ramadanTheme === true) {
        ramadanActive = true;
        document.body.classList.add('ramadan-active');
        const btn = document.getElementById('ramadanToggleBtn');
        const headerBtn = document.getElementById('btnRamadanTheme');
        if (btn) { btn.textContent = 'ON'; btn.style.background = 'linear-gradient(135deg,#ffd700,#00ff88)'; btn.style.color = '#000'; }
        if (headerBtn) { headerBtn.style.background = 'linear-gradient(135deg,rgba(255,215,0,0.3),rgba(0,255,136,0.2))'; headerBtn.style.borderColor = '#ffd700'; headerBtn.style.color = '#ffd700'; }
      } else {
        ramadanActive = false;
        document.body.classList.remove('ramadan-active');
        const btn = document.getElementById('ramadanToggleBtn');
        const headerBtn = document.getElementById('btnRamadanTheme');
        if (btn) { btn.textContent = 'OFF'; btn.style.background = ''; btn.style.color = ''; }
        if (headerBtn) { headerBtn.style.background = ''; headerBtn.style.borderColor = ''; headerBtn.style.color = ''; }
      }
      
      if (val.accentColor && typeof val.accentColor === 'string') {
        document.documentElement.style.setProperty('--accent', val.accentColor);
      } else {
        document.documentElement.style.setProperty('--accent', '#00ff88');
      }
      if (val.mt === true) {
        db.ref('users/' + (auth.currentUser?.uid) + '/role').once('value', r => {
          if (r.val() !== 'admin') document.getElementById('mtScreen').style.display = 'flex';
        });
      } else {
        document.getElementById('mtScreen').style.display = 'none';
      }
      if (val.announcement) triggerBroadcast(val.announcement);

      const lc = document.getElementById('lebaranCountdown');
      const lt = document.getElementById('lebaranTimer');
      if (val.lebaranTs && typeof val.lebaranTs === 'number') {
        setupLebaranCountdown(val.lebaranTs);
        if (lc && lt) {
          lc.classList.add('show');
        }
        const dEl = document.getElementById('adLebaranDate');
        const tEl = document.getElementById('adLebaranTime');
        if (dEl && tEl) {
          const dt = new Date(val.lebaranTs);
          const yyyy = dt.getFullYear();
          const mm = String(dt.getMonth() + 1).padStart(2, '0');
          const dd = String(dt.getDate()).padStart(2, '0');
          const hh = String(dt.getHours()).padStart(2, '0');
          const mi = String(dt.getMinutes()).padStart(2, '0');
          dEl.value = `${yyyy}-${mm}-${dd}`;
          tEl.value = `${hh}:${mi}`;
        }
      } else {
        if (lebaranInterval) {
          clearInterval(lebaranInterval);
          lebaranInterval = null;
        }
        if (lc) {
          lc.classList.remove('show', 'celebrate');
        }
      }
      if (val.globalCountdown && typeof val.globalCountdown === 'object') {
        setupGlobalCountdown(val.globalCountdown);
      } else {
        setupGlobalCountdown(null);
      }
    });

    // ============================================================
    // BROADCAST
    // ============================================================
    function triggerBroadcast(msg) {
      const el = document.getElementById('sysBroadcast');
      const bar = document.getElementById('sbBar');
      const msgEl = document.getElementById('sbMessage');
      el.classList.remove('active', 'sb-closing');
      bar.style.animation = 'none';
      void bar.offsetWidth;
      if (typeof msg === 'string' && msg.trim().toLowerCase().startsWith('hexky:')) {
        const rest = msg.slice(6).trim();
        msgEl.innerHTML = '<span class="sb-dev-name">Hexky</span>: ' + escapeHtml(rest);
      } else {
        msgEl.textContent = msg;
      }
      setTimeout(() => { el.classList.add('active'); bar.style.animation = 'countDown 15s linear forwards'; }, 100);
      clearTimeout(broadcastTimeout);
      broadcastTimeout = setTimeout(closeBroadcast, 15000);
    }
    function closeBroadcast() {
      const el = document.getElementById('sysBroadcast');
      el.classList.add('sb-closing');
      setTimeout(() => el.classList.remove('active', 'sb-closing'), 400);
    }

    function setupGlobalNotifsWatcher() {
      let lastKey = null;
      db.ref('globalNotifications').limitToLast(1).on('child_added', snap => {
        const val = snap.val();
        const key = snap.key;
        if (!val || !key) return;
        if (lastKey === null) {
          lastKey = key;
          mergeAndRenderNotifs([{ ...val, id: 'g_' + key }], 'global');
          return;
        }
        if (key === lastKey) {
          mergeAndRenderNotifs([{ ...val, id: 'g_' + key }], 'global');
          return;
        }
        lastKey = key;
        mergeAndRenderNotifs([{ ...val, id: 'g_' + key }], 'global');
        if (val.type === 'event') {
          const text = val.text || '';
          const from = val.fromName || 'Admin';
          const title = 'EVENT DIMULAI';
          const msg = text || ('Event baru dimulai oleh ' + from);
          showBroadcast(title + ' • ' + msg);
        }
      });
    }

    function setupAdminFloatChatWatcher() {
      const wrap = document.getElementById('adminFloatChat');
      const nameEl = document.getElementById('adminFloatName');
      const msgEl = document.getElementById('adminFloatMsg');
      const timerEl = document.getElementById('adminFloatTimer');
      if (!wrap || !nameEl || !msgEl || !timerEl) return;
      db.ref('adminFloatChat/current').on('value', snap => {
        const val = snap.val();
        if (adminFloatInterval) {
          clearInterval(adminFloatInterval);
          adminFloatInterval = null;
        }
        if (!val) {
          wrap.classList.remove('show');
          nameEl.textContent = '';
          msgEl.textContent = '';
          timerEl.textContent = '';
          return;
        }
        const now = Date.now();
        const expireAt = val.expireAt || 0;
        if (expireAt && now >= expireAt) {
          wrap.classList.remove('show');
          nameEl.textContent = '';
          msgEl.textContent = '';
          timerEl.textContent = '';
          if (auth.currentUser && userData && (userData.role === 'admin' || userData.role === 'owner')) {
            db.ref('adminFloatChat/current').remove();
          }
          return;
        }
        nameEl.textContent = (val.name || 'Admin') + '';
        msgEl.textContent = val.msg || '';
        wrap.classList.add('show');
        function updateTimer() {
          const now2 = Date.now();
          const diff = (val.expireAt || 0) - now2;
          if (diff <= 0) {
            timerEl.textContent = '0s';
            wrap.classList.remove('show');
            clearInterval(adminFloatInterval);
            adminFloatInterval = null;
            if (auth.currentUser && userData && (userData.role === 'admin' || userData.role === 'owner')) {
              db.ref('adminFloatChat/current').remove();
            }
            return;
          }
          const sec = Math.ceil(diff / 1000);
          timerEl.textContent = sec + 's';
        }
        updateTimer();
        adminFloatInterval = setInterval(updateTimer, 500);
      });
    }

    // ============================================================
    // NOTIFICATIONS
    // ============================================================
    function loadNotifs() {
      auth.onAuthStateChanged(u => {
        if (!u) {
          mergeAndRenderNotifs([], 'user');
          showGuestIntroNotif();
          return;
        }
        db.ref('users/' + u.uid + '/notifications').orderByChild('timestamp').limitToLast(80).on('value', snap => {
          const val = snap.val();
          const list = [];
          if (val) Object.keys(val).forEach(k => list.push({ ...val[k], id: 'u_' + k }));
          mergeAndRenderNotifs(list, 'user');
        });
      });
    }
    function mergeAndRenderNotifs(list, source) {
      if (source === 'global') _globalNotifs = list;
      else _userNotifs = list;
      notifList = [..._globalNotifs, ..._userNotifs].sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      renderNotifList(); updateNotifBadge();
    }
    function timeAgo(ts) {
      if (!ts) return '';
      const s = Math.floor((Date.now() - ts) / 1000);
      if (s < 60) return 'Baru saja';
      if (s < 3600) return Math.floor(s / 60) + ' menit lalu';
      if (s < 86400) return Math.floor(s / 3600) + ' jam lalu';
      if (s < 604800) return Math.floor(s / 86400) + ' hari lalu';
      return new Date(ts).toLocaleDateString('id-ID', { day: 'numeric', month: 'short' });
    }
    function renderNotifList() {
      const el = document.getElementById('notifList');
      if (!el) return;
      if (!notifList.length) { el.innerHTML = '<div class="notif-empty">Belum ada notifikasi</div>'; return; }
      const typeIcon = { admin: 'fa-shield-alt', violation: 'fa-exclamation-triangle', upload: 'fa-music', follow: 'fa-user-plus', system: 'fa-info-circle' };
      el.innerHTML = notifList.map(n => {
        const type = (n.type || 'system');
        const icon = typeIcon[type] || 'fa-bell';
        return `<div class="notif-item"><div class="notif-item-icon ${type}"><i class="fas ${icon}"></i></div><div class="notif-item-body"><div class="n-text">${escapeHtml(n.text || n.message || '')}</div><div class="n-time">${timeAgo(n.timestamp)}</div></div></div>`;
      }).join('');
    }
    function updateNotifBadge() {
      const lastRead = parseInt(localStorage.getItem(lastReadNotifTimeKey) || '0', 10);
      const count = notifList.filter(n => (n.timestamp || 0) > lastRead).length;
      const badge = document.getElementById('notifBadge');
      if (badge) { badge.textContent = count > 99 ? '99+' : count; badge.classList.toggle('show', count > 0); }
    }
    function positionNotifPanel() {
      const btn = document.getElementById('btnNotif');
      const panel = document.getElementById('notifPanel');
      if (!btn || !panel) return;
      const rect = btn.getBoundingClientRect();
      const panelW = Math.min(360, window.innerWidth - 20);
      let left = rect.right - panelW;
      if (left < 10) left = 10;
      if (left + panelW > window.innerWidth - 10) left = window.innerWidth - panelW - 10;
      panel.style.top = (rect.bottom + 10) + 'px';
      panel.style.left = left + 'px';
      panel.style.right = 'auto';
      panel.style.width = panelW + 'px';
    }
    function toggleNotifPanel() {
      const panel = document.getElementById('notifPanel');
      const willShow = !panel.classList.contains('show');
      if (willShow) {
        positionNotifPanel();
        panel.classList.add('show');
        localStorage.setItem(lastReadNotifTimeKey, String(Date.now()));
        updateNotifBadge();
      } else {
        panel.classList.remove('show');
        localStorage.setItem(lastReadNotifTimeKey, String(Date.now()));
        updateNotifBadge();
      }
    }
    function closeNotifPanel() { document.getElementById('notifPanel').classList.remove('show'); localStorage.setItem(lastReadNotifTimeKey, String(Date.now())); updateNotifBadge(); }
    document.addEventListener('click', function(e) {
      const panel = document.getElementById('notifPanel'); const btn = document.getElementById('btnNotif');
      if (panel && panel.classList.contains('show') && !panel.contains(e.target) && btn && !btn.contains(e.target)) closeNotifPanel();
    });
    function showGuestIntroNotif() {
      if (localStorage.getItem('exeGuestIntroShown') === '1') return;
      localStorage.setItem('exeGuestIntroShown', '1');
      const payload = {
        type: 'system',
        text: '[bot exemusic] Login dan daftarkan akun kamu ke ExeMusic sekarang!!',
        fromName: 'bot exemusic',
        timestamp: Date.now()
      };
      mergeAndRenderNotifs([payload], 'global');
    }
    loadNotifs();
    setupGlobalNotifsWatcher();
    setupAdminFloatChatWatcher();

    // ============================================================
    // AUTH
    // ============================================================
    auth.onAuthStateChanged(u => {
      if (u) {
        startUploadQueueWatcher(u.uid);
        db.ref('users/' + u.uid).on('value', snap => {
          userData = snap.val();
          if (!userData) { dismissLoader(); return; }
          if (userData.banned === true) { document.getElementById('bannedScreen').style.display = 'flex'; auth.signOut(); return; }

          const now = Date.now();
          const vipType = getVipStatus(userData);
          const vipActive = !!vipType;

          document.getElementById('topLoginBtn').innerHTML = '👤';
          document.getElementById('topLoginBtn').classList.add('logged-in');
          document.getElementById('topLoginBtn').title = userData.username;

          // Crown
          document.getElementById('pUsername').innerHTML = userData.username + (vipActive ? ' <i class="fas fa-crown" style="color:#ffd700;font-size:13px;margin-left:5px"></i>' : '');
          document.getElementById('pAvatarImg').src = userData.avatar || 'https://via.placeholder.com/150';

          const fol = userData.followers;
          const folCount = Array.isArray(fol) ? fol.length : (fol && typeof fol === 'object' ? Object.keys(fol).length : fol || 0);
          const flg = userData.following;
          const flgCount = Array.isArray(flg) ? flg.length : (flg && typeof flg === 'object' ? Object.keys(flg).length : flg || 0);
          document.getElementById('pFol').innerText = folCount;
          document.getElementById('pFollowing').innerText = flgCount;
          document.getElementById('pTagDisplay').innerHTML = getTagHTML(userData.tag);
          syncUserQuestTags(u.uid, userData, folCount, flgCount);
          ensureCurrentTagInAlltag(u.uid, userData);
          startUploadCooldownWatcher();

          document.getElementById('pBadge').innerHTML = folCount >= 50 ? '<i class="fas fa-check-circle v-badge"></i>' : '';
          
          // Update Admin/Creator Badge
          updateAdminBadge('p', userData.role, userData.admpanel);

        const profHeader = document.getElementById('profileHeader');
        if (profHeader) {
          profHeader.classList.remove(
            'vip',
            'pink-profile',
            'gamers-profile',
            'legend-profile',
            'frost-profile',
            'blaze-profile',
            'cosmic-profile',
            'elite-profile',
            'neon-profile'
          );
          const tagLower = (userData.tag || '').toLowerCase();
          if (tagLower.includes('velly')) profHeader.classList.add('pink-profile');
          else if (tagLower.includes('gamers')) profHeader.classList.add('gamers-profile');
          else if (tagLower.includes('legend')) profHeader.classList.add('legend-profile');
          else if (tagLower.includes('frost')) profHeader.classList.add('frost-profile');
          else if (tagLower.includes('blaze')) profHeader.classList.add('blaze-profile');
          else if (tagLower.includes('cosmic')) profHeader.classList.add('cosmic-profile');
          else if (tagLower.includes('elite')) profHeader.classList.add('elite-profile');
          else if (tagLower.includes('neon')) profHeader.classList.add('neon-profile');
        }

          const pmBtn = document.getElementById('btnProfileMusic');
          const pmRow = document.getElementById('profileMusicRow');
          if (pmBtn && pmRow) {
            pmBtn.style.display = vipActive ? 'inline-flex' : 'none';
            pmRow.style.display = 'none';
            document.getElementById('profileMusicUrl').value = userData.profilemusic || '';
          }

          // VIP status text
          let statusText = 'Status: NONVIP';
          if (userData.vip) statusText = 'Status: VIP PERMANENT ✨';
          else if (userData.trialvip && userData.trialvip.expireAt && now < userData.trialvip.expireAt) {
            statusText = 'Status: VIP TRIAL AKTIF 👑';
            updateVipTrialBanner(userData.trialvip.expireAt);
          }
          const vs = document.getElementById('pVipStatus');
          if (vs) vs.textContent = statusText;

          const emailParts = (u.email || '').split('@');
          const name = emailParts[0], domain = emailParts[1] || '';
          const sensoredEmail = name.slice(0, Math.max(1, Math.floor(name.length / 3))) + '*'.repeat(Math.max(3, name.length - 2)) + '@' + domain;
          document.getElementById('pEmail').innerText = sensoredEmail;

          document.getElementById('uploadFormUser').style.display = 'block';
          document.getElementById('uploadFormGuest').style.display = 'none';
          document.getElementById('btnFollow').style.display = 'flex';
          if (userData.role === 'admin' || userData.role === 'owner') {
            document.getElementById('btnAdmin').classList.add('show');
          }
          if (userData.admpanel === true) {
            document.getElementById('btnCreatorPanel').classList.add('show');
          }
          updateFollowUI();
        });
        setupTagDropWatcher();
      } else {
        stopUploadQueueWatcher();
        stopUploadCooldownWatcher();
        if (tagDropInterval) {
          clearInterval(tagDropInterval);
          tagDropInterval = null;
        }
        if (tagDropBannerInterval) {
          clearInterval(tagDropBannerInterval);
          tagDropBannerInterval = null;
        }
        document.getElementById('topLoginBtn').innerHTML = '👤';
        document.getElementById('topLoginBtn').classList.remove('logged-in');
        document.getElementById('topLoginBtn').title = 'Login';
        document.getElementById('btnFollow').style.display = 'none';
        document.getElementById('btnAdmin').classList.remove('show');
        document.getElementById('btnCreatorPanel').classList.remove('show');
        stopHearts();
      }
      dismissLoader();
      
      // Check if first time user - show tutorial
      if (u) {
        const seen = localStorage.getItem('exeTutorialSeen');
        if (!seen) {
          setTimeout(() => showFirstTimeTutorial(), 2000);
        }
      }
    });

    // ============================================================
    // VIP TRIAL BANNER
    // ============================================================
    function updateVipTrialBanner(expireAt) {
      const banner = document.getElementById('vipTrialBanner');
      const timerEl = document.getElementById('vipTrialTimer');
      if (!banner || !timerEl) return;

      function update() {
        if (vipTrialBannerClosed) { banner.classList.remove('show'); return; }
        const now = Date.now();
        const diff = expireAt - now;
        if (diff <= 0) { banner.classList.remove('show'); return; }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        timerEl.innerHTML = `
          <span class="countdown-segment">
            <span class="countdown-number">${days}</span>
            <span class="countdown-label">Hari</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${hours.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Jam</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${minutes.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Menit</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${seconds.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Detik</span>
          </span>
        `;
        banner.classList.add('show');
      }
      update();
      setInterval(update, 1000);
    }

    function closeVipTrialBanner() {
      vipTrialBannerClosed = true;
      const banner = document.getElementById('vipTrialBanner');
      if (banner) banner.classList.remove('show');
    }

    // ============================================================
    // LEBARAN COUNTDOWN
    // ============================================================
    function setupLebaranCountdown(targetTs) {
      const wrap = document.getElementById('lebaranCountdown');
      const timerEl = document.getElementById('lebaranTimer');
      if (!wrap || !timerEl) return;
      if (lebaranInterval) {
        clearInterval(lebaranInterval);
        lebaranInterval = null;
      }
      function updateLebaran() {
        const now = Date.now();
        const diff = targetTs - now;
        if (diff <= 0) {
          timerEl.innerHTML = '<span style="color:#ffd700">🎉 SELAMAT IDULFITRI! �</span>';
          wrap.classList.add('celebrate');
          if (lebaranInterval) {
            clearInterval(lebaranInterval);
            lebaranInterval = null;
          }
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        timerEl.innerHTML = `
          <span class="countdown-segment">
            <span class="countdown-number">${days}</span>
            <span class="countdown-label">Hari</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${hours.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Jam</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${minutes.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Menit</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${seconds.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Detik</span>
          </span>
        `;
        wrap.classList.add('show');
      }
      updateLebaran();
      lebaranInterval = setInterval(updateLebaran, 1000);
    }

    function setupGlobalCountdown(cfg) {
      const wrap = document.getElementById('globalCountdown');
      const labelEl = document.getElementById('globalCountdownLabel');
      const timerEl = document.getElementById('globalCountdownTimer');
      if (!wrap || !labelEl || !timerEl) return;
      if (globalCountdownInterval) {
        clearInterval(globalCountdownInterval);
        globalCountdownInterval = null;
      }
      if (!cfg || cfg.active === false || !cfg.targetTs) {
        wrap.classList.remove('show');
        return;
      }
      const title = cfg.title || 'Admin Event';
      labelEl.textContent = title;
      const update = () => {
        const now = Date.now();
        const diff = cfg.targetTs - now;
        if (diff <= 0) {
          timerEl.textContent = 'SEDANG BERLANGSUNG';
          wrap.classList.add('show');
          if (globalCountdownInterval) {
            clearInterval(globalCountdownInterval);
            globalCountdownInterval = null;
          }
          return;
        }
        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
        
        timerEl.innerHTML = `
          <span class="countdown-segment">
            <span class="countdown-number">${days}</span>
            <span class="countdown-label">Hari</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${hours.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Jam</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${minutes.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Menit</span>
          </span>
          <span style="color:#6b7280">:</span>
          <span class="countdown-segment">
            <span class="countdown-number">${seconds.toString().padStart(2,'0')}</span>
            <span class="countdown-label">Detik</span>
          </span>
        `;
        wrap.classList.add('show');
      };
      update();
      globalCountdownInterval = setInterval(update, 1000);
    }

    function closeGlobalCountdown() {
      const wrap = document.getElementById('globalCountdown');
      if (wrap) wrap.classList.remove('show');
    }

    function closeLebaranCountdown() {
      const wrap = document.getElementById('lebaranCountdown');
      if (wrap) wrap.classList.remove('show', 'celebrate');
      if (lebaranInterval) {
        clearInterval(lebaranInterval);
        lebaranInterval = null;
      }
    }

    // ============================================================
    // SONGS
    // ============================================================
    db.ref('songs').on('value', snap => {
      const val = snap.val();
      if (val) {
        songs = Object.keys(val).map(k => ({ ...val[k], key: k }));
        adAllSongs = [...songs];
        renderAdminSongs();

        const urlParams = new URLSearchParams(window.location.search);
        const songId = urlParams.get('id');
        const profileUid = urlParams.get('profile_userid');

        if (profileUid && auth.currentUser) {
          if (profileUid === auth.currentUser.uid) openProfile();
          else openCreatorByUid(profileUid);
        } else if (audio.src === '') {
          if (songId && songs[parseInt(songId)]) {
            setup(parseInt(songId), false);
          } else {
            const savedIdx = localStorage.getItem('exeLastSongIdx');
            const savedTime = localStorage.getItem('exeLastTime');
            if (savedIdx !== null && songs[parseInt(savedIdx)]) {
              setup(parseInt(savedIdx), false).then(() => { if (savedTime) audio.currentTime = parseFloat(savedTime); });
            } else {
              setup(0, false);
            }
          }
        }
      }
    });

    async function setup(idx, play = true) {
      if (!songs[idx]) return;
      i = idx;
      applyProfileUrl(true);
      audio.src = songs[i].url;
      document.getElementById('title').textContent = songs[i].title;
      const cRef = await db.ref('users/' + songs[i].uid).get();
      const cData = cRef.val();
      const fcb = (() => { const f = cData?.followers; return Array.isArray(f) ? f.length : (f && typeof f === 'object' ? Object.keys(f).length : f || 0); })();
      const badge = fcb >= 50 ? '<i class="fas fa-check-circle v-badge"></i>' : '';
      const creatorVip = getVipStatus(cData);
      const crown = creatorVip ? ' <i class="fas fa-crown" style="color:#ffd700;font-size:11px"></i>' : '';
      document.getElementById('by').innerHTML = '@' + (songs[i].by || 'system') + badge + crown;
      if (play) {
        audio.play();
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>';
        document.getElementById('eq').classList.add('playing');
        showToast(`🎵 Now Playing: ${songs[i].title}`);
      }
      updateFollowUI(); updateFavoriteUI(); saveLastSong();
    }

    function toggle() {
      if (audio.paused) { 
        audio.play(); 
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-pause"></i>'; 
        document.getElementById('eq').classList.add('playing');
        // Track Ramadhan Cycle 1 - songs played
        if (auth.currentUser && userData) {
          ramadhanProgress.cycle1.songsPlayed++;
          checkRamadhanProgress();
        }
      }
      else { audio.pause(); document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>'; document.getElementById('eq').classList.remove('playing'); }
    }
    function next() { setup(isShuf ? Math.floor(Math.random() * songs.length) : (i + 1) % songs.length); }
    function prev() { setup(isShuf ? Math.floor(Math.random() * songs.length) : (i - 1 + songs.length) % songs.length); }

    audio.ontimeupdate = () => {
      document.getElementById('seek').value = (audio.currentTime / audio.duration) * 100 || 0;
      document.getElementById('cur').textContent = fmt(audio.currentTime);
      document.getElementById('dur').textContent = fmt(audio.duration);
      if (audio.duration > 0) document.getElementById('loadSpinner').classList.remove('show');
      if (Math.floor(audio.currentTime) % 2 === 0) localStorage.setItem('exeLastTime', audio.currentTime);
      if (auth && auth.currentUser && !audio.paused && document.visibilityState === 'visible') {
        const now = Date.now();
        if (!lastListenTick) lastListenTick = now;
        const diffSec = (now - lastListenTick) / 1000;
        if (diffSec >= 5) {
          lastListenTick = now;
          const addSec = Math.floor(diffSec);
          addListeningProgress(addSec);
          
          // Track Ramadhan Cycle 1 - online minutes
          ramadhanProgress.cycle1.onlineMinutes += addSec / 60;
          // Track Ramadhan Cycle 3 - playtime minutes
          ramadhanProgress.cycle3.playtimeMinutes += addSec / 60;
          
          // Check evening time for Cycle 2 (18:00-20:00)
          const hour = new Date().getHours();
          if (hour >= 18 && hour < 20) {
            // Track evening activity (implement daily tracking in userData)
          }
          
          // Check late night for Cycle 3 (after 23:00)
          if (hour >= 23) {
            // Track late night activity (implement daily tracking in userData)
          }
          
          checkRamadhanProgress();
        }
      }
    };
    audio.onplay = () => { if (!audio.duration || isNaN(audio.duration)) document.getElementById('loadSpinner').classList.add('show'); };
    audio.onpause = () => { localStorage.setItem('exeLastTime', audio.currentTime); };
    audio.onloadedmetadata = () => document.getElementById('loadSpinner').classList.remove('show');
    document.getElementById('seek').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;
    document.getElementById('vol').oninput = (e) => { audio.volume = e.target.value; localStorage.setItem('exeVolume', e.target.value); };
    audio.onended = () => {
      if (repeatMode === 1) { audio.currentTime = 0; audio.play(); }
      else if (repeatMode === 2 || isShuf) next();
      else if (i < songs.length - 1) next();
    };
    function saveLastSong() { localStorage.setItem('exeLastSongIdx', i); }
    function addListeningProgress(sec) {
      if (!auth || !auth.currentUser || !sec) return;
      listenDailySeconds += sec;
      listenWeeklySeconds += sec;
      const addedDailyMin = Math.floor(listenDailySeconds / 60);
      const addedWeeklyMin = Math.floor(listenWeeklySeconds / 60);
      if (addedDailyMin > 0) {
        listenDailySeconds -= addedDailyMin * 60;
        updateQuestProgress('daily', 'daily_top_listener_1', addedDailyMin, auth.currentUser.uid);
      }
      if (addedWeeklyMin > 0) {
        listenWeeklySeconds -= addedWeeklyMin * 60;
        updateQuestProgress('weekly', 'weekly_top_listener_2', addedWeeklyMin, auth.currentUser.uid);
      }
    }

    // ============================================================
    // UPLOAD / SAVE + QUEUE
    // ============================================================
    function startUploadQueueWatcher(uid) {
      if (!uid) return;
      if (uploadQueueListenerUid && uploadQueueListenerUid !== uid) {
        db.ref('uploadQueue/' + uploadQueueListenerUid).off();
      }
      uploadQueueListenerUid = uid;
      db.ref('uploadQueue/' + uid).on('value', snap => {
        const val = snap.val() || {};
        renderUploadQueue(val);
      });
      if (uploadQueueInterval) clearInterval(uploadQueueInterval);
      uploadQueueInterval = setInterval(() => processUploadQueue(uid), 15000);
    }
    function stopUploadQueueWatcher() {
      if (uploadQueueInterval) {
        clearInterval(uploadQueueInterval);
        uploadQueueInterval = null;
      }
      if (uploadQueueListenerUid) {
        db.ref('uploadQueue/' + uploadQueueListenerUid).off();
        uploadQueueListenerUid = null;
      }
      const section = document.getElementById('uploadQueueSection');
      if (section) section.style.display = 'none';
    }
    function renderUploadQueue(map) {
      const section = document.getElementById('uploadQueueSection');
      const listEl = document.getElementById('uploadQueueList');
      const infoEl = document.getElementById('uploadQueueInfo');
      if (!section || !listEl || !infoEl || !userData) return;
      const limit = getUploadQueueLimit();
      const entries = Object.keys(map || {}).map(id => ({ id, ...(map[id] || {}) }))
        .sort((a, b) => (a.scheduledAt || 0) - (b.scheduledAt || 0));
      section.style.display = 'block';
      if (!entries.length) {
        infoEl.textContent = 'Belum ada antrian upload';
        listEl.innerHTML = '<div style="font-size:11px;color:#777;padding:6px 0">Kamu belum punya upload di queue.</div>';
        return;
      }
      const activeCount = entries.filter(it => it.status !== 'done' && it.status !== 'cancelled').length;
      if (limit) infoEl.textContent = activeCount + '/' + limit + ' slot terpakai';
      else infoEl.textContent = '';
      listEl.innerHTML = entries.map(it => {
        const t = it.title || '';
        const timeStr = it.scheduledAt ? new Date(it.scheduledAt).toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' }) : '';
        let statusLabel = 'Queued';
        let statusClass = 'status-queued';
        if (it.status === 'processing') { statusLabel = 'Processing'; statusClass = 'status-processing'; }
        else if (it.status === 'done') { statusLabel = 'Uploaded'; statusClass = 'status-done'; }
        const disabled = it.status === 'processing';
        return `<div class="upload-queue-item">
          <div class="upload-queue-main">
            <div class="upload-queue-title">${escapeHtml(t)}</div>
            <div class="upload-queue-time">${escapeHtml(timeStr)}</div>
          </div>
          <div class="upload-queue-actions">
            <span class="upload-queue-status ${statusClass}">${escapeHtml(statusLabel)}</span>
            <button class="upload-queue-btn" onclick="editUploadQueueItem('${it.id}')" ${disabled ? 'disabled' : ''}><i class="fas fa-pen"></i></button>
            <button class="upload-queue-btn" onclick="deleteUploadQueueItem('${it.id}')" ${disabled ? 'disabled' : ''}><i class="fas fa-trash"></i></button>
          </div>
        </div>`;
      }).join('');
    }
    async function processUploadQueue(uid) {
      if (!uid || !auth.currentUser || !userData || auth.currentUser.uid !== uid) return;
      const now = Date.now();
      const snap = await db.ref('uploadQueue/' + uid).orderByChild('scheduledAt').endAt(now).limitToFirst(1).get();
      const val = snap.val();
      if (!val) return;
      const id = Object.keys(val)[0];
      const item = val[id];
      if (!item || item.status !== 'queued') return;
      const itemRef = db.ref('uploadQueue/' + uid + '/' + id);
      const txRes = await itemRef.transaction(cur => {
        if (!cur || cur.status !== 'queued') return cur;
        return { ...cur, status: 'processing', processingAt: now };
      });
      if (!txRes.committed) return;
      const cur = txRes.snapshot.val();
      if (!cur || cur.status !== 'processing') return;
      const songRef = db.ref('songs').push();
      const songData = { title: cur.title, url: cur.url, uid, by: userData.username, timestamp: Date.now() };
      await songRef.set(songData);
      const songKey = songRef.key;
      await db.ref('users/' + uid).update({ lastUpload: Date.now() });
      await itemRef.update({ status: 'done', uploadedAt: Date.now(), songKey });
      await db.ref('users/' + uid + '/notifications').push({ type: 'upload', text: userData.username + ' mengupload (queue): ' + (cur.title || ''), fromName: userData.username, timestamp: Date.now() });
      updateQuestProgress('daily', 'daily_first_upload', 1, uid);
      updateQuestProgress('daily', 'daily_music_producer', 1, uid);
      updateQuestProgress('weekly', 'weekly_active_creator', 1, uid);
      msg('✅ Upload queue terupload: ' + (cur.title || ''));
    }
    async function editUploadQueueItem(id) {
      if (!auth.currentUser || !userData || !id) return;
      const uid = auth.currentUser.uid;
      const snap = await db.ref('uploadQueue/' + uid + '/' + id).get();
      const item = snap.val();
      if (!item) { msg('Queue tidak ditemukan'); return; }
      if (item.status === 'processing') { msg('Queue sedang diproses'); return; }
      const safeTitle = (item.title || '').replace(/"/g, '&quot;');
      const safeUrl = (item.url || '').replace(/"/g, '&quot;');
      Swal.fire({
        title: 'Edit Upload Queue',
        html:
          '<input id="qTitle" class="swal2-input" placeholder="Judul Lagu" value="' + safeTitle + '">' +
          '<input id="qUrl" class="swal2-input" placeholder="URL MP3" value="' + safeUrl + '">',
        focusConfirm: false,
        showCancelButton: true,
        background: '#181818',
        color: '#fff',
        confirmButtonColor: '#00ff88',
        cancelButtonColor: '#d33',
        preConfirm: () => {
          const title = (document.getElementById('qTitle').value || '').trim();
          const url = (document.getElementById('qUrl').value || '').trim();
          if (!title || !url) {
            Swal.showValidationMessage('Judul dan URL wajib diisi');
            return;
          }
          return { title, url };
        }
      }).then(async res => {
        if (!res.value) return;
        await db.ref('uploadQueue/' + uid + '/' + id).update({
          title: res.value.title,
          url: res.value.url
        });
        msg('Queue diperbarui');
      });
    }
    function deleteUploadQueueItem(id) {
      if (!auth.currentUser || !id) return;
      const uid = auth.currentUser.uid;
      Swal.fire({
        title: 'Hapus dari queue?',
        text: 'Lagu tidak akan diupload otomatis.',
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#ff4d4f',
        cancelButtonColor: '#555',
        confirmButtonText: 'Ya, hapus',
        background: '#181818',
        color: '#fff'
      }).then(async r => {
        if (!r.isConfirmed) return;
        await db.ref('uploadQueue/' + uid + '/' + id).remove();
        msg('Queue dihapus');
      });
    }
    function getUploadQueueLimit() {
      if (!userData || userData.role === 'admin') return 0;
      return 1;
    }
    async function confirmAndSave() {
      const title = document.getElementById('rLagu').value;
      const url = document.getElementById('rUrl').value;
      if (!title || !url) return msg('Isi semua data!');
      if (!auth.currentUser || !userData) return msg('Login dulu!');
      if (userData.banUpload) {
        msg('Akun ini dibanned dari upload');
        return;
      }
      const lastUpload = userData.lastUpload || 0;
      const now = Date.now();
      const diff = (now - lastUpload) / 1000 / 60;
      const vipType = getVipStatus(userData);
      const isAdmin = userData.role === 'admin';
      const cooldown = isAdmin ? 0 : (vipType ? 15 : 30);
      if (isAdmin || diff >= cooldown) {
        let cdInterval;
        Swal.fire({
          title: 'Yakin?',
          html: 'Pelanggaran rules → BANNED PERMANENT!<br><span id="uploadConfirmCd" style="font-size:11px;display:block;margin-top:6px;color:#ccc">Tunggu 5 detik sebelum bisa upload...</span>',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#00ff88',
          cancelButtonColor: '#d33',
          confirmButtonText: 'Saya Bertanggung Jawab',
          background: '#181828',
          color: '#fff',
          didOpen: () => {
            const btn = Swal.getConfirmButton();
            const label = document.getElementById('uploadConfirmCd');
            let sec = 5;
            if (btn) btn.disabled = true;
            cdInterval = setInterval(() => {
              sec--;
              if (label) label.textContent = sec > 0 ? `Tunggu ${sec} detik sebelum bisa upload...` : 'Silakan upload jika sudah yakin.';
              if (sec <= 0) {
                if (btn) btn.disabled = false;
                clearInterval(cdInterval);
              }
            }, 1000);
          },
          willClose: () => {
            if (cdInterval) clearInterval(cdInterval);
          }
        }).then(r => { if (r.isConfirmed) saveMusic(title, url); });
        return;
      }
      const queueLimit = getUploadQueueLimit();
      if (!queueLimit) {
        Swal.fire({ icon: 'error', title: 'Sabar...', text: `Tunggu ${Math.ceil(cooldown - diff)} menit lagi.`, background: '#181828', color: '#fff' });
        return;
      }
      const qSnap = await db.ref('uploadQueue/' + auth.currentUser.uid).get();
      const qVal = qSnap.val() || {};
      let activeCount = 0;
      Object.keys(qVal).forEach(k => {
        const it = qVal[k];
        if (!it) return;
        if (it.status === 'done' || it.status === 'cancelled') return;
        activeCount++;
      });
      if (activeCount >= queueLimit) {
        Swal.fire({ icon: 'error', title: 'Queue penuh', text: 'Upload queue kamu sudah penuh, tunggu antrian terupload dulu.', background: '#181828', color: '#fff' });
        return;
      }
      const scheduledAt = Math.max(lastUpload + cooldown * 60 * 1000, now);
      Swal.fire({ title: 'Masuk Upload Queue?', text: 'Lagu akan otomatis diupload saat cooldown selesai.', icon: 'question', showCancelButton: true, confirmButtonColor: '#00ff88', cancelButtonColor: '#d33', confirmButtonText: 'Ya, antrikan', background: '#181828', color: '#fff' })
        .then(async r => {
          if (!r.isConfirmed) return;
          const item = { title, url, uid: auth.currentUser.uid, by: userData.username, createdAt: now, scheduledAt, status: 'queued', cooldownMinutes: cooldown, vip: !!vipType };
          await db.ref('uploadQueue/' + auth.currentUser.uid).push(item);
          msg('✅ Lagu masuk upload queue');
          document.getElementById('rLagu').value = '';
          document.getElementById('rUrl').value = '';
        });
    }
    function saveMusic(t, u) {
      const newSong = { title: t, url: u, uid: auth.currentUser.uid, by: userData.username, timestamp: Date.now() };
      db.ref('songs').push(newSong).then(() => {
        const uid = auth.currentUser.uid;
        db.ref('users/' + uid).update({ lastUpload: Date.now() });
        db.ref('users/' + uid + '/notifications').push({ type: 'upload', text: userData.username + ' mengupload: ' + t, fromName: userData.username, timestamp: Date.now() });
        updateQuestProgress('daily', 'daily_first_upload', 1, uid);
        updateQuestProgress('daily', 'daily_music_producer', 1, uid);
        updateQuestProgress('weekly', 'weekly_active_creator', 1, uid);
        
        // Check Sahur Time - v3.2.3
        db.ref('settings/sahurTagEnabled').once('value', snap => {
          if (snap.val() === true && checkSahurTime()) {
            grantSahurTag(uid);
          }
        });
        
        msg('✅ Berhasil diposting!'); closeModal();
        document.getElementById('rLagu').value = ''; document.getElementById('rUrl').value = '';
      });
    }

    // ============================================================
    // FOLLOW / FAVORITE
    // ============================================================
    async function followUser() {
      if (!auth.currentUser) return msg('Login dulu!');
      const targetUid = songs[i].uid;
      if (!targetUid || targetUid === auth.currentUser.uid) return msg('Gak bisa follow diri sendiri');
      try {
        const [tSnap, cSnap] = await Promise.all([db.ref('users/' + targetUid).get(), db.ref('users/' + auth.currentUser.uid).get()]);
        const tData = tSnap.val(), cData = cSnap.val();
        const fArr = Array.isArray(tData?.followers) ? [...tData.followers] : (tData?.followers && typeof tData.followers === 'object' ? Object.keys(tData.followers) : []);
        const flArr = Array.isArray(cData?.following) ? [...cData.following] : (cData?.following && typeof cData.following === 'object' ? Object.keys(cData.following) : []);
        const isF = fArr.includes(auth.currentUser.uid);
        if (isF) {
          await db.ref('users/' + targetUid).update({ followers: fArr.filter(u => u !== auth.currentUser.uid) });
          await db.ref('users/' + auth.currentUser.uid).update({ following: flArr.filter(u => u !== targetUid) });
          msg('Unfollowed!');
        } else {
          await db.ref('users/' + targetUid).update({ followers: [...fArr, auth.currentUser.uid] });
          await db.ref('users/' + auth.currentUser.uid).update({ following: [...flArr, targetUid] });
          db.ref('users/' + targetUid + '/notifications').push({ type: 'follow', text: userData.username + ' mulai mengikuti kamu', fromName: userData.username, fromUid: auth.currentUser.uid, timestamp: Date.now() });
          msg('Followed! ✅');
        }
        const newFolCount = isF ? fArr.length - 1 : fArr.length + 1;
        const newFlCount = isF ? flArr.length - 1 : flArr.length + 1;
        syncUserQuestTags(targetUid, tData || {}, newFolCount, (tData && tData.following) ? (Array.isArray(tData.following) ? tData.following.length : (typeof tData.following === 'object' ? Object.keys(tData.following).length : 0)) : 0);
        syncUserQuestTags(auth.currentUser.uid, cData || {}, (cData && cData.followers) ? (Array.isArray(cData.followers) ? cData.followers.length : (typeof cData.followers === 'object' ? Object.keys(cData.followers).length : 0)) : 0, newFlCount);
        if (!isF) {
          updateQuestProgress('weekly', 'weekly_social_hunter', 1, auth.currentUser.uid);
          updateQuestProgress('daily', 'daily_follower_boost', 1, targetUid);
          updateQuestProgress('weekly', 'weekly_followers_20', 1, targetUid);
          updateQuestProgress('weekly', 'weekly_followers_50', 1, targetUid);
        }
        await updateFollowUI();
      } catch (err) { msg('Error: ' + err.message); }
    }
    async function updateFollowUI() {
      if (!auth.currentUser || !songs[i]?.uid) return;
      const tSnap = await db.ref('users/' + songs[i].uid).get();
      const tData = tSnap.val();
      const tFol = tData?.followers || {};
      const isF = Array.isArray(tFol) ? tFol.includes(auth.currentUser.uid) : !!tFol[auth.currentUser.uid];
      const btn = document.getElementById('btnFollow');
      btn.style.display = (isF || songs[i].uid === auth.currentUser.uid) ? 'none' : 'flex';
    }
    function toggleFavorite() {
      if (!songs[i]) return;
      const url = songs[i].url;
      const btn = document.getElementById('btnFav');
      if (fav.includes(url)) { 
        fav = fav.filter(u => u !== url); 
        showToast('Dihapus dari Favorit'); 
        btn.classList.remove('active'); 
        btn.innerHTML = '<i class="far fa-heart"></i>'; 
      }
      else { 
        fav.push(url); 
        showToast('❤️ Ditambahkan ke Favorit'); 
        btn.classList.add('active'); 
        btn.innerHTML = '<i class="fas fa-heart"></i>';
        // Track Ramadhan Cycle 2 - likes
        if (auth.currentUser && userData) {
          ramadhanProgress.cycle2.likes++;
          checkRamadhanProgress();
        }
      }
      localStorage.setItem('exeFav', JSON.stringify(fav));
      if (document.getElementById('modalList').style.display === 'block') openList(false);
    }
    function updateFavoriteUI() {
      if (!songs[i]) return;
      const btn = document.getElementById('btnFav');
      if (fav.includes(songs[i].url)) { btn.classList.add('active'); btn.innerHTML = '<i class="fas fa-heart"></i>'; }
      else { btn.classList.remove('active'); btn.innerHTML = '<i class="far fa-heart"></i>'; }
    }

    // ============================================================
    // SHUFFLE / REPEAT
    // ============================================================
    function toggleShuffle() {
      isShuf = !isShuf; localStorage.setItem('exeShuffle', isShuf);
      document.getElementById('shuf').classList.toggle('active-btn', isShuf);
      showToast(isShuf ? '🔀 Shuffle Aktif' : 'Shuffle Non-aktif');
    }
    function toggleRepeat() {
      repeatMode = (repeatMode + 1) % 3; localStorage.setItem('exeRepeat', repeatMode);
      const btn = document.getElementById('rep');
      btn.classList.remove('active-btn');
      btn.style.position = 'relative';
      if (repeatMode === 0) { btn.innerHTML = '<i class="fas fa-redo"></i>'; showToast('Repeat OFF'); }
      else if (repeatMode === 1) { btn.classList.add('active-btn'); btn.innerHTML = '<i class="fas fa-redo"></i><span style="font-size:7px;position:absolute;top:7px;right:5px;font-weight:bold;color:var(--bg)">1</span>'; showToast('🔁 Repeat: One'); }
      else { btn.classList.add('active-btn'); btn.innerHTML = '<i class="fas fa-redo"></i>'; showToast('🔁 Repeat: All'); }
    }

    // ============================================================
    // SONG LIST
    // ============================================================
    function openList(f) {
      const c = document.getElementById('songContainer');
      const l = f ? songs.filter(s => fav.includes(s.url)) : songs;
      const html = l.map(s => `<div class="song-item" onclick="setup(${songs.indexOf(s)}); closeModal()">
        <div style="flex:1"><b>${escapeHtml(s.title)}</b><br><small class="artist" data-uid="${s.uid}" style="color:#555">@${escapeHtml(s.by || '')}</small></div>
        <span onclick="toggleFav('${s.url}', event)" style="color:${fav.includes(s.url) ? 'var(--tiktok-red)' : '#333'}"><i class="fas fa-heart"></i></span>
      </div>`).join('');
      c.innerHTML = html;
      document.getElementById('modalList').style.display = 'block';
      // Clear search input when opening list
      const searchInput = document.getElementById('searchSongInput');
      if (searchInput) searchInput.value = '';
    }
    
    function filterSongList(query) {
      const container = document.getElementById('songContainer');
      if (!container) return;
      const items = container.querySelectorAll('.song-item');
      const q = query.toLowerCase();
      items.forEach(item => {
        const text = item.textContent.toLowerCase();
        item.style.display = text.includes(q) ? 'flex' : 'none';
      });
    }
    
    function toggleFav(u, e) {
      e.stopPropagation();
      if (fav.includes(u)) { fav = fav.filter(x => x !== u); showToast('Dihapus dari Favorit'); }
      else { fav.push(u); showToast('❤️ Ditambahkan ke Favorit'); }
      localStorage.setItem('exeFav', JSON.stringify(fav));
      openList(false);
      if (songs[i] && songs[i].url === u) updateFavoriteUI();
    }

    // ============================================================
    // PROFILE
    // ============================================================
    function openProfile() {
      if (!auth.currentUser) { document.getElementById('modalAuth').style.display = 'block'; return; }
      currentProfileUid = auth.currentUser.uid;
      const myPosts = songs.filter(s => s.uid === auth.currentUser.uid).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      document.getElementById('myPostList').innerHTML = myPosts.map(s =>
        `<div class="mp-song-item" onclick="setup(${songs.indexOf(s)}); closeModal()"><div class="mp-song-icon"><i class="fas fa-music"></i></div><div class="mp-song-info"><div class="mp-song-title">${escapeHtml(s.title)}</div></div><i class="fas fa-play" style="font-size:10px; color:#444"></i></div>`
      ).join('');
      const myLikes = songs.filter(s => fav.includes(s.url));
      document.getElementById('myLikeList').innerHTML = myLikes.map(s =>
        `<div class="mp-song-item" onclick="setup(${songs.indexOf(s)}); closeModal()"><div class="mp-song-icon" style="color:var(--tiktok-red)"><i class="fas fa-heart"></i></div><div class="mp-song-info"><div class="mp-song-title">${escapeHtml(s.title)}</div><div class="mp-song-artist">@${escapeHtml(s.by)}</div></div></div>`
      ).join('');
      switchProfileTab('posts');
      const myTagLower = (userData && userData.tag ? userData.tag.toLowerCase() : '');
      if (myTagLower.includes('velly')) startHearts('love');
      else if (myTagLower.includes('gamers')) startHearts('game');
      else stopHearts();
      if (!audio.paused) {
        audio.pause();
        document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
        document.getElementById('eq').classList.remove('playing');
      }
      if (userData && userData.profilemusic) playProfileMusic(userData.profilemusic);
      else stopProfileMusic();
      document.getElementById('modalProfile').style.display = 'block';
      applyProfileUrl(true);
    }
    function switchProfileTab(tab) {
      document.querySelectorAll('.mp-tab').forEach(t => t.classList.remove('active'));
      document.getElementById('myPostList').style.display = 'none';
      document.getElementById('myLikeList').style.display = 'none';
      if (tab === 'posts') { document.getElementById('tabPosts').classList.add('active'); document.getElementById('myPostList').style.display = 'flex'; }
      else { document.getElementById('tabLikes').classList.add('active'); document.getElementById('myLikeList').style.display = 'flex'; }
    }

    async function viewCreator() {
      const s = songs[i]; if (!s.uid) return;
      if (auth.currentUser && s.uid === auth.currentUser.uid) { openProfile(); return; }
      openCreatorByUid(s.uid);
    }
    async function openCreatorByUid(uid) {
      const cRef = await db.ref('users/' + uid).get();
      const cData = cRef.val();
      const now = Date.now();
      const fcr = (() => { const f = cData?.followers; return Array.isArray(f) ? f.length : (f && typeof f === 'object' ? Object.keys(f).length : f || 0); })();
      const flgr = (() => { const f = cData?.following; return Array.isArray(f) ? f.length : (f && typeof f === 'object' ? Object.keys(f).length : f || 0); })();
      document.getElementById('vAvatarImg').src = cData?.avatar || 'https://via.placeholder.com/150';
      const creatorVip = getVipStatus(cData);
      document.getElementById('vName').innerHTML = '@' + (cData?.username || uid) + (fcr >= 50 ? '<i class="fas fa-check-circle v-badge" style="font-size:13px;margin-left:4px"></i>' : '') + (creatorVip ? ' <i class="fas fa-crown" style="color:#ffd700;font-size:13px;margin-left:4px"></i>' : '');
      document.getElementById('vFol').innerText = fcr;
      document.getElementById('vFollowing').innerText = flgr;
      document.getElementById('vTagDisplay').innerHTML = getTagHTML(cData?.tag);
      
      // Update Admin/Creator Badge for viewer
      updateAdminBadge('v', cData?.role, cData?.admpanel);

      const creatorHeader = document.querySelector('#modalCreator .modern-profile-header');
      if (creatorHeader) {
        creatorHeader.classList.remove(
          'vip',
          'pink-profile',
          'gamers-profile',
          'legend-profile',
          'frost-profile',
          'blaze-profile',
          'cosmic-profile',
          'elite-profile',
          'neon-profile'
        );
        const cTagLower = (cData && cData.tag ? cData.tag.toLowerCase() : '');
        if (cTagLower.includes('velly')) creatorHeader.classList.add('pink-profile');
        else if (cTagLower.includes('gamers')) creatorHeader.classList.add('gamers-profile');
        else if (cTagLower.includes('legend')) creatorHeader.classList.add('legend-profile');
        else if (cTagLower.includes('frost')) creatorHeader.classList.add('frost-profile');
        else if (cTagLower.includes('blaze')) creatorHeader.classList.add('blaze-profile');
        else if (cTagLower.includes('cosmic')) creatorHeader.classList.add('cosmic-profile');
        else if (cTagLower.includes('elite')) creatorHeader.classList.add('elite-profile');
        else if (cTagLower.includes('neon')) creatorHeader.classList.add('neon-profile');
        else if (creatorVip) creatorHeader.classList.add('vip');
      }

      const cTagLower2 = (cData && cData.tag ? cData.tag.toLowerCase() : '');
      if (cTagLower2.includes('velly')) startHearts('love');
      else if (cTagLower2.includes('gamers')) startHearts('game');
      else stopHearts();

      if (cData && cData.profilemusic) playProfileMusic(cData.profilemusic);
      else {
        if (!audio.paused) {
          audio.pause();
          document.getElementById('playBtn').innerHTML = '<i class="fas fa-play"></i>';
          document.getElementById('eq').classList.remove('playing');
        }
        stopProfileMusic();
      }

      const creatorSongs = songs.filter(x => x.uid === uid).sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));
      document.getElementById('creatorPostList').innerHTML = creatorSongs.map(x =>
        `<div class="mp-song-item" onclick="setup(${songs.indexOf(x)}); closeModal()"><div class="mp-song-icon"><i class="fas fa-music"></i></div><div class="mp-song-info"><div class="mp-song-title">${escapeHtml(x.title)}</div></div><i class="fas fa-play" style="font-size:10px; color:#444"></i></div>`
      ).join('');

      document.getElementById('modalCreator').dataset.creatorUid = uid;
      updateCreatorFollowUI(uid);
      document.getElementById('modalCreator').style.display = 'block';
      currentProfileUid = uid;
      applyProfileUrl(true);
    }

    async function updateCreatorFollowUI(uid) {
      if (!auth.currentUser) return;
      const snap = await db.ref('users/' + uid + '/followers').get();
      const fol = snap.val() || {};
      const isF = Array.isArray(fol) ? fol.includes(auth.currentUser.uid) : !!fol[auth.currentUser.uid];
      const btn = document.getElementById('vCreatorFollowBtn');
      if (isF) { btn.innerText = 'Following ✓'; btn.style.background = 'rgba(255,255,255,0.1)'; btn.style.color = '#fff'; }
      else { btn.innerText = 'Follow'; btn.style.background = ''; btn.style.color = ''; }
    }

    async function followCreator() {
      if (!auth.currentUser) return msg('Login dulu!');
      const creatorUid = document.getElementById('modalCreator').dataset.creatorUid;
      if (!creatorUid || creatorUid === auth.currentUser.uid) return msg('Gak bisa follow diri sendiri');
      try {
        const [cSnap, mSnap] = await Promise.all([db.ref('users/' + creatorUid).get(), db.ref('users/' + auth.currentUser.uid).get()]);
        const cData = cSnap.val(), mData = mSnap.val();
        const fArr = Array.isArray(cData?.followers) ? [...cData.followers] : (cData?.followers && typeof cData.followers === 'object' ? Object.keys(cData.followers) : []);
        const flArr = Array.isArray(mData?.following) ? [...mData.following] : (mData?.following && typeof mData.following === 'object' ? Object.keys(mData.following) : []);
        const isF = fArr.includes(auth.currentUser.uid);
        if (isF) {
          await Promise.all([db.ref('users/' + creatorUid).update({ followers: fArr.filter(u => u !== auth.currentUser.uid) }), db.ref('users/' + auth.currentUser.uid).update({ following: flArr.filter(u => u !== creatorUid) })]);
          msg('Unfollowed!');
        } else {
          await Promise.all([db.ref('users/' + creatorUid).update({ followers: [...fArr, auth.currentUser.uid] }), db.ref('users/' + auth.currentUser.uid).update({ following: [...flArr, creatorUid] })]);
          db.ref('users/' + creatorUid + '/notifications').push({ type: 'follow', text: userData.username + ' mulai mengikuti kamu', fromName: userData.username, fromUid: auth.currentUser.uid, timestamp: Date.now() });
          msg('Followed! ✅');
        }
        const newFolCount = isF ? fArr.length - 1 : fArr.length + 1;
        const newFlCount = isF ? flArr.length - 1 : flArr.length + 1;
        syncUserQuestTags(creatorUid, cData || {}, newFolCount, (cData && cData.following) ? (Array.isArray(cData.following) ? cData.following.length : (typeof cData.following === 'object' ? Object.keys(cData.following).length : 0)) : 0);
        syncUserQuestTags(auth.currentUser.uid, mData || {}, (mData && mData.followers) ? (Array.isArray(mData.followers) ? mData.followers.length : (typeof mData.followers === 'object' ? Object.keys(mData.followers).length : 0)) : 0, newFlCount);
        await updateCreatorFollowUI(creatorUid);
      } catch (err) { msg('Error: ' + err.message); }
    }

    // ============================================================
    // SHARING / COPY
    // ============================================================
    function buildDeepLink() { return window.location.origin + window.location.pathname + '?id=' + i; }
    function openCopyLink() { document.getElementById('copyLinkText').textContent = buildDeepLink(); document.getElementById('modalCopyLink').style.display = 'block'; }
    function copyBuiltLink() { navigator.clipboard.writeText(document.getElementById('copyLinkText').textContent).then(() => showToast('Link disalin!')); document.getElementById('modalCopyLink').style.display = 'none'; }
    function shareToWhatsApp() { 
      const txt = '🎵 ' + (songs[i]?.title || 'ExeMusic') + '\n🔗 ' + buildDeepLink(); 
      window.open('https://wa.me/?text=' + encodeURIComponent(txt));
      // Track Ramadhan Cycle 2 - shares
      if (auth.currentUser && userData) {
        ramadhanProgress.cycle2.shares++;
        checkRamadhanProgress();
      }
    }
    function copyRawUrl() { document.getElementById('copyAudioText').textContent = songs[i]?.url || ''; document.getElementById('modalCopyAudio').style.display = 'block'; }
    function copyBuiltAudio() { const t = document.getElementById('copyAudioText').textContent; if (!t) return; navigator.clipboard.writeText(t).then(() => showToast('URL audio disalin')); document.getElementById('modalCopyAudio').style.display = 'none'; }
    function downloadSong() { window.open(songs[i].url); }
    function openReq() { document.getElementById('modalReq').style.display = 'block'; }
    function openAbout() { document.getElementById('modalAbout').style.display = 'block'; }
    function openBoomboxTutorial() { document.getElementById('modalBoombox').style.display = 'block'; }
    function openTutorial() { document.getElementById('tutorialOverlay').style.display = 'flex'; }
    function closeTutorial() { const o = document.getElementById('tutorialOverlay'); o.style.display = 'none'; const v = document.getElementById('tutorialVideo'); if (v) { const src = v.src; v.src = src; } }
    function sendWA() { window.open('https://wa.me/62895329018240?text=Halo Admin, saya ' + document.getElementById('guestName').value + ' ingin upload: ' + document.getElementById('guestLagu').value); }
    function shareProfile(uid, username) { if (!uid) return; navigator.clipboard.writeText(window.location.origin + window.location.pathname + '?profile_userid=' + uid); showToast('Link profil @' + (username || 'user') + ' disalin'); }
    function closeProfileModal() {
      const modal = document.getElementById('modalProfile');
      if (modal) modal.style.display = 'none';
      stopHearts();
      stopProfileMusic();
      currentProfileUid = null;
      applyProfileUrl(true);
    }
    function closeCreatorModal() {
      const modal = document.getElementById('modalCreator');
      if (modal) modal.style.display = 'none';
      stopHearts();
      stopProfileMusic();
      currentProfileUid = null;
      applyProfileUrl(true);
    }
    function openTagSelector() {
      if (!auth.currentUser || !userData) { msg('Login dulu!'); return; }
      ensureCurrentTagInAlltag(auth.currentUser.uid, userData);
      const all = userData.alltag || {};
      const keys = Object.keys(all).filter(k => all[k]);
      if (!keys.length) { msg('Belum ada tag yang kebuka'); return; }
      const modal = document.getElementById('modalTagSelector');
      const curEl = document.getElementById('tagSelectorCurrent');
      const grid = document.getElementById('tagSelectorChipGrid');
      const info = document.getElementById('tagSelectorAllInfo');
      if (!modal || !curEl || !grid || !info) return;
      const cur = (userData.tag || 'none').toLowerCase();
      curEl.innerHTML = cur === 'none' ? 'Tanpa tag aktif' : 'Tag aktif: ' + getTagHTML(cur);
      const chips = keys.map(k => {
        const meta = TAG_META[k] || { title: k.toUpperCase() };
        return `<button class="tag-chip" data-tag="${k}"><span class="user-tag tag-${k}">${meta.title}</span></button>`;
      }).join('') + `<button class="tag-chip tag-chip-none" data-tag="none">TANPA TAG</button>`;
      grid.innerHTML = chips;
      if (!grid.dataset.bound) {
        grid.dataset.bound = '1';
        grid.addEventListener('click', function(e) {
          const btn = e.target.closest('.tag-chip');
          if (!btn) return;
          const tag = btn.dataset.tag;
          const uid = auth.currentUser && auth.currentUser.uid;
          if (!uid || !userData) return;
          const updates = {};
          updates['users/' + uid + '/tag'] = tag === 'none' ? 'none' : tag;
          if (tag !== 'none') {
            updates['users/' + uid + '/alltag/' + tag] = true;
          }
          db.ref().update(updates).then(() => {
            document.getElementById('modalTagSelector').style.display = 'none';
            showToast('Tag diganti');
          });
        });
      }
      if (!info.dataset.filled) {
        const rows = Object.keys(TAG_META).map(k => {
          const m = TAG_META[k];
          return `<div class="tag-meta-row">
            <div><span class="user-tag tag-${k}">${m.title}</span></div>
            <div class="tag-meta-desc">${m.desc}</div>
          </div>`;
        }).join('');
        info.innerHTML = rows;
        info.dataset.filled = '1';
      }
      modal.style.display = 'block';
    }

    // ============================================================
    // NOTIFICATIONS - CLEAR
    // ============================================================
    function openClearNotifConfirm() { document.getElementById('modalClearNotif').style.display = 'block'; }
    function confirmClearNotif() {
      if (!auth.currentUser) return msg('Login dulu!');
      db.ref('users/' + auth.currentUser.uid + '/notifications').remove().then(() => {
        document.getElementById('modalClearNotif').style.display = 'none';
        mergeAndRenderNotifs([], 'user'); updateNotifBadge();
        showToast('Notifikasi dibersihkan');
      }).catch(() => showToast('Gagal menghapus notifikasi'));
    }

    // ============================================================
    // CHANGE NAME / PASSWORD
    // ============================================================
    function openChangeNameModal() {
      document.getElementById('cnMsg').innerText = ''; document.getElementById('cnMsg').classList.remove('show', 'success', 'error');
      document.getElementById('cnPass').value = ''; document.getElementById('cnNewName').value = '';
      document.getElementById('modalChangeNames').style.display = 'block';
    }
    async function handleChangeName() {
      const password = document.getElementById('cnPass').value;
      const newName = document.getElementById('cnNewName').value;
      const msgEl = document.getElementById('cnMsg');
      msgEl.classList.remove('success', 'error');
      if (!newName || !password) { msgEl.innerText = '⚠️ Isi semua field!'; msgEl.classList.add('show', 'error'); return; }
      if (newName.length < 3) { msgEl.innerText = '⚠️ Nama minimal 3 karakter!'; msgEl.classList.add('show', 'error'); return; }
      const lastChange = userData.lastNameChange || 0;
      const diffDays = (Date.now() - lastChange) / (1000 * 60 * 60 * 24);
      if (diffDays < 7) { msgEl.innerText = `⏳ Tunggu ${Math.ceil(7 - diffDays)} hari lagi!`; msgEl.classList.add('show', 'error'); return; }
      const credential = firebase.auth.EmailAuthProvider.credential(auth.currentUser.email, password);
      try {
        await auth.currentUser.reauthenticateWithCredential(credential);
        await db.ref('users/' + auth.currentUser.uid).update({ username: newName, lastNameChange: Date.now() });
        msgEl.innerText = '✅ Nama berhasil diubah!'; msgEl.classList.add('show', 'success');
        setTimeout(() => { document.getElementById('modalChangeNames').style.display = 'none'; msg('Nama pengguna diperbarui!'); }, 1500);
      } catch { msgEl.innerText = '❌ Password salah!'; msgEl.classList.add('show', 'error'); }
    }
    function openChangePasswordModal() {
      document.getElementById('cpMsg').innerText = ''; document.getElementById('cpMsg').classList.remove('show', 'success', 'error');
      ['cpOldPass', 'cpNewPass', 'cpConfirm'].forEach(id => document.getElementById(id).value = '');
      document.getElementById('modalChangePass').style.display = 'block';
    }
    function toggleProfileMusicInput() {
      const row = document.getElementById('profileMusicRow');
      if (!row) return;
      row.style.display = row.style.display === 'none' || row.style.display === '' ? 'block' : 'none';
    }
    function saveProfileMusic() {
      if (!auth.currentUser || !userData) return msg('Login dulu!');
      const vipType = getVipStatus(userData);
      if (!vipType) return msg('Fitur ini khusus VIP / VIP Trial');
      const inp = document.getElementById('profileMusicUrl');
      if (!inp) return;
      const url = inp.value.trim();
      db.ref('users/' + auth.currentUser.uid).update({ profilemusic: url || null }).then(() => {
        userData.profilemusic = url || null;
        msg('Music profil disimpan');
      }).catch(() => msg('Gagal menyimpan music profil'));
    }
    async function handleChangePassword() {
      const oldPass = document.getElementById('cpOldPass').value;
      const newPass = document.getElementById('cpNewPass').value;
      const confirm = document.getElementById('cpConfirm').value;
      const msgEl = document.getElementById('cpMsg');
      msgEl.classList.remove('success', 'error');
      if (!oldPass || !newPass || !confirm) { msgEl.innerText = '⚠️ Isi semua field!'; msgEl.classList.add('show', 'error'); return; }
      if (newPass.length < 6) { msgEl.innerText = '⚠️ Password min 6 karakter!'; msgEl.classList.add('show', 'error'); return; }
      if (newPass !== confirm) { msgEl.innerText = '⚠️ Password tidak cocok!'; msgEl.classList.add('show', 'error'); return; }
      const lastChange = userData.lastPasswordChange || 0;
      const diffDays = (Date.now() - lastChange) / (1000 * 60 * 60 * 24);
      if (diffDays < 7) { msgEl.innerText = `⏳ Tunggu ${Math.ceil(7 - diffDays)} hari lagi!`; msgEl.classList.add('show', 'error'); return; }
      const credential = firebase.auth.EmailAuthProvider.credential(auth.currentUser.email, oldPass);
      try {
        await auth.currentUser.reauthenticateWithCredential(credential);
        await auth.currentUser.updatePassword(newPass);
        await db.ref('users/' + auth.currentUser.uid).update({ lastPasswordChange: Date.now() });
        msgEl.innerText = '✅ Password berhasil diubah!'; msgEl.classList.add('show', 'success');
        setTimeout(() => { document.getElementById('modalChangePass').style.display = 'none'; msg('Password diperbarui!'); }, 1500);
      } catch { msgEl.innerText = '❌ Password lama salah!'; msgEl.classList.add('show', 'error'); }
    }

    // ============================================================
    // GOOGLE AUTH
    // ============================================================
    function handleGoogleAuth() {
      if (isFirstTimeUser) {
        const username = document.getElementById('authUser').value.trim();
        if (!username || username.length < 3) { msg('❌ Username minimal 3 karakter!'); return; }
        const user = auth.currentUser;
        if (!user) { msg('❌ Session expired'); isFirstTimeUser = false; document.getElementById('usernameSection').style.display = 'none'; document.getElementById('googleBtnText').innerText = 'Masuk dengan Google'; return; }
        db.ref('users/' + user.uid).set({ username, email: user.email, avatar: user.photoURL || 'https://via.placeholder.com/150', role: 'user', followers: {}, following: {}, tag: 'user', createdAt: Date.now() })
          .then(() => { isFirstTimeUser = false; document.getElementById('usernameSection').style.display = 'none'; document.getElementById('googleBtnText').innerText = 'Masuk dengan Google'; closeModal(); msg('✅ Selamat datang ' + username + '!'); })
          .catch(err => msg('❌ Gagal: ' + err.message));
      } else {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.setCustomParameters({ prompt: 'select_account' });
        auth.signInWithPopup(provider).then(result => {
          const isNew = result.additionalUserInfo.isNewUser;
          if (isNew) { isFirstTimeUser = true; document.getElementById('googleBtnText').innerText = 'Buat Akun'; document.getElementById('usernameSection').style.display = 'block'; msg('👋 Buat username Anda!'); }
          else { closeModal(); msg('✅ Selamat datang kembali!'); }
        }).catch(err => {
          if (err.code === 'auth/popup-closed-by-user') msg('⚠️ Login dibatalkan');
          else if (err.code !== 'auth/cancelled-popup-request') msg('❌ Gagal login: ' + err.message);
        });
      }
    }

    function uploadAvatar(input) {
      const file = input.files[0]; if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => { db.ref('users/' + auth.currentUser.uid).update({ avatar: e.target.result }).then(() => msg('Foto profil diperbarui!')); };
      reader.readAsDataURL(file);
    }

    // ============================================================
    // ADMIN PANEL - LOCK GATE + CAPTCHA
    // ============================================================
    let algSecret = '';
    let adMtState = false;

    async function openAdminPanel() {
      if (!auth.currentUser || !userData || (userData.role !== 'admin' && userData.role !== 'owner')) {
        msg('Khusus admin');
        return;
      }
      const uid = auth.currentUser.uid;
      const snap = await db.ref('users/' + uid + '/pwadmin').get();
      let pw = snap.val();
      if (!pw) {
        const resSet = await Swal.fire({
          title: 'Set Admin Password',
          input: 'password',
          inputPlaceholder: 'Password admin baru',
          confirmButtonText: 'Simpan',
          showCancelButton: true,
          background: '#0d0d15',
          color: '#fff'
        });
        if (!resSet.value) return;
        pw = resSet.value;
        await db.ref('users/' + uid).update({ pwadmin: pw });
        showToast('Password admin disimpan');
      } else {
        const res = await Swal.fire({
          title: 'Admin Password',
          input: 'password',
          inputPlaceholder: 'Masukkan password admin',
          confirmButtonText: 'Masuk',
          showCancelButton: true,
          background: '#0d0d15',
          color: '#fff'
        });
        if (!res.value || res.value !== pw) {
          msg('Password admin salah');
          return;
        }
      }
      const overlay = document.getElementById('adminPanelOverlay');
      const inner = document.getElementById('adminPanelInner');
      overlay.classList.add('show');
      inner.style.display = 'flex';
      adLoadData();
    }

    function algGenCaptcha() {
      const canvas = document.getElementById('algCapCanvas');
      if (!canvas) return;
      const ctx = canvas.getContext('2d');
      canvas.width = 290; canvas.height = 80;

      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
      algSecret = '';
      for (let c = 0; c < 5; c++) algSecret += chars[Math.floor(Math.random() * chars.length)];

      // bg
      ctx.fillStyle = '#020d15';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // grid lines
      ctx.strokeStyle = 'rgba(0,212,255,0.08)'; ctx.lineWidth = 1;
      for (let x = 0; x < canvas.width; x += 25) { ctx.beginPath(); ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); ctx.stroke(); }
      for (let y = 0; y < canvas.height; y += 20) { ctx.beginPath(); ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); ctx.stroke(); }

      // noise dots
      for (let n = 0; n < 40; n++) {
        ctx.fillStyle = `rgba(0,255,136,${Math.random()*0.25})`;
        ctx.beginPath(); ctx.arc(Math.random()*canvas.width, Math.random()*canvas.height, Math.random()*2, 0, Math.PI*2);
        ctx.fill();
      }

      // noise lines
      for (let l = 0; l < 4; l++) {
        ctx.strokeStyle = `rgba(${Math.random()>0.5?'0,255,136':'0,212,255'},${Math.random()*0.3+0.1})`;
        ctx.lineWidth = 1; ctx.beginPath();
        ctx.moveTo(Math.random()*canvas.width, Math.random()*canvas.height);
        ctx.lineTo(Math.random()*canvas.width, Math.random()*canvas.height);
        ctx.stroke();
      }

      // each character
      const colors = ['#00ff88','#00d4ff','#ffd700','#ffffff','#a0f0c0'];
      for (let c = 0; c < 5; c++) {
        ctx.save();
        const x = 28 + c * 50;
        const y = 42 + (Math.random() * 16 - 8);
        ctx.translate(x, y);
        ctx.rotate((Math.random() - 0.5) * 0.45);
        ctx.font = `bold ${34 + Math.random()*10}px 'Courier New', monospace`;
        ctx.textAlign = 'center'; ctx.textBaseline = 'middle';
        ctx.shadowColor = colors[c % colors.length];
        ctx.shadowBlur = 12;
        ctx.fillStyle = colors[c % colors.length];
        ctx.fillText(algSecret[c], 0, 0);
        ctx.restore();
      }

      // update fallback display
      const disp = document.getElementById('algCodeDisplay');
      if (disp) disp.textContent = algSecret;
    }

    function algVerify() {
      const inner = document.getElementById('adminPanelInner');
      if (!inner) return;
      inner.style.display = 'flex';
      adLoadData();
    }

    function closeAdminPanel() {
      const overlay = document.getElementById('adminPanelOverlay');
      const inner = document.getElementById('adminPanelInner');
      if (!overlay || !inner) return;
      overlay.classList.remove('show');
      inner.style.display = 'none';
      adminMode = 'normal';
      inner.classList.remove('admin-full', 'admin-mini');
      overlay.classList.remove('admin-overlay-mini');
      inner.style.position = '';
      inner.style.top = '';
      inner.style.left = '';
      inner.style.right = '';
      inner.style.bottom = '';
    }

    function startAdminDrag(e) {
      const panel = document.getElementById('adminPanelInner');
      if (!panel || adminMode === 'full') return;
      if (e.target.closest('button')) return;
      adminDrag.active = true;
      const rect = panel.getBoundingClientRect();
      adminDrag.offsetX = e.clientX - rect.left;
      adminDrag.offsetY = e.clientY - rect.top;
      document.addEventListener('mousemove', onAdminDrag);
      document.addEventListener('mouseup', stopAdminDrag);
    }
    function onAdminDrag(e) {
      if (!adminDrag.active) return;
      const panel = document.getElementById('adminPanelInner');
      if (!panel) return;
      panel.style.position = 'fixed';
      panel.style.top = (e.clientY - adminDrag.offsetY) + 'px';
      panel.style.left = (e.clientX - adminDrag.offsetX) + 'px';
      panel.style.right = 'auto';
      panel.style.bottom = 'auto';
    }
    function stopAdminDrag() {
      adminDrag.active = false;
      document.removeEventListener('mousemove', onAdminDrag);
      document.removeEventListener('mouseup', stopAdminDrag);
    }
    function toggleAdminSize(mode) {
      const overlay = document.getElementById('adminPanelOverlay');
      const panel = document.getElementById('adminPanelInner');
      if (!overlay || !panel) return;
      if (mode === 'full') {
        adminMode = adminMode === 'full' ? 'normal' : 'full';
      } else if (mode === 'mini') {
        adminMode = adminMode === 'mini' ? 'normal' : 'mini';
      }
      panel.classList.remove('admin-full', 'admin-mini');
      overlay.classList.remove('admin-overlay-mini');
      if (adminMode === 'full') {
        panel.classList.add('admin-full');
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      } else if (adminMode === 'mini') {
        panel.classList.add('admin-mini');
        overlay.classList.add('admin-overlay-mini');
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      } else {
        panel.style.position = '';
        panel.style.top = '';
        panel.style.left = '';
      }
    }

    function switchAdminView(id, btn) {
      document.querySelectorAll('.admin-view').forEach(v => v.classList.remove('active'));
      document.querySelectorAll('.admin-nav-btn').forEach(b => b.classList.remove('active'));
      document.getElementById('adv-' + id).classList.add('active');
      btn.classList.add('active');
      if (id === 'songs') renderAdminSongs();
      if (id === 'dash') {
        document.getElementById('adCountS').innerText = songs.length;
        db.ref('users').once('value').then(s => { document.getElementById('adCountU').innerText = s.numChildren(); });
      }
    }

    const TAG_META = {
      user: { title: 'USER', desc: 'Tag default semua user' },
      newbie: { title: 'NEWBIE', desc: '10+ followers' },
      pro: { title: 'PRO', desc: '50+ followers' },
      terkeren: { title: 'TERKEREN', desc: '150+ followers, special' },
      tersulit: { title: 'TERSULIT', desc: '150+ followers, special' },
      vip: { title: 'VIP', desc: 'Pernah VIP atau trial' },
      vvip: { title: 'VVIP', desc: 'Tag spesial sangat langka' },
      legend: { title: 'LEGEND', desc: 'Creator legend pilihan admin' },
      mythic: { title: 'MYTHIC', desc: 'Tag event eksklusif' },
      godlike: { title: 'GODLIKE', desc: 'Performa upload dan followers tinggi' },
      savage: { title: 'SAVAGE', desc: 'Aktif upload dan support creator lain' },
      ultra: { title: 'ULTRA', desc: 'Kombinasi event dan pencapaian' },
      velly: { title: 'VELLY', desc: 'Tag spesial owner' },
      gamers: { title: 'GAMERS', desc: 'Tag eksklusif bisa dibeli pakai ExeCoin' },
      execurive: { title: 'EXECURIVE', desc: 'Tag premium ExeCoin, terlihat lebih profesional' },
      frost: { title: 'FROST', desc: 'Calm elite listener dengan aura dingin dan clean' },
      blaze: { title: 'BLAZE', desc: 'Energy dominator dengan vibe panas dan agresif' },
      cosmic: { title: 'COSMIC', desc: 'Future listener dengan nuansa galaxy futuristik' },
      elite: { title: 'ELITE', desc: 'Top tier member dengan kesan mahal dan prestige' },
      neon: { title: 'NEON', desc: 'Cyber night user dengan aura tech dan cyberpunk' },
      'ramadhan-1447h': { title: 'RAMADHAN 1447H', desc: '🌅 Event Ramadhan Cycle 1: Login 3 hari + Play 10 lagu + Online 30 menit' },
      'night-tarawih': { title: 'NIGHT TARAWIH', desc: '🌙 Event Ramadhan Cycle 2: Online jam 18-20 (2 hari) + Share 2 lagu + Like 5 lagu' },
      'valentine': { title: 'VALENTINE', desc: '💕 Event Valentine: Dapatkan tag cinta spesial' },
      'love-story': { title: 'LOVE STORY', desc: '💖 Untuk yang mengalami story cinta indah' },
      'heartbreaker': { title: 'HEARTBREAKER', desc: '💔 Tapi tetep semangat! Tag motivasi' },
      'lailat-mode': { title: 'LAILAT MODE', desc: '🕌 Event Ramadhan Cycle 3: Login 7/10 hari terakhir + 120 menit playtime + Aktif jam 23+' },
      'exe-sahur': { title: 'EXE-SAHUR', desc: '🌙 SECRET TAG: Upload lagu jam 03:00-05:00 (waktu sahur) - Auto grant jika enabled' }
    };
    let adSelectedUserUid = null;

    function initTagDropSelect() {
      const sel = document.getElementById('adTagDropName');
      if (!sel || sel.dataset.bound) return;
      let html = '<option value="">Pilih tag...</option>';
      Object.keys(TAG_META).forEach(k => {
        if (k === 'user') return;
        const m = TAG_META[k];
        html += `<option value="${k}">${m.title}</option>`;
      });
      sel.innerHTML = html;
      sel.dataset.bound = '1';
    }

    function initAdminTagUI() {
      const info = document.getElementById('adAllTagInfo');
      if (info) {
        const rows = Object.keys(TAG_META).map(k => {
          const m = TAG_META[k];
          return `<div class="admin-tag-meta-row">
            <div><span class="user-tag tag-${k}">${m.title}</span></div>
            <div class="admin-tag-meta-desc">${m.desc}</div>
          </div>`;
        }).join('');
        info.innerHTML = rows;
      }
      
      // Init test tag select
      const testSel = document.getElementById('adTestTagSelect');
      if (testSel && !testSel.dataset.bound) {
        let html = '<option value="">Pilih tag untuk testing...</option>';
        Object.keys(TAG_META).forEach(k => {
          if (k === 'user') return;
          const m = TAG_META[k];
          html += `<option value="${k}">${m.title}</option>`;
        });
        testSel.innerHTML = html;
        testSel.dataset.bound = '1';
      }
      
      const grid = document.getElementById('adTagChipGrid');
      if (grid && !grid.dataset.bound) {
        const chips = Object.keys(TAG_META).map(k => {
          const m = TAG_META[k];
          return `<button class="admin-tag-chip" data-tag="${k}"><span class="user-tag tag-${k}">${m.title}</span></button>`;
        }).join('');
        grid.innerHTML = chips;
        grid.dataset.bound = '1';
        grid.addEventListener('click', function(e) {
          const btn = e.target.closest('.admin-tag-chip');
          if (!btn) return;
          const tag = btn.dataset.tag;
          if (!adSelectedUserUid) return;
          adSetUserTag(adSelectedUserUid, tag);
        });
      }
    }

    function adSelectUser(uid) {
      const u = adAllUsers.find(x => x.uid === uid);
      const body = document.getElementById('adTagEditor');
      const empty = document.getElementById('adTagEditorEmpty');
      if (!u || !body || !empty) return;
      adSelectedUserUid = uid;
      empty.style.display = 'none';
      body.style.display = 'block';
      const nameEl = document.getElementById('adTagUserName');
      const curEl = document.getElementById('adTagCurrentDisplay');
      if (nameEl) nameEl.textContent = '@' + (u.username || uid);
      if (curEl) curEl.innerHTML = getTagHTML(u.tag);
    }

    function adLoadData() {
      if (adminLoaded) return;
      adminLoaded = true;
      db.ref('users').on('value', snap => {
        const data = snap.val() || {};
        adAllUsers = Object.keys(data).map(uid => ({ uid, ...data[uid] }));
        document.getElementById('adCountU').innerText = adAllUsers.length;
        adRenderUsers(adAllUsers);
        initAdminTagUI();
      });
      db.ref('songs').on('value', snap => {
        const data = snap.val() || {};
        adAllSongs = Object.keys(data).map(key => ({ key, ...data[key] }));
        document.getElementById('adCountS').innerText = adAllSongs.length;
      });
      // Logs - realtime
      db.ref('logs').limitToLast(50).on('value', snap => {
        const box = document.getElementById('adLogBox');
        if (!box) return;
        let h = '';
        snap.forEach(c => { const l = c.val(); h = `<div class="log-line"><span class="log-time">[${l.time}]</span> ${escapeHtml(l.msg)}</div>` + h; });
        box.innerHTML = h || '<div style="color:#333">No logs</div>';
      });
      db.ref('settings').on('value', s => {
        const sv = s.val() || {};
        adMtState = sv.mt || false;
        if (sv.announcement) document.getElementById('adBcInput').value = sv.announcement;
        initTagDropSelect();
        const td = sv.tagDrop || null;
        const nameInp = document.getElementById('adTagDropName');
        const chInp = document.getElementById('adTagDropChance');
        const durInp = document.getElementById('adTagDropDuration');
        const maxInp = document.getElementById('adTagDropMax');
        const statusEl = document.getElementById('adTagDropStatus');
        if (nameInp && chInp && durInp && maxInp && statusEl) {
          if (!td) {
            nameInp.value = '';
            chInp.value = '0';
            durInp.value = '1800';
            maxInp.value = '0';
            statusEl.textContent = 'Event OFF';
          } else {
            nameInp.value = td.tag || '';
            chInp.value = String(Math.round((td.chance || 0) * 100));
            durInp.value = String(td.durationSec || 1800);
            maxInp.value = String(td.maxWinners || 0);
            statusEl.textContent = td.active ? 'Event aktif: ' + (td.tag || '') : 'Event tersimpan';
          }
        }
        currentTagDrop = td;
        setupTagDropWatcher();
        const gTitleEl = document.getElementById('adGlobalTitle');
        const gDateEl = document.getElementById('adGlobalDate');
        const gTimeEl = document.getElementById('adGlobalTime');
        const gc = sv.globalCountdown || null;
        if (gTitleEl && gDateEl && gTimeEl) {
          if (gc && gc.targetTs) {
            gTitleEl.value = gc.title || '';
            const dt = new Date(gc.targetTs);
            const yyyy = dt.getFullYear();
            const mm = String(dt.getMonth() + 1).padStart(2, '0');
            const dd = String(dt.getDate()).padStart(2, '0');
            const hh = String(dt.getHours()).padStart(2, '0');
            const mi = String(dt.getMinutes()).padStart(2, '0');
            gDateEl.value = `${yyyy}-${mm}-${dd}`;
            gTimeEl.value = `${hh}:${mi}`;
          } else {
            gTitleEl.value = '';
            gDateEl.value = '';
            gTimeEl.value = '00:00';
          }
        }
      });
    }

    function adRenderUsers(users) {
      const box = document.getElementById('adUserList');
      if (!box) return;
      if (!users.length) { box.innerHTML = '<div style="text-align:center;padding:30px;color:#444">Tidak ada user</div>'; return; }
      box.innerHTML = users.map(u => {
        const folCount = Array.isArray(u.followers) ? u.followers.length : (u.followers && typeof u.followers === 'object' ? Object.keys(u.followers).length : u.followers || 0);
        const tagHtml = getTagHTML(u.tag);
        const fakeTarget = u.fakeFollowerTarget || 0;
        const fakeAdded = u.fakeFollowerAdded || 0;
        const fakeStatus = fakeTarget > 0 ? `<span style="color:#22c55e;font-size:10px;margin-left:8px"><i class="fas fa-robot"></i> ${fakeAdded}/${fakeTarget}</span>` : '';
        return `<div class="user-row-admin">
          <div class="ur-top">
            <div style="flex:1">
              <div class="ur-name" onclick="adSelectUser('${u.uid}')">${escapeHtml(u.username || 'Unknown')} ${tagHtml} ${fakeStatus}</div>
              <div class="ur-uid">${u.uid}</div>
            </div>
          </div>
          <div class="ur-actions">
            <button class="admin-btn admin-btn-green" onclick="adSetFakeFollowerTarget('${u.uid}')" style="padding:6px 10px;font-size:10px" title="Set Fake Follower Target"><i class="fas fa-robot"></i></button>
            <button class="admin-btn admin-btn-gold" onclick="adSelectUser('${u.uid}')" style="padding:6px 10px;font-size:11px">TAG</button>
            <button class="admin-btn admin-btn-blue" onclick="adOpenUserTools('${u.uid}','${escapeHtml(u.username||'')}')" style="padding:6px 10px;font-size:11px">TOOLS</button>
            <button class="admin-btn admin-btn-red" onclick="adToggleBan('${u.uid}', ${!!u.banned})" style="padding:6px 10px;font-size:11px">${u.banned ? 'UNBAN' : 'BAN'}</button>
          </div>
        </div>`;
      }).join('');
    }

    function adFilterUsers(q) {
      const filtered = adAllUsers.filter(u => (u.username || '').toLowerCase().includes(q.toLowerCase()) || u.uid.includes(q));
      adRenderUsers(filtered);
    }

    function renderAdminSongs() {
      if (adAllSongs.length > 0) { adRenderSongs(adAllSongs); return; }
      db.ref('songs').once('value').then(snap => {
        adAllSongs = [];
        snap.forEach(c => adAllSongs.push({ key: c.key, ...c.val() }));
        document.getElementById('adCountS').innerText = adAllSongs.length;
        adRenderSongs(adAllSongs);
      });
    }
    function adRenderSongs(list) {
      const box = document.getElementById('adSongList');
      if (!box) return;
      box.innerHTML = list.map(s => `<div class="admin-song-row">
        <div class="as-info"><div class="as-title">${escapeHtml(s.title)}</div><div class="as-by">@${escapeHtml(s.by || '')}</div></div>
        <button class="admin-btn admin-btn-red" onclick="adDelSong('${s.key}')" style="padding:6px 10px;font-size:11px"><i class="fas fa-trash"></i></button>
      </div>`).join('');
    }
    function adFilterSongs(q) {
      const filtered = adAllSongs.filter(s => s.title.toLowerCase().includes(q.toLowerCase()) || (s.by || '').toLowerCase().includes(q.toLowerCase()));
      adRenderSongs(filtered);
    }

    function adDelSong(id) {
      Swal.fire({ title: 'Hapus Lagu?', text: 'Permanen!', icon: 'warning', showCancelButton: true, confirmButtonColor: '#ff3333', confirmButtonText: 'Hapus!', background: '#0d0d15', color: '#fff' })
        .then(r => { if (r.isConfirmed) { db.ref('songs/' + id).remove(); addLog('Deleted song: ' + id); showToast('Lagu dihapus'); } });
    }

    function adManualAdd() {
      const title = document.getElementById('adAddTitle').value;
      const url = document.getElementById('adAddUrl').value;
      if (!title || !url) { showToast('Isi judul dan URL!'); return; }
      db.ref('songs').push({ title, url, uid: 'ADMIN', by: 'ADMIN', timestamp: Date.now() })
        .then(() => { addLog('Admin upload: ' + title); showToast('✅ Lagu ditambahkan!'); document.getElementById('adAddTitle').value = ''; document.getElementById('adAddUrl').value = ''; });
    }

    function adSendBC() {
      const v = document.getElementById('adBcInput').value;
      if (!v) { showToast('Isi pesan dulu!'); return; }
      db.ref('settings').update({ announcement: v });
      addLog('Broadcast: ' + v);
      showToast('✅ Broadcast terkirim!');
    }
    function adClearBC() { db.ref('settings/announcement').remove(); showToast('Broadcast dihapus'); }
    function adSaveGlobalCountdown() {
      const titleEl = document.getElementById('adGlobalTitle');
      const dEl = document.getElementById('adGlobalDate');
      const tEl = document.getElementById('adGlobalTime');
      if (!titleEl || !dEl || !tEl) return;
      const title = (titleEl.value || '').trim() || 'Admin Event';
      const d = dEl.value;
      const t = tEl.value || '00:00';
      if (!d) { showToast('Isi tanggal event dulu!'); return; }
      const partsD = d.split('-').map(Number);
      const partsT = t.split(':').map(Number);
      const year = partsD[0], month = (partsD[1] || 1) - 1, day = partsD[2] || 1;
      const hour = partsT[0] || 0, minute = partsT[1] || 0;
      const ts = new Date(year, month, day, hour, minute, 0).getTime();
      if (isNaN(ts)) { showToast('Tanggal tidak valid'); return; }
      const payload = { title, targetTs: ts, active: true };
      db.ref('settings/globalCountdown').set(payload).then(() => {
        addLog('Set GlobalCountdown: ' + ts + ' (' + title + ')');
        showToast('✅ Countdown admin disimpan');
      });
    }
    function adClearGlobalCountdown() {
      db.ref('settings/globalCountdown').remove().then(() => {
        addLog('Clear GlobalCountdown');
        showToast('Countdown admin dimatikan');
        const wrap = document.getElementById('globalCountdown');
        if (wrap) wrap.classList.remove('show');
        if (globalCountdownInterval) {
          clearInterval(globalCountdownInterval);
          globalCountdownInterval = null;
        }
      });
    }
    function adSaveLebaran() {
      const d = document.getElementById('adLebaranDate').value;
      const t = document.getElementById('adLebaranTime').value || '00:00';
      if (!d) { showToast('Isi tanggal Lebaran dulu!'); return; }
      const partsD = d.split('-').map(Number);
      const partsT = t.split(':').map(Number);
      const year = partsD[0], month = (partsD[1] || 1) - 1, day = partsD[2] || 1;
      const hour = partsT[0] || 0, minute = partsT[1] || 0;
      const ts = new Date(year, month, day, hour, minute, 0).getTime();
      if (isNaN(ts)) { showToast('Tanggal tidak valid'); return; }
      db.ref('settings').update({ lebaranTs: ts }).then(() => {
        addLog('Set Lebaran TS: ' + ts);
        showToast('✅ Countdown Lebaran disimpan');
      });
    }
    function adClearLebaran() {
      db.ref('settings/lebaranTs').remove().then(() => {
        addLog('Clear Lebaran TS');
        showToast('Countdown Lebaran dimatikan');
        const lc = document.getElementById('lebaranCountdown');
        if (lc) lc.classList.remove('show', 'celebrate');
        if (lebaranInterval) { clearInterval(lebaranInterval); lebaranInterval = null; }
      });
    }

    // ============================================================
    // ADMIN RAMADHAN EVENT - v3.2.3
    // ============================================================
    function adSaveRamadhanEvent() {
      const startDate = document.getElementById('adRamadhanStart').value;
      const endDate = document.getElementById('adRamadhanEnd').value;
      if (!startDate || !endDate) {
        showToast('Isi tanggal mulai dan selesai');
        return;
      }
      const startTs = new Date(startDate).getTime();
      const endTs = new Date(endDate).getTime();
      if (isNaN(startTs) || isNaN(endTs)) {
        showToast('Tanggal tidak valid');
        return;
      }
      db.ref('settings/ramadhanEvent').set({
        enabled: true,
        startTs: startTs,
        endTs: endTs
      }).then(() => {
        addLog('Ramadhan Event Enabled: ' + startDate + ' - ' + endDate);
        showToast('✅ Event Ramadhan diaktifkan');
      });
    }
    
    function adClearRamadhanEvent() {
      db.ref('settings/ramadhanEvent').remove().then(() => {
        addLog('Ramadhan Event Disabled');
        showToast('Event Ramadhan dinonaktifkan');
      });
    }
    
    function adViewRamadhanProgress() {
      showToast('Fitur monitoring progress akan segera hadir');
      // TODO: Implementasi view progress semua user
    }
    
    function adEnableSahurTag() {
      db.ref('settings/sahurTagEnabled').set(true).then(() => {
        addLog('Sahur Tag Auto Enabled');
        showToast('✅ Auto Sahur Tag diaktifkan');
        updateSahurStatus();
      });
    }
    
    function adDisableSahurTag() {
      db.ref('settings/sahurTagEnabled').set(false).then(() => {
        addLog('Sahur Tag Auto Disabled');
        showToast('Auto Sahur Tag dinonaktifkan');
        updateSahurStatus();
      });
    }
    
    function updateSahurStatus() {
      db.ref('settings/sahurTagEnabled').once('value', snap => {
        const enabled = snap.val() === true;
        const statusEl = document.getElementById('adSahurStatus');
        if (statusEl) {
          statusEl.textContent = 'Status: ' + (enabled ? '✅ AKTIF (Auto grant jam 03:00-05:00)' : '❌ NONAKTIF');
          statusEl.style.color = enabled ? '#22c55e' : '#888';
        }
      });
    }
    
    // ============================================================
    // ADMIN TAG TESTING - v3.2.3
    // ============================================================
    function adGrantTestTag() {
      if (!auth.currentUser || !userData) {
        showToast('Login dulu sebagai admin');
        return;
      }
      const sel = document.getElementById('adTestTagSelect');
      if (!sel) return;
      const tag = sel.value;
      if (!tag) {
        showToast('Pilih tag dulu');
        return;
      }
      const uid = auth.currentUser.uid;
      const updates = {};
      updates['users/' + uid + '/alltag/' + tag] = true;
      db.ref().update(updates).then(() => {
        if (!userData.alltag) userData.alltag = {};
        userData.alltag[tag] = true;
        showTagUnlockFullscreen([tag]);
        showToast('✅ Tag ' + TAG_META[tag].title + ' berhasil di-grant untuk testing');
        addLog('Admin grant test tag: ' + tag);
      }).catch(err => {
        showToast('❌ Gagal grant tag: ' + err.message);
      });
    }
    function adToggleMT() {
      adMtState = !adMtState;
      db.ref('settings').update({ mt: adMtState });
      addLog('Maintenance: ' + adMtState);
      showToast('Maintenance: ' + (adMtState ? 'AKTIF' : 'OFF'));
    }
    function adOpenClearNotif() {
      if (!auth.currentUser) return msg('Login dulu!');
      db.ref('users/' + auth.currentUser.uid + '/notifications').remove().then(() => { mergeAndRenderNotifs([], 'user'); updateNotifBadge(); showToast('Notif dibersihkan'); });
    }
    function adClearLogs() { db.ref('logs').remove().then(() => showToast('Logs dihapus')); }

    function adSendFloatChat() {
      if (!auth.currentUser || !userData || (userData.role !== 'admin' && userData.role !== 'owner')) {
        showToast('Hanya admin/owner yang bisa kirim chat ini');
        return;
      }
      const inp = document.getElementById('adFloatMsg');
      if (!inp) return;
      const msg2 = inp.value.trim();
      if (!msg2) { showToast('Isi pesan dulu!'); return; }
      const now = Date.now();
      const data = {
        name: userData.username || 'Admin',
        msg: msg2,
        createdAt: now,
        expireAt: now + 15000
      };
      db.ref('adminFloatChat/current').set(data).then(() => {
        showToast('Chat admin dikirim');
        inp.value = '';
      });
    }

    function adSendNotif() {
      const type = document.getElementById('adNType').value;
      const target = document.getElementById('adNTarget').value.trim();
      const msg2 = document.getElementById('adNMsg').value.trim();
      if (!msg2) { showToast('Isi pesan dulu!'); return; }
      const payload = { type, text: msg2, fromName: 'Admin', timestamp: Date.now() };
      if (target) {
        db.ref('users/' + target + '/notifications')
          .push(payload)
          .then(() => showToast('✅ Notif terkirim ke ' + target));
      } else {
        db.ref('users').once('value').then(snap => {
          const users = snap.val() || {};
          const uids = Object.keys(users);
          if (!uids.length) return;
          const ops = uids.map(uid =>
            db.ref('users/' + uid + '/notifications').push(payload)
          );
          return Promise.all(ops);
        }).then(() => {
          addLog('Global notif: ' + msg2);
          showToast('✅ Global notif terkirim!');
          document.getElementById('adNMsg').value = '';
        });
      }
    }

    function adSetUserTag(uid, tag) {
      const updates = {};
      updates['users/' + uid + '/tag'] = tag || 'none';
      if (tag && tag !== 'none') {
        updates['users/' + uid + '/alltag/' + tag] = true;
      }
      db.ref().update(updates).then(() => {
        addLog('Tag: ' + uid + ' → ' + (tag || 'none'));
        showToast('Tag diubah!');
      });
    }

    function adSaveTagDrop() {
      const nameInp = document.getElementById('adTagDropName');
      const chInp = document.getElementById('adTagDropChance');
      const durInp = document.getElementById('adTagDropDuration');
      const maxInp = document.getElementById('adTagDropMax');
      if (!nameInp || !chInp || !durInp || !maxInp) return;
      const tag = nameInp.value.trim().toLowerCase();
      let chance = parseFloat(chInp.value);
      if (!tag) {
        msg('Tag tidak boleh kosong');
        return;
      }
      if (isNaN(chance) || chance <= 0) chance = 0;
      if (chance > 100) chance = 100;
      let durationSec = parseInt(durInp.value, 10);
      if (isNaN(durationSec) || durationSec < 10) durationSec = 1800;
      let maxWinners = parseInt(maxInp.value, 10);
      if (isNaN(maxWinners) || maxWinners < 0) maxWinners = 0;
      const active = chance > 0;
      const now = Date.now();
      const endAt = active ? now + durationSec * 1000 : 0;
      const data = {
        active,
        tag,
        chance: chance / 100,
        durationSec,
        maxWinners,
        desc: 'Event tag drop dimulai oleh admin',
        startedBy: auth.currentUser ? (userData && userData.username) : 'Admin',
        startedAt: now,
        endAt,
        obtainedCount: 0
      };
      db.ref('settings/tagDrop').set(data).then(() => {
        showToast('Event tag drop diupdate');
        if (active) {
          const msg2 = `Event tag drop ${tag.toUpperCase()} has started by ${data.startedBy}`;
          const payload = { type: 'event', text: msg2, timestamp: now, fromName: data.startedBy };
          db.ref('globalNotifications').push(payload);
        }
      });
    }
    function adClearTagDrop() {
      db.ref('settings/tagDrop').remove().then(() => {
        const statusEl = document.getElementById('adTagDropStatus');
        if (statusEl) statusEl.textContent = 'Event OFF';
        showToast('Event tag drop dimatikan');
      });
    }
    function adPreviewTagDrop() {
      const chInp = document.getElementById('adTagDropChance');
      if (!chInp) return;
      const chance = parseFloat(chInp.value) || 0;
      msg('Simulasi chance sekitar ' + chance.toFixed(1) + '% per tick untuk user online');
    }

    function adOpenUserTools(uid, name) {
      const html = `
        <div style="text-align:left; display:flex; flex-direction:column; gap:14px">
          <p style="color:#888; font-size:12px; font-family:'JetBrains Mono',monospace">${uid}</p>
          <div>
            <div style="font-size:11px;color:#666;margin-bottom:6px;font-weight:700">VIP MANAGEMENT</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="swal2-confirm swal2-styled" style="background:#ffc107;color:#000;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adAddPermanentVip('${uid}')">+ VIP PERMANENT</button>
              <button class="swal2-confirm swal2-styled" style="background:#1976d2;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adAddTrialVip('${uid}')">+ VIP TRIAL</button>
              <button class="swal2-confirm swal2-styled" style="background:#c62828;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adRemoveVip('${uid}')">REMOVE VIP</button>
              <button class="swal2-confirm swal2-styled" style="background:#555;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adRemoveTrialVip('${uid}')">REMOVE TRIAL</button>
            </div>
          </div>
          <div>
            <div style="font-size:11px;color:#666;margin-bottom:6px;font-weight:700">FOLLOWERS</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="swal2-confirm swal2-styled" style="background:#2e7d32;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adFakeDelta('${uid}',1)">+1</button>
              <button class="swal2-confirm swal2-styled" style="background:#2e7d32;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adFakeDelta('${uid}',5)">+5</button>
              <button class="swal2-confirm swal2-styled" style="background:#2e7d32;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adFakeDelta('${uid}',10)">+10</button>
              <button class="swal2-confirm swal2-styled" style="background:#c62828;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adFakeDelta('${uid}',-1)">-1</button>
              <button class="swal2-confirm swal2-styled" style="background:#c62828;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adFakeDelta('${uid}',-5)">-5</button>
              <button class="swal2-confirm swal2-styled" style="background:#555;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adClearFake('${uid}')">CLEAR FAKE</button>
            </div>
          </div>
          <div>
            <div style="font-size:11px;color:#666;margin-bottom:6px;font-weight:700">LAINNYA</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap">
              <button class="swal2-confirm swal2-styled" style="background:#388e3c;color:#fff;padding:8px 12px;font-size:12px;border:none;border-radius:8px;cursor:pointer" onclick="adResetCD('${uid}')">RESET COOLDOWN</button>
            </div>
          </div>
        </div>`;
      Swal.fire({ title: '⚙️ Tools: ' + name, html, background: '#0d0d15', color: '#fff', showConfirmButton: false, showCloseButton: true, width: '90%', maxWidth: '420px' });
    }

    function adAddPermanentVip(uid) {
      Swal.fire({ title: 'Tambah VIP Permanent?', icon: 'question', showCancelButton: true, confirmButtonColor: '#ffc107', background: '#0d0d15', color: '#fff' })
        .then(r => { if (r.isConfirmed) { db.ref('users/' + uid).update({ vip: true }).then(() => { addLog('Perm VIP: ' + uid); showToast('✅ VIP Permanent ditambahkan!'); adLoadData(); }); } });
    }

    function adAddTrialVip(uid) {
      Swal.fire({ title: 'VIP Trial (hari)', input: 'number', inputLabel: 'Berapa hari?', inputAttributes: { min: 1, max: 365 }, background: '#0d0d15', color: '#fff' })
        .then(r => {
          const d = parseInt(r.value, 10); if (!d || d <= 0) return;
          const expireAt = Date.now() + d * 24 * 60 * 60 * 1000;
          db.ref('users/' + uid + '/trialvip').set({ expireAt }).then(() => { addLog('TrialVIP ' + d + 'd: ' + uid); showToast('✅ VIP Trial ' + d + ' hari!'); adLoadData(); });
        });
    }

    function adRemoveVip(uid) {
      db.ref('users/' + uid).update({ vip: null }).then(() => { addLog('Remove VIP: ' + uid); showToast('VIP dihapus'); adLoadData(); });
    }

    function adRemoveTrialVip(uid) {
      db.ref('users/' + uid + '/trialvip').remove().then(() => { addLog('Remove TrialVIP: ' + uid); showToast('Trial VIP dihapus'); adLoadData(); });
    }

    function adFakeDelta(uid, delta) {
      db.ref('users/' + uid).once('value').then(s => {
        const u = s.val() || {};
        let fol = Array.isArray(u.followers) ? [...u.followers] : (u.followers && typeof u.followers === 'object' ? Object.keys(u.followers) : []);
        if (delta > 0) {
          for (let i = 0; i < delta; i++) fol.push('fake_' + Math.floor(Math.random() * 9999999));
        } else {
          let rem = Math.abs(delta);
          for (let i = fol.length - 1; i >= 0 && rem > 0; i--) {
            if (String(fol[i]).startsWith('fake_')) { fol.splice(i, 1); rem--; }
          }
        }
        db.ref('users/' + uid).update({ followers: fol }).then(() => {
          addLog('Followers delta ' + delta + ': ' + uid);
          showToast('Followers diubah ' + (delta > 0 ? '+' : '') + delta);
          if (delta > 0) {
            updateQuestProgress('daily', 'daily_follower_boost', delta, uid);
            updateQuestProgress('weekly', 'weekly_followers_20', delta, uid);
            updateQuestProgress('weekly', 'weekly_followers_50', delta, uid);
          }
          adLoadData();
        });
      });
    }

    function adClearFake(uid) {
      db.ref('users/' + uid).once('value').then(s => {
        const u = s.val() || {};
        let fol = Array.isArray(u.followers) ? [...u.followers] : (u.followers && typeof u.followers === 'object' ? Object.keys(u.followers) : []);
        fol = fol.filter(f => !String(f).startsWith('fake_'));
        db.ref('users/' + uid).update({ followers: fol, fakeFollowerTarget: null, fakeFollowerAdded: null }).then(() => { addLog('Clear fake fol: ' + uid); showToast('Fake followers dihapus'); adLoadData(); });
      });
    }
    
    // ============================================================
    // FAKE FOLLOWER AUTO-GROW SYSTEM
    // ============================================================
    let fakeFollowerInterval = null;
    
    function adSetFakeFollowerTarget(uid) {
      Swal.fire({
        title: 'Set Fake Follower Target',
        html: `<p style="color:#aaa;font-size:12px;margin-bottom:15px">Masukkan jumlah fake followers yang ingin ditambahkan secara bertahap</p>
               <input type="number" id="fakeTargetNum" class="swal2-input" placeholder="Contoh: 5" min="1" max="100">
               <p style="color:#666;font-size:11px;margin-top:10px">Akan menambah 1-2 follower setiap beberapa jam</p>`,
        background: '#0d0d15',
        color: '#fff',
        confirmButtonText: 'Set Target',
        confirmButtonColor: '#22c55e',
        cancelButtonText: 'Batal',
        showCancelButton: true,
        preConfirm: () => {
          const num = document.getElementById('fakeTargetNum').value;
          return parseInt(num) || null;
        }
      }).then(r => {
        if (r.isConfirmed && r.value) {
          const target = parseInt(r.value);
          db.ref('users/' + uid).update({ 
            fakeFollowerTarget: target,
            fakeFollowerAdded: 0
          }).then(() => {
            addLog('Fake follower target set: ' + uid + ' = ' + target);
            showToast(`✅ Target: ${target} fake followers`);
            adLoadData();
          });
        }
      });
    }
    
    function adCancelFakeTarget(uid) {
      db.ref('users/' + uid).update({ fakeFollowerTarget: null, fakeFollowerAdded: null }).then(() => {
        addLog('Fake follower target cancelled: ' + uid);
        showToast('Target fake follower dibatalkan');
        adLoadData();
      });
    }
    
    // Generate fake follower name
    function generateFakeFollower() {
      const names = ['User', 'Musik', 'Lagu', 'Exe', 'Music', 'Song', 'Artist', 'Creator', 'Fans', 'Listener', 'Melody', 'Beat', 'Tune', 'Rhythm', 'Vibe', 'Groove', 'Sound', 'Audio', 'Track', 'Play'];
      const suffix = Math.floor(Math.random() * 9000) + 1000;
      return 'fake_' + names[Math.floor(Math.random() * names.length)] + suffix;
    }
    
    // Process fake follower targets (runs periodically)
    function processFakeFollowerTargets() {
      db.ref('users').once('value').then(snap => {
        const users = snap.val() || {};
        Object.keys(users).forEach(uid => {
          const u = users[uid];
          const target = u.fakeFollowerTarget;
          const added = u.fakeFollowerAdded || 0;
          
          if (target && added < target) {
            // Add 1-2 fake followers
            const toAdd = Math.floor(Math.random() * 2) + 1; // 1 or 2
            const actuallyAdd = Math.min(toAdd, target - added);
            
            let currentFol = Array.isArray(u.followers) ? [...u.followers] : (u.followers && typeof u.followers === 'object' ? Object.keys(u.followers) : []);
            
            // Add new fake followers
            for (let i = 0; i < actuallyAdd; i++) {
              currentFol.push(generateFakeFollower());
            }
            
            db.ref('users/' + uid).update({
              followers: currentFol,
              fakeFollowerAdded: added + actuallyAdd
            }).then(() => {
              console.log(`Added ${actuallyAdd} fake followers to ${uid}. Progress: ${added + actuallyAdd}/${target}`);
            });
          }
        });
      });
    }
    
    // Start fake follower scheduler (check every 3 hours)
    function startFakeFollowerScheduler() {
      if (fakeFollowerInterval) clearInterval(fakeFollowerInterval);
      // Check every 3 hours (10800000 ms)
      fakeFollowerInterval = setInterval(processFakeFollowerTargets, 10800000);
      // Also run once on startup (delayed by 10 seconds)
      setTimeout(processFakeFollowerTargets, 10000);
    }
    
    // Initialize on page load
    window.addEventListener('load', () => {
      // Start fake follower scheduler
      setTimeout(startFakeFollowerScheduler, 5000);
      // Check heart theme
      setTimeout(checkHeartTheme, 3000);
    });

    function adResetCD(uid) { db.ref('users/' + uid + '/lastUpload').remove().then(() => { addLog('Reset CD: ' + uid); showToast('Cooldown direset!'); }); }
    function adToggleBan(uid, status) { db.ref('users/' + uid).update({ banned: !status }).then(() => { addLog((status ? 'Unban' : 'Ban') + ': ' + uid); showToast((status ? 'Unbanned' : 'Banned') + '!'); adLoadData(); }); }

    // VISUAL / DISCO
    let discoInterval = null;
    function adSetAccent(color) {
      if (!color || !color.startsWith('#')) { showToast('Format warna salah (gunakan #hex)'); return; }
      db.ref('settings').update({ accentColor: color });
      document.documentElement.style.setProperty('--accent', color);
      addLog('Accent color: ' + color);
      showToast('Warna accent diubah: ' + color);
    }

    function adStartDisco() {
      const variant = document.getElementById('adDiscoVariant').value;
      const color = document.getElementById('adDiscoColor').value || '#00ff88';
      db.ref('settings').update({ discoMode: true, discoVariant: variant, discoColor: color });
      applyDiscoMode(variant, color);
      addLog('Disco start: ' + variant);
      showToast('🎉 Disco Mode ON!');
    }
    function adStopDisco() {
      db.ref('settings').update({ discoMode: false });
      if (discoInterval) { clearInterval(discoInterval); discoInterval = null; }
      document.documentElement.style.setProperty('--accent', '#00ff88');
      addLog('Disco stop');
      showToast('Disco OFF');
    }

    // RAMADHAN THEME
    let ramadanActive = false;
    let ramadanDecorations = [];
    
    function toggleRamadanTheme() {
      ramadanActive = !ramadanActive;
      const btn = document.getElementById('ramadanToggleBtn');
      const headerBtn = document.getElementById('btnRamadanTheme');
      
      if (ramadanActive) {
        // ON - Apply Ramadan theme globally
        if (btn) { btn.textContent = 'ON'; btn.style.background = 'linear-gradient(135deg,#ffd700,#00ff88)'; btn.style.color = '#000'; }
        if (headerBtn) { headerBtn.style.background = 'linear-gradient(135deg,rgba(255,215,0,0.3),rgba(0,255,136,0.2))'; headerBtn.style.borderColor = '#ffd700'; headerBtn.style.color = '#ffd700'; }
        document.body.classList.add('ramadan-active');
        createRamadanDecorations();
        showToast('🕌 Ramadan Theme ON!');
        addLog('Ramadan theme activated');
      } else {
        // OFF - Remove Ramadan theme
        if (btn) { btn.textContent = 'OFF'; btn.style.background = ''; btn.style.color = ''; }
        if (headerBtn) { headerBtn.style.background = ''; headerBtn.style.borderColor = ''; headerBtn.style.color = ''; }
        document.body.classList.remove('ramadan-active');
        removeRamadanDecorations();
        showToast('Ramadan Theme OFF');
        addLog('Ramadan theme deactivated');
      }
      // Save to Firebase for global theme
      db.ref('settings').update({ ramadanTheme: ramadanActive });
    }
    
    function createRamadanDecorations() {
      // Remove existing decorations
      removeRamadanDecorations();
      
      // Create moon (top left)
      const moon = document.createElement('div');
      moon.className = 'ramadan-decoration ramadan-moon';
      moon.textContent = '🌙';
      moon.style.top = '10%';
      moon.style.left = '10%';
      moon.style.opacity = '1';
      document.body.appendChild(moon);
      ramadanDecorations.push(moon);
      
      // Create mosque (bottom left)
      const mosque = document.createElement('div');
      mosque.className = 'ramadan-decoration ramadan-mosque';
      mosque.textContent = '🕌';
      mosque.style.bottom = '15%';
      mosque.style.left = '8%';
      mosque.style.opacity = '1';
      document.body.appendChild(mosque);
      ramadanDecorations.push(mosque);
      
      // Create ketupat (top right)
      const ketupat1 = document.createElement('div');
      ketupat1.className = 'ramadan-decoration ramadan-ketupat';
      ketupat1.textContent = '🎋';
      ketupat1.style.top = '15%';
      ketupat1.style.right = '12%';
      ketupat1.style.opacity = '1';
      document.body.appendChild(ketupat1);
      ramadanDecorations.push(ketupat1);
      
      // Create ketupat (bottom right)
      const ketupat2 = document.createElement('div');
      ketupat2.className = 'ramadan-decoration ramadan-ketupat';
      ketupat2.textContent = '🎋';
      ketupat2.style.bottom = '20%';
      ketupat2.style.right = '15%';
      ketupat2.style.opacity = '1';
      ketupat2.style.animationDelay = '3s';
      document.body.appendChild(ketupat2);
      ramadanDecorations.push(ketupat2);
    }
    
    function removeRamadanDecorations() {
      ramadanDecorations.forEach(el => el.remove());
      ramadanDecorations = [];
    }
    
    function applyRamadanTheme() {
      if (ramadanActive && !document.body.classList.contains('ramadan-active')) {
        document.body.classList.add('ramadan-active');
        createRamadanDecorations();
      }
    }

    function applyDiscoMode(variant, color) {
      const c = color || '#00ff88';
      if (discoInterval) { clearInterval(discoInterval); discoInterval = null; }
      if (variant === 'rainbow') {
        const cols = ['#00ff88','#00d4ff','#ff0050','#ffd700','#bf00ff','#ff69b4'];
        let ci = 0;
        discoInterval = setInterval(() => { document.documentElement.style.setProperty('--accent', cols[ci++ % cols.length]); }, 600);
      } else if (variant === 'heartbeat') {
        let tog = false;
        discoInterval = setInterval(() => { document.documentElement.style.setProperty('--accent', tog ? c : '#ffffff'); tog = !tog; }, 800);
      } else if (variant === 'ice') {
        document.documentElement.style.setProperty('--accent', '#00d4ff');
      } else {
        document.documentElement.style.setProperty('--accent', c);
      }
    }

    function openCopyUrlCard() {
      document.getElementById('adCopySongId').value = '';
      document.getElementById('adCopyUrlText').textContent = 'Ketik ID lagu dulu';
      document.getElementById('modalAdminCopyUrl').style.display = 'block';
    }
    function adUpdateDeepLink(v) {
      const base = window.location.origin + window.location.pathname;
      document.getElementById('adCopyUrlText').textContent = v ? base + '?id=' + encodeURIComponent(v) : base;
    }
    function adCopyDeepLink() {
      const t = document.getElementById('adCopyUrlText').textContent;
      if (!t || t === 'Ketik ID lagu dulu') { showToast('Isi ID dulu'); return; }
      navigator.clipboard.writeText(t).then(() => showToast('URL disalin!')); document.getElementById('modalAdminCopyUrl').style.display = 'none';
    }
  </script>
</body>
</html>
